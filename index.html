<!DOCTYPE html>
<html lang="sv">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CP3TPCPMEB"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-CP3TPCPMEB');
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tarawih Schema ‚Äî K√§mpingehallen | Ramadan 2026</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600&family=Share+Tech+Mono&display=swap" rel="stylesheet" />
  <link href="https://fonts.cdnfonts.com/css/digital-7-mono" rel="stylesheet">
  <style>
    /* ‚îÄ‚îÄ IMAM COLOURS ‚Äî unchanged in both themes ‚îÄ‚îÄ */
    :root {
      --gold: #c9a84c;
      --gold-light: #e8c97a;
      --today-green: #3dba7e;
      --abdurrahman: #e8630a;
      --saed: #d4a800;
      --noor: #2980b9;
      --abdul: #2c2c2c;
      --mohammed: #219150;
      --yacquub: #7d3aac;
      --abdelsalam: #7b3f00;
      --hatem: #2d6a4f;
      --ibrahim: #1a3a6b;

      --bg:              #f7f4ef;
      --surface:         #ffffff;
      --surface-2:       #f0ece4;
      --border:          rgba(36,100,93,0.10);
      --border-subtle:   rgba(36,100,93,0.07);
      --text:            #1a1a1a;
      --muted:           #6b7280;
      --muted-2:         #9ca3af;
      --primary:         #24645d;
      --primary-dark:    #1a4a44;
      --today-bg:        #e8f7f0;
      --row-hover:       rgba(36,100,93,0.04);
      --chip-bg:         #ffffff;
      --chip-shadow:     0 2px 8px rgba(0,0,0,0.06);
      --table-shadow:    0 6px 32px rgba(36,100,93,0.12);
      --card-shadow:     0 2px 4px rgba(0,0,0,0.04), 0 8px 24px rgba(36,100,93,0.10), 0 24px 48px rgba(36,100,93,0.06);
      --mobile-shadow:   0 2px 12px rgba(36,100,93,0.08);
      --info-gap:        rgba(36,100,93,0.07);
      --cell-bg:         #ffffff;
      --countdown-bg:    rgba(36,100,93,0.04);
      --countdown-bdr:   rgba(36,100,93,0.09);
      --notif-border:    rgba(36,100,93,0.20);
      --dcm-pages-bg:    rgba(36,100,93,0.08);
      --dcm-surahs-bg:   rgba(36,100,93,0.06);
      --fredag-clr:      #b45309;
      --lordag-clr:      #1a4a44;
      --header-bg:       #24645d;
      --header-a-bg:     #ffffff;
      --header-a-clr:    #1a4a44;
      --wave-fill:       #24645d;
      --footer-bg:       #1a4a44;
      --legend-bg:       #ffffff;
      --ios-track-off:   #e5e5ea;
      --ios-track-on:    #34c759;
      --ios-thumb:       #ffffff;
    }

    [data-theme="dark"] {
      --bg:              #0f1614;
      --surface:         #1a2420;
      --surface-2:       #222e2a;
      --border:          rgba(255,255,255,0.07);
      --border-subtle:   rgba(255,255,255,0.05);
      --text:            #e8e3db;
      --muted:           #8a9490;
      --muted-2:         #5a6662;
      --primary:         #2d7a72;
      --primary-dark:    #3a9088;
      --today-bg:        rgba(45,122,114,0.18);
      --row-hover:       rgba(255,255,255,0.03);
      --chip-bg:         #1e2c28;
      --chip-shadow:     0 2px 8px rgba(0,0,0,0.30);
      --table-shadow:    0 6px 32px rgba(0,0,0,0.40);
      --card-shadow:     0 2px 4px rgba(0,0,0,0.20), 0 8px 24px rgba(0,0,0,0.30), 0 24px 48px rgba(0,0,0,0.20);
      --mobile-shadow:   0 2px 12px rgba(0,0,0,0.30);
      --info-gap:        rgba(255,255,255,0.06);
      --cell-bg:         #1a2420;
      --countdown-bg:    rgba(255,255,255,0.04);
      --countdown-bdr:   rgba(255,255,255,0.08);
      --notif-border:    rgba(255,255,255,0.12);
      --dcm-pages-bg:    rgba(255,255,255,0.07);
      --dcm-surahs-bg:   rgba(255,255,255,0.05);
      --fredag-clr:      #e09840;
      --lordag-clr:      #7ecec8;
      --header-bg:       linear-gradient(145deg, rgba(10,26,20,0.99) 0%, rgba(14,36,28,0.99) 40%, rgba(18,48,38,0.99) 70%, rgba(24,64,54,0.99) 100%);
      --header-a-bg:     rgba(255,255,255,0.10);
      --header-a-clr:    rgba(255,255,255,0.88);
      --wave-fill:       #131f1b;
      --footer-bg:       #0d1714;
      --legend-bg:       #1e2c28;
      --ios-track-off:   #3a3a3c;
      --ios-track-on:    #30d158;
      --ios-thumb:       #ffffff;
    }

    html { scrollbar-gutter: stable; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: var(--bg); font-family: 'DM Sans', sans-serif; color: var(--text); -webkit-text-size-adjust: 100%; transition: background 0.35s ease, color 0.35s ease; }

    /* ‚ïê‚ïê iOS TOGGLE ‚ïê‚ïê */
    .theme-toggle {
      position: absolute; top: 10px; right: 12px; z-index: 10;
      display: inline-flex; align-items: center;
      background: none; border: none; padding: 0;
      cursor: pointer; font-family: inherit;
      -webkit-tap-highlight-color: transparent;
    }
    .ios-track {
      position: relative; width: 76px; height: 30px; border-radius: 999px;
      background: #e8e8e8;
      box-shadow: 0 3px 8px rgba(0,0,0,0.30), inset 0 1px 2px rgba(255,255,255,0.6), inset 0 -1px 2px rgba(0,0,0,0.12);
      flex-shrink: 0;
      transition: background 0.38s cubic-bezier(0.4,0,0.2,1), box-shadow 0.38s ease;
      overflow: hidden;
    }
    [data-theme="dark"] .ios-track {
      background: #1c1c1e;
      box-shadow: 0 3px 8px rgba(0,0,0,0.50), inset 0 1px 3px rgba(255,255,255,0.04), inset 0 -1px 3px rgba(0,0,0,0.5);
    }
    .ios-track-label {
      position: absolute; top: 50%; left: 0; right: calc(24px + 3px);
      transform: translateY(-50%);
      font-size: 0.38rem; font-weight: 800; letter-spacing: 0.08em;
      text-transform: uppercase; line-height: 1.2; text-align: center;
      pointer-events: none; white-space: nowrap; user-select: none;
      color: rgba(70,70,70,0.80); transition: color 0.3s ease, left 0s, right 0s;
    }
    [data-theme="dark"] .ios-track-label { left: calc(24px + 3px); right: 0; color: rgba(160,160,160,0.70); }
    .ios-thumb {
      position: absolute; top: 3px; left: calc(100% - 3px - 24px);
      width: 24px; height: 24px; border-radius: 50%;
      background: radial-gradient(circle at 38% 35%, #4a4a4a, #1a1a1a);
      box-shadow: 0 2px 6px rgba(0,0,0,0.50), 0 1px 2px rgba(0,0,0,0.35), inset 0 1px 1px rgba(255,255,255,0.08);
      transition: left 0.38s cubic-bezier(0.34,1.45,0.64,1), width 0.10s ease;
      will-change: left; z-index: 2;
      display: flex; align-items: center; justify-content: center;
    }
    [data-theme="dark"] .ios-thumb { left: 3px; background: radial-gradient(circle at 38% 35%, #555, #222); }
    .ios-thumb-icon { position: absolute; display: flex; align-items: center; justify-content: center; transition: opacity 0.28s ease, transform 0.32s cubic-bezier(0.34,1.56,0.64,1); }
    .ios-thumb-sun  { opacity: 1;  transform: scale(1)   rotate(0deg); }
    .ios-thumb-moon { opacity: 0;  transform: scale(0.5) rotate(-30deg); }
    [data-theme="dark"] .ios-thumb-sun  { opacity: 0;  transform: scale(0.5) rotate(30deg); }
    [data-theme="dark"] .ios-thumb-moon { opacity: 1;  transform: scale(1)   rotate(0deg); }
    .theme-toggle:active .ios-thumb { width: 28px; }
    [data-theme="dark"] .theme-toggle:active .ios-thumb { width: 28px; left: 3px; }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    header { background: var(--header-bg); padding: 28px 20px 22px; text-align: center; position: relative; overflow: hidden; transition: background 0.35s ease; }
    header::before { content: ''; position: absolute; inset: 0; background: radial-gradient(ellipse at 15% 60%, rgba(201,168,76,0.14) 0%, transparent 55%); pointer-events: none; }
    [data-theme="dark"] header::before { background: radial-gradient(ellipse at 80% 25%, rgba(201,168,76,0.09) 0%, transparent 55%), radial-gradient(ellipse at 15% 70%, rgba(36,100,93,0.18) 0%, transparent 40%); }
    .ornament { display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 20px; position: relative; z-index: 2; }
    .orn-line { height: 1px; width: 50px; }
    .orn-line.l { background: linear-gradient(to right, transparent, var(--gold)); }
    .orn-line.r { background: linear-gradient(to left, transparent, var(--gold)); }
    .orn-diamond { width: 7px; height: 7px; background: var(--gold); transform: rotate(45deg); }
    .orn-dot { width: 3px; height: 3px; background: var(--gold-light); border-radius: 50%; }
    header h1 { font-family: 'Cormorant Garamond', serif; font-size: clamp(1.8rem, 6vw, 3.2rem); font-weight: 600; color: #ffffff; letter-spacing: .03em; line-height: 1.2; position: relative; z-index: 2; }
    .header-address { margin-top: 20px; position: relative; z-index: 2; display: flex; flex-direction: column; align-items: center; gap: 10px; }
    .header-address .addr-text { display: flex; align-items: center; gap: 6px; color: rgba(255,255,255,.65); font-size: .82rem; }
    .header-address a { display: inline-flex; align-items: center; gap: 6px; background: var(--header-a-bg); color: var(--header-a-clr); font-size: .75rem; font-weight: 600; letter-spacing: .08em; text-transform: uppercase; padding: 7px 18px; border-radius: 30px; text-decoration: none; box-shadow: 0 2px 12px rgba(0,0,0,.15); transition: background 0.35s, color 0.35s; }
    .wave { background: var(--header-bg); line-height: 0; transition: background 0.35s; }
    .wave svg { display: block; width: 100%; }

    /* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
    main { max-width: 960px; margin: 0 auto; padding: 32px 14px 80px; }
    @media (min-width: 641px) {
      main { max-width: 100%; padding: 32px 32px 80px; }
      .table-wrap table { width: 100%; table-layout: auto; }
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       TODAY CARD
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .today-card-top { position: relative; padding: 22px 28px 20px; background: linear-gradient(145deg, rgba(15,40,50,0.97) 0%, rgba(20,58,52,0.97) 40%, rgba(26,74,68,0.95) 70%, rgba(36,100,93,0.93) 100%); overflow: hidden; }
    .today-card-top::before { content: ''; position: absolute; inset: 0; background: radial-gradient(ellipse at 80% 20%, rgba(201,168,76,0.08) 0%, transparent 55%), radial-gradient(ellipse at 20% 80%, rgba(36,100,93,0.15) 0%, transparent 45%); pointer-events: none; }
    .today-card-top::after { content: ''; position: absolute; inset: 0; opacity: 0.025; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E"); background-size: 128px; pointer-events: none; }
    .today-badge-pill { position: relative; z-index: 2; display: inline-flex; align-items: center; gap: 5px; background: rgba(201,168,76,0.15); border: 1px solid rgba(201,168,76,0.30); border-radius: 100px; padding: 4px 12px; margin-bottom: 10px; }
    .today-badge-pill-dot { width: 5px; height: 5px; border-radius: 50%; background: var(--gold-light); flex-shrink: 0; box-shadow: 0 0 5px rgba(201,168,76,0.6); }
    .today-badge-pill-text { font-size: 0.60rem; font-weight: 600; letter-spacing: 0.14em; text-transform: uppercase; color: var(--gold-light); }
    .today-card-header-content { position: relative; z-index: 2; }
    .today-imam-name { font-family: 'Cormorant Garamond', serif; font-size: clamp(1.65rem, 5vw, 2.2rem); font-weight: 600; color: #ffffff; line-height: 1.1; letter-spacing: 0.01em; margin-bottom: 6px; display: block; }
    .today-date-row { display: flex; align-items: center; gap: 8px; }
    .today-date-text { font-size: 0.82rem; color: rgba(255,255,255,0.55); font-weight: 400; letter-spacing: 0.02em; }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       MOON ICON ‚Äî unchanged glow animations
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .today-moon-wrap { position: relative; display: inline-flex; align-items: center; }
    .today-moon-icon {
      display: inline-flex; align-items: center; justify-content: center;
      width: 22px; height: 22px; border-radius: 50%;
      background: rgba(15, 45, 94, 0.5);
      border: 1.5px solid rgba(255,255,255,0.2);
      cursor: pointer;
      animation: moonPulseBlue 2s ease-in-out infinite;
    }
    .today-moon-icon.moon-odd-today {
      background: linear-gradient(135deg, #9a6f0a, #c9a84c);
      border-color: rgba(255,220,100,0.4);
      animation: moonGlow 2.2s ease-in-out infinite;
    }
    @keyframes moonPulseBlue {
      0%, 100% { box-shadow: 0 0 0 0 rgba(58,123,213,0.5); }
      50% { box-shadow: 0 0 0 6px rgba(58,123,213,0); }
    }
    @keyframes moonGlow {
      0%,100% { box-shadow: 0 0 4px 1px rgba(201,168,76,0.6), 0 0 10px 2px rgba(201,168,76,0.35), 0 0 22px 4px rgba(201,168,76,0.15); }
      50% { box-shadow: 0 0 8px 3px rgba(232,201,122,0.85), 0 0 18px 6px rgba(201,168,76,0.55), 0 0 36px 10px rgba(201,168,76,0.22); }
    }

    .today-card-body { padding: 16px 28px 20px; display: flex; flex-direction: column; gap: 0; background: var(--surface); transition: background 0.35s; }
    .today-info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1px; background: var(--info-gap); border-radius: 14px; overflow: hidden; margin-bottom: 14px; transition: background 0.35s; }
    .today-info-cell { background: var(--cell-bg); padding: 12px 16px; transition: background 0.35s; }
    .today-info-cell:first-child { border-radius: 14px 0 0 14px; }
    .today-info-cell:last-child  { border-radius: 0 14px 14px 0; }
    /* Grid h√•ller alltid 2 kolumner ‚Äî suror-cellen expanderar vid behov */
    /* Expanderbar suror-cell */
    .surahs-cell { cursor: default; }
    .surahs-cell.expandable { cursor: pointer; }
    .surahs-value-wrap {
      position: relative;
    }
    .surahs-value-wrap.collapsed {
      max-height: 3.6em;
      overflow: hidden;
    }
    .surahs-value-wrap.collapsed::after {
      content: '';
      position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 1.8em;
      background: linear-gradient(to bottom, transparent, var(--cell-bg));
      pointer-events: none;
      transition: background 0.35s;
    }
    .surahs-expand-hint {
      display: none;
      font-size: 0.60rem; font-weight: 600; letter-spacing: 0.08em;
      text-transform: uppercase; color: var(--primary-dark);
      margin-top: 6px; opacity: 0.6;
    }
    .surahs-cell.expandable .surahs-expand-hint { display: block; }
    .surahs-cell.expanded .surahs-value-wrap { max-height: none; overflow: visible; }
    .surahs-cell.expanded .surahs-value-wrap::after { display: none; }
    .surahs-cell.expanded .surahs-expand-hint { opacity: 0.4; }

    .today-info-label { font-size: 0.60rem; font-weight: 600; letter-spacing: 0.13em; text-transform: uppercase; color: var(--muted); display: block; margin-bottom: 5px; transition: color 0.35s; }
    .today-info-value { font-family: 'Cormorant Garamond', serif; font-size: 1.35rem; font-weight: 600; color: var(--primary-dark); line-height: 1.2; display: block; transition: color 0.35s; }
    .today-info-sub { font-size: 0.75rem; color: var(--muted); margin-top: 3px; display: block; line-height: 1.4; transition: color 0.35s; }

    .today-countdown-section { display: none; background: var(--countdown-bg); border: 1px solid var(--countdown-bdr); border-radius: 14px; padding: 13px 16px; margin-bottom: 14px; transition: background 0.8s ease, border-color 0.8s ease, box-shadow 0.8s ease; }
    .today-countdown-section.isha-done { background: rgba(36,186,120,0.08); border-color: rgba(36,186,120,0.25); }
    @keyframes ishaGlow { 0% { box-shadow: 0 0 0 0 rgba(61,186,126,0); } 20% { box-shadow: 0 0 0 8px rgba(61,186,126,0.18); } 50% { box-shadow: 0 0 0 16px rgba(61,186,126,0.08); } 80% { box-shadow: 0 0 0 8px rgba(61,186,126,0.12); } 100% { box-shadow: 0 0 0 0 rgba(61,186,126,0); } }
    .today-countdown-section.isha-pulsing { animation: ishaGlow 1.6s ease-out 3; }
    .today-countdown-inner { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
    .today-countdown-left { flex: 1; min-width: 0; }
    .today-countdown-label { font-size: 0.60rem; font-weight: 600; letter-spacing: 0.13em; text-transform: uppercase; color: var(--muted); display: block; margin-bottom: 6px; transition: color 0.6s ease; }
    .isha-done .today-countdown-label { color: #1d7a4e; }
    .timer-wrap { position: relative; min-height: 2.2rem; display: flex; align-items: center; }
    .today-timer { font-family: 'Digital-7 Mono', 'Digital-7', monospace; font-size: 2.0rem; font-weight: 400; color: var(--primary-dark); letter-spacing: 0.05em; line-height: 1; transition: opacity 0.5s ease, transform 0.5s ease, color 0.35s; }
    .today-timer.fading-out { opacity: 0; transform: translateY(-6px); pointer-events: none; }
    .today-timer-done { position: absolute; left: 0; font-family: 'DM Sans', sans-serif; font-size: 1.05rem; font-weight: 600; color: #1d7a4e; opacity: 0; transform: translateY(6px); transition: opacity 0.5s ease 0.3s, transform 0.5s ease 0.3s; white-space: nowrap; }
    .today-timer-done.fading-in { opacity: 1; transform: translateY(0); }
    .today-countdown-sub { font-size: 0.72rem; color: var(--muted); margin-top: 6px; display: block; transition: color 0.6s ease; }
    .isha-done .today-countdown-sub { color: #2d9e6b; }

    .notif-btn { display: inline-flex; align-items: center; gap: 6px; background: none; border: 1px solid var(--notif-border); border-radius: 100px; padding: 5px 12px; font-size: 0.68rem; font-weight: 500; font-family: inherit; color: var(--muted); cursor: pointer; white-space: nowrap; transition: border-color 0.2s, color 0.2s, background 0.2s; flex-shrink: 0; align-self: flex-start; }
    .notif-btn:hover { border-color: var(--primary); color: var(--primary-dark); background: var(--row-hover); }
    .notif-btn.granted { border-color: rgba(36,186,120,0.35); color: #1d7a4e; background: rgba(36,186,120,0.06); cursor: default; pointer-events: none; }
    .notif-btn.denied { opacity: 0.4; cursor: not-allowed; pointer-events: none; }

    .today-card-footer { display: flex; align-items: center; justify-content: flex-end; }
    .today-scroll-btn { display: inline-flex; align-items: center; gap: 7px; background: var(--primary-dark); color: #fff; font-size: 0.72rem; font-weight: 600; letter-spacing: 0.10em; text-transform: uppercase; padding: 10px 20px; border-radius: 100px; border: none; cursor: pointer; font-family: inherit; white-space: nowrap; box-shadow: 0 2px 12px rgba(26,74,68,0.25); transition: box-shadow 0.2s ease, transform 0.2s ease, background 0.2s ease; }
    .today-scroll-btn:hover { background: var(--primary); box-shadow: 0 4px 20px rgba(26,74,68,0.35); transform: translateY(-1px); }

    .today-hadith-inline { position: relative; z-index: 2; margin-top: 12px; padding: 10px 12px; background: rgba(201,168,76,0.07); border-left: 2px solid rgba(201,168,76,0.45); border-radius: 0 8px 8px 0; font-size: 0.70rem; color: rgba(255,255,255,0.50); font-style: italic; line-height: 1.6; }
    .today-hadith-inline .hadith-label { display: block; font-size: 0.55rem; font-weight: 700; letter-spacing: 0.12em; text-transform: uppercase; color: rgba(201,168,76,0.65); margin-bottom: 4px; font-style: normal; }

    /* ‚ïê‚ïê KOMET ‚Äî roterande guldstj√§rna runt today-card ‚ïê‚ïê */
    @property --comet-angle {
      syntax: '<angle>';
      initial-value: 0deg;
      inherits: false;
    }
    @keyframes rotateComet {
      from { --comet-angle: 0deg; }
      to   { --comet-angle: 360deg; }
    }

    /* Wrapper runt today-card som h√•ller kometen */
    .today-card-comet {
      position: relative;
      border-radius: 24px;
      padding: 2px;
      margin-bottom: 32px;
    }
    .today-card-comet::before {
      content: '';
      position: absolute;
      inset: -1px;
      border-radius: 25px;
      background: conic-gradient(
        from var(--comet-angle),
        transparent 0deg,
        transparent 240deg,
        rgba(201,168,76,0.04) 260deg,
        rgba(201,168,76,0.15) 290deg,
        rgba(201,168,76,0.45) 320deg,
        rgba(232,201,122,0.85) 348deg,
        rgba(255,248,210,1.00) 357deg,
        rgba(255,255,255,0.95) 360deg,
        transparent 360deg
      );
      animation: rotateComet 7s linear infinite;
      z-index: 0;
    }
    .today-card-comet::after {
      content: '';
      position: absolute;
      inset: 2px;
      border-radius: 22px;
      background: var(--surface);
      z-index: 1;
      transition: background 0.35s;
    }

    .today-card {
      display: none;
      background: var(--surface);
      border-radius: 22px;
      border: none;
      box-shadow: var(--card-shadow);
      overflow: hidden;
      position: relative;
      z-index: 2;
      transition: background 0.35s, box-shadow 0.35s;
    }

    /* ‚îÄ‚îÄ Hijri datum ‚îÄ‚îÄ */
    .today-date-hijri-dot { width: 3px; height: 3px; border-radius: 50%; background: rgba(201,168,76,0.5); flex-shrink: 0; }
    .today-date-hijri { font-size: 0.78rem; color: rgba(201,168,76,0.85); font-weight: 500; }
    .today-date-hijri-arabic { font-family: 'Cormorant Garamond', serif; font-size: 0.88rem; color: rgba(201,168,76,0.45); }

    /* ‚îÄ‚îÄ Progress ring i countdown ‚îÄ‚îÄ */
    .isha-ring-wrap { position: relative; width: 54px; height: 54px; flex-shrink: 0; }
    .isha-ring-svg { width: 54px; height: 54px; transform: rotate(-90deg); display: block; }
    .isha-ring-track { fill: none; stroke: rgba(255,255,255,0.07); stroke-width: 3.5; }
    .isha-ring-fill {
      fill: none;
      stroke: url(#ishaRingGrad);
      stroke-width: 3.5;
      stroke-linecap: round;
      stroke-dasharray: 144.51;
      stroke-dashoffset: 144.51;
      transition: stroke-dashoffset 1s ease, stroke 0.6s ease;
    }
    .isha-ring-icon {
      position: absolute; inset: 0;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.1rem;
    }

    /* ‚îÄ‚îÄ Today row i desktop-tabellen ‚Äî guldskimmer fr√•n v√§nster till h√∂ger ‚îÄ‚îÄ */
    tbody tr.today {
      background: var(--today-bg) !important;
      border-left-color: var(--today-green);
    }
    .td-sweep {
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: linear-gradient(
        105deg,
        transparent 0%,
        transparent 45%,
        rgba(201,168,76,0.05) 47%,
        rgba(232,201,122,0.22) 49%,
        rgba(255,248,210,0.38) 50%,
        rgba(232,201,122,0.22) 51%,
        rgba(201,168,76,0.05) 53%,
        transparent 55%,
        transparent 100%
      );
      background-size: 500% 100%;
      background-position: 150% 0;
      animation: diamondSweep 8s linear infinite;
    }
    /* Aktiv spelande rad ‚Äî roterande komet-glow runt hela raden via outline + box-shadow */
    tbody tr.playing-row-comet {
      position: relative;
      outline: 1px solid transparent;
      outline-offset: -1px;
      animation: rowCometGlow 7s linear infinite;
    }
    tbody tr.playing-row-comet td { position: relative; z-index: 1; }

    @keyframes rowCometGlow {
      0%   {
        outline-color: rgba(201,168,76,0.12);
        box-shadow: 0 0 0 0 rgba(201,168,76,0), inset 0 0 0 rgba(201,168,76,0);
      }
      20%  {
        outline-color: rgba(201,168,76,0.20);
        box-shadow: 0 1px 6px rgba(201,168,76,0.06), inset 0 0 8px rgba(201,168,76,0.03);
      }
      38%  {
        outline-color: rgba(255,248,210,0.90);
        box-shadow: 0 0 18px rgba(232,201,122,0.30), 0 0 6px rgba(255,248,210,0.20), inset 0 0 14px rgba(201,168,76,0.08);
      }
      44%  {
        outline-color: rgba(232,201,122,0.70);
        box-shadow: 0 0 12px rgba(201,168,76,0.20), inset 0 0 10px rgba(201,168,76,0.06);
      }
      100% {
        outline-color: rgba(201,168,76,0.12);
        box-shadow: 0 0 0 0 rgba(201,168,76,0), inset 0 0 0 rgba(201,168,76,0);
      }
    }
    /* Mobile card wrapper */
    .playing-comet-wrap {
      position: relative;
      border-radius: 16px;
      padding: 2px;
      margin-bottom: 10px;
    }
    .playing-comet-wrap::before {
      content: '';
      position: absolute;
      inset: -1px;
      border-radius: 17px;
      background: conic-gradient(
        from var(--comet-angle),
        transparent 0deg,
        transparent 240deg,
        rgba(201,168,76,0.04) 260deg,
        rgba(201,168,76,0.15) 290deg,
        rgba(201,168,76,0.45) 320deg,
        rgba(232,201,122,0.85) 348deg,
        rgba(255,248,210,1.00) 357deg,
        rgba(255,255,255,0.95) 360deg,
        transparent 360deg
      );
      animation: rotateComet 7s linear infinite;
      z-index: 0;
      pointer-events: none;
    }
    .playing-comet-wrap::after {
      content: '';
      position: absolute;
      inset: 2px;
      border-radius: 14px;
      background: var(--surface);
      z-index: 1;
      pointer-events: none;
    }
    .playing-comet-wrap .day-card-mobile {
      position: relative;
      z-index: 2;
      margin-bottom: 0;
    }
    @keyframes diamondSweep {
      0%   { background-position: 150% 0; }
      28%  { background-position: -50% 0; }
      100% { background-position: -50% 0; }
    }

    /* ‚îÄ‚îÄ EID CARD ‚îÄ‚îÄ */
    .eid-card { display: none; position: relative; border-radius: 24px; padding: 52px 32px 44px; text-align: center; margin-bottom: 32px; overflow: hidden; background: linear-gradient(160deg, #0a1f3d 0%, #0f2d40 25%, #163d38 55%, #1a4a44 80%, #24645d 100%); box-shadow: 0 2px 4px rgba(0,0,0,0.08), 0 12px 40px rgba(10,31,61,0.35), 0 32px 64px rgba(10,31,61,0.18); border: 1px solid rgba(201,168,76,0.12); animation: eidFadeUp 1.1s cubic-bezier(0.22,1,0.36,1) both; }
    @keyframes eidFadeUp { from { opacity: 0; transform: translateY(28px); } to { opacity: 1; transform: translateY(0); } }
    .eid-card::before { content: ''; position: absolute; inset: 0; background: radial-gradient(ellipse at 15% 20%, rgba(201,168,76,0.13) 0%, transparent 50%), radial-gradient(ellipse at 85% 80%, rgba(36,100,93,0.25) 0%, transparent 45%), radial-gradient(ellipse at 50% 50%, rgba(15,45,64,0.3) 0%, transparent 70%); pointer-events: none; }
    .eid-card::after { content: ''; position: absolute; inset: 0; opacity: 0.03; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E"); background-size: 128px; pointer-events: none; }
    .eid-inner { position: relative; z-index: 2; }
    .eid-ornament { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 28px; animation: eidFadeUp 1.1s 0.15s cubic-bezier(0.22,1,0.36,1) both; }
    .eid-orn-line { height: 1px; width: 44px; background: linear-gradient(to right, transparent, rgba(201,168,76,0.6)); }
    .eid-orn-line.r { background: linear-gradient(to left, transparent, rgba(201,168,76,0.6)); }
    .eid-orn-diamond { width: 6px; height: 6px; background: var(--gold); transform: rotate(45deg); }
    .eid-orn-dot { width: 3px; height: 3px; background: var(--gold-light); border-radius: 50%; }
    .eid-arabic { font-family: 'Cormorant Garamond', serif; font-size: clamp(1.6rem, 5vw, 2.2rem); font-weight: 500; color: rgba(255,255,255,0.92); letter-spacing: 0.04em; line-height: 1.4; margin-bottom: 6px; direction: rtl; animation: eidFadeUp 1.1s 0.25s cubic-bezier(0.22,1,0.36,1) both; }
    .eid-title { font-family: 'Cormorant Garamond', serif; font-size: clamp(2.6rem, 8vw, 4rem); font-weight: 700; color: #fff; line-height: 1.05; letter-spacing: 0.01em; margin-bottom: 10px; background: linear-gradient(105deg, #fff 0%, #fff 35%, var(--gold-light) 50%, #fff 65%, #fff 100%); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: eidFadeUp 1.1s 0.35s cubic-bezier(0.22,1,0.36,1) both, eidShimmer 4s 1.5s ease-in-out infinite; }
    @keyframes eidShimmer { 0% { background-position: 200% center; } 50% { background-position: -50% center; } 100% { background-position: 200% center; } }
    .eid-divider { display: flex; align-items: center; justify-content: center; gap: 8px; margin: 16px 0 18px; animation: eidFadeUp 1.1s 0.45s cubic-bezier(0.22,1,0.36,1) both; }
    .eid-divider-line { height: 1px; width: 36px; background: rgba(201,168,76,0.45); }
    .eid-divider-dot  { width: 4px; height: 4px; background: var(--gold); transform: rotate(45deg); }
    .eid-subtitle { font-size: 0.88rem; color: rgba(255,255,255,0.55); font-style: italic; letter-spacing: 0.06em; line-height: 1.6; animation: eidFadeUp 1.1s 0.52s cubic-bezier(0.22,1,0.36,1) both; }
    .eid-note { margin-top: 28px; padding-top: 22px; border-top: 1px solid rgba(255,255,255,0.08); font-size: 0.78rem; color: rgba(255,255,255,0.38); letter-spacing: 0.03em; line-height: 1.7; animation: eidFadeUp 1.1s 0.62s cubic-bezier(0.22,1,0.36,1) both; }
    .eid-note strong { color: rgba(255,255,255,0.55); font-weight: 500; }
    .eid-instagram { display: inline-flex; align-items: center; gap: 7px; margin-top: 18px; color: rgba(255,255,255,0.45); font-size: 0.76rem; text-decoration: none; letter-spacing: 0.04em; transition: color 0.2s; animation: eidFadeUp 1.1s 0.70s cubic-bezier(0.22,1,0.36,1) both; }
    .eid-instagram:hover { color: rgba(255,255,255,0.75); }
    .eid-crescents { position: absolute; inset: 0; pointer-events: none; overflow: hidden; }
    .eid-crescent { position: absolute; font-size: 1.1rem; opacity: 0; animation: eidFloat var(--dur, 6s) var(--delay, 0s) ease-in-out infinite; }
    @keyframes eidFloat { 0% { opacity: 0; transform: translateY(0) rotate(var(--rot,0deg)) scale(0.8); } 15% { opacity: var(--max-op, 0.18); } 85% { opacity: var(--max-op, 0.18); } 100% { opacity: 0; transform: translateY(-30px) rotate(var(--rot,15deg)) scale(1); } }

    /* ‚îÄ‚îÄ SECTION TITLE ‚îÄ‚îÄ */
    .section-title { text-align: center; margin-bottom: 20px; }
    .section-title h2 { font-family: 'Cormorant Garamond', serif; font-size: clamp(1.3rem, 4vw, 1.9rem); font-weight: 600; color: var(--primary-dark); transition: color 0.35s; }
    .divider { display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px; }
    .divider span { height: 1px; width: 40px; background: var(--gold); display: block; }
    .divider i { width: 5px; height: 5px; background: var(--gold); transform: rotate(45deg); display: block; }

    /* ‚îÄ‚îÄ LEGEND ‚îÄ‚îÄ */
    .legend { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-bottom: 20px; }
    .legend-item { display: flex; align-items: center; gap: 6px; background: var(--legend-bg); border-radius: 30px; padding: 5px 12px 5px 8px; box-shadow: var(--chip-shadow); font-size: .78rem; font-weight: 500; color: var(--text); transition: background 0.35s, color 0.35s, box-shadow 0.35s; }
    .legend-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }

    /* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
    .table-wrap { overflow: visible; border-radius: 16px; box-shadow: var(--table-shadow); transition: box-shadow 0.35s; }
    table { width: 100%; border-collapse: collapse; background: var(--surface); font-size: .875rem; transition: background 0.35s; }
    thead tr { background: var(--primary); transition: background 0.35s; }
    thead th { font-size: .7rem; font-weight: 500; text-transform: uppercase; letter-spacing: .1em; color: rgba(255,255,255,.7); padding: 14px 16px; text-align: left; white-space: nowrap; }
    tbody tr { border-bottom: 1px solid var(--border-subtle); transition: background .15s; border-left: 4px solid transparent; }
    tbody tr:last-child { border-bottom: none; }
    tbody tr:hover { background: var(--row-hover); }
    td { padding: 12px 16px; vertical-align: middle; }
    .td-dag { font-weight: 700; font-size: .95rem; color: var(--primary-dark); text-align: center; transition: color 0.35s; }
    .td-sidor { font-size: .8rem; color: var(--muted); white-space: nowrap; transition: color 0.35s; }
    .td-surah { font-size: .78rem; color: var(--primary-dark); max-width: 240px; line-height: 1.4; }
    .td-datum { font-size: .8rem; color: var(--muted); white-space: nowrap; transition: color 0.35s; }
    .td-datum.today-date { color: #1d7a4e; font-weight: 600; }
    .td-veckodag { font-size: .8rem; font-weight: 500; white-space: nowrap; transition: color 0.35s; }
    .fredag { color: var(--fredag-clr); font-weight: 700; }
    .lordag { color: var(--lordag-clr); }
    .sondag { color: var(--fredag-clr); }
    /* ‚îÄ‚îÄ Hijri label ‚îÄ‚îÄ */
    .hijri-label { display: flex; align-items: center; gap: 3px; margin-top: 3px; font-size: .65rem; color: rgba(160,120,20,0.85); white-space: nowrap; }
    .hijri-label .hijri-moon { font-size: .65rem; opacity: .75; }
    [data-theme="dark"] .hijri-label { color: rgba(201,168,76,0.55); }
    [data-theme="dark"] .hijri-label .hijri-moon { opacity: .55; }
    tbody tr.today .hijri-label { color: rgba(201,168,76,0.95); }
    tbody tr.today .hijri-label .hijri-moon { opacity: 1; }
    /* mobile */
    .dcm-hijri { display: flex; align-items: center; gap: 3px; font-size: .65rem; color: rgba(160,120,20,0.85); white-space: nowrap; }
    .dcm-hijri .hijri-moon { opacity: .75; }
    [data-theme="dark"] .dcm-hijri { color: rgba(201,168,76,0.55); }
    [data-theme="dark"] .dcm-hijri .hijri-moon { opacity: .55; }
    .day-card-mobile.today .dcm-hijri { color: rgba(201,168,76,0.95); }
    .day-card-mobile.today .dcm-hijri .hijri-moon { opacity: 1; }
    .imam-chip { display: inline-flex; align-items: center; gap: 6px; padding: 4px 11px 4px 8px; border-radius: 30px; font-size: .78rem; font-weight: 500; color: #fff; white-space: nowrap; }
    .imam-chip .dot { width: 6px; height: 6px; border-radius: 50%; background: rgba(255,255,255,.35); flex-shrink: 0; }
    .imam-abdurrahman { background: var(--abdurrahman); }
    .imam-saed { background: var(--saed); color: #1a1a1a !important; }
    .imam-saed .dot { background: rgba(0,0,0,.15) !important; }
    .imam-noor { background: #f0ede8; color: #1a1a1a !important; }
    .imam-noor .dot { background: rgba(0,0,0,.15) !important; }
    .imam-abdul { background: var(--abdul); }
    .imam-mohammed { background: var(--mohammed); }
    .imam-yacquub { background: var(--yacquub); }
    .imam-abdelsalam { background: var(--abdelsalam); }
    .imam-hatem { background: var(--hatem); }
    .imam-ibrahim { background: var(--ibrahim); }
    .today-badge { display: inline-block; background: var(--today-green); color: #fff; font-size: .6rem; font-weight: 700; text-transform: uppercase; letter-spacing: .08em; padding: 2px 6px; border-radius: 8px; margin-left: 5px; vertical-align: middle; }

    /* ‚îÄ‚îÄ TOOLTIP (surah) ‚îÄ‚îÄ */
    .surah-cell { position: relative; cursor: pointer; }
    .surah-names { font-size: .78rem; color: var(--primary-dark); line-height: 1.5; transition: color 0.35s; }

    @keyframes tooltipSlideUp {
      0%   { opacity: 0; transform: translateY(10px) scale(0.97); }
      60%  { opacity: 1; transform: translateY(-2px) scale(1.01); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }

    .tooltip-box {
      display: none;
      position: absolute;
      left: 0; top: calc(100% + 8px);
      background: #12211f;
      border: 1px solid rgba(201,168,76,0.40);
      color: rgba(255,255,255,0.88);
      font-size: .75rem; font-weight: 400; font-style: italic;
      padding: 9px 14px; border-radius: 10px;
      white-space: nowrap; z-index: 100;
      box-shadow: 0 8px 28px rgba(0,0,0,0.35);
      letter-spacing: .02em; pointer-events: none;
      transform-origin: top left;
    }
    @media (hover: hover) {
      .surah-cell:hover .tooltip-box {
        display: block;
        animation: tooltipSlideUp 0.38s cubic-bezier(0.34,1.56,0.64,1) forwards;
      }
    }
    .tooltip-box.visible {
      display: block;
      animation: tooltipSlideUp 0.38s cubic-bezier(0.34,1.56,0.64,1) forwards;
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       MOON TOOLTIP ‚Äî exact original design from first document
       Gold dark bg, right-aligned above moon, stays inside table
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    /* Backdrop for mobile sheet */
    .moon-tooltip-backdrop {
      display: none;
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.45);
      z-index: 998;
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
    }
    @keyframes fadeInBackdrop  { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeOutBackdrop { from { opacity: 1; } to { opacity: 0; } }
    .moon-tooltip-backdrop.visible { display: block; animation: fadeInBackdrop 0.25s ease forwards; }
    .moon-tooltip-backdrop.hiding  { display: block; animation: fadeOutBackdrop 0.25s ease forwards; }

    /* ‚îÄ‚îÄ Moon icon ‚îÄ‚îÄ */
    .moon-icon {
      display: inline-flex; align-items: center; justify-content: center;
      width: 20px; height: 20px; border-radius: 50%;
      background: #0f2d5e; vertical-align: middle; flex-shrink: 0;
      cursor: pointer;
    }
    .moon-icon.moon-odd { background: linear-gradient(135deg, #9a6f0a, #c9a84c); animation: moonGlow 2.2s ease-in-out infinite; }

    /* ‚îÄ‚îÄ Moon wrap ‚îÄ‚îÄ */
    .moon-wrap { position: relative; display: inline-flex; align-items: center; }

    /* ‚ïê‚ïê MOON BUBBLE ‚Äî original gold design for ALL last-ten nights ‚ïê‚ïê */

    /* Spring "blow up" animation */

    .moon-bubble {
      position: absolute;
      bottom: calc(100% + 10px);
      right: -10px;
      transform: translateY(120px);
      transform-origin: bottom right;

      width: 260px;
      max-width: 90vw;

      background: #12211f;
      border-radius: 10px;
      padding: 10px 12px;
      border: 1px solid rgba(201,168,76,0.40);
      box-shadow: 0 8px 28px rgba(0,0,0,0.35);

      color: rgba(255,255,255,0.88);
      font-size: 0.72rem;
      line-height: 1.55;
      font-style: italic;
      text-align: left;
      font-family: 'DM Sans', sans-serif;

      z-index: 10002;
      pointer-events: none;
      opacity: 0;
      visibility: hidden;
      transition: transform 2s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.4s ease;
      will-change: transform, opacity;
    }

    /* Open state ‚Äî desktop */
    .moon-wrap.bubble-open .moon-bubble {
      visibility: visible;
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    /* Close animation ‚Äî desktop */
    .moon-bubble.bubble-closing {
      opacity: 0 !important;
      transform: translateY(120px) !important;
      pointer-events: none !important;
    }

    .moon-bubble::before {
      content: '';
      position: absolute;
      top: 0; left: 14px; right: 14px; height: 1px;
      background: linear-gradient(to right, transparent, rgba(201,168,76,0.5), transparent);
      border-radius: 999px;
    }

    /* Downward tail pointing at the moon ‚Äî far right */
    .moon-bubble::after {
      content: '';
      position: absolute;
      top: 100%; right: 12px; left: auto;
      transform: none;
      width: 0; height: 0;
      border-left: 7px solid transparent;
      border-right: 7px solid transparent;
      border-top: 8px solid #12211f;
      filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));
    }

    /* Gold label row ‚Äî "üåô Laylatul-Qadr" */
    .moon-bubble-label {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.60rem;
      font-weight: 700;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: rgba(201,168,76,0.90);
      margin-bottom: 7px;
      font-style: normal;
      line-height: 1;
    }

    /* Hadith body text */
    .moon-bubble-text {
      display: block;
      font-style: italic;
    }

    /* Desktop hover trigger */
    @media (hover: hover) {
      .moon-wrap:hover .moon-bubble {
        visibility: visible;
        opacity: 1;
        pointer-events: auto;
        transform: translateY(0);
      }
    }

    /* ‚îÄ‚îÄ Last 10 nights: table row & today card adjustments ‚îÄ‚îÄ */
    tbody tr.last-ten { background: var(--surface); }
    tbody tr.last-ten.today { background: #0f2d5e !important; border-left-color: #3a7bd5; }
    [data-theme="dark"] tbody tr.last-ten.today { background: #0a2040 !important; }
    tbody tr.last-ten.today td { color: #fff !important; }
    tbody tr.last-ten.today .td-sidor,
    tbody tr.last-ten.today .td-datum,
    tbody tr.last-ten.today .td-veckodag { color: rgba(255,255,255,0.75) !important; }
    tbody tr.last-ten.today .td-dag { color: #fff !important; }
    tbody tr.last-ten.today .today-date { color: #7eb8f7 !important; }
    tbody tr.last-ten.today .today-badge { background: #3a7bd5; }
    tbody tr.last-ten.today .td-surah .surah-names { color: rgba(255,255,255,0.9) !important; }
    tbody tr.last-ten.today .moon-icon { background: transparent !important; border: 2px solid rgba(255,255,255,0.8); box-shadow: none !important; animation: none !important; }
    .day-card-mobile.last-ten.today .moon-icon { background: transparent !important; border: 2px solid rgba(255,255,255,0.8); box-shadow: none !important; animation: none !important; }

    /* ‚îÄ‚îÄ MOBILE CARDS ‚îÄ‚îÄ */
    .mobile-cards { display: none; }
    .day-card-mobile { background: var(--surface); border-radius: 14px; padding: 14px 16px; margin-bottom: 10px; box-shadow: var(--mobile-shadow); border-left: 4px solid transparent; transition: background 0.35s, box-shadow 0.35s; }
    .day-card-mobile.today { background: var(--today-bg); border-left-color: var(--today-green); }
    .dcm-top { display: flex; align-items: center; gap: 14px; margin-bottom: 8px; }
    .dcm-audio-right .play-btn { width: 38px; height: 38px; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
    .dcm-audio-right { display: flex; align-items: center; height: 44px; margin-left: auto; flex-shrink: 0; }
    .dcm-dag { font-weight: 700; font-size: 1.3rem; color: var(--primary-dark); min-width: 32px; text-align: center; flex-shrink: 0; transition: color 0.35s; }
    .dcm-dag.today-day { color: #1d7a4e; }
    .dcm-body { flex: 1; min-width: 0; }
    .dcm-imam { margin-bottom: 5px; }
    .dcm-meta { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .dcm-date { font-size: .75rem; color: var(--muted); transition: color 0.35s; }
    .dcm-day-label { font-size: .75rem; font-weight: 500; }
    .dcm-pages { font-size: .75rem; color: var(--muted); background: var(--dcm-pages-bg); padding: 2px 8px; border-radius: 10px; transition: background 0.35s, color 0.35s; }
    .dcm-surahs { margin-left: 46px; font-size: .78rem; color: var(--primary-dark); background: var(--dcm-surahs-bg); border-radius: 8px; padding: 6px 10px; line-height: 1.5; position: relative; cursor: pointer; transition: background 0.35s, color 0.35s; }
    .dcm-surahs-label { font-size: .65rem; text-transform: uppercase; letter-spacing: .1em; color: var(--muted); display: block; margin-bottom: 2px; transition: color 0.35s; }
    .dcm-tooltip { max-height: 0; overflow: hidden; opacity: 0; margin-top: 0; padding: 0 10px; background: var(--primary-dark); color: #fff; font-size: .75rem; font-weight: 500; border-radius: 7px; letter-spacing: .02em; transition: max-height 0.45s cubic-bezier(0.4,0,0.2,1), opacity 0.35s ease, margin-top 0.35s ease, padding 0.35s ease; }
    .dcm-tooltip.visible { max-height: 80px; opacity: 1; margin-top: 6px; padding: 7px 10px; }

    /* ‚îÄ‚îÄ Mobile last-ten ‚îÄ‚îÄ */
    .day-card-mobile.last-ten { background: var(--surface); }
    .day-card-mobile.last-ten.today { background: #0f2d5e !important; border-left-color: #3a7bd5; }
    [data-theme="dark"] .day-card-mobile.last-ten.today { background: #0a2040 !important; }
    .day-card-mobile.last-ten.today .dcm-dag,
    .day-card-mobile.last-ten.today .dcm-date,
    .day-card-mobile.last-ten.today .dcm-day-label { color: rgba(255,255,255,0.85) !important; }
    .day-card-mobile.last-ten.today .imam-chip { opacity: 0.95; }
    .day-card-mobile.last-ten.today .dcm-surahs { background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.9); }
    .day-card-mobile.last-ten.today .dcm-surahs-label { color: rgba(255,255,255,0.5); }
    .day-card-mobile.last-ten.today .dcm-pages { background: rgba(255,255,255,0.12); color: rgba(255,255,255,0.7); }
    .day-card-mobile.last-ten.today .today-badge { background: #3a7bd5; }
    .day-card-mobile.last-ten.today .dcm-dag.today-day { color: #7eb8f7 !important; }

    /* ‚ïê‚ïê Mobile: .moon-bubble becomes full-screen bottom sheet ‚ïê‚ïê */
    @media (max-width: 640px) {
      .moon-bubble {
        position: fixed !important;
        bottom: 0 !important; left: 0 !important; right: 0 !important;
        top: auto !important;
        width: 100% !important;
        max-width: 100% !important;
        border-radius: 22px 22px 0 0 !important;
        padding: 24px 22px 40px !important;
        font-size: 0.88rem !important;
        line-height: 1.7 !important;
        z-index: 10001 !important;
        pointer-events: none !important;
        opacity: 1 !important;
        visibility: hidden !important;
        transform: translateY(100%) !important;
        transition: transform 2s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.4s ease !important;
        border-bottom: none !important;
        will-change: transform;
      }
      .moon-bubble::before { display: none !important; }
      .moon-bubble::after  { display: none !important; }

      /* Open state */
      .moon-wrap.bubble-open .moon-bubble,
      .today-moon-wrap.bubble-open .moon-bubble {
        visibility: visible !important;
        pointer-events: auto !important;
        transform: translateY(0) !important;
      }
      /* Close */
      .moon-bubble.bubble-closing {
        visibility: visible !important;
        pointer-events: none !important;
        transform: translateY(100%) !important;
        opacity: 0 !important;
      }
      .moon-wrap:hover .moon-bubble { visibility: hidden !important; }
    }

    /* Backdrop above player on mobile */
    @media (max-width: 640px) {
      .moon-tooltip-backdrop { z-index: 10000 !important; }
    }

    /* Today-card moon wrap: bubble opens upward, centered on moon */
    .today-moon-wrap { position: relative; display: inline-flex; align-items: center; }

    .sticky-player { position: fixed; bottom: 0; left: 0; right: 0; z-index: 9999; pointer-events: none; }
    .sticky-player.visible { pointer-events: none; } /* aldrig auto p√• hela containern */

    /* ‚îÄ‚îÄ FULL PLAYER ‚îÄ‚îÄ */
    .player-full {
      background: linear-gradient(160deg, #141e1a 0%, #0d1712 100%);
      border-radius: 24px 24px 0 0;
      border: 1px solid rgba(201,168,76,0.13);
      border-bottom: none;
      box-shadow: 0 -2px 0 rgba(201,168,76,0.15), 0 -24px 64px rgba(0,0,0,0.75),
                  inset 0 1px 0 rgba(255,255,255,0.04);
      padding: 4px 18px 20px;
      transform: translateY(100%);
      opacity: 0;
      transition: transform 0.38s cubic-bezier(0.32,0.72,0,1), opacity 0.28s ease;
      will-change: transform;
      pointer-events: none;
    }
    /* Light mode full player */
    [data-theme="light"] .player-full {
      background: linear-gradient(160deg, #f0ede7 0%, #e8e4dc 100%);
      border: 1px solid rgba(36,100,93,0.15);
      border-bottom: none;
      box-shadow: 0 -2px 0 rgba(201,168,76,0.20), 0 -24px 64px rgba(0,0,0,0.12),
                  inset 0 1px 0 rgba(255,255,255,0.6);
    }
    [data-theme="light"] .sp-drag-handle { background: rgba(0,0,0,0.12); }
    #sp-close-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 20px;
      height: 20px;
      border: none;
      background: none;
      color: rgba(255,255,255,0.25);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: color 0.18s;
      z-index: 10;
      padding: 0;
    }
    #sp-close-btn:hover {
      color: rgba(255,255,255,0.60) !important;
      background: none !important;
    }
    [data-theme="light"] #sp-close-btn {
      color: rgba(0,0,0,0.22) !important;
      border: none !important;
      background: none !important;
    }
    [data-theme="light"] #sp-close-btn:hover {
      color: rgba(0,0,0,0.52) !important;
      background: none !important;
    }
    [data-theme="light"] .sp-imam-name { color: #1a1a1a; }
    [data-theme="light"] .sp-meta-sub { color: rgba(0,0,0,0.45); }
    [data-theme="light"] .sp-accent { color: var(--primary-dark); }
    [data-theme="light"] .sp-progress-times { color: rgba(0,0,0,0.38); }
    [data-theme="light"] .sticky-seek::before { background: rgba(0,0,0,0.10); }
    [data-theme="light"] .sp-ring-bg { stroke: rgba(0,0,0,0.08); }
    [data-theme="light"] .sp-ctrl-btn { color: rgba(0,0,0,0.50); }
    [data-theme="light"] .sp-ctrl-btn:hover { color: #1a1a1a; background: rgba(0,0,0,0.06); }
    [data-theme="light"] .sp-ctrl-btn:disabled { color: rgba(0,0,0,0.20); }
    [data-theme="light"] .sp-ctrl-lbl { color: rgba(0,0,0,0.28); }
    [data-theme="light"] .sp-ring-inner { box-shadow: inset 0 2px 8px rgba(0,0,0,0.12); }
    [data-theme="light"] .sp-speed-chip {
      color: rgba(0,0,0,0.45);
      background: rgba(0,0,0,0.05);
      border-color: rgba(0,0,0,0.10);
    }
    [data-theme="light"] .sp-speed-chip:hover { background: rgba(0,0,0,0.09); color: rgba(0,0,0,0.7); }
    [data-theme="light"] .sp-mute-btn {
      color: rgba(0,0,0,0.45);
      background: rgba(0,0,0,0.05);
      border-color: rgba(0,0,0,0.10);
    }
    [data-theme="light"] .sp-mute-btn:hover { background: rgba(0,0,0,0.09); color: rgba(0,0,0,0.7); }
    [data-theme="light"] .sp-mute-btn.muted {
      background: rgba(180,40,40,0.10) !important;
      border-color: rgba(200,50,50,0.35) !important;
      color: #c0392b !important;
    }
    [data-theme="light"] .sp-share-btn {
      background: rgba(0,0,0,0.05);
      border-color: rgba(0,0,0,0.08);
      color: rgba(0,0,0,0.35);
    }
    [data-theme="light"] .sp-share-btn:hover { color: #1a1a1a; background: rgba(0,0,0,0.10); }
    [data-theme="light"] .fav-btn { color: rgba(0,0,0,0.20); }
    [data-theme="light"] #sp-fav-btn { color: rgba(0,0,0,0.28); border-color: rgba(0,0,0,0.08); background: rgba(0,0,0,0.04); }
    [data-theme="light"] #sp-fav-btn.active { color: #a84040; background: rgba(168,64,64,0.06); }

    /* Light mode mini player */
    [data-theme="light"] .sp-mini-inner {
      background: rgba(245,242,236,0.97);
      border: 1px solid rgba(36,100,93,0.15);
      box-shadow: 0 8px 36px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.8);
    }
    [data-theme="light"] .sp-mini-imam { color: #1a1a1a; }
    [data-theme="light"] .sp-mini-sub { color: rgba(0,0,0,0.40); }
    [data-theme="light"] .sp-mini-ctrl { color: rgba(0,0,0,0.45); }
    [data-theme="light"] .sp-mini-ctrl:hover { color: #1a1a1a; background: rgba(0,0,0,0.06); }
    [data-theme="light"] .sp-mini-progress { background: rgba(0,0,0,0.06); }
    .sticky-player.visible .player-full { transform: translateY(0); opacity: 1; pointer-events: auto; transition: transform 0.38s cubic-bezier(0.32,0.72,0,1), opacity 0.28s ease; }
    .sticky-player.mini-mode .player-full { transform: translateY(100%); opacity: 0; pointer-events: none; transition: transform 0.38s cubic-bezier(0.32,0.72,0,1), opacity 0.28s ease; }
    /* Gold top line */
    .player-full::before {
      content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%);
      width: 55%; height: 1px;
      background: linear-gradient(to right, transparent, rgba(201,168,76,0.5), transparent);
      pointer-events: none;
    }

    /* Drag handle */
    .sp-drag-handle {
      width: 36px; height: 4px;
      background: rgba(255,255,255,0.10);
      border-radius: 2px;
      margin: 10px auto 16px;
    }

    /* Metadata row */
    .sp-meta-row {
      display: flex; align-items: center;
      gap: 13px; margin-bottom: 16px;
    }
    .sp-artwork {
      width: 50px; height: 50px; border-radius: 13px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
      box-shadow: 0 4px 18px rgba(0,0,0,0.5);
      position: relative; overflow: hidden;
      transition: background 0.4s ease;
    }
    .sp-artwork::after {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.13), transparent);
      pointer-events: none;
    }
    .sp-initials {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.2rem; font-weight: 600;
      color: rgba(255,255,255,0.93);
      position: relative; z-index: 2;
      text-shadow: 0 2px 8px rgba(0,0,0,0.35);
    }
    .sp-meta-text { flex: 1; min-width: 0; }
    .sp-imam-name {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.22rem; font-weight: 600; color: #fff;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      line-height: 1.2;
    }
    .sp-meta-sub {
      font-size: 0.72rem; color: rgba(255,255,255,0.62);
      margin-top: 2px; white-space: normal; overflow: hidden; text-overflow: ellipsis;
      line-height: 1.5;
    }
    .sp-accent { color: rgba(201,168,76,0.90); font-weight: 600; }
    .sp-share-btn {
      width: 34px; height: 34px; border: none;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.08);
      color: rgba(255,255,255,0.4);
      cursor: pointer; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.18s; flex-shrink: 0;
    }
    .sp-share-btn:hover { color: #fff; background: rgba(255,255,255,0.10); }

    /* Progress */
    .sp-progress-section { margin-bottom: 16px; }
    .sp-progress-times {
      display: flex; justify-content: space-between;
      font-size: 0.65rem; color: rgba(255,255,255,0.50);
      font-variant-numeric: tabular-nums; margin-bottom: 9px;
    }

    /* Seek track ‚Äî reuse existing JS, new visuals */
    .sticky-seek {
      flex: 1; height: 28px;
      display: flex; align-items: center; position: relative;
      cursor: grab; touch-action: none;
    }
    .sticky-seek.seeking { cursor: grabbing; }
    .sticky-seek::before {
      content: ''; position: absolute; left: 0; right: 0; top: 50%;
      height: 3px; transform: translateY(-50%);
      border-radius: 999px; background: rgba(255,255,255,0.08);
      transition: height 0.18s cubic-bezier(0.4,0,0.2,1);
      pointer-events: none;
    }
    .sticky-seek:hover::before, .sticky-seek.seeking::before,
    .sticky-seek.bar-expanded::before { height: 5px; }
    .sticky-seek-fill {
      position: absolute; left: 0; top: 50%; transform: translateY(-50%);
      height: 3px; border-radius: 999px; width: 0%;
      pointer-events: none; z-index: 1;
      transition: height 0.18s cubic-bezier(0.4,0,0.2,1);
    }
    .sticky-seek:hover .sticky-seek-fill,
    .sticky-seek.seeking .sticky-seek-fill,
    .sticky-seek.bar-expanded .sticky-seek-fill { height: 5px; }
    .sticky-seek-thumb {
      position: absolute; top: 50%; left: 0%; width: 13px; height: 13px;
      background: #fff; border-radius: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      pointer-events: none; z-index: 3;
      transition: transform 0.18s cubic-bezier(0.34,1.56,0.64,1);
    }
    .sticky-seek-thumb.dragging { transform: translate(-50%,-50%) scale(1.2); }

    /* Controls row */
    .sp-controls-row {
      display: flex; align-items: center;
      justify-content: center; gap: 0; margin-bottom: 14px;
    }
    .sp-ctrl-btn {
      width: 46px; height: 46px; border: none; background: none;
      color: rgba(255,255,255,0.70); cursor: pointer; border-radius: 50%;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      gap: 2px; transition: all 0.15s; flex-shrink: 0;
    }
    .sp-ctrl-btn:hover { color: #fff; background: rgba(255,255,255,0.06); }
    .sp-ctrl-btn:disabled { opacity: 0.22; cursor: default; }
    .sp-ctrl-btn:disabled:hover { background: none; color: rgba(255,255,255,0.22); }
    .sp-ctrl-lbl {
      font-size: 0.50rem; color: rgba(255,255,255,0.42);
      letter-spacing: 0.02em; line-height: 1;
    }

    /* Hero play button with progress ring */
    .sp-play-hero {
      width: 62px; height: 62px; border: none; background: none;
      cursor: pointer; position: relative;
      margin: 0 16px; flex-shrink: 0;
      display: flex; align-items: center; justify-content: center;
    }
    .sp-ring-svg {
      position: absolute; inset: 0;
      transform: rotate(-90deg);
      pointer-events: none;
    }
    .sp-ring-bg { fill: none; stroke: rgba(255,255,255,0.07); stroke-width: 2.5; }
    .sp-ring-fill {
      fill: none; stroke-width: 2.5; stroke-linecap: round;
      stroke-dasharray: 175.9; stroke-dashoffset: 175.9;
      transition: stroke-dashoffset 0.4s ease, stroke 0.4s ease;
    }
    .sp-ring-inner {
      position: absolute; inset: 5px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.5);
      transition: background 0.4s ease;
    }
    @keyframes spmSpring { 0%{transform:scale(1)} 28%{transform:scale(0.80)} 62%{transform:scale(1.13)} 84%{transform:scale(0.95)} 100%{transform:scale(1)} }
    .sp-play-hero.springing .sp-ring-inner { animation: spmSpring 0.48s cubic-bezier(0.34,1.56,0.64,1); }
    .spm-icon-wrap { position: relative; width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; }
    .spm-icon-wrap svg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); transition: opacity 0.24s ease, transform 0.24s ease; }
    .spm-play  { opacity: 1; transform: translate(calc(-50% + 1px), -50%) scale(1) !important; }
    .spm-pause { opacity: 0; transform: translate(-50%, -50%) scale(0.45) !important; }
    .sp-play-hero.playing .spm-play  { opacity: 0 !important; transform: translate(calc(-50% + 1px), -50%) scale(0.45) !important; }
    .sp-play-hero.playing .spm-pause { opacity: 1 !important; transform: translate(-50%, -50%) scale(1) !important; }
    .spm-ripple { position: absolute; border-radius: 50%; width: 52px; height: 52px; left: 50%; top: 50%; transform: translate(-50%,-50%) scale(0); pointer-events: none; animation: spmRipple 0.55s ease-out forwards; }
    @keyframes spmRipple { to { transform: translate(-50%,-50%) scale(2.2); opacity: 0; } }

    /* Extras row */
    .sp-extras-row {
      display: flex; align-items: center;
      justify-content: space-between; padding: 0 4px;
    }
    .sp-speed-chip {
      font-size: 0.62rem; font-weight: 700;
      color: rgba(255,255,255,0.38);
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 100px; padding: 4px 11px;
      cursor: pointer; letter-spacing: 0.04em;
      transition: all 0.15s;
    }
    .sp-speed-chip:hover { background: rgba(255,255,255,0.09); color: rgba(255,255,255,0.65); }
    .sp-mute-btn {
      display: inline-flex; align-items: center; gap: 6px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 100px; padding: 4px 12px;
      color: rgba(255,255,255,0.45);
      cursor: pointer; font-family: inherit;
      font-size: 0.60rem; font-weight: 600; letter-spacing: 0.05em;
      transition: all 0.22s ease;
    }
    .sp-mute-btn:hover { background: rgba(255,255,255,0.09); color: rgba(255,255,255,0.70); }
    .sp-mute-btn.muted {
      background: rgba(180,40,40,0.18) !important;
      border-color: rgba(220,60,60,0.40) !important;
      color: #e05555 !important;
    }
    .sp-mute-btn .sp-vol-icon { transition: color 0.22s; }
    .sp-mute-btn.muted .sp-vol-icon { color: #e05555; }
    /* Mini mute indicator */
    .sp-mini-muted-dot {
      position: absolute; top: 8px; right: 8px;
      width: 7px; height: 7px; border-radius: 50%;
      background: #e05555;
      box-shadow: 0 0 6px rgba(224,85,85,0.7);
      display: none;
    }
    .sticky-player.muted-state .sp-mini-muted-dot { display: block; }
    /* ‚ïê‚ïê SOUND WAVE ‚Äî Web Audio API driven ‚ïê‚ïê */
    .sp-soundwave {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 2px;
      height: 40px;
      flex-shrink: 0;
      position: relative;
    }
    /* Varje stapel v√§xer fr√•n mitten ‚Äî transform-origin: center */
    .sw-col {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 40px;
      position: relative;
      width: 3px;
      flex-shrink: 0;
    }
    .sw-bar {
      width: 3px;
      border-radius: 2px;
      background: linear-gradient(to top,
        #c8860a 0%,
        #e8a020 30%,
        #f5c842 65%,
        #ffe87a 100%
      );
      box-shadow: 0 0 4px rgba(232,168,32,0.45);
      transform-origin: bottom center;
      height: 38px;
      transform: scaleY(0.04);
      will-change: transform;
    }
    /* Peak-mark√∂r: dold */
    .sw-peak {
      display: none;
    }
    [data-theme="light"] .sw-bar {
      background: linear-gradient(to top, #8a5c00 0%, #c4830a 40%, #e8a820 100%);
      box-shadow: 0 0 4px rgba(180,120,0,0.35);
    }
    [data-theme="light"] .sw-peak {
      background: #c4830a;
      box-shadow: 0 0 4px rgba(180,120,0,0.6);
    }



    /* ‚ïê‚ïê SLEEP TIMER ‚ïê‚ïê */
    .sp-sleep-btn {
      width: 34px; height: 34px; border-radius: 50%;
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(255,255,255,0.05);
      color: rgba(255,255,255,0.35); cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.22s ease; flex-shrink: 0;
      position: relative;
    }
    .sp-sleep-btn:hover {
      background: rgba(100,130,255,0.12);
      border-color: rgba(130,160,255,0.30);
      color: rgba(160,185,255,0.85);
    }
    .sp-sleep-btn.active {
      background: rgba(100,130,255,0.18);
      border-color: rgba(130,160,255,0.45);
      color: rgba(170,200,255,1);
      box-shadow: 0 0 10px rgba(100,140,255,0.25);
    }
    /* Puls-ring n√§r aktiv */
    .sp-sleep-btn.active::after {
      content: '';
      position: absolute; inset: -4px;
      border-radius: 50%;
      border: 1.5px solid rgba(130,160,255,0.30);
      animation: sleepPulseRing 2.2s ease-in-out infinite;
      pointer-events: none;
    }
    @keyframes sleepPulseRing {
      0%,100% { transform: scale(1); opacity: 0.7; }
      50%      { transform: scale(1.22); opacity: 0.15; }
    }
    /* Pip-indikator */
    .sp-sleep-pip {
      position: absolute; top: 1px; right: 1px;
      width: 7px; height: 7px; border-radius: 50%;
      background: #7b96ff;
      box-shadow: 0 0 6px rgba(100,140,255,0.9);
      display: none; pointer-events: none;
    }
    .sp-sleep-btn.active .sp-sleep-pip { display: block; }

    /* Panel */
    .sp-sleep-panel {
      position: absolute; bottom: calc(100% + 12px);
      right: 18px;
      background: rgba(8,18,14,0.98);
      border: 1px solid rgba(130,160,255,0.20);
      border-radius: 16px; padding: 16px;
      width: 220px;
      box-shadow: 0 -8px 32px rgba(0,0,0,0.6);
      opacity: 0; pointer-events: none;
      transform: translateY(8px);
      transition: opacity 0.2s ease, transform 0.2s ease;
      z-index: 10;
    }
    .sp-sleep-panel.open {
      opacity: 1; pointer-events: auto; transform: translateY(0);
    }
    .sp-sleep-panel-title {
      font-size: 0.58rem; font-weight: 700; letter-spacing: 0.12em;
      text-transform: uppercase; color: rgba(130,160,255,0.6);
      margin-bottom: 10px;
    }
    .sp-sleep-opts {
      display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 0;
    }
    .sp-sleep-opt {
      font-size: 0.65rem; font-weight: 600;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 8px; padding: 5px 10px;
      color: rgba(255,255,255,0.42); cursor: pointer; font-family: inherit;
      transition: all 0.15s;
    }
    .sp-sleep-opt:hover {
      background: rgba(100,130,255,0.12);
      border-color: rgba(130,160,255,0.30);
      color: rgba(160,185,255,0.9);
    }
    .sp-sleep-opt.selected {
      background: rgba(100,130,255,0.20);
      border-color: rgba(130,160,255,0.55);
      color: rgba(175,205,255,1);
    }
    /* Progress inom panel */
    .sp-sleep-progress {
      margin-top: 12px; display: none;
    }
    .sp-sleep-progress.visible { display: block; }
    .sp-sleep-progress-row {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 5px;
    }
    .sp-sleep-progress-lbl {
      font-size: 0.58rem; color: rgba(255,255,255,0.35);
    }
    .sp-sleep-progress-time {
      font-size: 0.65rem; font-weight: 700;
      color: rgba(160,185,255,0.9);
      font-variant-numeric: tabular-nums;
    }
    .sp-sleep-track {
      height: 3px; background: rgba(255,255,255,0.07);
      border-radius: 999px; overflow: hidden;
    }
    .sp-sleep-fill {
      height: 100%;
      background: linear-gradient(to right, rgba(100,130,255,0.55), rgba(160,195,255,0.9));
      border-radius: 999px; width: 100%;
      transition: width 1s linear;
    }
    .sp-sleep-cancel {
      margin-top: 10px; width: 100%;
      font-size: 0.58rem; font-weight: 600; letter-spacing: 0.06em;
      text-transform: uppercase; background: none;
      border: 1px solid rgba(255,255,255,0.07);
      color: rgba(255,255,255,0.28); padding: 6px;
      border-radius: 8px; cursor: pointer; font-family: inherit;
      transition: all 0.18s;
    }
    .sp-sleep-cancel:hover {
      border-color: rgba(220,80,80,0.35);
      color: rgba(255,120,120,0.75);
    }

    /* ‚îÄ‚îÄ Sound wave CSS-animation (iOS fallback) ‚îÄ‚îÄ */
    @keyframes swPulse {
      0%        { transform: scaleY(var(--sw-floor)); }
      30%       { transform: scaleY(var(--sw-peak));  }
      100%      { transform: scaleY(var(--sw-floor)); }
    }
    .sw-bar--animate { animation: swPulse var(--sw-dur, 0.9s) cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite; }

    /* ‚îÄ‚îÄ TRACK FLOATING PILL (Tarawih / Isha) ‚îÄ‚îÄ */
    .sp-segment-wrap {
      display: none;
      justify-content: center;
      margin: 8px 0 14px;
    }
    .sp-segment-wrap.visible { display: flex; }
    .sp-segment {
      display: inline-flex;
      align-items: center;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 20px;
      padding: 3px;
      position: relative;
      gap: 2px;
    }
    [data-theme="light"] .sp-segment {
      background: rgba(0,0,0,0.05);
      border-color: rgba(0,0,0,0.08);
    }
    .sp-segment-pill {
      position: absolute;
      top: 3px; bottom: 3px;
      border-radius: 17px;
      background: rgba(201,168,76,0.15);
      border: 1px solid rgba(201,168,76,0.35);
      box-shadow: 0 1px 8px rgba(201,168,76,0.12), 0 0 0 0 rgba(201,168,76,0);
      transition: left 0.3s cubic-bezier(0.34,1.2,0.64,1), width 0.3s cubic-bezier(0.34,1.2,0.64,1);
      pointer-events: none;
      z-index: 0;
    }
    [data-theme="light"] .sp-segment-pill {
      background: rgba(201,168,76,0.12);
      border-color: rgba(201,168,76,0.4);
    }
    .sp-segment-btn {
      position: relative; z-index: 1;
      background: none; border: none;
      padding: 5px 14px;
      font-family: inherit; font-size: 0.70rem; font-weight: 600;
      color: rgba(255,255,255,0.30);
      border-radius: 17px;
      cursor: pointer;
      transition: color 0.2s ease;
      letter-spacing: 0.04em;
      white-space: nowrap;
      text-align: center;
      -webkit-tap-highlight-color: transparent;
      display: flex; align-items: center; gap: 5px;
    }
    .sp-segment-btn.active {
      color: rgba(201,168,76,0.95);
    }
    .sp-segment-btn .sp-seg-icon { font-size: 0.75rem; line-height: 1; }
    [data-theme="light"] .sp-segment-btn { color: rgba(0,0,0,0.30); }
    [data-theme="light"] .sp-segment-btn.active { color: rgba(140,100,30,0.95); }

    /* Small dot indicator on table row when isha exists */
    .isha-dot {
      display: inline-block;
      width: 5px; height: 5px;
      border-radius: 50%;
      background: rgba(201,168,76,0.7);
      margin-left: 4px;
      vertical-align: middle;
      flex-shrink: 0;
    }

        /* ‚îÄ‚îÄ MINI PLAYER ‚îÄ‚îÄ */
    .player-mini {
      position: absolute; bottom: 0; left: 0; right: 0;
      padding: 0 10px 10px;
      pointer-events: none;
      transform: translateY(100%);
      opacity: 0;
      transition: transform 0.38s cubic-bezier(0.32,0.72,0,1), opacity 0.28s ease;
      will-change: transform;
    }
    .sticky-player.mini-mode .player-mini { transform: translateY(0); opacity: 1; pointer-events: none; transition: transform 0.38s cubic-bezier(0.32,0.72,0,1) 0.06s, opacity 0.28s ease 0.06s; }
    .sticky-player.mini-mode .sp-mini-inner { pointer-events: auto; }

    .sp-mini-inner {
      background: rgba(12, 20, 16, 0.97);
      backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
      border: 1px solid rgba(201,168,76,0.15);
      border-radius: 18px;
      padding: 9px 11px 11px 10px;
      display: flex; align-items: center; gap: 10px;
      box-shadow: 0 8px 36px rgba(0,0,0,0.55),
                  inset 0 1px 0 rgba(255,255,255,0.04);
      position: relative; overflow: hidden;
    }

    /* Mini progress bar at bottom */
    .sp-mini-progress {
      position: absolute; bottom: 0; left: 0; right: 0; height: 3px;
      background: rgba(255,255,255,0.10);
      border-radius: 0 0 18px 18px;
      overflow: hidden;
    }
    .sp-mini-progress-fill {
      height: 100%; width: 0%;
      border-radius: 0 2px 2px 0;
      transition: width 0.4s linear;
      background: linear-gradient(to right, rgba(201,168,76,0.7), rgba(232,201,122,1));
    }
    [data-theme="light"] .sp-mini-progress { background: rgba(0,0,0,0.08); }

    .sp-mini-artwork {
      width: 38px; height: 38px; border-radius: 9px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0; box-shadow: 0 2px 10px rgba(0,0,0,0.45);
      position: relative; overflow: hidden;
      transition: background 0.4s ease;
    }
    .sp-mini-artwork::after {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 50%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.12), transparent);
      pointer-events: none;
    }
    .sp-mini-initials {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1rem; font-weight: 600;
      color: rgba(255,255,255,0.93); position: relative; z-index: 2;
    }
    .sp-mini-meta { flex: 1; min-width: 0; }
    .sp-mini-imam {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.05rem; font-weight: 600; color: #fff;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      line-height: 1.2;
    }
    .sp-mini-sub {
      font-size: 0.66rem; color: rgba(255,255,255,0.55); margin-top: 1px;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .sp-mini-controls { display: flex; align-items: center; gap: 6px; flex-shrink: 0; }
    .sp-mini-ctrl {
      width: 34px; height: 34px; border: none; background: none;
      color: rgba(255,255,255,0.5); cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      border-radius: 50%; transition: all 0.15s;
      touch-action: manipulation; -webkit-tap-highlight-color: transparent;
    }
    .sp-mini-ctrl:hover { color: #fff; background: rgba(255,255,255,0.07); }
    .sp-mini-play {
      width: 34px; height: 34px; border-radius: 50%;
      border: none; color: #fff; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 2px 12px rgba(0,0,0,0.4);
      transition: transform 0.18s, box-shadow 0.18s;
      flex-shrink: 0;
    }
    .sp-mini-play:hover { transform: scale(1.09); }

    /* ‚îÄ‚îÄ FAVORITER / HJ√ÑRTA ‚îÄ‚îÄ */
    .fav-btn {
      background: none; border: none; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      width: 30px; height: 30px; border-radius: 50%;
      color: rgba(255,255,255,0.25);
      transition: color 0.2s, transform 0.2s, background 0.15s;
      flex-shrink: 0; padding: 0;
    }
    .fav-btn:hover { transform: scale(1.18); background: rgba(255,255,255,0.06); }
    .fav-btn.active { color: #a84040; }
    .fav-btn.active svg { fill: #a84040; }
    @keyframes heartPop { 0%{transform:scale(1)} 35%{transform:scale(1.45)} 65%{transform:scale(0.88)} 100%{transform:scale(1)} }
    .fav-btn.pop { animation: heartPop 0.38s cubic-bezier(0.34,1.56,0.64,1); }
    @keyframes favRingFade {
      0%   { box-shadow: 0 0 0 3px rgba(255,255,255,0.55); }
      60%  { box-shadow: 0 0 0 5px rgba(255,255,255,0.20); }
      100% { box-shadow: 0 0 0 6px rgba(255,255,255,0); }
    }
    .fav-btn.ring-fade { animation: favRingFade 2.5s cubic-bezier(0.4,0,1,1) forwards; }

    /* Hj√§rta i table-rader */
    .td-fav { width: 36px; text-align: center; padding: 0 2px; }
    .td-fav .fav-btn { color: rgba(0,0,0,0.15); }
    [data-theme="dark"] .td-fav .fav-btn { color: rgba(255,255,255,0.15); }
    .td-fav .fav-btn.active { color: #a84040; }

    /* Hj√§rta i mobil-kort */
    .dcm-fav-wrap { display: flex; align-items: center; height: 44px; }
    .dcm-fav-wrap .fav-btn { color: rgba(0,0,0,0.15); width: 44px; height: 44px; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
    [data-theme="dark"] .dcm-fav-wrap .fav-btn { color: rgba(255,255,255,0.15); }
    .dcm-fav-wrap .fav-btn.active { color: #a84040; }

    /* Hj√§rta i spelaren */
    #sp-fav-btn { color: rgba(255,255,255,0.28); }
    #sp-fav-btn.active { color: #a84040; }
    #sp-fav-btn.active svg { fill: #a84040; }

    /* Favorit filter-chip */
    .filter-chip.fav-chip .fav-chip-heart { transition: color 0.2s; }
    .filter-chip.fav-chip.active .fav-chip-heart { color: #a84040; }

    /* ‚îÄ‚îÄ Fav chip animations ‚îÄ‚îÄ */

    /* POP IN: grows from a ball, quick start, soft landing */
    @keyframes favChipPopIn {
      0%   { transform: scale(0);    opacity: 0;   max-width: 0;     margin-right: 0; }
      60%  { opacity: 1; }
      100% { transform: scale(1);    opacity: 1;   max-width: 200px; margin-right: 8px; }
    }

    /* FALL OUT: slides down and fades */
    @keyframes favChipFallOut {
      0%   { transform: translateY(0)    scale(1);    opacity: 1;   max-width: 200px; margin-right: 8px; }
      100% { transform: translateY(28px) scale(0.8);  opacity: 0;   max-width: 0;     margin-right: 0; }
    }

    /* Siblings bounce RIGHT */
    @keyframes chipBounceRight {
      0%   { transform: translateX(0); }
      30%  { transform: translateX(10px); }
      60%  { transform: translateX(-3px); }
      80%  { transform: translateX(2px); }
      100% { transform: translateX(0); }
    }

    /* Siblings bounce LEFT */
    @keyframes chipBounceLeft {
      0%   { transform: translateX(0); }
      30%  { transform: translateX(-10px); }
      60%  { transform: translateX(3px); }
      80%  { transform: translateX(-2px); }
      100% { transform: translateX(0); }
    }

    .fav-chip-entering {
      display: inline-flex !important;
      transform-origin: left center;
      overflow: hidden;
      animation: favChipPopIn 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    }
    .fav-chip-leaving {
      transform-origin: center center;
      overflow: hidden;
      animation: favChipFallOut 0.5s cubic-bezier(0.4, 0, 1, 1) forwards;
    }
    .chip-nudge-right {
      animation: chipBounceRight 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    }
    .chip-nudge-left {
      animation: chipBounceLeft 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    }
    .fav-count-badge {
      background: #a84040; color: #fff;
      font-size: 0.58rem; font-weight: 700;
      min-width: 16px; height: 16px; border-radius: 8px;
      display: inline-flex; align-items: center; justify-content: center;
      padding: 0 4px; margin-left: 2px; line-height: 1;
    }


        /* ‚îÄ‚îÄ PLAY BUTTONS ‚îÄ‚îÄ */
    .play-btn { display: inline-flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 50%; background: var(--primary); border: none; cursor: pointer; color: #fff; flex-shrink: 0; box-shadow: 0 2px 8px rgba(36,100,93,.3); position: relative; overflow: hidden; transition: background 0.42s cubic-bezier(0.4,0,0.2,1), box-shadow 0.15s ease; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
    .play-btn:hover { box-shadow: 0 4px 14px rgba(36,100,93,.45); }
    .play-btn.playing { background: #c0392b; box-shadow: 0 2px 10px rgba(192,57,43,0.40); }
    .play-btn svg { display: block; position: relative; z-index: 1; }
    /* Extra klickyta utan att √§ndra visuell storlek */
    .td-audio { text-align: center; width: 48px; padding: 8px 6px 8px 10px; }
    .td-audio .play-btn::before {
      content: ''; position: absolute; inset: -8px; border-radius: 50%;
    }
    @keyframes playBtnSpring { 0% { transform: scale(1); } 28% { transform: scale(0.78); } 62% { transform: scale(1.14); } 84% { transform: scale(0.94); } 100% { transform: scale(1); } }
    .play-btn.springing { animation: playBtnSpring 0.48s cubic-bezier(0.34,1.56,0.64,1); }
    @keyframes sharePulse {
      0%   { transform: scale(1);    box-shadow: 0 2px 8px rgba(36,100,93,.3); }
      40%  { transform: scale(1.22); box-shadow: 0 4px 22px rgba(36,100,93,.7); }
      100% { transform: scale(1);    box-shadow: 0 2px 8px rgba(36,100,93,.3); }
    }
    .play-btn.share-pulse { animation: sharePulse 0.55s ease-in-out; }
    .sp-play-hero.share-pulse { animation: sharePulse 0.55s ease-in-out; }
    .play-btn-ripple { position: absolute; border-radius: 50%; width: 36px; height: 36px; left: 0; top: 0; background: rgba(255,255,255,0.28); transform: scale(0); pointer-events: none; animation: spmRipple 0.55s ease-out forwards; }
    .td-moon { text-align: center; width: 32px; padding: 12px 8px 12px 0; }
    .moon-icon svg { display: block; }

    /* ‚îÄ‚îÄ FILTER ‚îÄ‚îÄ */
    .filter-wrap { margin-bottom: 20px; display: flex; flex-direction: column; align-items: center; gap: 10px; transition: margin-bottom 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
    .filter-chips { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; transition: height 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
    .filter-chip { display: inline-flex; align-items: center; gap: 6px; background: var(--chip-bg); border: 1.5px solid transparent; border-radius: 30px; padding: 5px 12px 5px 8px; box-shadow: var(--chip-shadow); font-size: .78rem; font-weight: 500; font-family: inherit; cursor: pointer; color: var(--text); transition: all 0.2s ease; }
    .filter-chip:hover { box-shadow: 0 3px 12px rgba(0,0,0,.18); transform: translateY(-1px); }
    .filter-chip.active { background: var(--primary-dark); color: #fff; border-color: var(--primary-dark); box-shadow: 0 4px 14px rgba(26,74,68,.3); animation: chipPulse 3.2s ease-in-out infinite; }
    .filter-chip.active .filter-dot { border-color: rgba(255,255,255,.4) !important; }
    .filter-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
    @keyframes chipPulse { 
      0%   { box-shadow: 0 0 0 0 var(--pulse-color, rgba(255,255,255,0.9)), 0 4px 14px rgba(26,74,68,.3); transform: scale(1); } 
      50%  { box-shadow: 0 0 0 5px rgba(0,0,0,0), 0 4px 14px rgba(26,74,68,.3); transform: scale(1.04); } 
      100% { box-shadow: 0 0 0 0 rgba(0,0,0,0), 0 4px 14px rgba(26,74,68,.3); transform: scale(1); } 
    }
    .filter-chip[data-imam="abdurrahman"].active { --pulse-color: rgba(232,99,10,1); }
    .filter-chip[data-imam="saed"].active        { --pulse-color: rgba(212,168,0,1); }
    .filter-chip[data-imam="noor"].active         { --pulse-color: rgba(41,128,185,1); }
    .filter-chip[data-imam="abdul"].active        { --pulse-color: rgba(160,160,160,0.9); }
    .filter-chip[data-imam="mohammed"].active     { --pulse-color: rgba(33,145,80,1); }
    .filter-chip[data-imam="yacquub"].active      { --pulse-color: rgba(200,200,200,0.9); }
    .filter-chip[data-imam="ibrahim"].active      { --pulse-color: rgba(41,128,185,1); }
    .filter-chip[data-imam="abdelsalam"].active   { --pulse-color: rgba(200,200,200,0.9); }
    .filter-chip[data-imam="hatem"].active        { --pulse-color: rgba(200,200,200,0.9); }
    tbody tr.filtered-out { display: none; }
    .day-card-mobile.filtered-out { display: none; }

    @keyframes fadeUp { from { opacity: 0; transform: translateY(18px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    footer { background: var(--footer-bg); text-align: center; padding: 24px 20px; color: rgba(255,255,255,.45); font-size: .8rem; letter-spacing: .05em; transition: background 0.35s; }
    footer strong { color: var(--gold); }

    @media (max-width: 640px) {
      header { padding: 20px 16px 18px; }
      main { padding: 24px 12px 60px; }
      .table-wrap { display: none; }
      .mobile-cards { display: block; }
      .filter-chips { flex-direction: row; flex-wrap: wrap; justify-content: flex-start; width: 100%; gap: 8px; }
      .filter-chip { justify-content: flex-start; border-radius: 30px; padding: 6px 12px 6px 8px; font-size: .8rem; flex: 0 1 auto; }
      .filter-wrap { align-items: flex-start; }
      .today-card-top { padding: 18px 20px 16px; }
      .today-card-body { padding: 14px 20px 16px; }
      .today-imam-name { font-size: 1.6rem; }
    }


    /* ‚îÄ‚îÄ Instagram / Kamera-knapp i today-card ‚îÄ‚îÄ */
    .today-cam-btn {
      display: inline-flex; align-items: center; justify-content: center;
      gap: 6px; background: rgba(201,168,76,0.15);
      border: 1px solid rgba(201,168,76,0.45); color: #e8c97a;
      padding: 9px 16px; border-radius: 100px;
      font-size: 0.68rem; font-weight: 600; letter-spacing: .06em; text-transform: uppercase;
      cursor: pointer; transition: all .25s; font-family: inherit; white-space: nowrap;
    }
    .today-cam-btn:hover { background: rgba(201,168,76,0.28); border-color: rgba(201,168,76,0.70); color: #e8c97a; transform: translateY(-1px); }
    #img-canvas { display: none; }

    /* ‚îÄ‚îÄ HEADER CONTROLS (left side) ‚îÄ‚îÄ */
    .header-controls-left {
      position: absolute; top: 10px; left: 12px; z-index: 10;
      display: inline-flex; align-items: center; gap: 8px;
    }
    @media (max-width: 640px) {
      .header-controls-left {
        flex-direction: column; align-items: flex-start; gap: 6px; top: 8px;
      }
    }

    /* Share button ‚Äî icon only */
    .share-btn {
      display: inline-flex; align-items: center; justify-content: center;
      width: 32px; height: 32px; border-radius: 50%;
      background: rgba(201,168,76,0.12);
      border: 1px solid rgba(201,168,76,0.32);
      color: var(--gold-light);
      cursor: pointer; transition: all .25s; font-family: inherit; flex-shrink: 0;
    }
    .share-btn:hover { background: rgba(201,168,76,0.22); border-color: rgba(201,168,76,0.6); transform: translateY(-1px); }
    .share-btn.share-copied { background: rgba(61,186,126,0.15); border-color: rgba(61,186,126,0.45); color: #3dba7e; }

    /* Share toast */
    .share-toast {
      position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%) translateY(12px);
      background: var(--surface); border: 1px solid rgba(61,186,126,0.4); color: #3dba7e;
      font-size: .75rem; font-weight: 600; padding: 10px 22px; border-radius: 100px;
      opacity: 0; transition: all .3s cubic-bezier(0.34,1.56,0.64,1); pointer-events: none;
      white-space: nowrap; box-shadow: 0 8px 24px rgba(0,0,0,0.3); z-index: 9998;
    }
    .share-toast.visible { opacity: 1; transform: translateX(-50%) translateY(0); }

    /* Lang dropdown */
    .lang-wrap { position: relative; }
    .lang-trigger {
      display: inline-flex; align-items: center; gap: 6px;
      background: rgba(255,255,255,0.09); border: 1px solid rgba(255,255,255,0.14);
      border-radius: 10px; padding: 4px 9px; cursor: pointer; transition: all .2s;
      font-family: inherit; color: #fff;
    }
    .lang-trigger:hover { background: rgba(255,255,255,0.15); }
    .lang-trigger .lang-flag { font-size: .9rem; line-height: 1; }
    .lang-trigger .lang-code { font-size: .68rem; font-weight: 700; color: rgba(255,255,255,.8); letter-spacing: .04em; }
    .lang-trigger .lang-chevron { color: rgba(255,255,255,.35); transition: transform .2s; flex-shrink: 0; }
    .lang-wrap.open .lang-chevron { transform: rotate(180deg); }
    .lang-dropdown {
      position: absolute; top: calc(100% + 8px); left: 0;
      background: #1a2e24; border: 1px solid rgba(255,255,255,0.12);
      border-radius: 14px; padding: 6px; min-width: 172px; z-index: 10010;
      box-shadow: 0 12px 40px rgba(0,0,0,0.55);
      opacity: 0; transform: translateY(-6px) scale(0.97);
      pointer-events: none; transition: all .22s cubic-bezier(0.34,1.56,0.64,1);
    }
    /* Light mode: ljus bakgrund ‚Äî byt text till m√∂rk */
    [data-theme="light"] .lang-dropdown {
      background: #ffffff;
      border-color: rgba(0,0,0,0.10);
      box-shadow: 0 12px 40px rgba(0,0,0,0.15);
    }
    .lang-wrap.open .lang-dropdown { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
    .lang-item {
      display: flex; align-items: center; gap: 10px; padding: 8px 10px;
      border-radius: 9px; cursor: pointer; transition: background .15s;
    }
    .lang-item:hover { background: rgba(255,255,255,0.09); }
    [data-theme="light"] .lang-item:hover { background: rgba(0,0,0,0.05); }
    .lang-item.active { background: rgba(36,100,93,0.45); }
    [data-theme="light"] .lang-item.active { background: rgba(36,100,93,0.12); }
    .lang-item .li-flag { font-size: .9rem; }
    .lang-item .li-native { font-size: .75rem; font-weight: 500; color: rgba(255,255,255,.85); flex: 1; }
    [data-theme="light"] .lang-item .li-native { color: rgba(20,40,30,.85); }
    .lang-item .li-code { font-size: .6rem; font-weight: 700; letter-spacing: .06em; color: rgba(255,255,255,.40); }
    [data-theme="light"] .lang-item .li-code { color: rgba(20,40,30,.35); }
    .lang-item.active .li-native { color: #fff; }
    [data-theme="light"] .lang-item.active .li-native { color: #0f2820; }
    .lang-item.active .li-code { color: rgba(201,168,76,.85); }
    .lang-divider-line { height: 1px; background: rgba(255,255,255,.06); margin: 4px 2px; }
    [data-theme="light"] .lang-divider-line { background: rgba(0,0,0,.07); }
  </style>
</head>
<body>

<header>
  <button class="theme-toggle" id="theme-toggle" onclick="toggleTheme()" aria-label="Byt tema">
    <div class="ios-track" id="ios-track">
      <span class="ios-track-label" id="toggle-label">LJUST<br>L√ÑGE</span>
      <div class="ios-thumb" id="ios-thumb">
        <span class="ios-thumb-icon ios-thumb-sun">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="4"/>
            <line x1="12" y1="2"  x2="12" y2="5"/>
            <line x1="12" y1="19" x2="12" y2="22"/>
            <line x1="4.22" y1="4.22"  x2="6.34" y2="6.34"/>
            <line x1="17.66" y1="17.66" x2="19.78" y2="19.78"/>
            <line x1="2"  y1="12" x2="5"  y2="12"/>
            <line x1="19" y1="12" x2="22" y2="12"/>
            <line x1="4.22" y1="19.78" x2="6.34" y2="17.66"/>
            <line x1="17.66" y1="6.34"  x2="19.78" y2="4.22"/>
          </svg>
        </span>
        <span class="ios-thumb-icon ios-thumb-moon">
          <svg width="11" height="11" viewBox="0 0 24 24" fill="white" stroke="none">
            <path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/>
          </svg>
        </span>
      </div>
    </div>
  </button>
  <div class="ornament">
    <div class="orn-line l"></div><div class="orn-dot"></div>
    <div class="orn-diamond"></div><div class="orn-dot"></div>
    <div class="orn-line r"></div>
  </div>
  <h1 id="header-h1">Tarawih Schema f√∂r<br>K√§mpingehallen<br><span style="font-size:0.65em;letter-spacing:0.04em;opacity:0.85;" id="header-year">Ramadan 2026</span></h1>
  <div class="header-address">
    <div class="addr-text">
      <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
      Tenstastr√•ket 16, 163 61 Sp√•nga
    </div>
    <a href="https://www.google.com/maps/search/?api=1&query=Tenstastr√•ket+16,+163+61+Sp√•nga" target="_blank">
      <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
      <span data-i18n="findUs">Hitta hit</span>
    </a>
  </div>
  <!-- HEADER CONTROLS LEFT: Spr√•k + Dela -->
  <div class="header-controls-left">
    <div class="lang-wrap" id="lang-wrap">
      <div class="lang-trigger" id="lang-trigger">
        <span class="lang-flag" id="lang-flag">üá∏üá™</span>
        <span class="lang-code" id="lang-code">SV</span>
        <svg class="lang-chevron" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="lang-dropdown" id="lang-dropdown">
        <div class="lang-item active" data-lang="sv" data-flag="üá∏üá™" data-code="SV"><span class="li-flag">üá∏üá™</span><span class="li-native">Svenska</span><span class="li-code">SV</span></div>
        <div class="lang-item" data-lang="ar" data-flag="üá∏üá¶" data-code="AR"><span class="li-flag">üá∏üá¶</span><span class="li-native">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</span><span class="li-code">AR</span></div>
        <div class="lang-divider-line"></div>
        <div class="lang-item" data-lang="en" data-flag="üá¨üáß" data-code="EN"><span class="li-flag">üá¨üáß</span><span class="li-native">English</span><span class="li-code">EN</span></div>
        <div class="lang-item" data-lang="tr" data-flag="üáπüá∑" data-code="TR"><span class="li-flag">üáπüá∑</span><span class="li-native">T√ºrk√ße</span><span class="li-code">TR</span></div>
        <div class="lang-item" data-lang="so" data-flag="üá∏üá¥" data-code="SO"><span class="li-flag">üá∏üá¥</span><span class="li-native">Soomaali</span><span class="li-code">SO</span></div>
      </div>
    </div>
    <button class="share-btn" id="share-btn" onclick="handleShare()">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="15.5"/><polyline points="8 5 12 1 16 5"/><path d="M16 11h2a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h2"/></svg>
    </button>
  </div>
  <!-- SHARE TOAST -->
  <div class="share-toast" id="share-toast"></div>
</header>

<!-- Mobile backdrop for moon bubble -->
<div class="moon-tooltip-backdrop" id="moon-tooltip-backdrop"></div>

<div class="wave">
  <svg viewBox="0 0 1440 56" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
    <path id="wave-path" d="M0,28 C400,65 1040,-9 1440,28 L1440,0 L0,0 Z" fill="#24645d"/>
  </svg>
</div>

<main>

  <!-- EID CARD -->
  <div class="eid-card" id="eid-card">
    <div class="eid-crescents">
      <span class="eid-crescent" style="left:8%;top:18%;--dur:7s;--delay:0s;--rot:-12deg;--max-op:0.15;">üåô</span>
      <span class="eid-crescent" style="right:10%;top:12%;--dur:9s;--delay:1.2s;--rot:10deg;--max-op:0.12;">üåô</span>
      <span class="eid-crescent" style="left:20%;bottom:20%;--dur:8s;--delay:2.5s;--rot:5deg;--max-op:0.10;">‚ú¶</span>
      <span class="eid-crescent" style="right:18%;bottom:25%;--dur:6.5s;--delay:0.8s;--rot:-8deg;--max-op:0.13;">‚ú¶</span>
      <span class="eid-crescent" style="left:50%;top:8%;--dur:10s;--delay:3s;--rot:3deg;--max-op:0.09;">üåô</span>
    </div>
    <div class="eid-inner">
      <div class="eid-ornament">
        <div class="eid-orn-line"></div><div class="eid-orn-dot"></div>
        <div class="eid-orn-diamond"></div><div class="eid-orn-dot"></div>
        <div class="eid-orn-line r"></div>
      </div>
      <div class="eid-arabic">ÿ™ŸéŸÇŸéÿ®ŸéŸëŸÑŸé ÿßŸÑŸÑŸáŸè ŸÖŸêŸÜŸéŸëÿß ŸàŸéŸÖŸêŸÜŸíŸÉŸèŸÖ</div>
      <div class="eid-title">Eid Mubarak</div>
      <div class="eid-divider">
        <div class="eid-divider-line"></div><div class="eid-divider-dot"></div><div class="eid-divider-line"></div>
      </div>
      <div class="eid-subtitle">Taqabbal Allahu minna wa minkum</div>
      <div class="eid-note">
        <strong>Ramadan 1447 √§r avslutat.</strong><br>
        M√• Allah acceptera era b√∂ner, fasta och goda g√§rningar.<br>
        Vi ses n√§sta √•r, in shaa Allah.
      </div>
      <a class="eid-instagram" href="https://www.instagram.com/sverigesimamer/" target="_blank" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>
        @sverigesimamer
      </a>
    </div>
  </div>

  <!-- TODAY CARD -->
  <div class="today-card-comet" id="today-card-comet" style="display:none;">
  <div class="today-card" id="today-card">
    <div class="today-card-top">
      <div class="today-card-header-content">
        <div class="today-badge-pill">
          <div class="today-badge-pill-dot"></div>
          <span class="today-badge-pill-text" data-i18n="badgeText">Dagens Imam</span>
        </div>
        <span class="today-imam-name" id="today-imam-name">‚Äî</span>
        <div class="today-date-row">
          <span class="today-date-text" id="today-date-label">‚Äî</span>
        </div>
      </div>
    </div>
    <div class="today-card-body">
      <div class="today-info-grid">
        <div class="today-info-cell">
          <span class="today-info-label" data-i18n="labelPages">Sidor idag</span>
          <span class="today-info-value" id="today-pages">‚Äî</span>
        </div>
        <div class="today-info-cell surahs-cell" id="surahs-cell">
          <span class="today-info-label" data-i18n="labelSurahs">Suror</span>
          <div class="surahs-value-wrap" id="surahs-value-wrap">
            <span class="today-info-value" style="font-size:1rem; font-family:'DM Sans',sans-serif; font-weight:500;" id="today-surahs-name">‚Äî</span>
            <span class="today-info-sub" id="today-surahs-ref"></span>
          </div>
          <span class="surahs-expand-hint" id="surahs-expand-hint" data-i18n="showMore">Visa alla ‚ñæ</span>
        </div>
      </div>
      <div class="today-countdown-section" id="isha-countdown">
        <div class="today-countdown-inner">
          <!-- Progress ring -->
          <div class="isha-ring-wrap">
            <svg class="isha-ring-svg" viewBox="0 0 54 54">
              <defs>
                <linearGradient id="ishaRingGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="rgba(201,168,76,0.7)"/>
                  <stop offset="100%" stop-color="rgba(255,230,120,1)"/>
                </linearGradient>
              </defs>
              <circle class="isha-ring-track" cx="27" cy="27" r="23"/>
              <circle class="isha-ring-fill" id="isha-ring-fill" cx="27" cy="27" r="23"/>
            </svg>
            <div class="isha-ring-icon">üïå</div>
          </div>
          <div class="today-countdown-left">
            <span class="today-countdown-label" id="isha-label" data-i18n="ishaLabel">Tid kvar till Isha</span>
            <div class="timer-wrap">
              <div class="today-timer" id="isha-timer">--:--:--</div>
              <div class="today-timer-done" id="isha-timer-done" data-i18n="ishaDoneTimer">üïå B√∂netiden √§r inne</div>
            </div>
            <span class="today-countdown-sub" id="isha-time-info"></span>
          </div>
          <button class="notif-btn" id="notif-btn" title="F√• en notis n√§r Isha-b√∂netiden b√∂rjar">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
            <span id="notif-btn-label" data-i18n="notifyMe">Notifiera mig</span>
          </button>
        </div>
      </div>
      <div class="today-card-footer" style="justify-content:space-between;">
        <button class="today-cam-btn" id="today-cam-btn" onclick="exportInstagramCard()">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="5" width="20" height="15" rx="2"/><circle cx="12" cy="12" r="4"/><path d="M9 5V3h6v2"/></svg>
          <span data-i18n="shareImg">Dela bild</span>
        </button>
        <button class="today-scroll-btn" onclick="scrollToToday()">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
          <span data-i18n="scrollBtn">Se i schemat</span>
        </button>
      </div>
    </div>
  </div>
  </div>
  <canvas id="img-canvas"></canvas>

  <!-- SECTION TITLE -->
  <div class="section-title">
    <h2 data-i18n="sectionHeading">Imamernas B√∂neledning</h2>
    <div class="divider"><span></span><i></i><span></span></div>
  </div>

  <!-- FILTER -->
  <div class="filter-wrap" id="filter-wrap">
    <div class="filter-chips" id="filter-chips">
      <button class="filter-chip fav-chip" id="fav-filter-chip" data-imam="favs" onclick="toggleFilter('favs')" style="display:none">
        <span class="fav-chip-heart" data-i18n-title="favTip" style="display:flex;align-items:center;color:rgba(0,0,0,0.4);">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        </span>
        <span data-i18n="favChip">Favoriter</span>
        <span class="fav-count-badge" style="display:none">0</span>
      </button>
      <button class="filter-chip" data-imam="abdurrahman" onclick="toggleFilter('abdurrahman')"><span class="filter-dot" style="background:var(--abdurrahman)"></span>Abdurrahman Sudani</button>
      <button class="filter-chip" data-imam="saed" onclick="toggleFilter('saed')"><span class="filter-dot" style="background:var(--saed);border:1px solid #bbb"></span>Saed Magan</button>
      <button class="filter-chip" data-imam="noor" onclick="toggleFilter('noor')"><span class="filter-dot" style="background:#ffffff;border:1px solid #bbb"></span>Noor</button>
      <button class="filter-chip" data-imam="abdul" onclick="toggleFilter('abdul')"><span class="filter-dot" style="background:var(--abdul)"></span>Abdul Qadir</button>
      <button class="filter-chip" data-imam="mohammed" onclick="toggleFilter('mohammed')"><span class="filter-dot" style="background:var(--mohammed)"></span>Mohammed Haji</button>
      <button class="filter-chip" data-imam="yacquub" onclick="toggleFilter('yacquub')"><span class="filter-dot" style="background:var(--yacquub)"></span>Yacquub</button>
      <button class="filter-chip" data-imam="ibrahim" onclick="toggleFilter('ibrahim')"><span class="filter-dot" style="background:var(--ibrahim)"></span>Ibrahim Noor</button>
      <button class="filter-chip" data-imam="abdelsalam" onclick="toggleFilter('abdelsalam')"><span class="filter-dot" style="background:var(--abdelsalam)"></span>Abdelsalam Nour</button>
      <button class="filter-chip" data-imam="hatem" onclick="toggleFilter('hatem')"><span class="filter-dot" style="background:var(--hatem)"></span>Hatem</button>
    </div>
  </div>

  <!-- DESKTOP TABLE -->
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>#</th><th data-i18n="thPages">Sidor</th><th data-i18n="thSurahs">Suror</th><th>Imam</th><th data-i18n="thDate">Datum</th><th></th><th></th><th data-i18n="thDay">Dag</th>
        </tr>
      </thead>
      <tbody id="table-body"></tbody>
    </table>
  </div>
  <div id="fav-empty" style="display:none; padding:48px 0; text-align:center;">
    <div style="font-size:2rem; margin-bottom:12px; opacity:0.25;">‚ô°</div>
    <p id="fav-empty-text" style="font-size:0.85rem; color:var(--muted); max-width:300px; margin:0 auto; line-height:1.6;"></p>
  </div>

  <!-- MOBILE CARDS -->
  <div class="mobile-cards" id="mobile-cards"></div>

</main>

<footer>
  <a href="https://www.instagram.com/sverigesimamer/" target="_blank" rel="noopener" style="display:inline-flex;align-items:center;gap:7px;color:rgba(255,255,255,.65);text-decoration:none;margin-bottom:12px;font-size:.82rem;transition:color 0.2s;" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='rgba(255,255,255,.65)'">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>
    @sverigesimamer
  </a>
  <br>
  &copy; 2026 &nbsp;<strong>Sveriges Imamer</strong>&nbsp; ‚Äî <span data-i18n="footerText">Tarawih Schema Ramadan 1447</span>
</footer>

<script>
  // ‚îÄ‚îÄ iOS-detektering ‚Äî Web Audio API hindrar bakgrundsuppspelning p√• iOS ‚îÄ‚îÄ
  window._isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !!navigator.maxTouchPoints;

  // ‚îÄ‚îÄ Hadith-texter ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const H_STAND_UP        = 'standUp';
  const H_SEEK_ODD        = 'seekOdd';
  const H_SEEK_NIGHT      = 'seekNight';
  const DEFAULT_MOON_TEXT = 'standUp';

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TRANSLATIONS
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  const LANG_KEY = 'tarawih-lang';
  let _currentLang = 'sv';

  const T = {
    sv: {
      days: { Monday:'M√•ndag', Tuesday:'Tisdag', Wednesday:'Onsdag', Thursday:'Torsdag', Friday:'Fredag', Saturday:'L√∂rdag', Sunday:'S√∂ndag' },
      hadith: {
        standUp:   'Profeten Ô∑∫ sade: "Den som st√•r upp i nattb√∂n under Laylatul-Qadr med tro och i hopp om bel√∂ning f√•r sina tidigare synder f√∂rl√•tna." (al-Bukhari och Muslim)',
        seekOdd:   'Profeten Ô∑∫ sade: "S√∂k Laylat al-Qadr i de udda n√§tterna under de sista tio dagarna av Ramadan." (Sahih Bukhari)',
        seekNight: 'Profeten Ô∑∫ sade: "S√∂k efter den (Maktens natt) p√• den tjugonionde, tjugosjunde och tjugofemte natten." Sahih al-Bukhari 2023',
      },
      months: ['januari','februari','mars','april','maj','juni','juli','augusti','september','oktober','november','december'],
      days7:  ['S√∂ndag','M√•ndag','Tisdag','Onsdag','Torsdag','Fredag','L√∂rdag'],
      night:           'Natt',
      todayBadge:      'Idag',
      pagesPrefix:     'Sidor',
      headerTitle:     'Tarawih Schema f√∂r<br>K√§mpingehallen',
      headerYear:      'Ramadan 2026',
      findUs:          'Hitta hit',
      lightMode:       'LJUST<br>L√ÑGE',
      darkMode:        'M√ñRKT<br>L√ÑGE',
      shareToast:      '‚úì L√§nk kopierad till urklipp',
      badgeText:       'Dagens Imam',
      labelPages:      'Sidor idag',
      labelSurahs:     'Suror',
      ishaLabel:       'Tid kvar till Isha',
      ishaDoneLabel:   'Isha',
      ishaDoneTimer:   'üïå B√∂netiden √§r inne',
      ishaPrefix:      'Isha-b√∂nen b√∂rjar kl. ',
      ishaDone:        'Isha-b√∂nen √§r inne sedan kl. ',
      notifyMe:        'Notifiera mig',
      showMore:         'Visa alla ‚ñæ',
      showLess:        'Visa mindre ‚ñ¥',
      favChip:          'Favoriter',
      noFavs:  'Du har inga favoriter √§n ‚Äî klicka p√• ‚ô° bredvid en natt f√∂r att spara den.',
      favTip:  'Spara favorit',
      shareTip:  'Dela session',
      skipBack:  '‚àí30 sekunder',
      skipFwd:   '+30 sekunder',
      prevNight: 'F√∂reg√•ende natt',
      nextNight: 'N√§sta natt',
      speedTip:  'Uppspelningshastighet',
      sleepTitle:  'St√§ng av efter',
      sleepStops:  'Stannar om',
      sleepCancel: 'Avbryt',
      sleepNightEnd: 'Nattslut',
      scrollBtn:       'Se i schemat',
      shareImg:        'Dela bild',
      sectionHeading:  'Imamernas B√∂neledning',
      thPages:         'Sidor',
      thSurahs:        'Suror',
      thDate:          'Datum',
      thDay:           'Dag',
      surahsDetail:    'Suror ‚Äî tryck f√∂r detaljer',
      footerText:      'Tarawih Schema Ramadan 1447',
      notifTitle:      'üïå Isha-b√∂nen √§r inne',
      notifBody:       'B√∂netiden har b√∂rjat ‚Äî kl. ',
      notifGranted:    'Notis aktiv',
      notifDenied:     'Notis blockerad',
    },
    ar: {
      days: { Monday:'ÿßŸÑÿßÿ´ŸÜŸäŸÜ', Tuesday:'ÿßŸÑÿ´ŸÑÿßÿ´ÿßÿ°', Wednesday:'ÿßŸÑÿ£ÿ±ÿ®ÿπÿßÿ°', Thursday:'ÿßŸÑÿÆŸÖŸäÿ≥', Friday:'ÿßŸÑÿ¨ŸÖÿπÿ©', Saturday:'ÿßŸÑÿ≥ÿ®ÿ™', Sunday:'ÿßŸÑÿ£ÿ≠ÿØ' },
      hadith: {
        standUp:   'ŸÇÿßŸÑ ÿßŸÑŸÜÿ®Ÿä Ô∑∫: ¬´ŸÖŸéŸÜ ŸÇÿßŸÖŸé ŸÑŸéŸäŸÑÿ©Ÿé ÿßŸÑŸÇŸéÿØÿ±Ÿê ÿ•ŸäŸÖÿßŸÜŸãÿß Ÿàÿßÿ≠ÿ™Ÿêÿ≥ÿßÿ®Ÿãÿßÿå ÿ∫ŸèŸÅŸêÿ±Ÿé ŸÑŸá ŸÖÿß ÿ™ŸéŸÇÿØŸéŸëŸÖŸé ŸÖŸêŸÜ ÿ∞ŸéŸÜÿ®ŸêŸá.¬ª (ÿßŸÑÿ®ÿÆÿßÿ±Ÿä ŸàŸÖÿ≥ŸÑŸÖ)',
        seekOdd:   'ŸÇÿßŸÑ ÿßŸÑŸÜÿ®Ÿä Ô∑∫: ¬´ÿ™Ÿéÿ≠Ÿéÿ±ŸéŸëŸàÿß ŸÑŸéŸäŸÑÿ©Ÿé ÿßŸÑŸÇŸéÿØÿ±Ÿê ŸÅŸä ÿßŸÑŸàŸêÿ™ÿ±Ÿê ŸÖŸêŸÜ ÿßŸÑÿπŸéÿ¥ÿ±Ÿê ÿßŸÑÿ£ŸàÿßÿÆŸêÿ±Ÿê ŸÖŸêŸÜ ÿ±ŸéŸÖŸéÿ∂ÿßŸÜ.¬ª (ÿµÿ≠Ÿäÿ≠ ÿßŸÑÿ®ÿÆÿßÿ±Ÿä)',
        seekNight: 'ŸÇÿßŸÑ ÿßŸÑŸÜÿ®Ÿä Ô∑∫: ¬´ÿßŸÑÿ™ŸéŸÖŸêÿ≥ŸàŸáÿß ŸÅŸä ÿßŸÑÿ™ÿßÿ≥Ÿêÿπÿ©Ÿê ŸàÿßŸÑÿ≥ÿßÿ®Ÿêÿπÿ©Ÿê ŸàÿßŸÑÿÆÿßŸÖŸêÿ≥ÿ©Ÿê.¬ª ÿµÿ≠Ÿäÿ≠ ÿßŸÑÿ®ÿÆÿßÿ±Ÿä 2023',
      },
      months: ['ŸäŸÜÿßŸäÿ±','ŸÅÿ®ÿ±ÿßŸäÿ±','ŸÖÿßÿ±ÿ≥','ÿ£ÿ®ÿ±ŸäŸÑ','ŸÖÿßŸäŸà','ŸäŸàŸÜŸäŸà','ŸäŸàŸÑŸäŸà','ÿ£ÿ∫ÿ≥ÿ∑ÿ≥','ÿ≥ÿ®ÿ™ŸÖÿ®ÿ±','ÿ£ŸÉÿ™Ÿàÿ®ÿ±','ŸÜŸàŸÅŸÖÿ®ÿ±','ÿØŸäÿ≥ŸÖÿ®ÿ±'],
      days7:  ['ÿßŸÑÿ£ÿ≠ÿØ','ÿßŸÑÿßÿ´ŸÜŸäŸÜ','ÿßŸÑÿ´ŸÑÿßÿ´ÿßÿ°','ÿßŸÑÿ£ÿ±ÿ®ÿπÿßÿ°','ÿßŸÑÿÆŸÖŸäÿ≥','ÿßŸÑÿ¨ŸÖÿπÿ©','ÿßŸÑÿ≥ÿ®ÿ™'],
      night:           'ŸÑŸäŸÑÿ©',
      todayBadge:      'ÿßŸÑŸäŸàŸÖ',
      pagesPrefix:     'ÿµŸÅÿ≠ÿßÿ™',
      headerTitle:     'ÿ¨ÿØŸàŸÑ ÿßŸÑÿ™ÿ±ÿßŸàŸäÿ≠<br>ŸÉÿßŸÖÿ®ŸäŸÜÿ∫ŸäŸáÿßŸÑŸÜ',
      headerYear:      'ÿ±ŸÖÿ∂ÿßŸÜ 2026',
      findUs:          'ÿßÿπÿ´ÿ± ÿπŸÑŸäŸÜÿß',
      lightMode:       'ŸÅÿßÿ™ÿ≠',
      darkMode:        'ÿØÿßŸÉŸÜ',
      shareToast:      '‚úì ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑',
      badgeText:       'ÿ•ŸÖÿßŸÖ ÿßŸÑŸäŸàŸÖ',
      labelPages:      'ÿßŸÑÿµŸÅÿ≠ÿßÿ™ ÿßŸÑŸäŸàŸÖ',
      labelSurahs:     'ÿßŸÑÿ≥Ÿàÿ±',
      ishaLabel:       'ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä ŸÑŸÑÿπÿ¥ÿßÿ°',
      ishaDoneLabel:   'ÿßŸÑÿπÿ¥ÿßÿ°',
      ishaDoneTimer:   'üïå ŸàŸÇÿ™ ÿßŸÑÿµŸÑÿßÿ© ÿ≠ÿßŸÜ',
      ishaPrefix:      'ÿµŸÑÿßÿ© ÿßŸÑÿπÿ¥ÿßÿ° ÿ™ÿ®ÿØÿ£ ÿßŸÑÿ≥ÿßÿπÿ© ',
      ishaDone:        'ÿµŸÑÿßÿ© ÿßŸÑÿπÿ¥ÿßÿ° ÿ®ÿØÿ£ÿ™ ÿßŸÑÿ≥ÿßÿπÿ© ',
      notifyMe:        'ÿ£ÿ¥ÿπÿ±ŸÜŸä',
      showMore:         'ÿπÿ±ÿ∂ ÿßŸÑŸÉŸÑ ‚ñæ',
      showLess:        'ÿπÿ±ÿ∂ ÿ£ŸÇŸÑ ‚ñ¥',
      favChip:          'ÿßŸÑŸÖŸÅÿ∂ŸÑÿ©',
      noFavs:  'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸÅÿ∂ŸÑÿßÿ™ ÿ®ÿπÿØ ‚Äî ÿßŸÜŸÇÿ± ÿπŸÑŸâ ‚ô° ÿ®ÿ¨ÿßŸÜÿ® ŸÑŸäŸÑÿ© ŸÑÿ≠ŸÅÿ∏Ÿáÿß.',
      favTip:  'ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÅÿ∂ŸÑÿ©',
      shareTip:  'ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©',
      skipBack:  '‚àíŸ£Ÿ† ÿ´ÿßŸÜŸäÿ©',
      skipFwd:   '+Ÿ£Ÿ† ÿ´ÿßŸÜŸäÿ©',
      prevNight: 'ÿßŸÑŸÑŸäŸÑÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©',
      nextNight: 'ÿßŸÑŸÑŸäŸÑÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ©',
      speedTip:  'ÿ≥ÿ±ÿπÿ© ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ',
      sleepTitle:  'ÿ•ŸäŸÇÿßŸÅ ÿ®ÿπÿØ',
      sleepStops:  'Ÿäÿ™ŸàŸÇŸÅ ÿÆŸÑÿßŸÑ',
      sleepCancel: 'ÿ•ŸÑÿ∫ÿßÿ°',
      sleepNightEnd: 'ŸÜŸáÿßŸäÿ© ÿßŸÑŸÑŸäŸÑÿ©',
      scrollBtn:       'ÿπÿ±ÿ∂ ŸÅŸä ÿßŸÑÿ¨ÿØŸàŸÑ',
      shareImg:        'ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿµŸàÿ±ÿ©',
      sectionHeading:  'ÿ•ŸÖÿßŸÖÿ© ÿßŸÑÿµŸÑÿßÿ©',
      thPages:         'ÿßŸÑÿµŸÅÿ≠ÿßÿ™',
      thSurahs:        'ÿßŸÑÿ≥Ÿàÿ±',
      thDate:          'ÿßŸÑÿ™ÿßÿ±ŸäÿÆ',
      thDay:           'ÿßŸÑŸäŸàŸÖ',
      surahsDetail:    'ÿßŸÑÿ≥Ÿàÿ± ‚Äî ÿßÿ∂ÿ∫ÿ∑ ŸÑŸÑÿ™ŸÅÿßÿµŸäŸÑ',
      footerText:      'ÿ¨ÿØŸàŸÑ ÿßŸÑÿ™ÿ±ÿßŸàŸäÿ≠ ÿ±ŸÖÿ∂ÿßŸÜ 1447',
      notifTitle:      'üïå ÿ≠ÿßŸÜ ŸàŸÇÿ™ ÿµŸÑÿßÿ© ÿßŸÑÿπÿ¥ÿßÿ°',
      notifBody:       'ÿ®ÿØÿ£ÿ™ ÿßŸÑÿµŸÑÿßÿ© ‚Äî ÿßŸÑÿ≥ÿßÿπÿ© ',
      notifGranted:    'ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ŸÜÿ¥ÿ∑',
      notifDenied:     'ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ŸÖÿ≠ÿ∏Ÿàÿ±',
    },
    en: {
      days: { Monday:'Monday', Tuesday:'Tuesday', Wednesday:'Wednesday', Thursday:'Thursday', Friday:'Friday', Saturday:'Saturday', Sunday:'Sunday' },
      hadith: {
        standUp:   'The Prophet Ô∑∫ said: "Whoever stands in prayer on Laylatul-Qadr with faith and in hope of reward, his previous sins will be forgiven." (al-Bukhari and Muslim)',
        seekOdd:   'The Prophet Ô∑∫ said: "Seek Laylat al-Qadr in the odd nights of the last ten days of Ramadan." (Sahih Bukhari)',
        seekNight: 'The Prophet Ô∑∫ said: "Seek it on the twenty-ninth, twenty-seventh and twenty-fifth night." Sahih al-Bukhari 2023',
      },
      months: ['January','February','March','April','May','June','July','August','September','October','November','December'],
      days7:  ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],
      night:           'Night',
      todayBadge:      'Today',
      pagesPrefix:     'Pages',
      headerTitle:     'Tarawih Schedule<br>K√§mpingehallen',
      headerYear:      'Ramadan 2026',
      findUs:          'Get directions',
      lightMode:       'LIGHT<br>MODE',
      darkMode:        'DARK<br>MODE',
      shareToast:      '‚úì Link copied to clipboard',
      badgeText:       "Today's Imam",
      labelPages:      "Today's pages",
      labelSurahs:     'Surahs',
      ishaLabel:       'Time until Isha',
      ishaDoneLabel:   'Isha',
      ishaDoneTimer:   'üïå Prayer time has begun',
      ishaPrefix:      'Isha prayer begins at ',
      ishaDone:        'Isha prayer started at ',
      notifyMe:        'Notify me',
      showMore:         'Show all ‚ñæ',
      showLess:        'Show less ‚ñ¥',
      favChip:          'Favourites',
      noFavs:  'No favourites yet ‚Äî tap ‚ô° next to a night to save it.',
      favTip:  'Save to favourites',
      shareTip:  'Share session',
      skipBack:  '‚àí30 seconds',
      skipFwd:   '+30 seconds',
      prevNight: 'Previous night',
      nextNight: 'Next night',
      speedTip:  'Playback speed',
      sleepTitle:  'Stop after',
      sleepStops:  'Stops in',
      sleepCancel: 'Cancel',
      sleepNightEnd: 'End of night',
      scrollBtn:       'View in schedule',
      shareImg:        'Share image',
      sectionHeading:  'Prayer Leadership',
      thPages:         'Pages',
      thSurahs:        'Surahs',
      thDate:          'Date',
      thDay:           'Day',
      surahsDetail:    'Surahs ‚Äî tap for details',
      footerText:      'Tarawih Schedule Ramadan 1447',
      notifTitle:      'üïå Isha prayer has begun',
      notifBody:       'Prayer time has started ‚Äî ',
      notifGranted:    'Notification active',
      notifDenied:     'Notification blocked',
    },
    tr: {
      days: { Monday:'Pazartesi', Tuesday:'Salƒ±', Wednesday:'√áar≈üamba', Thursday:'Per≈üembe', Friday:'Cuma', Saturday:'Cumartesi', Sunday:'Pazar' },
      hadith: {
        standUp:   "Peygamber Ô∑∫ ≈ü√∂yle buyurdu: 'Kim Kadir Gecesi‚Äônde inanarak ve sevabƒ±nƒ± yalnƒ±zca Allah‚Äôtan umarak ibadet ederse, ge√ßmi≈ü g√ºnahlarƒ± baƒüƒ±≈ülanƒ±r.' (Buhari ve M√ºslim)",
        seekOdd:   "Peygamber Ô∑∫ ≈ü√∂yle buyurdu: 'Kadir Gecesi‚Äôni, Ramazan‚Äôƒ±n son on g√ºn√ºndeki tek gecelerde arayƒ±nƒ±z.' (Sahih Buhari)",
        seekNight: 'Peygamber Ô∑∫ ≈ü√∂yle buyurdu: "Onu yirmi dokuzuncu, yirmi yedinci ve yirmi be≈üinci gecede arayƒ±nƒ±z." Sahih el-Buhari 2023',
      },
      months: ['Ocak','≈ûubat','Mart','Nisan','Mayƒ±s','Haziran','Temmuz','Aƒüustos','Eyl√ºl','Ekim','Kasƒ±m','Aralƒ±k'],
      days7:  ['Pazar','Pazartesi','Salƒ±','√áar≈üamba','Per≈üembe','Cuma','Cumartesi'],
      night:           'Gece',
      todayBadge:      'Bug√ºn',
      pagesPrefix:     'Sayfalar',
      headerTitle:     'Teravih Programƒ±<br>K√§mpingehallen',
      headerYear:      'Ramazan 2026',
      findUs:          'Yol tarifi',
      lightMode:       'A√áIK<br>MOD',
      darkMode:        'KOYU<br>MOD',
      shareToast:      '‚úì Baƒülantƒ± panoya kopyalandƒ±',
      badgeText:       'G√ºn√ºn ƒ∞mamƒ±',
      labelPages:      'Bug√ºn√ºn sayfalarƒ±',
      labelSurahs:     'Sureler',
      ishaLabel:       'Yatsƒ±ya kalan s√ºre',
      ishaDoneLabel:   'Yatsƒ±',
      ishaDoneTimer:   'üïå Namaz vakti girdi',
      ishaPrefix:      'Yatsƒ± namazƒ± saat ',
      ishaDone:        'Yatsƒ± namazƒ± ba≈üladƒ±, saat ',
      notifyMe:        'Beni bildir',
      showMore:         'T√ºm√ºn√º g√∂ster ‚ñæ',
      showLess:        'Daha az ‚ñ¥',
      favChip:          'Favoriler',
      noFavs:  'Hen√ºz favori yok ‚Äî kaydetmek i√ßin bir gecenin yanƒ±ndaki ‚ô° simgesine dokun.',
      favTip:  'Favorilere ekle',
      shareTip:  'Oturumu payla≈ü',
      skipBack:  '‚àí30 saniye',
      skipFwd:   '+30 saniye',
      prevNight: '√ñnceki gece',
      nextNight: 'Sonraki gece',
      speedTip:  'Oynatma hƒ±zƒ±',
      sleepTitle:  'Sonra durdur',
      sleepStops:  'Duruyor',
      sleepCancel: 'ƒ∞ptal',
      sleepNightEnd: 'Gecenin sonu',
      scrollBtn:       'Programda g√∂ster',
      shareImg:        'Resim payla≈ü',
      sectionHeading:  'ƒ∞mam Programƒ±',
      thPages:         'Sayfalar',
      thSurahs:        'Sureler',
      thDate:          'Tarih',
      thDay:           'G√ºn',
      surahsDetail:    'Sureler ‚Äî detaylar i√ßin dokun',
      footerText:      'Teravih Programƒ± Ramazan 1447',
      notifTitle:      'üïå Yatsƒ± namazƒ± vakti girdi',
      notifBody:       'Namaz ba≈üladƒ± ‚Äî saat ',
      notifGranted:    'Bildirim aktif',
      notifDenied:     'Bildirim engellendi',
    },
    so: {
      days: { Monday:'Isniin', Tuesday:'Talaado', Wednesday:'Arbaco', Thursday:'Khamiis', Friday:'Jimce', Saturday:'Sabti', Sunday:'Axad' },
      hadith: {
        standUp:   'Nabiga Ô∑∫ wuxuu yiri: "Qofkii taagan Laylatul-Qadr oo rumaysan oo rajaynaya abaalgud, dembiyadiisii hore waa la cafiyaa." (al-Bukhaari iyo Muslim)',
        seekOdd:   'Nabiga Ô∑∫ wuxuu yiri: "Ka doona Laylat al-Qadr habeenkii ku beegan tirada odd ee tobanka ugu dambeeyey ee Ramadaan." (Sahih Bukhaari)',
        seekNight: 'Nabiga Ô∑∫ wuxuu yiri: "Ka doona habeenka labaatan iyo sagaalaad, labaatan iyo toddobaad, iyo labaatan iyo shanaad." Sahih al-Bukhaari 2023',
      },
      months: ['Jannaayo','Febraayo','Maarso','Abriil','Maayo','Juun','Luulyo','Ogosto','Sebtembar','Oktoobar','Noofembar','Diseembar'],
      days7:  ['Axad','Isniin','Talaado','Arbaco','Khamiis','Jimce','Sabti'],
      night:           'Habeenka',
      todayBadge:      'Maanta',
      pagesPrefix:     'Bogagga',
      headerTitle:     'Jadwalka Taraawiix<br>K√§mpingehallen',
      headerYear:      'Ramadaan 2026',
      findUs:          'Raadi halka',
      lightMode:       'IFTI<br>MOD',
      darkMode:        'MADOW<br>MOD',
      shareToast:      '‚úì Xiriirka la koobiyeeyay',
      badgeText:       'Imaamka Maanta',
      labelPages:      'Bogagga maanta',
      labelSurahs:     'Surooyin',
      ishaLabel:       'Waqtiga khadka Cishaada',
      ishaDoneLabel:   "Cishaa'",
      ishaDoneTimer:   'üïå Waqtiga salaadda wuu yimid',
      ishaPrefix:      'Salaadda Cishaa waxay bilaabataa ',
      ishaDone:        'Salaadda Cishaa waxay bilaabatay ',
      notifyMe:        'I ogeysiiso',
      showMore:         'Muuji dhammaan ‚ñæ',
      showLess:        'Muuji yar ‚ñ¥',
      favChip:          'Jaceylayaasha',
      noFavs:  'Weli jaceelayaal ma jiraan ‚Äî riix ‚ô° agta habeenka si aad u keydsato.',
      favTip:  'Ku dar jaceylayaasha',
      shareTip:  'La wadaag xaaladda',
      skipBack:  '‚àí30 ilbiriqsi',
      skipFwd:   '+30 ilbiriqsi',
      prevNight: 'Habeenkii hore',
      nextNight: 'Habeenka xiga',
      speedTip:  'Xawaaraha ciyaarta',
      sleepTitle:  'Ka jooji kadib',
      sleepStops:  'Joogsanayaa',
      sleepCancel: 'Jooji',
      sleepNightEnd: 'Dhamaadka habeenka',
      scrollBtn:       'Arag jadwalka',
      shareImg:        'Wadaag sawir',
      sectionHeading:  'Hogaanka Salaadda',
      thPages:         'Bogagga',
      thSurahs:        'Surooyin',
      thDate:          'Taariikhda',
      thDay:           'Maalinta',
      surahsDetail:    'Surooyin ‚Äî taabo faahfaahin',
      footerText:      'Jadwalka Taraawiix Ramadaan 1447',
      notifTitle:      'üïå Waqtiga Cishaada wuu yimid',
      notifBody:       'Salaadda waxay bilaabatay ‚Äî ',
      notifGranted:    'Ogeysiiska waa firfircoon',
      notifDenied:     'Ogeysiiska waa la xidhay',
    },
  };

  function getMoonText(row) {
    const key = row.moonText || DEFAULT_MOON_TEXT;
    return (T[_currentLang] && T[_currentLang].hadith && T[_currentLang].hadith[key])
      ? T[_currentLang].hadith[key]
      : T['sv'].hadith[key];
  }

  function getDay(englishDay) {
    return (T[_currentLang] && T[_currentLang].days && T[_currentLang].days[englishDay])
      ? T[_currentLang].days[englishDay]
      : englishDay;
  }

  function getDateLabel(d) {
    const t = T[_currentLang] || T['sv'];
    const dayName   = t.days7  ? t.days7[d.getDay()]   : ['S√∂ndag','M√•ndag','Tisdag','Onsdag','Torsdag','Fredag','L√∂rdag'][d.getDay()];
    const monthName = t.months ? t.months[d.getMonth()] : ['januari','februari','mars','april','maj','juni','juli','augusti','september','oktober','november','december'][d.getMonth()];
    return dayName + ' ' + d.getDate() + ' ' + monthName;
  }

  const SCHEDULE = window.SCHEDULE = [
    {day:1,  sidor:'2‚Äì11',    imam:'abdurrahman', imamLabel:'Abdurrahman Sudani', datum:'2026-02-17', vecka:'Tuesday',   surahs:'Al-Baqarah',                                                                                                        tooltip:'2:1 ‚Äì 2:74'},
    {day:2,  sidor:'11‚Äì21',  imam:'saed',        imamLabel:'Saed Magan',         datum:'2026-02-18', vecka:'Wednesday',   surahs:'Al-Baqarah',                                                                                                        tooltip:'2:75 ‚Äì 2:141'},
    {day:3,  sidor:'22‚Äì31',  imam:'noor',        imamLabel:'Noor',               datum:'2026-02-19', vecka:'Thursday',  surahs:'Al-Baqarah',                                                                                                        tooltip:'2:142 ‚Äì 2:202'},
    {day:4,  sidor:'32‚Äì41',  imam:'abdul',       imamLabel:'Abdul Qadir',        datum:'2026-02-20', vecka:'Friday',   surahs:'Al-Baqarah',                                                                                                        tooltip:'2:203 ‚Äì 2:265'},
    {day:5,  sidor:'42‚Äì51',  imam:'mohammed',    imamLabel:'Mohammed Haji',      datum:'2026-02-21', vecka:'Saturday',   surahs:'Al-Baqarah, Ali Imran',                                                                                             tooltip:'2:266 ‚Äì 3:14'},
    {day:6,  sidor:'51‚Äì62',  imam:'abdurrahman', imamLabel:'Abdurrahman Sudani', datum:'2026-02-22', vecka:'Sunday',   surahs:'Ali Imran',                                                                                                         tooltip:'3:15 ‚Äì 3:92'},
    {day:7,  sidor:'62‚Äì72',  imam:'abdurrahman', imamLabel:'Abdurrahman Sudani', datum:'2026-02-23', vecka:'Monday',   surahs:'Ali Imran',                                                                                                         tooltip:'3:93 ‚Äì 3:170'},
    {day:8,  sidor:'72‚Äì81',  imam:'saed',        imamLabel:'Saed Magan',         datum:'2026-02-24', vecka:'Tuesday',   surahs:'Ali Imran, An-Nisa',                                                                                                tooltip:'3:171 ‚Äì 4:23'},
    {day:9,  sidor:'82‚Äì92',  imam:'ibrahim',     imamLabel:'Ibrahim Noor',        datum:'2026-02-25', vecka:'Wednesday',   surahs:'An-Nisa',                                                                                                           tooltip:'4:24 ‚Äì 4:87'},
    {day:10, sidor:'92‚Äì101', imam:'ibrahim',      imamLabel:'Ibrahim Noor',        datum:'2026-02-26', vecka:'Thursday',  surahs:'An-Nisa',                                                                                                           tooltip:'4:88 ‚Äì 4:147'},
    {day:11, sidor:'102‚Äì106',imam:'mohammed',    imamLabel:'Mohammed Haji',      datum:'2026-02-27', vecka:'Friday',   surahs:'An-Nisa, Fatir',                                                                                                    tooltip:'4:148 ‚Äì 35:30'},
    {day:12, sidor:'438‚Äì449',imam:'saed',        imamLabel:'Saed Magan',         datum:'2026-02-28', vecka:'Saturday',   surahs:'Fatir, Ya-Sin, As-Saffat',                                                                                          tooltip:'35:31 ‚Äì 37:82'},
    {day:13, sidor:'449‚Äì458',imam:'abdelsalam',  imamLabel:'Abdelsalam Nour',    datum:'2026-03-01', vecka:'Sunday',   surahs:'As-Saffat, Sad',                                                                                                    tooltip:'37:83 ‚Äì 38:88'},
    {day:14, sidor:'458‚Äì467',imam:'saed',        imamLabel:'Saed Magan',         datum:'2026-03-02', vecka:'Monday',   surahs:'Az-Zumar',                                                                                                          tooltip:'39:1 ‚Äì 39:75'},
    {day:15, sidor:'467‚Äì476',imam:'noor',        imamLabel:'Noor',               datum:'2026-03-03', vecka:'Tuesday',   surahs:'Ghafir',                                                                                                            tooltip:'40:1 ‚Äì 40:85'},
    {day:16, sidor:'476‚Äì486',imam:'mohammed',    imamLabel:'Mohammed Haji',      datum:'2026-03-04', vecka:'Wednesday',   surahs:'Fussilat, Ash-Shura',                                                                                               tooltip:'41:1 ‚Äì 42:26'},
    {day:17, sidor:'486‚Äì495',imam:'saed',        imamLabel:'Saed Magan',         datum:'2026-03-05', vecka:'Thursday',  surahs:'Ash-Shura, Az-Zukhruf',                                                                                             tooltip:'42:27 ‚Äì 43:89'},
    {day:18, sidor:'496‚Äì506',imam:'saed',        imamLabel:'Saed Magan',         datum:'2026-03-06', vecka:'Friday',   surahs:'Ad-Dukhan, Al-Jathiyah, Al-Ahqaf',                                                                                  tooltip:'44:1 ‚Äì 46:35'},
    {day:19, sidor:'507‚Äì515',imam:'yacquub',     imamLabel:'Yacquub',            datum:'2026-03-07', vecka:'Saturday',   surahs:'Muhammad, Al-Fath',                                                                                                 tooltip:'47:1 ‚Äì 48:29'},
    {day:20, sidor:'515‚Äì523',imam:'yacquub',     imamLabel:'Yacquub',            datum:'2026-03-08', vecka:'Sunday',   surahs:'Al-Hujurat, Qaf, Adh-Dhariyat',                                                                                     tooltip:'49:1 ‚Äì 51:60', moonText:H_SEEK_ODD},
    {day:21, sidor:'523‚Äì531',imam:'noor',        imamLabel:'Noor',               datum:'2026-03-09', vecka:'Monday',   surahs:'At-Tur, An-Najm, Al-Qamar',                                                                                         tooltip:'52:1 ‚Äì 54:55', moonText:H_SEEK_ODD},
    {day:22, sidor:'531‚Äì539',imam:'mohammed',    imamLabel:'Mohammed Haji',      datum:'2026-03-10', vecka:'Tuesday',   surahs:'Ar-Rahman, Al-Waqiah, Al-Hadid',                                                                                    tooltip:'55:1 ‚Äì 57:15', moonText:H_STAND_UP},
    {day:23, sidor:'539‚Äì548',imam:'abdurrahman', imamLabel:'Abdurrahman Sudani', datum:'2026-03-11', vecka:'Wednesday',   surahs:'Al-Hadid, Al-Mujadilah, Al-Hashr',                                                                                  tooltip:'57:16 ‚Äì 59:24', moonText:H_SEEK_ODD},
    {day:24, sidor:'549‚Äì557',imam:'abdul',       imamLabel:'Abdul Qadir',        datum:'2026-03-12', vecka:'Thursday',  surahs:'Al-Mumtahanah, As-Saf, Al-Jumuah, Al-Munafiqun, At-Taghabun',                                                       tooltip:'60:1 ‚Äì 64:18', moonText:H_STAND_UP},
    {day:25, sidor:'558‚Äì566',imam:'hatem',       imamLabel:'Hatem',              datum:'2026-03-13', vecka:'Friday',   surahs:'At-Talaq, At-Tahrim, Al-Mulk, Al-Qalam',                                                                            tooltip:'65:1 ‚Äì 68:52', moonText:H_SEEK_NIGHT},
    {day:26, sidor:'566‚Äì574',imam:'abdurrahman', imamLabel:'Abdurrahman Sudani', datum:'2026-03-14', vecka:'Saturday',   surahs:'Al-Haqqah, Al-Maarij, Nuh, Al-Jinn, Al-Muzzammil',                                                                  tooltip:'69:1 ‚Äì 73:20', moonText:H_STAND_UP},
    {day:27, sidor:'575‚Äì583',imam:'noor',        imamLabel:'Noor',               datum:'2026-03-15', vecka:'Sunday',   surahs:'Al-Muddaththir, Al-Qiyamah, Al-Insan, Al-Mursalat, An-Naba',                                                         tooltip:'74:1 ‚Äì 78:40', moonText:H_SEEK_NIGHT},
    {day:28, sidor:'583‚Äì591',imam:'mohammed',    imamLabel:'Mohammed Haji',      datum:'2026-03-16', vecka:'Monday',   surahs:'An-Naziat, Abasa, At-Takwir, Al-Infitar, Al-Mutaffifin, Al-Inshiqaq, Al-Buruj, At-Tariq, Al-Ala',                    tooltip:'79:1 ‚Äì 87:19', moonText:H_STAND_UP},
    {day:29, sidor:'592‚Äì604',imam:'yacquub',     imamLabel:'Yacquub',            datum:'2026-03-17', vecka:'Tuesday',   surahs:'Al-Ghashiyah, Al-Fajr, Al-Balad, Ash-Shams, Al-Layl, Ad-Duha, Ash-Sharh, At-Tin, Al-Alaq, Al-Qadr, Al-Bayyinah, Az-Zalzalah, Al-Adiyat, Al-Qariah, At-Takathur, Al-Asr, Al-Humazah, Al-Fil, Quraysh, Al-Maun, Al-Kawthar, Al-Kafirun, An-Nasr, Al-Masad, Al-Ikhlas, Al-Falaq, An-Nas', tooltip:'88:1 ‚Äì 114:6', moonText:H_SEEK_NIGHT},
    {day:30, sidor:'2‚Äì11',   imam:'noor',        imamLabel:'Noor',               datum:'2026-03-18', vecka:'Wednesday',   surahs:'Al-Baqarah',                                                                                                        tooltip:'2:1 ‚Äì 2:74'},
  ];

  const _now = new Date();
  const _p2 = n => String(n).padStart(2,'0');
  const today = _now.getFullYear() + '-' + _p2(_now.getMonth()+1) + '-' + _p2(_now.getDate());
  const isAfterRamadan = today > '2026-03-18';

  function scrollToToday() {
    const isMobile = window.innerWidth <= 640;
    const el = document.getElementById(isMobile ? 'today-row-mobile' : 'today-row-desktop');
    if (!el) return;
    const y = el.getBoundingClientRect().top + window.scrollY - 80;
    window.scrollTo({ top: y, behavior: 'smooth' });
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MOON BUBBLE LOGIC
     - Desktop: hover opens, click toggles, outside click closes
     - Mobile: tap opens full-screen bottom sheet with backdrop
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  const backdrop = document.getElementById('moon-tooltip-backdrop');
  let _activeMoonWrap = null;

  // ‚îÄ‚îÄ Animationstider ‚Äî matchar CSS-transitions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const BUBBLE_CLOSE_MS      = 2050;

  function isMobile() { return window.innerWidth <= 640; }

  function closeBubble(animate = true) {
    if (!_activeMoonWrap) return;
    const bubble = _activeMoonWrap.querySelector('.moon-bubble');
    _activeMoonWrap.classList.remove('bubble-open');
    if (bubble) {
      if (animate && isMobile()) {
        bubble.style.transform = 'translateY(100%)';
        setTimeout(() => {
          bubble.style.cssText = '';
          bubble.classList.remove('bubble-closing');
        }, BUBBLE_CLOSE_MS);
      } else if (animate) {
        bubble.classList.add('bubble-closing');
        setTimeout(() => {
          bubble.classList.remove('bubble-closing');
          bubble.style.cssText = '';
        }, BUBBLE_CLOSE_MS);
      } else {
        bubble.classList.remove('bubble-closing');
        bubble.style.cssText = '';
      }
    }
    if (isMobile()) {
      backdrop.classList.add('hiding');
      backdrop.classList.remove('visible');
      backdrop.addEventListener('animationend', () => backdrop.classList.remove('hiding'), { once: true });
    }
    _activeMoonWrap = null;
  }

  function openBubble(wrapEl) {
    if (_activeMoonWrap === wrapEl) { closeBubble(true); return; }
    if (_activeMoonWrap) closeBubble(false);
    _activeMoonWrap = wrapEl;
    const bubble = wrapEl.querySelector('.moon-bubble');
    if (bubble) {
      bubble.classList.remove('bubble-closing');
      if (isMobile()) {
        bubble.style.visibility = 'visible';
        bubble.style.transform = 'translateY(100%)';
        requestAnimationFrame(() => {
          requestAnimationFrame(() => { bubble.style.transform = 'translateY(0)'; });
        });
      } else {
        bubble.style.cssText = '';
        requestAnimationFrame(() => {
          const playerEl = document.getElementById('sticky-player');
          if (!playerEl || !playerEl.classList.contains('visible')) return;
          const bubbleRect = bubble.getBoundingClientRect();
          const playerRect = playerEl.getBoundingClientRect();
          if (bubbleRect.bottom > playerRect.top) {
            const overlap = bubbleRect.bottom - playerRect.top + 8;
            bubble.style.bottom = `calc(100% + 10px + ${overlap}px)`;
          }
        });
      }
    }
    wrapEl.classList.add('bubble-open');
    if (isMobile()) {
      backdrop.classList.add('visible');
      backdrop.classList.remove('hiding');
    }
  }

  backdrop.addEventListener('click', () => closeBubble(true));

  document.addEventListener('click', (e) => {
    // Klick utanf√∂r full player ‚Üí mini
    const playerEl = document.getElementById('sticky-player');
    if (_activeDatum && playerEl && playerEl.classList.contains('visible') && !playerEl.classList.contains('mini-mode')) {
      if (!e.target.closest('.sticky-player')) {
        clearTimeout(_autoMiniTimer);
        miniSticky();
      }
    }

    // Close surah tooltips
    if (!e.target.closest('.surah-cell') && !e.target.closest('.dcm-surahs'))
      document.querySelectorAll('.tooltip-box.visible, .dcm-tooltip.visible').forEach(el => el.classList.remove('visible'));

    // Moon bubble click handling ‚Äî works on ALL screen sizes
    const moonWrap = e.target.closest('.moon-wrap, .today-moon-wrap');
    if (moonWrap) {
      const isOpen = moonWrap.classList.contains('bubble-open');
      if (_activeMoonWrap && _activeMoonWrap !== moonWrap) closeBubble(false);
      isOpen ? closeBubble(true) : openBubble(moonWrap);
      e.stopPropagation();
      return;
    }

    // Close on outside click
    if (_activeMoonWrap && !e.target.closest('.moon-wrap') && !e.target.closest('.today-moon-wrap') && !e.target.closest('.moon-bubble')) {
      closeBubble(true);
    }
  });

  /* ‚îÄ‚îÄ Build moon bubble HTML ‚Äî identical for ALL last-ten days ‚îÄ‚îÄ */
  function makeMoonBubble(text) {
    return `<div class="moon-bubble"><span class="moon-bubble-label">üåô Laylatul-Qadr</span><span class="moon-bubble-text">${text}</span></div>`;
  }

  /* ‚îÄ‚îÄ Moon icon SVG ‚îÄ‚îÄ */
  function moonSvg(fill, size) {
    return `<svg width="${size}" height="${size}" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z" fill="${fill}"/></svg>`;
  }

  /* ‚îÄ‚îÄ Build desktop table ‚îÄ‚îÄ */
  const tbody = document.getElementById('table-body');
  SCHEDULE.forEach(row => {
    const isToday = row.datum === today;
    const tr = document.createElement('tr');
    tr.setAttribute('data-datum', row.datum);
    if (isToday) { tr.classList.add('today'); tr.id = 'today-row-desktop'; }
    const veckaClass = row.vecka === 'Friday' ? 'fredag' : row.vecka === 'Saturday' ? 'lordag' : row.vecka === 'Sunday' ? 'sondag' : '';
    const badge = isToday ? '<span class="today-badge" data-i18n="todayBadge">' + (T[_currentLang].todayBadge || 'Idag') + '</span>' : '';
    const isLastTen = row.day >= 21;
    if (isLastTen) tr.classList.add('last-ten');

    const isOdd = row.day % 2 !== 0;
    const moonFill = isOdd ? '#fff2c0' : 'white';
    const moonClass = isOdd ? 'moon-icon moon-odd' : 'moon-icon';
    const moonText = getMoonText(row);

    const moonCell = isLastTen
      ? `<span class="moon-wrap"><span class="${moonClass}">${moonSvg(moonFill, 12)}</span>${makeMoonBubble(moonText)}</span>`
      : '';

    const hijriDay = row.day - 1;
    const hijriLabel = hijriDay > 0 ? `<div class="hijri-label"><span class="hijri-moon">üåô</span>${hijriDay} Ramadan</div>` : '';

    tr.innerHTML = `
      <td class="td-dag">${row.day}</td>
      <td class="td-sidor">${row.sidor}</td>
      <td class="td-surah surah-cell" tabindex="0">
        <div class="surah-names">${row.surahs}</div>
        <div class="tooltip-box">üìñ ${row.tooltip}</div>
      </td>
      <td><span class="imam-chip imam-${row.imam}"><span class="dot"></span>${row.imamLabel}</span></td>
      <td class="td-datum ${isToday ? 'today-date' : ''}">${row.datum}${badge}${hijriLabel}</td>
      <td class="td-audio" id="audio-desktop-${row.datum}"></td>
      <td class="td-moon">${moonCell}</td>
      <td class="td-veckodag ${veckaClass}" data-vecka="${row.vecka}">${getDay(row.vecka)}</td>
      <td class="td-fav"><button class="fav-btn" data-day="${row.day}" title="Spara favorit" onclick="toggleFav(${row.day}, this);event.stopPropagation()"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></button></td>
    `;
    // Injicera EN sweep-div som t√§cker hela today desktop-raden
    if (isToday) {
      tr.style.position = 'relative';
      const sweepTd = document.createElement('td');
      sweepTd.style.cssText = 'position:absolute;inset:0;padding:0;border:none;pointer-events:none;overflow:hidden;';
      const sweep = document.createElement('div');
      sweep.className = 'td-sweep';
      sweepTd.appendChild(sweep);
      tr.appendChild(sweepTd);
    }
    const cell = tr.querySelector('.surah-cell');
    if (cell) {
      cell.addEventListener('click', (e) => {
        const tip = cell.querySelector('.tooltip-box');
        const isVisible = tip.classList.contains('visible');
        document.querySelectorAll('.tooltip-box.visible').forEach(el => el.classList.remove('visible'));
        if (!isVisible) tip.classList.add('visible');
        e.stopPropagation();
      });
    }
    tbody.appendChild(tr);
  });

  /* ‚îÄ‚îÄ Build mobile cards ‚îÄ‚îÄ */
  const container = document.getElementById('mobile-cards');
  SCHEDULE.forEach(row => {
    const isToday = row.datum === today;
    const card = document.createElement('div');
    const isLastTenM = row.day >= 21;
    card.className = 'day-card-mobile' + (isToday ? ' today' : '') + (isLastTenM ? ' last-ten' : '');
    card.setAttribute('data-datum', row.datum);
    if (isToday) card.id = 'today-row-mobile';
    const veckaClass = row.vecka === 'Friday' ? 'fredag' : row.vecka === 'Saturday' ? 'lordag' : row.vecka === 'Sunday' ? 'sondag' : '';
    const badge = isToday ? '<span class="today-badge" data-i18n="todayBadge">' + (T[_currentLang].todayBadge || 'Idag') + '</span>' : '';
    const isOdd = row.day % 2 !== 0;
    const moonFill = isOdd ? '#fff2c0' : 'white';
    const moonClass = isOdd ? 'moon-icon moon-odd' : 'moon-icon';
    const moonText = getMoonText(row);

    const moonSpan = isLastTenM
      ? `<span class="moon-wrap" style="margin-left:5px;"><span class="${moonClass}">${moonSvg(moonFill, 11)}</span>${makeMoonBubble(moonText)}</span>`
      : '';

    card.innerHTML = `
      <div class="dcm-top">
        <div class="dcm-dag ${isToday ? 'today-day' : ''}">${row.day}</div>
        <div class="dcm-body">
          <div class="dcm-imam"><span class="imam-chip imam-${row.imam}"><span class="dot"></span>${row.imamLabel}</span></div>
          <div class="dcm-meta">
            <span class="dcm-date">${row.datum}${badge}</span>
            ${row.day > 1 ? `<span class="dcm-hijri"><span class="hijri-moon">üåô</span>${row.day - 1} Ramadan</span>` : ''}
            ${moonSpan}
            <span class="dcm-day-label ${veckaClass}" data-vecka="${row.vecka}">${getDay(row.vecka)}</span>
            <span class="dcm-pages">s. ${row.sidor}</span>
          </div>
        </div>
        <div class="dcm-right-wrap" style="display:flex;align-items:center;gap:12px;flex-shrink:0;margin-left:auto;">
          <div class="dcm-audio-right" id="audio-mobile-${row.datum}" style="margin-left:0;"></div>
          <div class="dcm-fav-wrap"><button class="fav-btn" data-day="${row.day}" title="Spara favorit" onclick="toggleFav(${row.day}, this);event.stopPropagation()"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></button></div>
        </div>
      </div>
      <div class="dcm-surahs">
        <span class="dcm-surahs-label">${T[_currentLang].surahsDetail || 'Suror ‚Äî tryck f√∂r detaljer'}</span>
        ${row.surahs}
        <div class="dcm-tooltip">üìñ ${row.tooltip}</div>
      </div>
    `;
    const surahBox = card.querySelector('.dcm-surahs');
    surahBox.addEventListener('click', (e) => {
      const tip = surahBox.querySelector('.dcm-tooltip');
      const isVisible = tip.classList.contains('visible');
      document.querySelectorAll('.dcm-tooltip.visible').forEach(el => el.classList.remove('visible'));
      if (!isVisible) {
        tip.classList.add('visible');
        setTimeout(() => { surahBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); }, 220);
      }
      e.stopPropagation();
    });
    // Sweep p√• mobile today-kort
    if (isToday) {
      card.style.position = 'relative';
      card.style.overflow = 'hidden';
      const sweep = document.createElement('div');
      sweep.className = 'td-sweep';
      card.appendChild(sweep);
    }
    container.appendChild(card);
  });

  /* ‚îÄ‚îÄ Today card ‚îÄ‚îÄ */
  if (isAfterRamadan) document.getElementById('eid-card').style.display = 'block';

  const todayData = SCHEDULE.find(r => r.datum === today);
  if (todayData) {
    const d = new Date(today);
    document.getElementById('today-imam-name').textContent = todayData.imamLabel;
    const dateLabel = getDateLabel(d);

    // Hijri datum ‚Äî dag 2 i schemat = 1 Ramadan 1447 (offset -1)
    const hijriDay = todayData.day - 1;
    const hijriStr = hijriDay + ' Ramadan 1447';

    if (todayData.day >= 21) {
      const dateEl = document.getElementById('today-date-label');
      dateEl.textContent = dateLabel;
      const isTodayOdd = todayData.day % 2 !== 0;
      const todayMoonText = getMoonText(todayData);
      const moonFill = isTodayOdd ? '#fff2c0' : 'white';
      const oddClass = isTodayOdd ? ' moon-odd-today' : '';
      const moonWrap = document.createElement('span');
      moonWrap.className = 'today-moon-wrap';
      moonWrap.style.marginLeft = '8px';
      moonWrap.innerHTML = `<span class="today-moon-icon${oddClass}">${moonSvg(moonFill, 12)}</span>${makeMoonBubble(todayMoonText)}`;
      dateEl.parentNode.appendChild(moonWrap);

      // Inline hadith in today-card header
      const headerContent = document.querySelector('.today-card-header-content');
      const hadithDiv = document.createElement('div');
      hadithDiv.className = 'today-hadith-inline';
      hadithDiv.innerHTML = `<span class="hadith-label">üåô Laylatul-Qadr</span>${todayMoonText}`;
      headerContent.appendChild(hadithDiv);
    } else {
      document.getElementById('today-date-label').textContent = dateLabel;
    }

    // L√§gg till Hijri-datum i date-row
    const dateRow = document.querySelector('.today-date-row');
    if (dateRow) {
      const dot = document.createElement('div');
      dot.className = 'today-date-hijri-dot';
      const hijriEl = document.createElement('span');
      hijriEl.className = 'today-date-hijri';
      hijriEl.textContent = hijriStr;
      const arabicEl = document.createElement('span');
      arabicEl.className = 'today-date-hijri-arabic';
      arabicEl.textContent = 'ÿ±ŸÖÿ∂ÿßŸÜ';
      dateRow.appendChild(dot);
      dateRow.appendChild(hijriEl);
      dateRow.appendChild(arabicEl);
    }

    const pagesValEl = document.getElementById('today-pages');
    pagesValEl.dataset.sidor = todayData.sidor;
    pagesValEl.textContent = (T[_currentLang].pagesPrefix || 'Sidor') + ' ' + todayData.sidor;
    document.getElementById('today-surahs-name').textContent = todayData.surahs;

    // Expanderbar suror-cell ‚Äî kolla om texten √§r f√∂r l√•ng
    (function() {
      const cell    = document.getElementById('surahs-cell');
      const wrap    = document.getElementById('surahs-value-wrap');
      const hint    = document.getElementById('surahs-expand-hint');
      const nameEl  = document.getElementById('today-surahs-name');
      // V√§nta en tick s√• webbl√§saren hunnit ritat ut texten
      requestAnimationFrame(() => {
        const lineH   = parseFloat(getComputedStyle(nameEl).lineHeight) || 20;
        const maxH    = lineH * 3;   // 3 rader = gr√§ns
        if (nameEl.scrollHeight > maxH + 4) {
          wrap.classList.add('collapsed');
          cell.classList.add('expandable');
          let expanded = false;
          cell.addEventListener('click', () => {
            expanded = !expanded;
            cell.classList.toggle('expanded', expanded);
            wrap.classList.toggle('collapsed', !expanded);
            const t = T[_currentLang];
            hint.textContent = expanded ? (t.showLess || 'Visa mindre ‚ñ¥') : (t.showMore || 'Visa alla ‚ñæ');
          });
        }
      });
    })();
    document.getElementById('today-surahs-ref').textContent = todayData.tooltip;

    // Visa komet-wrapper ist√§llet f√∂r pulsing
    const todayCard = document.getElementById('today-card');
    const cometWrap = document.getElementById('today-card-comet');
    todayCard.style.display = 'block';
    cometWrap.style.display = 'block';
  }

  /* ‚îÄ‚îÄ AUDIO ‚îÄ‚îÄ */
  const audioState = {};
  let _stickyScrollTimer = null;
  let _seekActive = false;
  let _autoMiniTimer = null;   // true under p√•g√•ende seek ‚Äî blockerar scroll‚Üímini

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // FAVORITER ‚Äî localStorage
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  const FAV_KEY = 'tarawih_favs_2026';





  function getFavs() {
    try { return JSON.parse(localStorage.getItem(FAV_KEY) || '[]'); } catch { return []; }
  }
  function saveFavs(arr) {
    localStorage.setItem(FAV_KEY, JSON.stringify(arr));
  }
  function isFav(day) { return getFavs().includes(day); }

  function toggleFav(day, triggerEl) {
    const favs = getFavs();
    const idx  = favs.indexOf(day);
    const adding = idx === -1;
    if (adding) favs.push(day); else favs.splice(idx, 1);
    saveFavs(favs);
    updateAllFavBtns(day, adding);
    updateFavChip();
    if (activeFilter === 'favs') applyFilter();


    // Pop-animation p√• det klickade elementet
    if (triggerEl) {
      triggerEl.classList.remove('pop');
      triggerEl.classList.remove('ring-fade');
      void triggerEl.offsetWidth;
      triggerEl.classList.add('pop');
      triggerEl.addEventListener('animationend', () => triggerEl.classList.remove('pop'), { once: true });
      if (adding) {
        setTimeout(() => {
          triggerEl.classList.add('ring-fade');
          triggerEl.addEventListener('animationend', () => triggerEl.classList.remove('ring-fade'), { once: true });
        }, 80);
      }
    }
  }

  function updateAllFavBtns(day, isFaved) {
    document.querySelectorAll('.fav-btn[data-day="' + day + '"]').forEach(btn => {
      btn.classList.toggle('active', isFaved);
    });
  }

  function updateFavChip() {
    const count    = getFavs().length;
    const chip     = document.getElementById('fav-filter-chip');
    if (!chip) return;
    const badge    = chip.querySelector('.fav-count-badge');
    const wasHidden = chip.style.display === 'none' || chip.style.display === '';
    const siblings  = Array.from(chip.parentElement.querySelectorAll('.filter-chip:not(#fav-filter-chip)'));

    if (badge) {
      badge.textContent = count > 0 ? count : '';
      badge.style.display = count > 0 ? '' : 'none';
    }

    if (count > 0 && (chip.style.display === 'none' || chip.style.display === '')) {
      // ‚Äî POP IN ‚Äî
      chip.style.display = 'inline-flex';
      chip.classList.remove('fav-chip-leaving');
      void chip.offsetWidth; // force reflow
      chip.classList.add('fav-chip-entering');
      chip.addEventListener('animationend', () => {
        chip.classList.remove('fav-chip-entering');
      }, { once: true });

      // Siblings glide right
      siblings.forEach(s => {
        s.classList.remove('chip-nudge-right', 'chip-nudge-left');
        void s.offsetWidth;
        s.classList.add('chip-nudge-right');
        s.addEventListener('animationend', () => s.classList.remove('chip-nudge-right'), { once: true });
      });

    } else if (count === 0 && chip.style.display !== 'none') {
      // ‚Äî POP OUT ‚Äî
      chip.classList.remove('fav-chip-entering');
      chip.classList.add('fav-chip-leaving');
      chip.addEventListener('animationend', () => {
        chip.classList.remove('fav-chip-leaving');
        chip.style.display = 'none';
      }, { once: true });

      // Siblings glide left
      siblings.forEach(s => {
        s.classList.remove('chip-nudge-right', 'chip-nudge-left');
        void s.offsetWidth;
        s.classList.add('chip-nudge-left');
        s.addEventListener('animationend', () => s.classList.remove('chip-nudge-left'), { once: true });
      });

      // √Öterst√§ll filter om favs var aktivt
      if (chip.classList.contains('active')) {
        chip.classList.remove('active');
        if (typeof activeFilter !== 'undefined' && activeFilter === 'favs') {
          activeFilter = null;
          if (typeof applyFilter === 'function') applyFilter();
        }
      }
    }
  }

  // ‚îÄ‚îÄ ACTIVE TRACK TYPE per datum: 'tarawih' | 'isha' ‚îÄ‚îÄ
  const _activeTrackType = {}; // datum ‚Üí 'tarawih' | 'isha'

  function showSegmentControl(datum) {
    const wrap = document.getElementById('sp-segment-wrap');
    if (!wrap) return;
    const hasIsha = !!ishaUrls[datum];
    wrap.classList.toggle('visible', hasIsha);
    if (!hasIsha) return;
    // Set pill to current active track
    const type = _activeTrackType[datum] || 'tarawih';
    _updateSegmentPill(type);
  }

  function hideSegmentControl() {
    const wrap = document.getElementById('sp-segment-wrap');
    if (wrap) wrap.classList.remove('visible');
  }

  function _updateSegmentPill(type) {
    const seg   = document.getElementById('sp-segment');
    const pill  = document.getElementById('sp-segment-pill');
    const btnT  = document.getElementById('sp-seg-tarawih');
    const btnI  = document.getElementById('sp-seg-isha');
    if (!seg || !pill || !btnT || !btnI) return;

    btnT.classList.toggle('active', type === 'tarawih');
    btnI.classList.toggle('active', type === 'isha');

    // Move pill to active button
    const activeBtn = type === 'tarawih' ? btnT : btnI;
    const segRect   = seg.getBoundingClientRect();
    const btnRect   = activeBtn.getBoundingClientRect();
    pill.style.left  = (btnRect.left - segRect.left) + 'px';
    pill.style.width = btnRect.width + 'px';
  }

  function _switchTrack(datum, type) {
    if (!datum) return;
    const prevType = _activeTrackType[datum] || 'tarawih';
    if (prevType === type) return;

    // Pause whichever is playing
    const prevAudio = type === 'isha' ? audioState[datum] : ishaState[datum];
    if (prevAudio && !prevAudio.paused) {
      prevAudio.pause();
      setBtns(datum, PLAY_SVG, false);
      updateStickyPlayBtn(false);
      if (window._stopWaveDraw) window._stopWaveDraw();
    }

    _activeTrackType[datum] = type;
    _updateSegmentPill(type);

    // Update progress bar to new track's position
    const nextAudio = type === 'isha' ? ishaState[datum] : audioState[datum];
    if (nextAudio) {
      updatePlayerUI(datum, nextAudio.currentTime, nextAudio.duration || 0);
      setBtns(datum, nextAudio.paused ? PLAY_SVG : PAUSE_SVG, !nextAudio.paused);
    } else {
      updatePlayerUI(datum, 0, 0);
      setBtns(datum, PLAY_SVG, false);
    }
  }

  // Override toggleAudio to respect active track type
  // We patch the sticky play button to route to correct audio
  function _getActiveAudio(datum) {
    const type = _activeTrackType[datum] || 'tarawih';
    if (type === 'isha') return ishaState[datum];
    return audioState[datum];
  }

    function syncAllFavBtns() {
    const favs = getFavs();
    document.querySelectorAll('.fav-btn[data-day]').forEach(btn => {
      const day = parseInt(btn.dataset.day);
      btn.classList.toggle('active', favs.includes(day));
    });
    updateFavChip();
  }


  let _activeDatum = null;

  // Imam-f√§rger ‚Äî matchar CSS-variablerna och filter-chips
  const IMAM_COLORS = {
    abdurrahman: '#e8630a',
    saed:        '#d4a800',
    noor:        '#4a7fa8',
    abdul:       '#4a4a4a',
    mohammed:    '#219150',
    yacquub:     '#7d3aac',
    abdelsalam:  '#7b3f00',
    hatem:       '#2d6a4f',
    ibrahim:     '#1a3a6b',
  };

  function imamInitials(label) {
    const parts = label.trim().split(/\s+/);
    if (parts.length === 1) return parts[0].slice(0,2).toUpperCase();
    return (parts[0][0] + parts[parts.length-1][0]).toUpperCase();
  }

  function lightenHex(hex, amt) {
    const num = parseInt(hex.replace('#',''), 16);
    const r = Math.min(255, (num>>16) + amt);
    const g = Math.min(255, ((num>>8)&0xff) + amt);
    const b = Math.min(255, (num&0xff) + amt);
    return '#' + [r,g,b].map(v => v.toString(16).padStart(2,'0')).join('');
  }

  function applyImamColor(imamKey, imamLabel, nightNum) {
    const base    = IMAM_COLORS[imamKey] || '#1a4a44';
    const light   = lightenHex(base, 48);
    const grad    = 'linear-gradient(135deg, ' + base + ' 0%, ' + light + ' 100%)';

    // Full player artwork
    const art = document.getElementById('sp-artwork');
    if (art) { art.style.background = grad; }
    const ini = document.getElementById('sp-initials');
    if (ini) ini.textContent = imamInitials(imamLabel);
    // Progress fill + ring
    const pf = document.getElementById('sticky-fill');
    if (pf) pf.style.background = 'linear-gradient(to right, ' + base + ', ' + light + ')';
    const rf = document.getElementById('sp-ring-fill');
    if (rf) rf.style.stroke = light;
    const ri = document.getElementById('sp-ring-inner');
    if (ri) ri.style.background = 'linear-gradient(135deg, ' + lightenHex(base,-20) + ', ' + lightenHex(base,-40) + ')';

    // Mini artwork + progress
    const ma = document.getElementById('sp-mini-artwork');
    if (ma) ma.style.background = grad;
    const mi = document.getElementById('sp-mini-initials');
    if (mi) mi.textContent = imamInitials(imamLabel);
    const mpf = document.getElementById('sp-mini-pfill');
    if (mpf) mpf.style.background = 'linear-gradient(to right, ' + base + ', ' + light + ')';
    const mp = document.getElementById('sp-mini-play');
    if (mp) mp.style.background = grad;
  }

  const PLAY_SVG  = `<svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor" style="display:block;margin-left:1px"><polygon points="7,3 21,12 7,21"/></svg>`;
  const PAUSE_SVG = `<svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor" style="display:block"><rect x="6" y="3" width="4" height="18"/><rect x="14" y="3" width="4" height="18"/></svg>`;
  const SPIN_SVG  = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" style="animation:spin 0.9s linear infinite;display:block"><path d="M12 2a10 10 0 1 0 10 10"/></svg>`;

  function triggerPlayBtnSpring(btn) {
    btn.classList.remove('springing');
    void btn.offsetWidth;
    btn.classList.add('springing');
    btn.addEventListener('animationend', () => btn.classList.remove('springing'), { once: true });
    const rip = document.createElement('span');
    rip.className = 'play-btn-ripple';
    btn.appendChild(rip);
    rip.addEventListener('animationend', () => rip.remove(), { once: true });
  }

  function updateStickyPlayBtn(isPlaying) {
    const btn = document.getElementById('sticky-play-btn');
    if (!btn) return;
    // Always update play/pause class
    if (isPlaying) btn.classList.add('playing');
    else           btn.classList.remove('playing');
    // Skip spring/ripple animations if state hasn't changed ‚Äî avoids glitch on repeated calls
    const stateChanged = isPlaying !== btn._lastPlayState;
    btn._lastPlayState = isPlaying;
    if (!stateChanged) {
      // Still update mini play button icon
      const miniPlay = document.getElementById('sp-mini-play');
      if (miniPlay) {
        miniPlay.innerHTML = isPlaying
          ? '<svg width="14" height="14" viewBox="0 0 24 24" fill="white"><rect x="6" y="3" width="4" height="18" rx="1.5"/><rect x="14" y="3" width="4" height="18" rx="1.5"/></svg>'
          : '<svg width="14" height="14" viewBox="0 0 24 24" fill="white"><polygon points="7,3 21,12 7,21"/></svg>';
      }
      return;
    }
    // Spring animation on ring-inner
    btn.classList.remove('springing');
    void btn.offsetWidth;
    btn.classList.add('springing');
    btn.addEventListener('animationend', () => btn.classList.remove('springing'), { once: true });
    // Ripple
    const rip = document.createElement('span');
    rip.className = 'spm-ripple';
    rip.style.background = 'rgba(255,255,255,0.18)';
    btn.appendChild(rip);
    rip.addEventListener('animationend', () => rip.remove(), { once: true });
    // Sound wave ‚Äî startas/stoppas via audio events (playing/pause), inte h√§r
    // Mini play button icon
    const miniPlay = document.getElementById('sp-mini-play');
    if (miniPlay) {
      miniPlay.innerHTML = isPlaying
        ? '<svg width="14" height="14" viewBox="0 0 24 24" fill="white"><rect x="6" y="3" width="4" height="18" rx="1.5"/><rect x="14" y="3" width="4" height="18" rx="1.5"/></svg>'
        : '<svg width="14" height="14" viewBox="0 0 24 24" fill="white"><polygon points="7,3 21,12 7,21"/></svg>';
    }
  }

  function setBtns(datum, icon, isPlaying) {
    document.querySelectorAll('.play-btn[data-datum="' + datum + '"]').forEach(b => {
      b.innerHTML = icon;
      isPlaying ? b.classList.add('playing') : b.classList.remove('playing');
    });
    if (datum === _activeDatum) updateStickyPlayBtn(isPlaying);
  }

  function createPlayBtn(datum) {
    const btn = document.createElement('button');
    btn.className = 'play-btn';
    btn.setAttribute('data-datum', datum);
    btn.title = 'Spela upp recitation';
    btn.innerHTML = PLAY_SVG;
    btn.addEventListener('click', e => {
      e.stopPropagation();
      triggerPlayBtnSpring(btn);
      toggleAudio(datum);
    });
    return btn;
  }

  function fmtTime(s) {
    if (!isFinite(s)) return '0:00';
    const m = Math.floor(s / 60);
    const sec = Math.floor(s % 60);
    return `${m}:${sec.toString().padStart(2,'0')}`;
  }

  function updatePlayerUI(datum, currentTime, duration) {
    const pct = duration > 0 ? (currentTime / duration) * 100 : 0;
    const cur   = document.getElementById('cur-desktop-'   + datum);
    const dur   = document.getElementById('dur-desktop-'   + datum);
    const fill  = document.getElementById('fill-desktop-'  + datum);
    const thumb = document.getElementById('thumb-desktop-' + datum);
    if (cur)   cur.textContent   = fmtTime(currentTime);
    if (dur)   dur.textContent   = fmtTime(duration);
    if (fill)  fill.style.width  = pct + '%';
    if (thumb) thumb.style.left  = pct + '%';
    const sFill  = document.getElementById('sticky-fill');
    const sThumb = document.getElementById('sticky-thumb');
    if (sFill)  sFill.style.width  = pct + '%';
    if (sThumb) sThumb.style.left  = pct + '%';
    const spMiniPfill = document.getElementById('sp-mini-pfill');
    if (spMiniPfill) spMiniPfill.style.width = pct + '%';

    // Update progress ring on play button (circumference = 2œÄ√ó28 ‚âà 175.9)
    const ringFill = document.getElementById('sp-ring-fill');
    if (ringFill) {
      const circ = 175.9;
      ringFill.style.strokeDashoffset = circ - (pct / 100) * circ;
    }
    // Mini time
    const miniSubEl = document.getElementById('sp-mini-sub');
    if (miniSubEl && _activeDatum) {
      const row = SCHEDULE.find(r => r.datum === _activeDatum);
      if (row) {
        const nightStr = (T[_currentLang].night || 'Natt') + ' ' + row.day;
        miniSubEl.textContent = nightStr + ' ¬∑ ' + fmtTime(currentTime) + ' / ' + fmtTime(duration);
      }
    }
    // Full player times
    const spCur = document.getElementById('sp-cur');
    const spDur = document.getElementById('sp-dur');
    if (spCur) spCur.textContent = fmtTime(currentTime);
    if (spDur) spDur.textContent = fmtTime(duration);
  }

  function showSticky() {
    if (!_activeDatum) return;
    const p = document.getElementById('sticky-player');
    p.classList.remove('is-collapsing');
    p.classList.add('visible');
    p.classList.remove('mini-mode');
  }
  function hideSticky() {
    const p = document.getElementById('sticky-player');
    p.classList.remove('visible');
    p.classList.remove('mini-mode');
    p.classList.remove('is-collapsing');
  }
  function miniSticky() {
    if (!_activeDatum) return;
    const p = document.getElementById('sticky-player');
    if (p.classList.contains('mini-mode')) return;
    p.classList.add('visible');
    p.classList.remove('mini-mode');
    // Force browser to register start state, then animate to mini
    void p.offsetHeight;
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        p.classList.add('mini-mode');
      });
    });
  }

  let _miniTimer = null;
  let _shareNavActive = false;
  window.addEventListener('scroll', () => {
    if (!_activeDatum || _seekActive || _shareNavActive) return;
    const p = document.getElementById('sticky-player');
    if (!p || !p.classList.contains('visible') || p.classList.contains('mini-mode')) return;
    clearTimeout(_miniTimer);
    clearTimeout(_autoMiniTimer);
    miniSticky();
  }, { passive: true });

  async function navigateTo(datum) {
    if (_toggleBusy) return;
    _toggleBusy = true;
    try {
      if (_activeDatum && audioState[_activeDatum]) {
        const prev = _activeDatum;
        await _stopAudio(prev);
        if (_activeDatum === prev) closePlayer(prev);
      }
    } finally {
      _toggleBusy = false;
    }
    toggleAudio(datum);
  }

  function makeDraggableSeek(trackEl, thumbEl) {
    if (!trackEl) return;
    let _dragging = false;
    let _collapseTimer = null;
    const fillEl = document.getElementById('sticky-fill');

    function getPct(clientX) {
      const rect = trackEl.getBoundingClientRect();
      return Math.max(0, Math.min(1, (clientX - rect.left) / rect.width));
    }
    function applyPct(pct) {
      if (thumbEl) thumbEl.style.left = (pct * 100) + '%';
      if (fillEl) fillEl.style.width = (pct * 100) + '%';
    }
    function expand() { clearTimeout(_collapseTimer); trackEl.classList.add('bar-expanded'); }
    function scheduleCollapse() {
      clearTimeout(_collapseTimer);
      _collapseTimer = setTimeout(() => { if (!_dragging) trackEl.classList.remove('bar-expanded'); }, 800);
    }
    function commitSeek(pct) {
      if (!_activeDatum) return;
      const audio = _getActiveAudio(_activeDatum);
      if (!audio || !audio.duration) return;
      audio._seekLock = true;
      audio.currentTime = pct * audio.duration;
      updatePlayerUI(_activeDatum, audio.currentTime, audio.duration);
      clearTimeout(audio._seekLockTimer);
      audio._seekLockTimer = setTimeout(() => { audio._seekLock = false; }, 300);
    }
    trackEl.addEventListener('pointerdown', e => {
      if (!_activeDatum || !audioState[_activeDatum]) return;
      const audio = audioState[_activeDatum];
      if (!audio.duration) return;
      _dragging = true; audio._seekLock = true; _seekActive = true;
      trackEl.setPointerCapture(e.pointerId);
      trackEl.classList.add('seeking');
      if (thumbEl) thumbEl.classList.add('dragging');
      expand(); applyPct(getPct(e.clientX));
      e.stopPropagation(); e.preventDefault();
    }, { passive: false });
    trackEl.addEventListener('pointermove', e => {
      if (!_dragging) return;
      const pct = getPct(e.clientX); applyPct(pct);
      const _scrubAud = _activeDatum ? _getActiveAudio(_activeDatum) : null;
      if (_scrubAud?.duration) {
        const scrubTime = pct * _scrubAud.duration;
        const spCur = document.getElementById('sp-cur');
        if (spCur) spCur.textContent = fmtTime(scrubTime);
      }
      e.stopPropagation();
    });
    trackEl.addEventListener('pointerup', e => {
      if (!_dragging) return;
      _dragging = false; _seekActive = false;
      trackEl.classList.remove('seeking');
      if (thumbEl) thumbEl.classList.remove('dragging');
      trackEl.releasePointerCapture(e.pointerId);
      commitSeek(getPct(e.clientX)); scheduleCollapse();
      e.stopPropagation();
    });
    trackEl.addEventListener('pointercancel', () => {
      _dragging = false; _seekActive = false;
      trackEl.classList.remove('seeking');
      if (thumbEl) thumbEl.classList.remove('dragging'); scheduleCollapse();
    });
    trackEl.addEventListener('pointerleave', () => { if (!_dragging) scheduleCollapse(); });
    trackEl.addEventListener('pointerenter', () => { expand(); });
  }

  // Dela-l√§nk: ?natt=N ‚Äî scrolla till raden, pulsa play-knappen och starta uppspelning
  window.addEventListener('load', () => {
    const params = new URLSearchParams(window.location.search);
    const natt = parseInt(params.get('natt'));
    if (!natt) return;
    const row = SCHEDULE.find(r => r.day === natt);
    if (!row) return;

    const deadline = Date.now() + 8000;

    function tryInit() {
      const isMobile = window.innerWidth <= 640;
      const target = isMobile
        ? document.querySelector('.day-card-mobile[data-datum="' + row.datum + '"]')
        : document.querySelector('tr[data-datum="' + row.datum + '"]');

      if (!target) {
        if (Date.now() < deadline) setTimeout(tryInit, 150);
        return;
      }

      // Blockera scroll‚Üímini under navigeringen
      _shareNavActive = true;

      // Scrolla till raden
      target.scrollIntoView({ behavior: 'smooth', block: 'center' });

      // √ñppna full player utan att starta ljud ‚Äî anv√§ndaren klickar play sj√§lv
      _activeDatum = row.datum;
      updateStickyControls();
      showSegmentControl(row.datum);
      showSticky();
      clearTimeout(_autoMiniTimer);

      // Sl√§pp scroll-blockeringen efter att scroll √§r klar (~1s)
      setTimeout(() => { _shareNavActive = false; }, 1200);
    }

    setTimeout(tryInit, 400);
  });

  // ‚îÄ‚îÄ MASTER STOP ‚Äî pausar absolut allt ljud ‚îÄ‚îÄ
  function _stopAll(exceptDatum, exceptType) {
    Object.keys(audioState).forEach(d => {
      if (audioState[d] && !audioState[d].paused) {
        if (d === exceptDatum && exceptType === 'tarawih') return;
        audioState[d].pause();
        if (d !== exceptDatum) setBtns(d, PLAY_SVG, false);
      }
    });
    Object.keys(ishaState).forEach(d => {
      if (ishaState[d] && !ishaState[d].paused) {
        if (d === exceptDatum && exceptType === 'isha') return;
        ishaState[d].pause();
      }
    });
  }

    // ‚îÄ‚îÄ ISHA AUDIO TOGGLE ‚îÄ‚îÄ
  function _toggleIshaAudio(datum) {
    if (!ishaUrls[datum]) return;

    if (!ishaState[datum]) {
      const a = new Audio();
      a.preload = 'auto';
      a.setAttribute('playsinline', '');
      a.muted = !!window._globalMuted;
      a.src = ishaUrls[datum];

      a.addEventListener('waiting', () => {
        if (_activeTrackType[datum] !== 'isha') return;
        setBtns(datum, SPIN_SVG, true);
        updateStickyPlayBtn(false);
      });
      a.addEventListener('playing', () => {
        if (a._stopping) return;
        // Only update UI if this is still the active track
        if (_activeTrackType[datum] === 'isha' && _activeDatum === datum) {
          setBtns(datum, PAUSE_SVG, true);
          updateStickyPlayBtn(true);
        }
        if (window._connectAnalyser) window._connectAnalyser(datum, a);
      });
      a.addEventListener('pause', () => {
        if (_activeTrackType[datum] === 'isha' && _activeDatum === datum) {
          setBtns(datum, PLAY_SVG, false);
          updateStickyPlayBtn(false);
        }
        if (window._stopWaveDraw) window._stopWaveDraw();
      });
      a.addEventListener('timeupdate', () => {
        if (!a._seekLock && _activeTrackType[datum] === 'isha' && _activeDatum === datum) {
          updatePlayerUI(datum, a.currentTime, a.duration);
        }
      });
      a.addEventListener('loadedmetadata', () => {
        if (_activeTrackType[datum] === 'isha' && _activeDatum === datum)
          updatePlayerUI(datum, a.currentTime, a.duration);
      });
      a.addEventListener('ended', () => {
        if (_activeDatum === datum) {
          setBtns(datum, PLAY_SVG, false);
          updateStickyPlayBtn(false);
          updatePlayerUI(datum, 0, a.duration);
        }
        if (window._stopWaveDraw) window._stopWaveDraw();
      });

      ishaState[datum] = a;
    }

    const a = ishaState[datum];
    if (a.paused) {
      _stopAll(datum, 'isha'); // stop everything else first
      const p = a.play();
      if (p) p.catch(() => {});
    } else {
      a.pause();
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    const seekEl  = document.getElementById('sticky-seek');
    const thumbEl = document.getElementById('sticky-thumb');
    makeDraggableSeek(seekEl, thumbEl);
    // ‚îÄ‚îÄ New player buttons ‚îÄ‚îÄ
    syncAllFavBtns();
    updateFavChip();

    // ‚ïê‚ïê SOUND WAVE ‚Äî CSS-animation, ingen Web Audio API ‚ïê‚ïê
    (function() {
      const waveEl = document.getElementById('sp-soundwave');
      if (!waveEl) return;

      const BAR_COUNT = 52;
      const MIN_SCALE = 0.04;
      const COL_H     = 38;

      const bars    = [];
      const peakEls = [];

      // Bygg DOM: .sw-col > .sw-bar + .sw-peak
      for (let i = 0; i < BAR_COUNT; i++) {
        const col = document.createElement('div');
        col.className = 'sw-col';
        col.style.cssText = 'position:relative;display:flex;align-items:flex-end;justify-content:center;height:' + COL_H + 'px;width:3px;flex-shrink:0;';
        const bar = document.createElement('div');
        bar.className = 'sw-bar';
        const pk = document.createElement('div');
        pk.className = 'sw-peak';
        pk.style.bottom = '0px';
        col.appendChild(bar);
        col.appendChild(pk);
        waveEl.appendChild(col);
        bars.push(bar);
        peakEls.push(pk);
      }

      // Samma v√§rden som tidigare ‚Äî exakt samma animation
      const PEAK_CSS = [0.20,0.25,0.30,0.35,0.40,0.46,0.52,0.58,0.64,0.70,0.75,0.80,0.84,0.87,0.90,0.91,0.92,0.91,0.90,0.91,0.90,0.91,0.92,0.91,0.90,0.88,0.86,0.82,0.78,0.74,0.70,0.66,0.62,0.58,0.54,0.50,0.46,0.42,0.38,0.36,0.34,0.36,0.38,0.34,0.30,0.36,0.32,0.28,0.30,0.26,0.24,0.20];
      const DUR_CSS  = [1.0,0.95,0.90,0.85,0.82,0.80,0.78,0.75,0.72,0.70,0.68,0.72,0.70,0.75,0.72,0.68,0.70,0.74,0.70,0.76,0.68,0.74,0.70,0.76,0.72,0.68,0.70,0.74,0.72,0.76,0.70,0.74,0.72,0.76,0.80,0.78,0.82,0.80,0.85,0.82,0.88,0.85,0.90,0.88,0.92,0.90,0.94,0.92,0.96,0.94,0.97,1.0];
      const DLY_CSS  = [0,0.05,0.10,0.08,0.15,0.12,0.20,0.04,0.18,0.25,0.06,0.14,0.22,0.03,0.16,0.28,0.08,0.20,0.12,0.04,0.18,0.25,0.06,0.14,0.22,0.03,0.16,0.28,0.10,0.22,0.08,0.16,0.04,0.20,0.12,0.24,0.06,0.18,0.10,0.22,0.04,0.16,0.08,0.20,0.12,0.24,0.06,0.18,0.10,0.22,0.04,0];

      let _waveRunning = false;

      function startCSS() {
        _waveRunning = true;
        bars.forEach((b, i) => {
          b.style.removeProperty('transform'); // ta bort inline transform s√• animation tar √∂ver
          b.style.setProperty('--sw-floor', MIN_SCALE);
          b.style.setProperty('--sw-peak',  PEAK_CSS[i]);
          b.style.setProperty('--sw-dur',   DUR_CSS[i] + 's');
          b.style.animationDelay = DLY_CSS[i] + 's';
          b.classList.add('sw-bar--animate');
        });
        // S√§tt peak-mark√∂rer p√• r√§tt h√∂jd direkt
        peakEls.forEach((p, i) => {
          p.style.bottom = Math.round(PEAK_CSS[i] * COL_H) + 'px';
          p.style.top = 'auto';
        });
      }

      // Mjuk fall-animation p√• paus ‚Äî staplarna och topparna glider ner stegvis
      let fallRafId = null;
      const smooth  = new Float32Array(BAR_COUNT);
      const peakVal = new Float32Array(BAR_COUNT);

      window._stopWaveDraw = function() {
        if (!_waveRunning) return;
        _waveRunning = false;
        cancelAnimationFrame(fallRafId);
        // Stoppa CSS-animation och l√§s av ungef√§rlig nuvarande h√∂jd per stapel
        bars.forEach((b, i) => {
          b.classList.remove('sw-bar--animate');
          // Uppskatta nuvarande scaleY baserat p√• CSS-peak (animationen √§r n√•gonstans mellan floor och peak)
          smooth[i]  = PEAK_CSS[i] * 0.6; // konservativ uppskattning
          peakVal[i] = PEAK_CSS[i];
          b.style.transform = 'scaleY(' + smooth[i] + ')';
        });

        const FALL_SPEED = 0.012;
        const PEAK_FALL  = 0.008;

        function fallDown() {
          let anyVisible = false;
          for (let i = 0; i < BAR_COUNT; i++) {
            if (smooth[i] > MIN_SCALE) {
              smooth[i] = Math.max(MIN_SCALE, smooth[i] - FALL_SPEED * (0.3 + smooth[i] * 0.5));
              bars[i].style.transform = 'scaleY(' + smooth[i] + ')';
              anyVisible = true;
            }
            if (peakVal[i] > MIN_SCALE) {
              peakVal[i] = Math.max(MIN_SCALE, peakVal[i] - PEAK_FALL);
              peakEls[i].style.bottom = Math.round(peakVal[i] * COL_H) + 'px';
              peakEls[i].style.top = 'auto';
              anyVisible = true;
            }
          }
          if (anyVisible) {
            fallRafId = requestAnimationFrame(fallDown);
          } else {
            bars.forEach(b => { b.style.transform = 'scaleY(' + MIN_SCALE + ')'; });
            peakEls.forEach(p => { p.style.bottom = '0px'; p.style.top = 'auto'; });
          }
        }
        fallRafId = requestAnimationFrame(fallDown);
      };

      // Stubs ‚Äî inga Web Audio API-anrop
      window._primeAudioCtx   = function() {};
      window._resumeAudioCtx  = function() {};
      window._connectAnalyser = function() { startCSS(); };
    })();

    // Segment control ‚Äî Tarawih / Isha buttons
    document.getElementById('sp-seg-tarawih')?.addEventListener('click', e => {
      if (!_activeDatum) return;
      // Pause isha if playing
      const ishaAud = ishaState[_activeDatum];
      if (ishaAud && !ishaAud.paused) {
        ishaAud.pause();
        if (window._stopWaveDraw) window._stopWaveDraw();
      }
      _switchTrack(_activeDatum, 'tarawih');
      e.stopPropagation();
    });
    document.getElementById('sp-seg-isha')?.addEventListener('click', e => {
      if (!_activeDatum || !ishaUrls[_activeDatum]) return;
      // Pause tarawih if playing
      const tAud = audioState[_activeDatum];
      if (tAud && !tAud.paused) {
        tAud.pause();
        if (window._stopWaveDraw) window._stopWaveDraw();
      }
      _switchTrack(_activeDatum, 'isha');
      e.stopPropagation();
    });

    // Position pill after layout
    requestAnimationFrame(() => {
      const btnT = document.getElementById('sp-seg-tarawih');
      const pill = document.getElementById('sp-segment-pill');
      const seg  = document.getElementById('sp-segment');
      if (btnT && pill && seg) {
        const segRect = seg.getBoundingClientRect();
        const btnRect = btnT.getBoundingClientRect();
        pill.style.transition = 'none';
        pill.style.left  = (btnRect.left - segRect.left) + 'px';
        pill.style.width = btnRect.width + 'px';
        requestAnimationFrame(() => { pill.style.transition = ''; });
      }
    });

        const muteBtn = document.getElementById('sticky-mute');
    if (muteBtn) muteBtn.addEventListener('click', e => {
      const isMuted = muteBtn.classList.toggle('muted');
      Object.values(audioState).forEach(a => { a.muted = isMuted; });
      window._globalMuted = isMuted;
      // Visa/d√∂lj mute-indikator p√• sticky player och mini player
      const stickyEl = document.getElementById('sticky-player');
      if (stickyEl) stickyEl.classList.toggle('muted-state', isMuted);
      // Uppdatera ikon: visa mute-ikonen eller volume-ikonen
      const volIcon = muteBtn.querySelector('.sp-vol-icon');
      const muteIcon = muteBtn.querySelector('#mute-icon-on');
      if (volIcon && muteIcon) {
        volIcon.style.display = isMuted ? 'none' : '';
        muteIcon.style.display = isMuted ? '' : 'none';
      }
      e.stopPropagation();
    });

    const playBtn = document.getElementById('sticky-play-btn');
    if (playBtn) playBtn.addEventListener('click', e => {
      if (!_activeDatum) return;
      const type = _activeTrackType[_activeDatum] || 'tarawih';
      if (type === 'isha') {
        _toggleIshaAudio(_activeDatum);
      } else {
        // Make sure isha is stopped before toggling tarawih
        if (ishaState[_activeDatum] && !ishaState[_activeDatum].paused) {
          ishaState[_activeDatum].pause();
        }
        toggleAudio(_activeDatum);
      }
      e.stopPropagation();
    });

    // √Öteruppta AudioContext n√§r appen kommer tillbaka i f√∂rgrunden
    // (iOS Safari suspenderar AudioContext vid sk√§rml√•s ‚Äî men audio forts√§tter spela)
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible') {
        if (window._resumeAudioCtx) window._resumeAudioCtx();
      }
    });

    // Klick p√• mini-inner ‚Üí expandera till full (men inte play/skip-knappar)
    document.querySelector('.sp-mini-inner')?.addEventListener('click', e => {
      if (e.target.closest('.sp-mini-ctrl') || e.target.closest('.sp-mini-play')) return;
      clearTimeout(_autoMiniTimer);
      showSticky();
      e.stopPropagation();
    });

    // Pausa auto-mini timer n√§r anv√§ndaren interagerar med full player,
    // √•teruppta n√§r de l√§mnar
    const playerFullEl = document.querySelector('.player-full');
    if (playerFullEl) {
      playerFullEl.addEventListener('mouseenter', () => clearTimeout(_autoMiniTimer));
      playerFullEl.addEventListener('touchstart', () => clearTimeout(_autoMiniTimer), { passive: true });
      playerFullEl.addEventListener('pointerdown', () => clearTimeout(_autoMiniTimer), { passive: true });
      const _resumeTimer = () => {
        clearTimeout(_autoMiniTimer);
        _autoMiniTimer = setTimeout(() => { if (_activeDatum) miniSticky(); }, 5000);
      };
      playerFullEl.addEventListener('mouseleave', _resumeTimer);
      playerFullEl.addEventListener('touchend', _resumeTimer, { passive: true });
    }

    // Skip ¬±30s
    document.getElementById('sp-skip-back-btn')?.addEventListener('click', e => {
      if (!_activeDatum || !audioState[_activeDatum]) return;
      audioState[_activeDatum].currentTime = Math.max(0, audioState[_activeDatum].currentTime - 30);
      e.stopPropagation();
    });
    document.getElementById('sp-skip-fwd-btn')?.addEventListener('click', e => {
      if (!_activeDatum || !audioState[_activeDatum]) return;
      const a = audioState[_activeDatum];
      audioState[_activeDatum].currentTime = Math.min(a.duration || 0, a.currentTime + 30);
      e.stopPropagation();
    });
    document.getElementById('sp-mini-skip-back')?.addEventListener('click', e => {
      if (!_activeDatum || !audioState[_activeDatum]) return;
      audioState[_activeDatum].currentTime = Math.max(0, audioState[_activeDatum].currentTime - 30);
      e.stopPropagation();
    });
    document.getElementById('sp-mini-skip-fwd')?.addEventListener('click', e => {
      if (!_activeDatum || !audioState[_activeDatum]) return;
      const a = audioState[_activeDatum];
      audioState[_activeDatum].currentTime = Math.min(a.duration || 0, a.currentTime + 30);
      e.stopPropagation();
    });

    // Mini play button
    document.getElementById('sp-mini-play')?.addEventListener('click', e => {
      if (!_activeDatum) return; toggleAudio(_activeDatum); e.stopPropagation();
    });

    // Prev/next
    document.getElementById('sp-prev-btn')?.addEventListener('click', e => {
      if (!_activeDatum) return;
      const idx = SCHEDULE.findIndex(r => r.datum === _activeDatum);
      if (idx > 0 && audioUrls[SCHEDULE[idx-1].datum]) navigateTo(SCHEDULE[idx-1].datum);
      e.stopPropagation();
    });
    document.getElementById('sp-next-btn')?.addEventListener('click', e => {
      if (!_activeDatum) return;
      const idx = SCHEDULE.findIndex(r => r.datum === _activeDatum);
      if (idx < SCHEDULE.length-1 && audioUrls[SCHEDULE[idx+1].datum]) navigateTo(SCHEDULE[idx+1].datum);
      e.stopPropagation();
    });

    // Speed cycle: 1√ó ‚Üí 1.25√ó ‚Üí 1.5√ó ‚Üí 1.75√ó ‚Üí 2√ó ‚Üí 1√ó
    const speeds = [1, 1.25, 1.5, 1.75, 2];
    let _speedIdx = 0;
    document.getElementById('sp-speed-btn')?.addEventListener('click', e => {
      _speedIdx = (_speedIdx + 1) % speeds.length;
      const spd = speeds[_speedIdx];
      document.getElementById('sp-speed-btn').textContent = spd + '√ó';
      Object.values(audioState).forEach(a => { a.playbackRate = spd; });
      e.stopPropagation();
    });


    // ‚ïê‚ïê SLEEP TIMER ‚ïê‚ïê
    (function() {
      const btn      = document.getElementById('sp-sleep-btn');
      const panel    = document.getElementById('sp-sleep-panel');
      const progress = document.getElementById('sp-sleep-progress');
      const fillEl   = document.getElementById('sp-sleep-fill');
      const timeEl   = document.getElementById('sp-sleep-time');
      const cancelEl = document.getElementById('sp-sleep-cancel');
      const opts     = document.querySelectorAll('.sp-sleep-opt');
      if (!btn || !panel) return;

      let _sleepTimer    = null;  // setInterval-id
      let _sleepTotal    = 0;     // vald tid i sekunder
      let _sleepRemain   = 0;     // √•terst√•ende sekunder
      let _sleepEndMode  = false; // "Nattslut"-l√§ge

      function fmtSleep(s) {
        const m = Math.floor(s / 60), sec = s % 60;
        return m + ':' + String(sec).padStart(2, '0');
      }

      function updatePanel() {
        const t = T[_currentLang] || {};
        const titleEl = document.getElementById('sp-sleep-panel-title');
        const lblEl   = document.getElementById('sp-sleep-progress-lbl');
        if (titleEl) titleEl.textContent = t.sleepTitle  || 'St√§ng av efter';
        if (lblEl)   lblEl.textContent   = t.sleepStops  || 'Stannar om';
        if (cancelEl) cancelEl.textContent = t.sleepCancel || 'Avbryt';
        const endOpt = document.getElementById('sp-sleep-end-opt');
        if (endOpt) endOpt.textContent = t.sleepNightEnd || 'Nattslut';
      }

      function startTimer(minutes, endMode) {
        clearSleep();
        _sleepEndMode = !!endMode;

        if (endMode) {
          // Nattslut: lyssna p√• 'ended'-event
          window._sleepEndMode = true;
          btn.classList.add('active');
          progress.classList.remove('visible');
          panel.classList.remove('open');
          return;
        }

        _sleepTotal  = minutes * 60;
        _sleepRemain = _sleepTotal;
        btn.classList.add('active');
        progress.classList.add('visible');
        panel.classList.remove('open');

        // Uppdatera direkt
        timeEl.textContent = fmtSleep(_sleepRemain);
        fillEl.style.width = '100%';

        _sleepTimer = setInterval(() => {
          _sleepRemain--;
          if (_sleepRemain <= 0) {
            doSleep();
            return;
          }
          const pct = (_sleepRemain / _sleepTotal) * 100;
          fillEl.style.width = pct + '%';
          timeEl.textContent = fmtSleep(_sleepRemain);
        }, 1000);
      }

      function doSleep() {
        // Pausa aktivt ljud
        if (_activeDatum && audioState[_activeDatum]) {
          audioState[_activeDatum].pause();
        }
        clearSleep();
      }

      function clearSleep() {
        clearInterval(_sleepTimer);
        _sleepTimer   = null;
        _sleepTotal   = 0;
        _sleepRemain  = 0;
        _sleepEndMode = false;
        window._sleepEndMode = false;
        btn.classList.remove('active');
        progress.classList.remove('visible');
        // Avmarkera alla opts
        opts.forEach(o => o.classList.remove('selected'));
        timeEl.textContent = '‚Äì';
        fillEl.style.width = '100%';
      }

      // Knapp-klick: √∂ppna/st√§ng panel
      btn.addEventListener('click', e => {
        if (btn.classList.contains('active') && _sleepEndMode) {
          // Avbryt nattslut-l√§ge direkt
          clearSleep();
          panel.classList.remove('open');
          e.stopPropagation(); return;
        }
        const isOpen = panel.classList.contains('open');
        panel.classList.toggle('open', !isOpen);
        if (!isOpen) updatePanel();
        e.stopPropagation();
      });

      // V√§lj tid
      opts.forEach(opt => {
        opt.addEventListener('click', e => {
          opts.forEach(o => o.classList.remove('selected'));
          opt.classList.add('selected');
          const minutes = opt.dataset.minutes;
          if (minutes === 'end') {
            startTimer(0, true);
          } else {
            startTimer(parseInt(minutes), false);
          }
          e.stopPropagation();
        });
      });

      // Avbryt-knapp
      cancelEl?.addEventListener('click', e => {
        clearSleep();
        panel.classList.remove('open');
        e.stopPropagation();
      });

      // St√§ng panel vid klick utanf√∂r
      document.addEventListener('click', e => {
        if (!e.target.closest('#sp-sleep-btn') && !e.target.closest('#sp-sleep-panel')) {
          panel.classList.remove('open');
        }
      });

      // Exponera f√∂r applyLang och "ended"-event
      window._sleepClear   = clearSleep;
      window._sleepEndMode = false;
      window._updateSleepPanel = updatePanel;
    })();

    // Favorit-knapp i spelaren
    document.getElementById('sp-fav-btn')?.addEventListener('click', e => {
      const day = parseInt(e.currentTarget.dataset.day);
      if (day) toggleFav(day, e.currentTarget);
      e.stopPropagation();
    });

    // St√§ng-knapp ‚Äî stoppa ljud och d√∂lj spelaren
    document.getElementById('sp-close-btn')?.addEventListener('click', e => {
      e.stopPropagation();
      if (!_activeDatum) { hideSticky(); return; }
      if (_toggleBusy) return;
      _toggleBusy = true;
      const d = _activeDatum;
      // St√§ng spelaren visuellt direkt ‚Äî v√§nta inte p√• audio-cleanup
      closePlayer(d);
      _stopAudio(d).finally(() => { _toggleBusy = false; });
    });

    // Share button ‚Äî copy ?natt=N URL
    document.getElementById('sp-share-btn')?.addEventListener('click', e => {
      if (!_activeDatum) return;
      const row = SCHEDULE.find(r => r.datum === _activeDatum);
      if (!row) return;
      const url = window.location.origin + window.location.pathname + '?natt=' + row.day;
      if (navigator.share) {
        navigator.share({ title: row.imamLabel + ' ¬∑ Natt ' + row.day, url }).catch(() => {});
      } else {
        navigator.clipboard?.writeText(url).then(() => {
          const btn = document.getElementById('sp-share-btn');
          if (btn) {
            btn.style.color = '#2d9c6e';
            setTimeout(() => { btn.style.color = ''; }, 1400);
          }
        });
      }
      e.stopPropagation();
    });

  });


  function updateStickyControls() {
    if (!_activeDatum) return;
    const idx = SCHEDULE.findIndex(r => r.datum === _activeDatum);
    const row = SCHEDULE[idx];
    const spPrevBtn = document.getElementById('sp-prev-btn');
    const spNextBtn = document.getElementById('sp-next-btn');
    // Kolla om play-knappen faktiskt injicerats (HEAD-fetch bekr√§ftade att filen finns)
    function hasAudio(datum) {
      if (!datum) return false;
      return !!document.getElementById('audio-desktop-' + datum)?.querySelector('.play-btn')
          || !!document.getElementById('audio-mobile-' + datum)?.querySelector('.play-btn');
    }
    const prevDatum = SCHEDULE[idx-1]?.datum;
    const nextDatum = SCHEDULE[idx+1]?.datum;
    if (spPrevBtn) spPrevBtn.disabled = idx <= 0 || !hasAudio(prevDatum);
    if (spNextBtn) spNextBtn.disabled = idx >= SCHEDULE.length-1 || !hasAudio(nextDatum);

    // Ny design ‚Äî uppdatera metadata-rad och imam-f√§rger
    if (row) {
      const spImam  = document.getElementById('sp-imam-name');
      const spSub   = document.getElementById('sp-meta-sub');
      const miniImam = document.getElementById('sp-mini-imam');
      const miniSub  = document.getElementById('sp-mini-sub');
      const prevLbl  = document.getElementById('sp-prev-label');
      const nextLbl  = document.getElementById('sp-next-label');
      const nightStr = (T[_currentLang].night || 'Natt') + ' ' + row.day;
      if (spImam)  spImam.textContent  = row.imamLabel;
      if (spSub)   spSub.innerHTML     = '<span class="sp-accent" id="sp-night-label">' + nightStr + '</span> ¬∑ ' + row.surahs + (row.tooltip ? '<br><span style="font-size:0.62rem;color:rgba(255,255,255,0.38);letter-spacing:0.02em;">' + row.tooltip + '</span>' : '');
      if (miniImam) miniImam.textContent = row.imamLabel;
      if (miniSub)  miniSub.textContent  = nightStr;
      // Prev/next labels
      const prevRow = SCHEDULE[idx-1];
      const nextRow = SCHEDULE[idx+1];
      if (prevLbl) prevLbl.textContent = prevRow ? (T[_currentLang].night||'Natt')+' '+prevRow.day : '';
      if (nextLbl) nextLbl.textContent = nextRow ? (T[_currentLang].night||'Natt')+' '+nextRow.day : '';
      applyImamColor(row.imam, row.imamLabel, row.day);
      // Uppdatera hj√§rta i spelaren
      const spFav = document.getElementById('sp-fav-btn');
      if (spFav) {
        spFav.dataset.day = row.day;
        spFav.classList.toggle('active', isFav(row.day));
      }
    }
  }

  function updatePlayingRow(datum) {
    // Rensa tidigare komet ‚Äî desktop
    document.querySelectorAll('tbody tr.playing-row-comet').forEach(tr => {
      tr.classList.remove('playing-row-comet');
    });
    // Rensa tidigare komet ‚Äî mobil (unwrappa kortet)
    document.querySelectorAll('.playing-comet-wrap').forEach(wrap => {
      const card = wrap.querySelector('.day-card-mobile');
      if (card) {
        wrap.parentNode.insertBefore(card, wrap);
        // √Öterst√§ll margin
        card.style.marginBottom = '';
      }
      wrap.remove();
    });

    if (!datum) return;

    // Desktop ‚Äî l√§gg till komet-klass p√• <tr>
    const tr = document.querySelector('tr[data-datum="' + datum + '"]');
    if (tr) tr.classList.add('playing-row-comet');

    // Mobil ‚Äî wrappa .day-card-mobile i .playing-comet-wrap
    const card = document.querySelector('.day-card-mobile[data-datum="' + datum + '"]');
    if (card) {
      const wrap = document.createElement('div');
      wrap.className = 'playing-comet-wrap';
      card.parentNode.insertBefore(wrap, card);
      wrap.appendChild(card);
      card.style.marginBottom = '0';
    }
  }

  function openPlayer(datum) {
    // Stop isha from any previously active day
    if (_activeDatum && _activeDatum !== datum) {
      if (ishaState[_activeDatum] && !ishaState[_activeDatum].paused) {
        ishaState[_activeDatum].pause();
      }
    }
    _activeDatum = datum;
    // Segment control: reset to tarawih unless isha is actively playing for this datum
    if (!ishaState[datum] || ishaState[datum].paused) {
      _activeTrackType[datum] = 'tarawih';
    }
    updatePlayingRow(datum);
    updateStickyControls();
    updateStickyPlayBtn(true);
    showSegmentControl(datum);

    // MediaSession API ‚Äî h√•ller bakgrundsuppspelning aktiv p√• iOS/Android
    if ('mediaSession' in navigator) {
      const row = SCHEDULE.find(r => r.datum === datum);
      if (row) {
        const IMAM_COLORS = {
          abdurrahman:'#e8630a', saed:'#d4a800', noor:'#2980b9',
          abdul:'#555555', mohammed:'#219150', yacquub:'#7d3aac',
          abdelsalam:'#7b3f00', hatem:'#2d6a4f', ibrahim:'#1a3a6b'
        };
        const color = IMAM_COLORS[row.imam] || '#24645d';
        const initials = row.imamLabel.split(' ').map(w=>w[0]).join('').slice(0,2).toUpperCase();
        // Endast ASCII i SVG ‚Äî btoa() kraschar annars p√• svenska tecken
        const svg = '<svg xmlns="http://www.w3.org/2000/svg" width="512" height="512">'
          + '<rect width="512" height="512" fill="#0f1614"/>'
          + '<rect width="512" height="512" fill="' + color + '" opacity="0.3"/>'
          + '<circle cx="256" cy="210" r="130" fill="' + color + '"/>'
          + '<text x="256" y="258" font-family="system-ui" font-size="110" font-weight="700" fill="white" text-anchor="middle">' + initials + '</text>'
          + '<text x="256" y="380" font-family="system-ui" font-size="40" fill="rgba(255,255,255,0.7)" text-anchor="middle">Natt ' + row.day + '</text>'
          + '</svg>';
        let artUrl = '';
        try { artUrl = 'data:image/svg+xml;base64,' + btoa(svg); } catch(e) {}
        try {
          navigator.mediaSession.metadata = new MediaMetadata({
            title: row.imamLabel,
            artist: 'Natt ' + row.day,
            album: 'Tarawih Kampingehallen 2026',
            artwork: artUrl ? [{ src: artUrl, sizes: '512x512', type: 'image/svg+xml' }] : []
          });
        } catch(e) {}
        // S√§tt playbackState direkt ‚Äî iOS beh√∂ver detta f√∂r att till√•ta bakgrundsuppspelning
        navigator.mediaSession.playbackState = 'playing';
        navigator.mediaSession.setActionHandler('play', () => {
          const a = audioState[datum];
          if (a && a.paused) {
            a.play().catch(() => {});
            navigator.mediaSession.playbackState = 'playing';
          }
        });
        navigator.mediaSession.setActionHandler('pause', () => {
          const a = audioState[datum];
          if (a && !a.paused) {
            a.pause();
            navigator.mediaSession.playbackState = 'paused';
          }
        });
        // nexttrack/previoustrack kr√§vs av iOS f√∂r att h√•lla MediaSession levande i bakgrunden
        navigator.mediaSession.setActionHandler('nexttrack', () => {
          const a = audioState[datum];
          if (a) a.currentTime = Math.min((a.duration || 0), a.currentTime + 30);
        });
        navigator.mediaSession.setActionHandler('previoustrack', () => {
          const a = audioState[datum];
          if (a) a.currentTime = Math.max(0, a.currentTime - 30);
        });
        navigator.mediaSession.setActionHandler('seekforward', (d) => {
          const a = audioState[datum];
          if (a) a.currentTime = Math.min((a.duration || 0), a.currentTime + (d.seekOffset || 30));
        });
        navigator.mediaSession.setActionHandler('seekbackward', (d) => {
          const a = audioState[datum];
          if (a) a.currentTime = Math.max(0, a.currentTime - (d.seekOffset || 30));
        });
      }
    }

    const p = document.getElementById('sticky-player');
    // Om spelaren redan √§r i mini-l√§ge (t.ex. play klickades i mini-spelaren),
    // stanna kvar i mini-l√§ge ‚Äî expandera INTE till full player
    const alreadyMini = p && p.classList.contains('mini-mode') && p.classList.contains('visible');
    if (!alreadyMini) {
      setTimeout(showSticky, 200);
    }
    clearTimeout(_autoMiniTimer);
    _autoMiniTimer = setTimeout(() => { if (_activeDatum) miniSticky(); }, 5000);
  }

  function closePlayer(datum) { _activeDatum = null; updatePlayingRow(null); hideSticky(); updateStickyPlayBtn(false); hideSegmentControl(); }

  // H√•ller koll p√• p√•g√•ende play()-promises per datum f√∂r att f√∂rhindra race conditions
  const _playingPromise = {};
  let _toggleBusy = false; // blockerar √∂verlappande toggle-anrop

  function _stopAudio(datum) {
    const a = audioState[datum];
    if (!a) return Promise.resolve();
    // S√§tt _stopping F√ñRE pause() ‚Äî hindrar playing-event fr√•n att √∂ppna spelaren igen
    a._stopping = true;
    _playingPromise[datum] = null;
    try { a.pause(); } catch(e) {}
    setBtns(datum, PLAY_SVG, false);
    // √Öterst√§ll flaggan i n√§sta microtask n√§r alla events k√∂rt klart
    Promise.resolve().then(() => { a._stopping = false; });
    return Promise.resolve();
  }

  async function toggleAudio(datum) {
    // Blockera om ett toggle redan p√•g√•r ‚Äî f√∂rhindrar dubbelklick-race
    if (_toggleBusy) return;
    _toggleBusy = true;

    try {
      // Stop ALL audio (tarawih + isha across all days) ‚Äî only one can play at a time
      _stopAll(datum, 'tarawih');
      // Also stop other days' tarawih via closePlayer
      const others = Object.keys(audioState).filter(d => d !== datum);
      for (const d of others) {
        if (_activeDatum === d) closePlayer(d);
      }
      // Reset track type to tarawih ‚Äî table row click always means tarawih
      _activeTrackType[datum] = 'tarawih';
      // Update segment pill if player is open for this datum
      if (_activeDatum === datum) _updateSegmentPill('tarawih');

      if (!audioState[datum]) {
        const a = new Audio();
        a.preload = 'auto';
        a.setAttribute('playsinline', '');
        a.muted = !!window._globalMuted;
        a.src = audioUrls[datum];
        a.addEventListener('waiting',  () => setBtns(datum, SPIN_SVG, true));
        a.addEventListener('playing',  () => {
          if (a._stopping) return;
          setBtns(datum, PAUSE_SVG, true);
          if (_activeDatum !== datum) openPlayer(datum);
          if ('mediaSession' in navigator) navigator.mediaSession.playbackState = 'playing';
          if (window._connectAnalyser) window._connectAnalyser(datum, a);
        });
        a.addEventListener('pause', () => {
          if ('mediaSession' in navigator) navigator.mediaSession.playbackState = 'paused';
          if (_activeDatum === datum && window._stopWaveDraw) window._stopWaveDraw();
        });
        a.addEventListener('timeupdate', () => { if (!a._seekLock) updatePlayerUI(datum, a.currentTime, a.duration); });
        a.addEventListener('loadedmetadata', () => updatePlayerUI(datum, a.currentTime, a.duration));
        a.addEventListener('ended', () => {
          closePlayer(datum); setBtns(datum, PLAY_SVG, false); updatePlayerUI(datum, 0, a.duration);
          if (window._stopWaveDraw) window._stopWaveDraw();
          // Nattslut-sleep: rensa timern n√§r sp√•ret √§r slut
          if (window._sleepEndMode && window._sleepClear) window._sleepClear();
        });
        a.addEventListener('error', () => {
          _playingPromise[datum] = null;
          setBtns(datum, PLAY_SVG, false);
          if (_activeDatum === datum) closePlayer(datum);
          if (window._stopWaveDraw) window._stopWaveDraw();
        });
        audioState[datum] = a;
      }

      const audio = audioState[datum];

      if (audio.paused) {
        // SPELA ‚Äî frig√∂r l√•set DIREKT s√• paus-knappen inte fryser
        _toggleBusy = false;
        setBtns(datum, SPIN_SVG, true);
        // Skapa/resumea AudioContext direkt i user gesture (kr√§vs p√• mobil)
        if (window._primeAudioCtx) window._primeAudioCtx();
        if (window._resumeAudioCtx) window._resumeAudioCtx(datum);
        const p = audio.play();
        _playingPromise[datum] = p;
        if (p && typeof p.then === 'function') {
          p.then(() => {
            if (_playingPromise[datum] === p) _playingPromise[datum] = null;
          }).catch(err => {
            _playingPromise[datum] = null;
            if (err.name !== 'AbortError') {
              console.warn('Play failed:', err);
              setBtns(datum, PLAY_SVG, false);
            }
          });
        }
        return; // l√•set redan frigjort ovan
      } else {
        // PAUSA ‚Äî frig√∂r l√•set DIREKT, k√∂r cleanup async
        _toggleBusy = false;
        _stopAudio(datum);
        if (_activeDatum === datum) updateStickyPlayBtn(false);
        return; // l√•set redan frigjort ovan
      }
    } catch(e) {
      // ignorera
    } finally {
      // Frig√∂r l√•set om vi inte redan gjort det via tidiga return-satser
      _toggleBusy = false;
    }
  }

  function injectPlayButtons(datum) {
    ['audio-desktop-' + datum, 'audio-mobile-' + datum].forEach(id => {
      const cell = document.getElementById(id);
      if (cell && !cell.querySelector('.play-btn')) cell.appendChild(createPlayBtn(datum));
    });
  }

  const basePath = window.location.pathname.split('/').slice(0, -1).join('/');
  const audioUrls = {};
  const ishaUrls  = {}; // datum ‚Üí isha mp3 URL (only populated if file exists)
  const ishaState = {}; // datum ‚Üí Audio object for isha track

  SCHEDULE.forEach(row => {
    const url = basePath + '/' + row.datum + '.mp3';
    audioUrls[row.datum] = url;
    fetch(url, { method: 'HEAD' })
      .then(res => { if (res.ok || res.status === 206) injectPlayButtons(row.datum); })
      .catch(() => { fetch(url).then(res => { if (res.ok) injectPlayButtons(row.datum); }).catch(() => {}); });

    // Probe for isha track ‚Äî datum-isha.mp3
    const ishaUrl = basePath + '/' + row.datum + '-isha.mp3';
    fetch(ishaUrl, { method: 'HEAD' })
      .then(res => {
        if (res.ok || res.status === 206) {
          ishaUrls[row.datum] = ishaUrl;
          markIshaAvailable(row.datum);
        }
      })
      .catch(() => {});
  });

  // Marks a row/card as having isha available (adds dot indicator)
  function markIshaAvailable(datum) {
    // Desktop row ‚Äî add dot after imam chip
    const tr = document.querySelector('tr[data-datum="' + datum + '"]');
    if (tr) {
      const chip = tr.querySelector('.imam-chip');
      if (chip && !chip.querySelector('.isha-dot')) {
        const dot = document.createElement('span');
        dot.className = 'isha-dot';
        dot.title = 'Isha tillg√§nglig';
        chip.appendChild(dot);
      }
    }
    // Mobile card ‚Äî same
    const card = document.querySelector('.day-card-mobile[data-datum="' + datum + '"]');
    if (card) {
      const chip = card.querySelector('.imam-chip');
      if (chip && !chip.querySelector('.isha-dot')) {
        const dot = document.createElement('span');
        dot.className = 'isha-dot';
        dot.title = 'Isha tillg√§nglig';
        chip.appendChild(dot);
      }
    }
    // If this datum is currently open in player, show segment control
    if (_activeDatum === datum) showSegmentControl(datum);
  }

  function applyLang(lang) {
    _currentLang = lang;
    const t = T[lang];
    document.dir = lang === 'ar' ? 'rtl' : 'ltr';

    // All data-i18n elements
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.dataset.i18n;
      if (t[key] !== undefined) el.textContent = t[key];
    });
    // Uppdatera fav empty-state text om den visas
    if (window._updateSleepPanel) window._updateSleepPanel();
    const emptyTxt2 = document.getElementById('fav-empty-text');
    if (emptyTxt2) emptyTxt2.textContent = t.noFavs || '';

    // data-i18n-title ‚Äî tooltip/title attributes
    document.querySelectorAll('[data-i18n-title]').forEach(el => {
      const key = el.dataset.i18nTitle;
      if (t[key] !== undefined) el.title = t[key];
    });
    // Table fav buttons (dynamically rendered) ‚Äî update title
    document.querySelectorAll('.fav-btn[data-day]').forEach(el => {
      el.title = t.favTip || 'Spara favorit';
    });

    // Mobile cards surah label (dynamically rendered)
    document.querySelectorAll('.dcm-surahs-label').forEach(el => {
      el.textContent = t.surahsDetail;
    });

    // Header title + year
    const h1 = document.getElementById('header-h1');
    if (h1 && t.headerTitle) {
      const yearSpan = h1.querySelector('span');
      h1.childNodes[0].textContent = '';
      h1.innerHTML = t.headerTitle + '<br><span style="font-size:0.65em;letter-spacing:0.04em;opacity:0.85;">' + t.headerYear + '</span>';
    }

    // Suror expand hint
    const expandHint = document.getElementById('surahs-expand-hint');
    if (expandHint) {
      const isExpanded = document.getElementById('surahs-cell')?.classList.contains('expanded');
      expandHint.textContent = isExpanded ? (t.showLess || 'Visa mindre ‚ñ¥') : (t.showMore || 'Visa alla ‚ñæ');
    }

    // Today-card date label ‚Äî re-render with correct language
    const dateLabelEl = document.getElementById('today-date-label');
    if (dateLabelEl && dateLabelEl.textContent && dateLabelEl.textContent !== '‚Äî') {
      const todayRow = SCHEDULE.find(r => r.datum === today);
      if (todayRow) dateLabelEl.textContent = getDateLabel(new Date(today));
    }

    // Today-pages prefix ‚Äî update if already rendered
    const pagesEl = document.getElementById('today-pages');
    if (pagesEl && pagesEl.dataset.sidor) {
      pagesEl.textContent = (t.pagesPrefix || 'Sidor') + ' ' + pagesEl.dataset.sidor;
    }

    // Theme toggle label ‚Äî respect current theme
    const toggleLabel = document.getElementById('toggle-label');
    if (toggleLabel && t.lightMode && t.darkMode) {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      toggleLabel.innerHTML = isDark ? t.darkMode : t.lightMode;
    }

    // Today badge in table/cards
    document.querySelectorAll('.today-badge').forEach(el => {
      el.textContent = t.todayBadge || 'Idag';
    });

    // Weekday names in table and mobile cards
    document.querySelectorAll('[data-vecka]').forEach(el => {
      el.textContent = getDay(el.dataset.vecka);
    });

    // Today-card inline hadith
    const hadithInline = document.querySelector('.today-hadith-inline');
    if (hadithInline) {
      const todayRow = SCHEDULE.find(r => r.datum === today);
      if (todayRow) {
        const key = todayRow.moonText || DEFAULT_MOON_TEXT;
        const newText = (t.hadith && t.hadith[key]) ? t.hadith[key] : T['sv'].hadith[key];
        const label = hadithInline.querySelector('.hadith-label');
        hadithInline.innerHTML = (label ? label.outerHTML : '<span class="hadith-label">üåô Laylatul-Qadr</span>') + newText;
      }
    }

    // Moon bubble hadiths (desktop table + mobile cards)
    document.querySelectorAll('.moon-bubble').forEach(bubble => {
      const tr   = bubble.closest('tr');
      const card = bubble.closest('.day-card-mobile');
      let row = null;
      if (tr) {
        const dayNum = parseInt(tr.querySelector('.td-dag')?.textContent);
        if (!isNaN(dayNum)) row = SCHEDULE.find(r => r.day === dayNum);
      } else if (card) {
        const dayNum = parseInt(card.querySelector('.dcm-dag')?.textContent);
        if (!isNaN(dayNum)) row = SCHEDULE.find(r => r.day === dayNum);
      }
      if (!row) return;
      const key = row.moonText || DEFAULT_MOON_TEXT;
      const newText = (t.hadith && t.hadith[key]) ? t.hadith[key] : T['sv'].hadith[key];
      // Preserve inner structure (label span) if present, replace only text
      const textEl = bubble.querySelector('.moon-bubble-text');
      if (textEl) textEl.textContent = newText;
    });

    // Isha countdown live labels (only if not already done)
    const ishaLabelEl = document.getElementById('isha-label');
    if (ishaLabelEl && ishaLabelEl.textContent !== t.ishaDoneLabel) {
      ishaLabelEl.textContent = t.ishaLabel;
    }

    localStorage.setItem(LANG_KEY, lang);
  }

  /* ‚îÄ‚îÄ Lang dropdown toggle ‚îÄ‚îÄ */
  document.getElementById('lang-trigger').addEventListener('click', () => {
    const wrap     = document.getElementById('lang-wrap');
    const dropdown = document.getElementById('lang-dropdown');
    const isOpen   = wrap.classList.toggle('open');
    if (isOpen && window.innerWidth <= 640) {
      // Positionera dropdown med fixed s√• den inte klipps av header overflow
      const triggerRect = document.getElementById('lang-trigger').getBoundingClientRect();
      dropdown.style.position = 'fixed';
      dropdown.style.top      = (triggerRect.bottom + 8) + 'px';
      dropdown.style.left     = triggerRect.left + 'px';
    } else {
      dropdown.style.position = '';
      dropdown.style.top      = '';
      dropdown.style.left     = '';
    }
  });
  document.addEventListener('click', e => {
    if (!e.target.closest('#lang-wrap')) {
      document.getElementById('lang-wrap').classList.remove('open');
    }
  });
  document.querySelectorAll('.lang-item').forEach(item => {
    item.addEventListener('click', () => {
      document.querySelectorAll('.lang-item').forEach(i => i.classList.remove('active'));
      item.classList.add('active');
      document.getElementById('lang-flag').textContent = item.dataset.flag;
      document.getElementById('lang-code').textContent = item.dataset.code;
      document.getElementById('lang-wrap').classList.remove('open');
      applyLang(item.dataset.lang);
    });
  });


  /* ‚îÄ‚îÄ Instagram Story canvas export ‚îÄ‚îÄ */
  function exportInstagramCard() {
    const todayRow = SCHEDULE.find(r => r.datum === today);
    if (!todayRow) return;

    // V√§nta p√• att Google Fonts √§r laddade ‚Äî annars ritar canvas med system-font
    // document.fonts.ready √§r en Promise som l√∂ser sig direkt om fonts redan √§r klara
    document.fonts.ready.then(() => _drawAndExport(todayRow));
  }

  function _drawAndExport(todayRow) {
    const t   = T[_currentLang];
    const DPR = 2;
    const CW  = 1080, CH = 1920;
    const canvas = document.getElementById('img-canvas');
    canvas.width  = CW * DPR;
    canvas.height = CH * DPR;
    const ctx = canvas.getContext('2d');
    ctx.scale(DPR, DPR);
    const CX = CW / 2;

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // HELPERS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function rrect(x, y, w, h, r) {
      if (ctx.roundRect) { ctx.roundRect(x, y, w, h, r); return; }
      ctx.beginPath();
      ctx.moveTo(x+r,y); ctx.lineTo(x+w-r,y); ctx.quadraticCurveTo(x+w,y,x+w,y+r);
      ctx.lineTo(x+w,y+h-r); ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);
      ctx.lineTo(x+r,y+h); ctx.quadraticCurveTo(x,y+h,x,y+h-r);
      ctx.lineTo(x,y+r); ctx.quadraticCurveTo(x,y,x+r,y);
      ctx.closePath();
    }

    function goldLine(x1, y, x2) {
      const g = ctx.createLinearGradient(x1, 0, x2, 0);
      g.addColorStop(0,   'rgba(201,168,76,0)');
      g.addColorStop(0.3, 'rgba(201,168,76,0.6)');
      g.addColorStop(0.5, 'rgba(232,201,100,1)');
      g.addColorStop(0.7, 'rgba(201,168,76,0.6)');
      g.addColorStop(1,   'rgba(201,168,76,0)');
      ctx.strokeStyle = g; ctx.lineWidth = 1.5;
      ctx.beginPath(); ctx.moveTo(x1,y); ctx.lineTo(x2,y); ctx.stroke();
    }

    function diamond(cx, cy, size, alpha) {
      ctx.save();
      ctx.translate(cx, cy); ctx.rotate(Math.PI/4);
      ctx.fillStyle = 'rgba(201,168,76,' + alpha + ')';
      ctx.fillRect(-size/2, -size/2, size, size);
      ctx.restore();
    }

    function islamicStar(cx, cy, R, r, pts, alpha) {
      ctx.save();
      ctx.beginPath();
      for (let i = 0; i < pts * 2; i++) {
        const angle = (i * Math.PI / pts) - Math.PI / 2;
        const rad   = i % 2 === 0 ? R : r;
        const x = cx + Math.cos(angle) * rad;
        const y = cy + Math.sin(angle) * rad;
        i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
      }
      ctx.closePath();
      ctx.fillStyle = 'rgba(201,168,76,' + alpha + ')';
      ctx.fill();
      ctx.restore();
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // 1. BAKGRUND ‚Äî djup svart-smaragd
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const bg = ctx.createLinearGradient(0, 0, CW * 0.8, CH);
    bg.addColorStop(0,    '#060e09');
    bg.addColorStop(0.25, '#0a1a10');
    bg.addColorStop(0.55, '#0e2418');
    bg.addColorStop(0.80, '#122c1e');
    bg.addColorStop(1,    '#163424');
    ctx.fillStyle = bg;
    ctx.fillRect(0, 0, CW, CH);

    // Atmosf√§risk smaragd-glow mitten-v√§nster
    const g1 = ctx.createRadialGradient(CW*0.15, CH*0.42, 0, CW*0.15, CH*0.42, CW*0.9);
    g1.addColorStop(0,   'rgba(18,90,60,0.35)');
    g1.addColorStop(0.5, 'rgba(18,90,60,0.08)');
    g1.addColorStop(1,   'rgba(18,90,60,0)');
    ctx.fillStyle = g1; ctx.fillRect(0,0,CW,CH);

    // Guld aura uppe h√∂ger
    const g2 = ctx.createRadialGradient(CW*0.9, CH*0.07, 0, CW*0.9, CH*0.07, CW*0.65);
    g2.addColorStop(0,   'rgba(201,168,76,0.20)');
    g2.addColorStop(0.35,'rgba(201,168,76,0.06)');
    g2.addColorStop(1,   'rgba(201,168,76,0)');
    ctx.fillStyle = g2; ctx.fillRect(0,0,CW,CH);

    // Subtil lila-guld glow nere h√∂ger
    const g3 = ctx.createRadialGradient(CW*0.88, CH*0.88, 0, CW*0.88, CH*0.88, CW*0.5);
    g3.addColorStop(0,   'rgba(120,80,200,0.08)');
    g3.addColorStop(1,   'rgba(120,80,200,0)');
    ctx.fillStyle = g3; ctx.fillRect(0,0,CW,CH);

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // 2. GIRIH-M√ñNSTER ‚Äî t√§ckande islamiskt geometriskt gitter
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    (function drawGirih() {
      ctx.save();
      ctx.globalAlpha = 0.09;
      ctx.strokeStyle = 'rgba(201,168,76,1)';
      ctx.lineWidth   = 1.4;

      // Girih bygger p√• ett gitter av regelbundna 10-h√∂rningar (dekagoner)
      // Varje cell har radien R, och cellerna placeras i ett offset-gitter
      const R   = 88;          // radius p√• varje dekagon
      const cos36 = Math.cos(Math.PI / 5);
      const sin36 = Math.sin(Math.PI / 5);
      const cos72 = Math.cos(2 * Math.PI / 5);
      const sin72 = Math.sin(2 * Math.PI / 5);

      // Cellstorlek i x och y f√∂r hexagonalt offset-gitter
      const cellW = R * 2 * Math.sin(Math.PI / 10) * 2 + R * (1 - cos36) * 2;
      const dx    = R * (1 + cos36) * 2;          // horisontellt avst√•nd cell‚Äìcell
      const dy    = R * (sin36 + sin72);           // vertikalt avst√•nd

      // Rita en 10-punktig girih-stj√§rna med inre linjer p√• position (cx,cy)
      function girhiCell(cx, cy) {
        const pts = 10;
        const outer = [];
        const inner = [];
        for (let i = 0; i < pts; i++) {
          const a = (i / pts) * Math.PI * 2 - Math.PI / 2;
          outer.push([cx + Math.cos(a) * R,       cy + Math.sin(a) * R]);
          inner.push([cx + Math.cos(a) * R * 0.38, cy + Math.sin(a) * R * 0.38]);
        }

        // Yttre dekagon
        ctx.beginPath();
        outer.forEach(([x,y],i) => i===0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y));
        ctx.closePath(); ctx.stroke();

        // 10-punktig stj√§rna ‚Äî varje yttre punkt ansluter till varannan
        ctx.beginPath();
        for (let i = 0; i < pts; i++) {
          const [x1,y1] = outer[i];
          const [x2,y2] = outer[(i+3) % pts];
          ctx.moveTo(x1,y1); ctx.lineTo(x2,y2);
        }
        ctx.stroke();

        // Inre "rosett" ‚Äî anslut inre punkter f√∂r girih-k√§nsla
        ctx.beginPath();
        for (let i = 0; i < pts; i++) {
          const [ix,iy] = inner[i];
          const [ox,oy] = outer[i];
          const [ox2,oy2] = outer[(i+1)%pts];
          const mx = (ox+ox2)/2, my = (oy+oy2)/2;
          ctx.moveTo(ix,iy); ctx.lineTo(mx,my);
        }
        ctx.stroke();
      }

      // T√§ck hela bilden med offset-gitter
      const cols = Math.ceil(CW / dx) + 2;
      const rows = Math.ceil(CH / dy) + 2;
      for (let row = -1; row < rows; row++) {
        for (let col = -1; col < cols; col++) {
          const cx = col * dx + (row % 2 === 0 ? 0 : dx / 2);
          const cy = row * dy;
          girhiCell(cx, cy);
        }
      }

      ctx.restore();
    })();

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // 3. HEADER ORNAMENT ‚Äî toppen
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    goldLine(60, 80, CW-60);
    diamond(CX, 80, 18, 0.9);
    diamond(CX - 60, 80, 8, 0.5);
    diamond(CX + 60, 80, 8, 0.5);

    // Mosk√©-emoji stor, subtil
    ctx.font = '80px serif';
    ctx.textAlign = 'center';
    ctx.globalAlpha = 0.18;
    ctx.fillText('üïå', CX, 200);
    ctx.globalAlpha = 1;

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // 4. "DAGENS IMAM" CHIP
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const pillTxt = (t.badgeText || 'Dagens Imam').toUpperCase();
    ctx.font = '700 26px "DM Sans", sans-serif';
    const pillTW  = ctx.measureText(pillTxt).width;
    const pH = 58, pW = pillTW + 80;
    const pX = CX - pW/2, pY = 240;

    // Glassmorfism-bakgrund
    const pillBg = ctx.createLinearGradient(pX, pY, pX+pW, pY+pH);
    pillBg.addColorStop(0, 'rgba(201,168,76,0.22)');
    pillBg.addColorStop(1, 'rgba(201,168,76,0.08)');
    ctx.fillStyle = pillBg;
    rrect(pX, pY, pW, pH, pH/2); ctx.fill();

    // Border gradient
    ctx.strokeStyle = 'rgba(201,168,76,0.55)';
    ctx.lineWidth = 1.5;
    rrect(pX, pY, pW, pH, pH/2); ctx.stroke();

    // Prick + text
    ctx.beginPath(); ctx.arc(pX+26, pY+pH/2, 7, 0, Math.PI*2);
    ctx.fillStyle = '#c9a84c'; ctx.fill();
    ctx.fillStyle = '#f0d080';
    ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
    ctx.fillText(pillTxt, CX+8, pY+pH/2);
    ctx.textBaseline = 'alphabetic';

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // 5. IMAM-NAMN ‚Äî stor, vit, dramatisk
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const imamName    = todayRow.imamLabel;
    const nameFontSz  = imamName.length > 22 ? 104 : imamName.length > 16 ? 120 : imamName.length > 12 ? 140 : 156;
    ctx.textAlign  = 'center';
    ctx.fillStyle  = '#ffffff';

    // Skugga f√∂r djup
    ctx.shadowColor   = 'rgba(0,0,0,0.6)';
    ctx.shadowBlur    = 30;
    ctx.shadowOffsetY = 8;

    ctx.font = '600 ' + nameFontSz + 'px "Cormorant Garamond", serif';
    const nameY = pY + pH + 50 + nameFontSz;

    if (ctx.measureText(imamName).width > CW - 80) {
      const parts = imamName.split(' ');
      const mid   = Math.ceil(parts.length / 2);
      ctx.fillText(parts.slice(0,mid).join(' '), CX, nameY);
      ctx.fillText(parts.slice(mid).join(' '),   CX, nameY + nameFontSz + 14);
    } else {
      ctx.fillText(imamName, CX, nameY);
    }
    ctx.shadowColor = 'transparent'; ctx.shadowBlur = 0; ctx.shadowOffsetY = 0;

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // 6. DATUM & HIJRI
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const hijriDay    = todayRow.day - 1;
    const dateStr     = getDateLabel(new Date(today));
    const hijriLatin  = hijriDay > 0 ? hijriDay + ' Ramadan 1447' : '';
    const hijriArabic = 'ÿ±ŸÖÿ∂ÿßŸÜ';
    const dateY       = nameY + 64;

    ctx.font = '400 38px "DM Sans", sans-serif';
    if (hijriLatin) {
      const dateW  = ctx.measureText(dateStr).width;
      const latinW = ctx.measureText(hijriLatin).width;
      ctx.font = '400 40px "Cormorant Garamond", serif';
      const arabicW = ctx.measureText(hijriArabic).width;
      ctx.font = '400 38px "DM Sans", sans-serif';
      const DOT = 44, GAP = 16;
      const totalW = dateW + DOT + latinW + GAP + arabicW;
      const sx = CX - totalW/2;

      ctx.textAlign = 'left';
      ctx.fillStyle = 'rgba(255,255,255,0.60)';
      ctx.fillText(dateStr, sx, dateY);

      ctx.beginPath(); ctx.arc(sx + dateW + DOT/2, dateY-13, 5, 0, Math.PI*2);
      ctx.fillStyle = 'rgba(201,168,76,0.7)'; ctx.fill();

      ctx.fillStyle = 'rgba(255,255,255,0.60)';
      ctx.font = '400 38px "DM Sans", sans-serif';
      ctx.fillText(hijriLatin, sx+dateW+DOT, dateY);

      ctx.font = '400 42px "Cormorant Garamond", serif';
      ctx.fillStyle = 'rgba(201,168,76,0.85)';
      ctx.fillText(hijriArabic, sx+dateW+DOT+latinW+GAP, dateY);
    } else {
      ctx.textAlign = 'center';
      ctx.fillStyle = 'rgba(255,255,255,0.60)';
      ctx.fillText(dateStr, CX, dateY);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // 7. GULD DIVIDER med ornament
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const divY = dateY + 80;
    goldLine(80, divY, CW-80);
    diamond(CX, divY, 20, 0.95);
    diamond(CX-90, divY, 7, 0.5);
    diamond(CX+90, divY, 7, 0.5);
    // Stj√§rnor l√§ngs linjen
    islamicStar(CX-200, divY, 10, 4, 6, 0.3);
    islamicStar(CX+200, divY, 10, 4, 6, 0.3);

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // 8. INFO-PANEL ‚Äî glassmorfism med tv√• kolumner
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const panelY  = divY + 60;
    const panelH  = CH - panelY - 140;
    const panelPad = 56;

    // Panel bakgrund ‚Äî frostat glas
    const panelBg = ctx.createLinearGradient(0, panelY, 0, panelY+panelH);
    panelBg.addColorStop(0, 'rgba(255,255,255,0.05)');
    panelBg.addColorStop(1, 'rgba(255,255,255,0.02)');
    ctx.fillStyle = panelBg;
    rrect(panelPad, panelY, CW-panelPad*2, panelH, 36); ctx.fill();

    // Panel border
    const panelBorder = ctx.createLinearGradient(0, panelY, 0, panelY+panelH);
    panelBorder.addColorStop(0, 'rgba(201,168,76,0.25)');
    panelBorder.addColorStop(0.5,'rgba(255,255,255,0.06)');
    panelBorder.addColorStop(1, 'rgba(201,168,76,0.12)');
    ctx.strokeStyle = panelBorder;
    ctx.lineWidth = 1.5;
    rrect(panelPad, panelY, CW-panelPad*2, panelH, 36); ctx.stroke();

    // Vertikal separator
    const sepX = CW/2;
    const sepGrad = ctx.createLinearGradient(0, panelY+40, 0, panelY+panelH-40);
    sepGrad.addColorStop(0, 'rgba(201,168,76,0)');
    sepGrad.addColorStop(0.3,'rgba(201,168,76,0.25)');
    sepGrad.addColorStop(0.7,'rgba(201,168,76,0.25)');
    sepGrad.addColorStop(1, 'rgba(201,168,76,0)');
    ctx.strokeStyle = sepGrad; ctx.lineWidth = 1;
    ctx.beginPath(); ctx.moveTo(sepX, panelY+40); ctx.lineTo(sepX, panelY+panelH-40); ctx.stroke();

    const col1X   = panelPad + panelPad*0.5;
    const col2X   = CW/2 + panelPad*0.5;
    const colMaxW = CW/2 - panelPad*1.5;
    const infoY   = panelY + 72;

    // ‚îÄ‚îÄ Kolumn 1: SIDOR ‚îÄ‚îÄ
    // Label
    ctx.font = '700 22px "DM Sans", sans-serif';
    ctx.fillStyle = 'rgba(201,168,76,0.60)';
    ctx.textAlign = 'left';
    ctx.letterSpacing = '0.14em';
    ctx.fillText((t.labelPages || 'SIDOR IDAG').toUpperCase(), col1X, infoY);
    ctx.letterSpacing = '0';

    // Guld understrykning under label
    ctx.strokeStyle = 'rgba(201,168,76,0.20)'; ctx.lineWidth = 1;
    ctx.beginPath(); ctx.moveTo(col1X, infoY+10); ctx.lineTo(col1X+180, infoY+10); ctx.stroke();

    // Sidor-v√§rde
    ctx.font = '500 110px "Cormorant Garamond", serif';
    ctx.fillStyle = '#ffffff';
    ctx.shadowColor = 'rgba(45,156,110,0.4)';
    ctx.shadowBlur  = 20;
    ctx.fillText(todayRow.sidor, col1X, infoY+128);
    ctx.shadowBlur = 0; ctx.shadowColor = 'transparent';

    // ‚îÄ‚îÄ Kolumn 2: SUROR ‚îÄ‚îÄ
    ctx.font = '700 22px "DM Sans", sans-serif';
    ctx.fillStyle = 'rgba(201,168,76,0.60)';
    ctx.letterSpacing = '0.14em';
    ctx.fillText((t.labelSurahs || 'SUROR').toUpperCase(), col2X, infoY);
    ctx.letterSpacing = '0';

    ctx.strokeStyle = 'rgba(201,168,76,0.20)'; ctx.lineWidth = 1;
    ctx.beginPath(); ctx.moveTo(col2X, infoY+10); ctx.lineTo(col2X+120, infoY+10); ctx.stroke();

    // Suror-namn ‚Äî radbryt med fallback
    ctx.font = '500 58px "Cormorant Garamond", serif';
    ctx.fillStyle = '#ffffff';
    const surahParts = todayRow.surahs.split(', ');
    let sLine = '', sY = infoY+72, sLH = 68;
    ctx.shadowColor = 'rgba(45,156,110,0.3)'; ctx.shadowBlur = 16;
    for (let i = 0; i < surahParts.length; i++) {
      const test = sLine ? sLine + ', ' + surahParts[i] : surahParts[i];
      if (ctx.measureText(test).width > colMaxW && sLine) {
        ctx.fillText(sLine + ',', col2X, sY); sY += sLH;
        if (sY > panelY+panelH-140) {
          ctx.font = '400 36px "DM Sans", sans-serif';
          ctx.fillStyle = 'rgba(255,255,255,0.35)';
          ctx.shadowBlur = 0;
          ctx.fillText('+ ' + (surahParts.length - i) + ' till‚Ä¶', col2X, sY);
          sLine = ''; break;
        }
        sLine = surahParts[i];
      } else { sLine = test; }
    }
    if (sLine) { ctx.fillText(sLine, col2X, sY); sY += sLH; }
    ctx.shadowBlur = 0; ctx.shadowColor = 'transparent';

    // Ayat-ref
    ctx.font = '400 32px "DM Sans", sans-serif';
    ctx.fillStyle = 'rgba(201,168,76,0.55)';
    ctx.fillText(todayRow.tooltip, col2X, sY + 6);

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // 9. NATT-NUMMER ‚Äî stor subtil bakgrundssiffra
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    ctx.save();
    ctx.globalAlpha = 0.04;
    ctx.font = '700 600px "Cormorant Garamond", serif';
    ctx.fillStyle = '#ffffff';
    ctx.textAlign = 'center';
    ctx.fillText(todayRow.day, CX, panelY + panelH * 0.7);
    ctx.restore();

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // 10. FOOTER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    goldLine(80, CH-120, CW-80);
    diamond(CX, CH-120, 14, 0.7);

    ctx.font = '500 30px "DM Sans", sans-serif';
    ctx.fillStyle = 'rgba(255,255,255,0.28)';
    ctx.textAlign = 'center';
    ctx.fillText('K√§mpingehallen  ¬∑  Ramadan 2026', CX, CH-72);

    ctx.font = '600 28px "DM Sans", sans-serif';
    ctx.fillStyle = 'rgba(201,168,76,0.55)';
    ctx.fillText('@sverigesimamer', CX, CH-30);

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // EXPORT
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const nightLabel = (t.night || 'Natt') + ' ' + todayRow.day;
    canvas.toBlob(blob => {
      const fname = 'tarawih-natt-' + todayRow.day + '.png';
      const file  = new File([blob], fname, { type: 'image/png' });
      if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
        navigator.share({ files: [file], title: 'Tarawih ' + nightLabel }).catch(() => {});
      } else {
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = fname; a.click();
        setTimeout(() => URL.revokeObjectURL(a.href), 3000);
      }
    }, 'image/png');
  }

  /* ‚îÄ‚îÄ Share ‚îÄ‚îÄ */
  function handleShare() {
    const t = T[_currentLang];
    const btn = document.getElementById('share-btn');
    const toast = document.getElementById('share-toast');
    if (navigator.share) {
      navigator.share({ title: 'Tarawih Schema ‚Äî K√§mpingehallen', url: window.location.href });
      return;
    }
    navigator.clipboard.writeText(window.location.href).catch(() => {});
    btn.classList.add('share-copied');
    toast.textContent = t.shareToast;
    toast.classList.add('visible');
    setTimeout(() => {
      btn.classList.remove('share-copied');
      toast.classList.remove('visible');
    }, 2200);
  }

  /* ‚îÄ‚îÄ Detect or restore language ‚îÄ‚îÄ
     Priority: 1) localStorage  2) browser language  3) 'sv'
  ‚îÄ‚îÄ */
  (function() {
    // Map browser language codes ‚Üí our supported keys
    const LANG_MAP = {
      'sv': 'sv', 'sv-SE': 'sv', 'sv-FI': 'sv',
      'ar': 'ar', 'ar-SA': 'ar', 'ar-EG': 'ar', 'ar-AE': 'ar',
        'ar-IQ': 'ar', 'ar-MA': 'ar', 'ar-DZ': 'ar', 'ar-TN': 'ar',
        'ar-LY': 'ar', 'ar-JO': 'ar', 'ar-LB': 'ar', 'ar-SY': 'ar',
        'ar-YE': 'ar', 'ar-KW': 'ar', 'ar-QA': 'ar', 'ar-BH': 'ar',
        'ar-OM': 'ar', 'ar-SD': 'ar', 'ar-SO': 'ar',
      'en': 'en', 'en-US': 'en', 'en-GB': 'en', 'en-AU': 'en',
        'en-CA': 'en', 'en-NZ': 'en', 'en-ZA': 'en',
      'tr': 'tr', 'tr-TR': 'tr', 'tr-CY': 'tr',
      'so': 'so', 'so-SO': 'so', 'so-ET': 'so', 'so-KE': 'so',
    };

    function detectBrowserLang() {
      const langs = navigator.languages || [navigator.language || 'sv'];
      for (const l of langs) {
        if (LANG_MAP[l])            return LANG_MAP[l];
        const base = l.split('-')[0];
        if (LANG_MAP[base])         return LANG_MAP[base];
      }
      return 'sv';
    }

    const lang = localStorage.getItem(LANG_KEY) || detectBrowserLang();
    // Always activate the matching UI item
    const item = document.querySelector('.lang-item[data-lang="' + lang + '"]');
    if (item) {
      document.querySelectorAll('.lang-item').forEach(i => i.classList.remove('active'));
      item.classList.add('active');
      document.getElementById('lang-flag').textContent = item.dataset.flag;
      document.getElementById('lang-code').textContent = item.dataset.code;
    }
    applyLang(lang);
    // Save detected lang so next visit skips detection
    if (!localStorage.getItem(LANG_KEY)) localStorage.setItem(LANG_KEY, lang);
  })();

  /* ‚îÄ‚îÄ ISHA COUNTDOWN ‚îÄ‚îÄ */
  const ISHA_TIMES = {
    '2026-02-17':'18:56','2026-02-18':'18:58','2026-02-19':'19:00',
    '2026-02-20':'19:03','2026-02-21':'19:05','2026-02-22':'19:07',
    '2026-02-23':'19:10','2026-02-24':'19:12','2026-02-25':'19:14',
    '2026-02-26':'19:17','2026-02-27':'19:19','2026-02-28':'19:22',
    '2026-03-01':'19:24','2026-03-02':'19:27','2026-03-03':'19:29',
    '2026-03-04':'19:32','2026-03-05':'19:34','2026-03-06':'19:37',
    '2026-03-07':'19:39','2026-03-08':'19:42','2026-03-09':'19:45',
    '2026-03-10':'19:47','2026-03-11':'19:50','2026-03-12':'19:53',
    '2026-03-13':'19:55','2026-03-14':'19:58','2026-03-15':'20:01',
    '2026-03-16':'20:04','2026-03-17':'20:07','2026-03-18':'20:09',
  };

  function padZ(n) { return String(n).padStart(2,'0'); }
  function getDateKey(d) { const y=d.getFullYear(),m=padZ(d.getMonth()+1),day=padZ(d.getDate()); return y+'-'+m+'-'+day; }

  function startIshaCountdown() {
    const countdownEl  = document.getElementById('isha-countdown');
    const timerEl      = document.getElementById('isha-timer');
    const timerDoneEl  = document.getElementById('isha-timer-done');
    const infoEl       = document.getElementById('isha-time-info');
    const labelEl      = document.getElementById('isha-label');
    const notifBtn     = document.getElementById('notif-btn');
    const notifLabel   = document.getElementById('notif-btn-label');
    if (!countdownEl) return;
    countdownEl.style.display = 'block';
    let _hasTriggeredDone = false;

    function updateNotifBtn() {
      if (!('Notification' in window)) { notifBtn.style.display = 'none'; return; }
      if (Notification.permission === 'granted') { notifBtn.classList.add('granted'); notifLabel.textContent = T[_currentLang].notifGranted || 'Notis aktiv'; notifBtn.querySelector('svg').style.stroke = '#1d7a4e'; }
      else if (Notification.permission === 'denied') { notifBtn.classList.add('denied'); notifLabel.textContent = T[_currentLang].notifDenied || 'Notis blockerad'; }
    }
    updateNotifBtn();
    notifBtn.addEventListener('click', async () => {
      if (!('Notification' in window)) return;
      if (Notification.permission === 'default') { await Notification.requestPermission(); updateNotifBtn(); }
    });

    function fireIshaNotification(ishaStr) {
      if (!('Notification' in window) || Notification.permission !== 'granted') return;
      new Notification(T[_currentLang].notifTitle, { body: T[_currentLang].notifBody + ishaStr, icon: '/favicon.ico', badge: '/favicon.ico', tag: 'isha-prayer', renotify: false, silent: false });
    }

    function triggerDoneAnimation(ishaStr) {
      if (_hasTriggeredDone) return;
      _hasTriggeredDone = true;
      timerEl.classList.add('fading-out');
      timerDoneEl.classList.add('fading-in');
      countdownEl.classList.add('isha-done');
      countdownEl.classList.add('isha-pulsing');
      countdownEl.addEventListener('animationend', () => { countdownEl.classList.remove('isha-pulsing'); }, { once: true });
      fireIshaNotification(ishaStr);
    }

    function tick() {
      const now = new Date();
      const todayKey = getDateKey(now);
      const nowSec = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
      const ishaStr = ISHA_TIMES[todayKey];
      if (!ishaStr) { timerEl.textContent = '--:--:--'; labelEl.textContent = T[_currentLang].ishaLabel; infoEl.textContent = ''; return; }
      const [ishaH, ishaM] = ishaStr.split(':').map(Number);
      const ishaSec = ishaH * 3600 + ishaM * 60;

      // Progress ring ‚Äî f√∂nster fr√•n 16:00 till Isha
      const ringEl = document.getElementById('isha-ring-fill');
      const CIRCUMFERENCE = 2 * Math.PI * 23; // 144.51
      if (ringEl) {
        const windowStart = 16 * 3600;
        const windowLen   = ishaSec - windowStart;
        const elapsed     = Math.max(0, nowSec - windowStart);
        const progress    = Math.min(1, elapsed / windowLen);
        ringEl.style.strokeDashoffset = CIRCUMFERENCE * (1 - progress);
      }

      if (nowSec >= ishaSec) {
        triggerDoneAnimation(ishaStr);
        labelEl.textContent = T[_currentLang].ishaDoneLabel;
        infoEl.textContent  = T[_currentLang].ishaDone + ishaStr;
        if (ringEl) { ringEl.style.stroke = '#3dba7e'; ringEl.style.strokeDashoffset = '0'; }
      } else {
        labelEl.textContent = T[_currentLang].ishaLabel;
        infoEl.textContent  = T[_currentLang].ishaPrefix + ishaStr;
        const diff = ishaSec - nowSec;
        const h = Math.floor(diff / 3600), m = Math.floor((diff % 3600) / 60), s = diff % 60;
        timerEl.textContent = padZ(h) + ':' + padZ(m) + ':' + padZ(s);
        // Guld-ton n√§r < 30 min kvar
        if (ringEl && diff < 1800) {
          timerEl.style.color = 'var(--gold)';
          ringEl.style.stroke = 'rgba(201,168,76,0.9)';
        } else if (ringEl) {
          timerEl.style.color = '';
          ringEl.style.stroke = '';
        }
      }
    }
    tick();
    setInterval(tick, 1000);
  }
  startIshaCountdown();

  /* ‚îÄ‚îÄ THEME TOGGLE ‚îÄ‚îÄ */
  const THEME_KEY = 'tarawih-theme';
  const _root = document.documentElement;

  function _applyTheme(theme) {
    _root.setAttribute('data-theme', theme);
    const label    = document.getElementById('toggle-label');
    const wavePath = document.getElementById('wave-path');
    if (theme === 'dark') {
      if (label)    label.innerHTML = (T[_currentLang] && T[_currentLang].darkMode) ? T[_currentLang].darkMode : 'M√ñRKT<br>L√ÑGE';
      if (wavePath) wavePath.setAttribute('fill', '#131f1b');
    } else {
      if (label)    label.innerHTML = (T[_currentLang] && T[_currentLang].lightMode) ? T[_currentLang].lightMode : 'LJUST<br>L√ÑGE';
      if (wavePath) wavePath.setAttribute('fill', '#24645d');
    }
    localStorage.setItem(THEME_KEY, theme);
  }

  function toggleTheme() {
    const next = _root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
    _applyTheme(next);
  }

  (function() {
    const saved = localStorage.getItem(THEME_KEY);
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    _applyTheme(saved || (prefersDark ? 'dark' : 'light'));
  })();

  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
    if (!localStorage.getItem(THEME_KEY)) _applyTheme(e.matches ? 'dark' : 'light');
  });

  /* ‚îÄ‚îÄ FILTER ‚îÄ‚îÄ */
  let activeFilter = null;
  function toggleFilter(imam) {
    activeFilter = (activeFilter === imam) ? null : imam;
    applyFilter();
    if (activeFilter) {
      setTimeout(() => {
        const target = window.innerWidth <= 640 ? document.getElementById('mobile-cards') : document.querySelector('.table-wrap');
        if (target) { const y = target.getBoundingClientRect().top + window.scrollY - 90; window.scrollTo({ top: y, behavior: 'smooth' }); }
      }, 80);
    }
  }

  function applyFilter() {
    const imamColors = { abdurrahman:'rgba(232,99,10,0.5)', saed:'rgba(212,168,0,0.5)', noor:'rgba(41,128,185,0.5)', abdul:'rgba(44,44,44,0.5)', mohammed:'rgba(33,145,80,0.5)', yacquub:'rgba(125,58,172,0.5)', ibrahim:'rgba(26,58,107,0.5)', abdelsalam:'rgba(123,63,0,0.5)', hatem:'rgba(45,106,79,0.5)' };
    document.querySelectorAll('.filter-chip').forEach(btn => {
      const isActive = btn.dataset.imam === activeFilter;
      btn.classList.toggle('active', isActive);
      if (isActive) btn.style.setProperty('--pulse-color', imamColors[btn.dataset.imam] || 'rgba(0,0,0,0.3)');
      else btn.style.removeProperty('--pulse-color');
    });
    document.querySelectorAll('#table-body tr').forEach(tr => {
      const chip = tr.querySelector('.imam-chip');
      let show;
      if (activeFilter === 'favs') {
        const dayNum = parseInt(tr.querySelector('.td-dag')?.textContent);
        show = !isNaN(dayNum) && isFav(dayNum);
      } else {
        show = !activeFilter || (chip && chip.classList.contains('imam-' + activeFilter));
      }
      tr.classList.toggle('filtered-out', !show);
    });
    document.querySelectorAll('#mobile-cards .day-card-mobile').forEach(card => {
      const chip = card.querySelector('.imam-chip');
      let show;
      if (activeFilter === 'favs') {
        const dayEl  = card.querySelector('.dcm-dag');
        const dayNum = dayEl ? parseInt(dayEl.textContent) : NaN;
        show = !isNaN(dayNum) && isFav(dayNum);
      } else {
        show = !activeFilter || (chip && chip.classList.contains('imam-' + activeFilter));
      }
      card.classList.toggle('filtered-out', !show);
    });
    const visibleRows  = [...document.querySelectorAll('#table-body tr:not(.filtered-out)')];
    const visibleCards = [...document.querySelectorAll('#mobile-cards .day-card-mobile:not(.filtered-out)')];

    // Tom-state f√∂r favoriter
    const isFavFilter = activeFilter === 'favs';
    const noFavsMsg   = T[_currentLang]?.noFavs || 'Du har inga favoriter √§n.';
    const emptyEl = document.getElementById('fav-empty');
    const emptyTxt = document.getElementById('fav-empty-text');
    const showEmpty = isFavFilter && getFavs().length === 0;
    if (emptyEl) emptyEl.style.display = showEmpty ? '' : 'none';
    if (emptyTxt) emptyTxt.textContent = noFavsMsg;
    const lastDelay = Math.max(
      visibleRows.length  ? (visibleRows.length  - 1) * 45 + 320 : 0,
      visibleCards.length ? (visibleCards.length - 1) * 55 + 320 : 0
    );
    visibleRows.forEach((tr, i) => {
      tr.style.opacity='0'; tr.style.transform='translateY(8px)'; tr.style.transition='opacity 0.3s ease,transform 0.3s ease';
      setTimeout(() => { tr.style.opacity='1'; tr.style.transform='translateY(0)'; setTimeout(() => { tr.style.transition='background .15s'; tr.style.opacity=''; tr.style.transform=''; }, 320); }, i*45);
    });
    visibleCards.forEach((card, i) => {
      card.style.opacity='0'; card.style.transform='translateY(10px)'; card.style.transition='opacity 0.3s ease,transform 0.3s ease';
      setTimeout(() => { card.style.opacity='1'; card.style.transform='translateY(0)'; setTimeout(() => { card.style.transition=''; card.style.opacity=''; card.style.transform=''; }, 320); }, i*55);
    });
  }

</script>

<!-- STICKY BOTTOM PLAYER ‚Äî New Design -->
<div class="sticky-player" id="sticky-player">

  <!-- ‚îÄ‚îÄ FULL PLAYER ‚îÄ‚îÄ -->
  <div class="player-full" style="position:relative;">
    <!-- St√§ng-knapp ‚Äî friflytande i √∂vre h√∂gra h√∂rnet -->
    <button id="sp-close-btn" title="St√§ng spelaren">
      <svg width="9" height="9" viewBox="0 0 11 11" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M1 1L10 10M10 1L1 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
    <div class="sp-drag-handle"></div>


    <!-- Track floating pill ‚Äî Tarawih / Isha -->
    <div class="sp-segment-wrap" id="sp-segment-wrap">
      <div class="sp-segment" id="sp-segment">
        <div class="sp-segment-pill" id="sp-segment-pill"></div>
        <button class="sp-segment-btn active" id="sp-seg-tarawih" data-track="tarawih">
          <span class="sp-seg-icon">üåô</span> Tarawih
        </button>
        <button class="sp-segment-btn" id="sp-seg-isha" data-track="isha">
          <span class="sp-seg-icon">‚≠ê</span> Isha
        </button>
      </div>
    </div>

    <!-- Metadata row -->
    <div class="sp-meta-row">
      <div class="sp-artwork" id="sp-artwork">
        <span class="sp-initials" id="sp-initials">‚Äì</span>
      </div>
      <div class="sp-meta-text">
        <div class="sp-imam-name" id="sp-imam-name">‚Äì</div>
        <div class="sp-meta-sub" id="sp-meta-sub"></div>
      </div>
      <div style="display:flex;align-items:center;gap:4px;flex-shrink:0;position:relative;">
        <!-- Sleep Timer (m√•nen) ‚Äî v√§nster om hj√§rtat -->
        <button class="sp-sleep-btn" id="sp-sleep-btn" title="Sleep timer">
          <div class="sp-sleep-pip"></div>
          <svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        </button>
        <!-- Sleep Panel -->
        <div class="sp-sleep-panel" id="sp-sleep-panel">
          <div class="sp-sleep-panel-title" id="sp-sleep-panel-title">St√§ng av efter</div>
          <div class="sp-sleep-opts" id="sp-sleep-opts">
            <button class="sp-sleep-opt" data-minutes="15">15 min</button>
            <button class="sp-sleep-opt" data-minutes="30">30 min</button>
            <button class="sp-sleep-opt" data-minutes="45">45 min</button>
            <button class="sp-sleep-opt" data-minutes="60">60 min</button>
            <button class="sp-sleep-opt" data-minutes="end" id="sp-sleep-end-opt">Nattslut</button>
          </div>
          <div class="sp-sleep-progress" id="sp-sleep-progress">
            <div class="sp-sleep-progress-row">
              <span class="sp-sleep-progress-lbl" id="sp-sleep-progress-lbl">Stannar om</span>
              <span class="sp-sleep-progress-time" id="sp-sleep-time">‚Äì</span>
            </div>
            <div class="sp-sleep-track">
              <div class="sp-sleep-fill" id="sp-sleep-fill"></div>
            </div>
          </div>
          <button class="sp-sleep-cancel" id="sp-sleep-cancel">Avbryt</button>
        </div>
        <!-- Hj√§rta + like count -->
        <button class="fav-btn" id="sp-fav-btn" data-day="" data-i18n-title="favTip" title="Spara favorit" style="width:34px;height:34px;border:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.06);">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        </button>
        <!-- Dela -->
        <button class="sp-share-btn" id="sp-share-btn" data-i18n-title="shareTip" title="Dela session">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="15.5"/><polyline points="8 5 12 1 16 5"/><path d="M16 11h2a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h2"/></svg>
        </button>
      </div>
    </div>

    <!-- Progress / Seek -->
    <div class="sp-progress-section">
      <div class="sp-progress-times">
        <span id="sp-cur">0:00</span>
        <span id="sp-dur">0:00</span>
      </div>
      <div style="display:flex; align-items:center;">
        <div class="sticky-seek" id="sticky-seek">
          <div class="sticky-seek-fill" id="sticky-fill"></div>
          <div class="sticky-seek-thumb" id="sticky-thumb"></div>
        </div>
      </div>
    </div>

    <!-- Controls -->
    <div class="sp-controls-row">
      <button class="sp-ctrl-btn" id="sp-prev-btn" data-i18n-title="prevNight" title="F√∂reg√•ende natt" disabled>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h2v12H6zm3.5 6 8.5 6V6z"/></svg>
        <span class="sp-ctrl-lbl" id="sp-prev-label"></span>
      </button>
      <button class="sp-ctrl-btn" id="sp-skip-back-btn" data-i18n-title="skipBack" title="‚àí30 sekunder">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
          <polygon points="12.5,4 4,12 12.5,20"/>
          <polygon points="20.5,4 12,12 20.5,20"/>
        </svg>
        <span class="sp-ctrl-lbl">‚àí30s</span>
      </button>

      <!-- Hero play button -->
      <button class="sp-play-hero" id="sticky-play-btn" aria-label="Spela/Pausa">
        <svg class="sp-ring-svg" viewBox="0 0 62 62">
          <circle class="sp-ring-bg" cx="31" cy="31" r="28"/>
          <circle class="sp-ring-fill" id="sp-ring-fill" cx="31" cy="31" r="28"/>
        </svg>
        <div class="sp-ring-inner" id="sp-ring-inner">
          <span class="spm-icon-wrap">
            <svg class="spm-play" width="20" height="20" viewBox="0 0 24 24" fill="white"><polygon points="7,3 21,12 7,21"/></svg>
            <svg class="spm-pause" width="20" height="20" viewBox="0 0 24 24" fill="white"><rect x="6" y="3" width="4" height="18" rx="1.5"/><rect x="14" y="3" width="4" height="18" rx="1.5"/></svg>
          </span>
        </div>
      </button>

      <button class="sp-ctrl-btn" id="sp-skip-fwd-btn" data-i18n-title="skipFwd" title="+30 sekunder">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
          <polygon points="3.5,4 12,12 3.5,20"/>
          <polygon points="11.5,4 20,12 11.5,20"/>
        </svg>
        <span class="sp-ctrl-lbl">+30s</span>
      </button>
      <button class="sp-ctrl-btn" id="sp-next-btn" data-i18n-title="nextNight" title="N√§sta natt" disabled>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18 6h-2v12h2zm-3.5 6L6 6v12z"/></svg>
        <span class="sp-ctrl-lbl" id="sp-next-label"></span>
      </button>
    </div>

    <!-- Extras: speed ¬∑ soundwave ¬∑ sleep ¬∑ mute -->
    <div class="sp-extras-row">
      <button class="sp-speed-chip" id="sp-speed-btn" data-i18n-title="speedTip" title="Uppspelningshastighet">1√ó</button>

      <!-- ‚ïê‚ïê SOUND WAVE ‚Äî flex:1 centrerar den mellan 1√ó och knapparna ‚ïê‚ïê -->
      <div class="sp-soundwave" id="sp-soundwave" style="flex:1;"></div>

      <button class="sp-mute-btn" id="sticky-mute">
        <svg class="sp-vol-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
        <svg id="mute-icon-on" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/></svg>
      </button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ MINI PLAYER ‚îÄ‚îÄ -->
  <div class="player-mini">
    <div class="sp-mini-inner">
      <!-- Mute-indikator -->
      <div class="sp-mini-muted-dot" id="sp-mini-muted-dot" title="Ljud avst√§ngt ‚Äî tryck f√∂r att sl√• p√•"></div>
      <!-- Mini artwork -->
      <div class="sp-mini-artwork" id="sp-mini-artwork">
        <span class="sp-mini-initials" id="sp-mini-initials">‚Äì</span>
      </div>
      <!-- Mini meta -->
      <div class="sp-mini-meta">
        <div class="sp-mini-imam" id="sp-mini-imam">‚Äì</div>
        <div class="sp-mini-sub" id="sp-mini-sub"></div>
      </div>
      <!-- Mini controls -->
      <div class="sp-mini-controls">
        <button class="sp-mini-ctrl" id="sp-mini-skip-back">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <polygon points="12.5,4 4,12 12.5,20"/>
            <polygon points="20.5,4 12,12 20.5,20"/>
          </svg>
        </button>
        <button class="sp-mini-play" id="sp-mini-play">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="white"><polygon points="7,3 21,12 7,21"/></svg>
        </button>
        <button class="sp-mini-ctrl" id="sp-mini-skip-fwd">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <polygon points="3.5,4 12,12 3.5,20"/>
            <polygon points="11.5,4 20,12 11.5,20"/>
          </svg>
        </button>
      </div>
      <!-- Mini progress -->
      <div class="sp-mini-progress">
        <div class="sp-mini-progress-fill" id="sp-mini-pfill"></div>
      </div>
    </div>
  </div>

</div>

</body>
</html>
