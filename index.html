<!DOCTYPE html>
<html lang="sv">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CP3TPCPMEB"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-CP3TPCPMEB');
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tarawih Schema â€” KÃ¤mpingehallen | Ramadan 2026</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600&family=Share+Tech+Mono&display=swap" rel="stylesheet" />
  <link href="https://fonts.cdnfonts.com/css/digital-7-mono" rel="stylesheet">
  <style>
    /* â”€â”€ IMAM COLOURS â€” unchanged in both themes â”€â”€ */
    :root {
      --gold: #c9a84c;
      --gold-light: #e8c97a;
      --today-green: #3dba7e;
      --abdurrahman: #e8630a;
      --saed: #d4a800;
      --noor: #2980b9;
      --abdul: #2c2c2c;
      --mohammed: #219150;
      --yacquub: #7d3aac;
      --abdelsalam: #7b3f00;
      --hatem: #2d6a4f;
      --ibrahim: #1a3a6b;

      --bg:              #f7f4ef;
      --surface:         #ffffff;
      --surface-2:       #f0ece4;
      --border:          rgba(36,100,93,0.10);
      --border-subtle:   rgba(36,100,93,0.07);
      --text:            #1a1a1a;
      --muted:           #6b7280;
      --muted-2:         #9ca3af;
      --primary:         #24645d;
      --primary-dark:    #1a4a44;
      --today-bg:        #e8f7f0;
      --row-hover:       rgba(36,100,93,0.04);
      --chip-bg:         #ffffff;
      --chip-shadow:     0 2px 8px rgba(0,0,0,0.06);
      --table-shadow:    0 6px 32px rgba(36,100,93,0.12);
      --card-shadow:     0 2px 4px rgba(0,0,0,0.04), 0 8px 24px rgba(36,100,93,0.10), 0 24px 48px rgba(36,100,93,0.06);
      --mobile-shadow:   0 2px 12px rgba(36,100,93,0.08);
      --info-gap:        rgba(36,100,93,0.07);
      --cell-bg:         #ffffff;
      --countdown-bg:    rgba(36,100,93,0.04);
      --countdown-bdr:   rgba(36,100,93,0.09);
      --notif-border:    rgba(36,100,93,0.20);
      --seek-bg:         rgba(0,0,0,0.10);
      --seek-fill:       #1a4a44;
      --scrubber-notch:  #1a4a44;
      --thumb-border:    #ffffff;
      --player-bg:       #ffffff;
      --player-border:   rgba(36,100,93,0.10);
      --player-shadow:   0 -6px 32px rgba(0,0,0,0.11);
      --mini-bg:         rgba(255,255,255,0.96);
      --dcm-pages-bg:    rgba(36,100,93,0.08);
      --dcm-surahs-bg:   rgba(36,100,93,0.06);
      --fredag-clr:      #b45309;
      --lordag-clr:      #1a4a44;
      --header-bg:       #24645d;
      --header-a-bg:     #ffffff;
      --header-a-clr:    #1a4a44;
      --wave-fill:       #24645d;
      --footer-bg:       #1a4a44;
      --legend-bg:       #ffffff;
      --ios-track-off:   #e5e5ea;
      --ios-track-on:    #34c759;
      --ios-thumb:       #ffffff;
    }

    [data-theme="dark"] {
      --bg:              #0f1614;
      --surface:         #1a2420;
      --surface-2:       #222e2a;
      --border:          rgba(255,255,255,0.07);
      --border-subtle:   rgba(255,255,255,0.05);
      --text:            #e8e3db;
      --muted:           #8a9490;
      --muted-2:         #5a6662;
      --primary:         #2d7a72;
      --primary-dark:    #3a9088;
      --today-bg:        rgba(45,122,114,0.18);
      --row-hover:       rgba(255,255,255,0.03);
      --chip-bg:         #1e2c28;
      --chip-shadow:     0 2px 8px rgba(0,0,0,0.30);
      --table-shadow:    0 6px 32px rgba(0,0,0,0.40);
      --card-shadow:     0 2px 4px rgba(0,0,0,0.20), 0 8px 24px rgba(0,0,0,0.30), 0 24px 48px rgba(0,0,0,0.20);
      --mobile-shadow:   0 2px 12px rgba(0,0,0,0.30);
      --info-gap:        rgba(255,255,255,0.06);
      --cell-bg:         #1a2420;
      --countdown-bg:    rgba(255,255,255,0.04);
      --countdown-bdr:   rgba(255,255,255,0.08);
      --notif-border:    rgba(255,255,255,0.12);
      --seek-bg:         rgba(255,255,255,0.10);
      --seek-fill:       rgba(255,255,255,0.88);
      --scrubber-notch:  rgba(255,255,255,0.90);
      --thumb-border:    #1a2420;
      --player-bg:       #1a2420;
      --player-border:   rgba(255,255,255,0.07);
      --player-shadow:   0 -6px 32px rgba(0,0,0,0.45);
      --mini-bg:         rgba(18,28,24,0.97);
      --dcm-pages-bg:    rgba(255,255,255,0.07);
      --dcm-surahs-bg:   rgba(255,255,255,0.05);
      --fredag-clr:      #e09840;
      --lordag-clr:      #7ecec8;
      --header-bg:       linear-gradient(145deg, rgba(10,26,20,0.99) 0%, rgba(14,36,28,0.99) 40%, rgba(18,48,38,0.99) 70%, rgba(24,64,54,0.99) 100%);
      --header-a-bg:     rgba(255,255,255,0.10);
      --header-a-clr:    rgba(255,255,255,0.88);
      --wave-fill:       #131f1b;
      --footer-bg:       #0d1714;
      --legend-bg:       #1e2c28;
      --ios-track-off:   #3a3a3c;
      --ios-track-on:    #30d158;
      --ios-thumb:       #ffffff;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: var(--bg); font-family: 'DM Sans', sans-serif; color: var(--text); -webkit-text-size-adjust: 100%; transition: background 0.35s ease, color 0.35s ease; }

    /* â•â• iOS TOGGLE â•â• */
    .theme-toggle {
      position: absolute; top: 10px; right: 12px; z-index: 10;
      display: inline-flex; align-items: center;
      background: none; border: none; padding: 0;
      cursor: pointer; font-family: inherit;
      -webkit-tap-highlight-color: transparent;
    }
    .ios-track {
      position: relative; width: 76px; height: 30px; border-radius: 999px;
      background: #e8e8e8;
      box-shadow: 0 3px 8px rgba(0,0,0,0.30), inset 0 1px 2px rgba(255,255,255,0.6), inset 0 -1px 2px rgba(0,0,0,0.12);
      flex-shrink: 0;
      transition: background 0.38s cubic-bezier(0.4,0,0.2,1), box-shadow 0.38s ease;
      overflow: hidden;
    }
    [data-theme="dark"] .ios-track {
      background: #1c1c1e;
      box-shadow: 0 3px 8px rgba(0,0,0,0.50), inset 0 1px 3px rgba(255,255,255,0.04), inset 0 -1px 3px rgba(0,0,0,0.5);
    }
    .ios-track-label {
      position: absolute; top: 50%; left: 0; right: calc(24px + 3px);
      transform: translateY(-50%);
      font-size: 0.38rem; font-weight: 800; letter-spacing: 0.08em;
      text-transform: uppercase; line-height: 1.2; text-align: center;
      pointer-events: none; white-space: nowrap; user-select: none;
      color: rgba(70,70,70,0.80); transition: color 0.3s ease, left 0s, right 0s;
    }
    [data-theme="dark"] .ios-track-label { left: calc(24px + 3px); right: 0; color: rgba(160,160,160,0.70); }
    .ios-thumb {
      position: absolute; top: 3px; left: calc(100% - 3px - 24px);
      width: 24px; height: 24px; border-radius: 50%;
      background: radial-gradient(circle at 38% 35%, #4a4a4a, #1a1a1a);
      box-shadow: 0 2px 6px rgba(0,0,0,0.50), 0 1px 2px rgba(0,0,0,0.35), inset 0 1px 1px rgba(255,255,255,0.08);
      transition: left 0.38s cubic-bezier(0.34,1.45,0.64,1), width 0.10s ease;
      will-change: left; z-index: 2;
      display: flex; align-items: center; justify-content: center;
    }
    [data-theme="dark"] .ios-thumb { left: 3px; background: radial-gradient(circle at 38% 35%, #555, #222); }
    .ios-thumb-icon { position: absolute; display: flex; align-items: center; justify-content: center; transition: opacity 0.28s ease, transform 0.32s cubic-bezier(0.34,1.56,0.64,1); }
    .ios-thumb-sun  { opacity: 1;  transform: scale(1)   rotate(0deg); }
    .ios-thumb-moon { opacity: 0;  transform: scale(0.5) rotate(-30deg); }
    [data-theme="dark"] .ios-thumb-sun  { opacity: 0;  transform: scale(0.5) rotate(30deg); }
    [data-theme="dark"] .ios-thumb-moon { opacity: 1;  transform: scale(1)   rotate(0deg); }
    .theme-toggle:active .ios-thumb { width: 28px; }
    [data-theme="dark"] .theme-toggle:active .ios-thumb { width: 28px; left: 3px; }

    /* â”€â”€ HEADER â”€â”€ */
    header { background: var(--header-bg); padding: 28px 20px 22px; text-align: center; position: relative; overflow: hidden; transition: background 0.35s ease; }
    header::before { content: ''; position: absolute; inset: 0; background: radial-gradient(ellipse at 15% 60%, rgba(201,168,76,0.14) 0%, transparent 55%); pointer-events: none; }
    [data-theme="dark"] header::before { background: radial-gradient(ellipse at 80% 25%, rgba(201,168,76,0.09) 0%, transparent 55%), radial-gradient(ellipse at 15% 70%, rgba(36,100,93,0.18) 0%, transparent 40%); }
    .ornament { display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 20px; position: relative; z-index: 2; }
    .orn-line { height: 1px; width: 50px; }
    .orn-line.l { background: linear-gradient(to right, transparent, var(--gold)); }
    .orn-line.r { background: linear-gradient(to left, transparent, var(--gold)); }
    .orn-diamond { width: 7px; height: 7px; background: var(--gold); transform: rotate(45deg); }
    .orn-dot { width: 3px; height: 3px; background: var(--gold-light); border-radius: 50%; }
    header h1 { font-family: 'Cormorant Garamond', serif; font-size: clamp(1.8rem, 6vw, 3.2rem); font-weight: 600; color: #ffffff; letter-spacing: .03em; line-height: 1.2; position: relative; z-index: 2; }
    .header-address { margin-top: 20px; position: relative; z-index: 2; display: flex; flex-direction: column; align-items: center; gap: 10px; }
    .header-address .addr-text { display: flex; align-items: center; gap: 6px; color: rgba(255,255,255,.65); font-size: .82rem; }
    .header-address a { display: inline-flex; align-items: center; gap: 6px; background: var(--header-a-bg); color: var(--header-a-clr); font-size: .75rem; font-weight: 600; letter-spacing: .08em; text-transform: uppercase; padding: 7px 18px; border-radius: 30px; text-decoration: none; box-shadow: 0 2px 12px rgba(0,0,0,.15); transition: background 0.35s, color 0.35s; }
    .wave { background: var(--header-bg); line-height: 0; transition: background 0.35s; }
    .wave svg { display: block; width: 100%; }

    /* â”€â”€ MAIN â”€â”€ */
    main { max-width: 960px; margin: 0 auto; padding: 32px 14px 80px; }
    @media (min-width: 641px) {
      main { max-width: 100%; padding: 32px 32px 80px; }
      .table-wrap table { width: 100%; table-layout: auto; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TODAY CARD
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .today-card-top { position: relative; padding: 22px 28px 20px; background: linear-gradient(145deg, rgba(15,40,50,0.97) 0%, rgba(20,58,52,0.97) 40%, rgba(26,74,68,0.95) 70%, rgba(36,100,93,0.93) 100%); overflow: hidden; }
    .today-card-top::before { content: ''; position: absolute; inset: 0; background: radial-gradient(ellipse at 80% 20%, rgba(201,168,76,0.08) 0%, transparent 55%), radial-gradient(ellipse at 20% 80%, rgba(36,100,93,0.15) 0%, transparent 45%); pointer-events: none; }
    .today-card-top::after { content: ''; position: absolute; inset: 0; opacity: 0.025; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E"); background-size: 128px; pointer-events: none; }
    .today-badge-pill { position: relative; z-index: 2; display: inline-flex; align-items: center; gap: 5px; background: rgba(201,168,76,0.15); border: 1px solid rgba(201,168,76,0.30); border-radius: 100px; padding: 4px 12px; margin-bottom: 10px; }
    .today-badge-pill-dot { width: 5px; height: 5px; border-radius: 50%; background: var(--gold-light); flex-shrink: 0; box-shadow: 0 0 5px rgba(201,168,76,0.6); }
    .today-badge-pill-text { font-size: 0.60rem; font-weight: 600; letter-spacing: 0.14em; text-transform: uppercase; color: var(--gold-light); }
    .today-card-header-content { position: relative; z-index: 2; }
    .today-imam-name { font-family: 'Cormorant Garamond', serif; font-size: clamp(1.65rem, 5vw, 2.2rem); font-weight: 600; color: #ffffff; line-height: 1.1; letter-spacing: 0.01em; margin-bottom: 6px; display: block; }
    .today-date-row { display: flex; align-items: center; gap: 8px; }
    .today-date-text { font-size: 0.82rem; color: rgba(255,255,255,0.55); font-weight: 400; letter-spacing: 0.02em; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MOON ICON â€” unchanged glow animations
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .today-moon-wrap { position: relative; display: inline-flex; align-items: center; }
    .today-moon-icon {
      display: inline-flex; align-items: center; justify-content: center;
      width: 22px; height: 22px; border-radius: 50%;
      background: rgba(15, 45, 94, 0.5);
      border: 1.5px solid rgba(255,255,255,0.2);
      cursor: pointer;
      animation: moonPulseBlue 2s ease-in-out infinite;
    }
    .today-moon-icon.moon-odd-today {
      background: linear-gradient(135deg, #9a6f0a, #c9a84c);
      border-color: rgba(255,220,100,0.4);
      animation: moonGlow 2.2s ease-in-out infinite;
    }
    @keyframes moonPulseBlue {
      0%, 100% { box-shadow: 0 0 0 0 rgba(58,123,213,0.5); }
      50% { box-shadow: 0 0 0 6px rgba(58,123,213,0); }
    }
    @keyframes moonGlow {
      0%,100% { box-shadow: 0 0 4px 1px rgba(201,168,76,0.6), 0 0 10px 2px rgba(201,168,76,0.35), 0 0 22px 4px rgba(201,168,76,0.15); }
      50% { box-shadow: 0 0 8px 3px rgba(232,201,122,0.85), 0 0 18px 6px rgba(201,168,76,0.55), 0 0 36px 10px rgba(201,168,76,0.22); }
    }

    .today-card-body { padding: 16px 28px 20px; display: flex; flex-direction: column; gap: 0; background: var(--surface); transition: background 0.35s; }
    .today-info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1px; background: var(--info-gap); border-radius: 14px; overflow: hidden; margin-bottom: 14px; transition: background 0.35s; }
    .today-info-cell { background: var(--cell-bg); padding: 12px 16px; transition: background 0.35s; }
    .today-info-cell:first-child { border-radius: 14px 0 0 14px; }
    .today-info-cell:last-child  { border-radius: 0 14px 14px 0; }
    @media (max-width: 480px) {
      .today-info-grid { grid-template-columns: 1fr; }
      .today-info-cell:first-child { border-radius: 14px 14px 0 0; }
      .today-info-cell:last-child  { border-radius: 0 0 14px 14px; }
    }
    .today-info-label { font-size: 0.60rem; font-weight: 600; letter-spacing: 0.13em; text-transform: uppercase; color: var(--muted); display: block; margin-bottom: 5px; transition: color 0.35s; }
    .today-info-value { font-family: 'Cormorant Garamond', serif; font-size: 1.35rem; font-weight: 600; color: var(--primary-dark); line-height: 1.2; display: block; transition: color 0.35s; }
    .today-info-sub { font-size: 0.75rem; color: var(--muted); margin-top: 3px; display: block; line-height: 1.4; transition: color 0.35s; }

    .today-countdown-section { display: none; background: var(--countdown-bg); border: 1px solid var(--countdown-bdr); border-radius: 14px; padding: 13px 16px; margin-bottom: 14px; transition: background 0.8s ease, border-color 0.8s ease, box-shadow 0.8s ease; }
    .today-countdown-section.isha-done { background: rgba(36,186,120,0.08); border-color: rgba(36,186,120,0.25); }
    @keyframes ishaGlow { 0% { box-shadow: 0 0 0 0 rgba(61,186,126,0); } 20% { box-shadow: 0 0 0 8px rgba(61,186,126,0.18); } 50% { box-shadow: 0 0 0 16px rgba(61,186,126,0.08); } 80% { box-shadow: 0 0 0 8px rgba(61,186,126,0.12); } 100% { box-shadow: 0 0 0 0 rgba(61,186,126,0); } }
    .today-countdown-section.isha-pulsing { animation: ishaGlow 1.6s ease-out 3; }
    .today-countdown-inner { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
    .today-countdown-left { flex: 1; min-width: 0; }
    .today-countdown-label { font-size: 0.60rem; font-weight: 600; letter-spacing: 0.13em; text-transform: uppercase; color: var(--muted); display: block; margin-bottom: 6px; transition: color 0.6s ease; }
    .isha-done .today-countdown-label { color: #1d7a4e; }
    .timer-wrap { position: relative; min-height: 2.2rem; display: flex; align-items: center; }
    .today-timer { font-family: 'Digital-7 Mono', 'Digital-7', monospace; font-size: 2.0rem; font-weight: 400; color: var(--primary-dark); letter-spacing: 0.05em; line-height: 1; transition: opacity 0.5s ease, transform 0.5s ease, color 0.35s; }
    .today-timer.fading-out { opacity: 0; transform: translateY(-6px); pointer-events: none; }
    .today-timer-done { position: absolute; left: 0; font-family: 'DM Sans', sans-serif; font-size: 1.05rem; font-weight: 600; color: #1d7a4e; opacity: 0; transform: translateY(6px); transition: opacity 0.5s ease 0.3s, transform 0.5s ease 0.3s; white-space: nowrap; }
    .today-timer-done.fading-in { opacity: 1; transform: translateY(0); }
    .today-countdown-sub { font-size: 0.72rem; color: var(--muted); margin-top: 6px; display: block; transition: color 0.6s ease; }
    .isha-done .today-countdown-sub { color: #2d9e6b; }

    .notif-btn { display: inline-flex; align-items: center; gap: 6px; background: none; border: 1px solid var(--notif-border); border-radius: 100px; padding: 5px 12px; font-size: 0.68rem; font-weight: 500; font-family: inherit; color: var(--muted); cursor: pointer; white-space: nowrap; transition: border-color 0.2s, color 0.2s, background 0.2s; flex-shrink: 0; align-self: flex-start; }
    .notif-btn:hover { border-color: var(--primary); color: var(--primary-dark); background: var(--row-hover); }
    .notif-btn.granted { border-color: rgba(36,186,120,0.35); color: #1d7a4e; background: rgba(36,186,120,0.06); cursor: default; pointer-events: none; }
    .notif-btn.denied { opacity: 0.4; cursor: not-allowed; pointer-events: none; }

    .today-card-footer { display: flex; align-items: center; justify-content: flex-end; }
    .today-scroll-btn { display: inline-flex; align-items: center; gap: 7px; background: var(--primary-dark); color: #fff; font-size: 0.72rem; font-weight: 600; letter-spacing: 0.10em; text-transform: uppercase; padding: 10px 20px; border-radius: 100px; border: none; cursor: pointer; font-family: inherit; white-space: nowrap; box-shadow: 0 2px 12px rgba(26,74,68,0.25); transition: box-shadow 0.2s ease, transform 0.2s ease, background 0.2s ease; }
    .today-scroll-btn:hover { background: var(--primary); box-shadow: 0 4px 20px rgba(26,74,68,0.35); transform: translateY(-1px); }

    .today-hadith-inline { position: relative; z-index: 2; margin-top: 12px; padding: 10px 12px; background: rgba(201,168,76,0.07); border-left: 2px solid rgba(201,168,76,0.45); border-radius: 0 8px 8px 0; font-size: 0.70rem; color: rgba(255,255,255,0.50); font-style: italic; line-height: 1.6; }
    .today-hadith-inline .hadith-label { display: block; font-size: 0.55rem; font-weight: 700; letter-spacing: 0.12em; text-transform: uppercase; color: rgba(201,168,76,0.65); margin-bottom: 4px; font-style: normal; }

    /* â•â• KOMET â€” roterande guldstjÃ¤rna runt today-card â•â• */
    @property --comet-angle {
      syntax: '<angle>';
      initial-value: 0deg;
      inherits: false;
    }
    @keyframes rotateComet {
      from { --comet-angle: 0deg; }
      to   { --comet-angle: 360deg; }
    }

    /* Wrapper runt today-card som hÃ¥ller kometen */
    .today-card-comet {
      position: relative;
      border-radius: 24px;
      padding: 2px;
      margin-bottom: 32px;
    }
    .today-card-comet::before {
      content: '';
      position: absolute;
      inset: -1px;
      border-radius: 25px;
      background: conic-gradient(
        from var(--comet-angle),
        transparent 0deg,
        transparent 240deg,
        rgba(201,168,76,0.04) 260deg,
        rgba(201,168,76,0.15) 290deg,
        rgba(201,168,76,0.45) 320deg,
        rgba(232,201,122,0.85) 348deg,
        rgba(255,248,210,1.00) 357deg,
        rgba(255,255,255,0.95) 360deg,
        transparent 360deg
      );
      animation: rotateComet 7s linear infinite;
      z-index: 0;
    }
    .today-card-comet::after {
      content: '';
      position: absolute;
      inset: 2px;
      border-radius: 22px;
      background: var(--surface);
      z-index: 1;
      transition: background 0.35s;
    }

    .today-card {
      display: none;
      background: var(--surface);
      border-radius: 22px;
      border: none;
      box-shadow: var(--card-shadow);
      overflow: hidden;
      position: relative;
      z-index: 2;
      transition: background 0.35s, box-shadow 0.35s;
    }

    /* â”€â”€ Hijri datum â”€â”€ */
    .today-date-hijri-dot { width: 3px; height: 3px; border-radius: 50%; background: rgba(201,168,76,0.5); flex-shrink: 0; }
    .today-date-hijri { font-size: 0.78rem; color: rgba(201,168,76,0.85); font-weight: 500; }
    .today-date-hijri-arabic { font-family: 'Cormorant Garamond', serif; font-size: 0.88rem; color: rgba(201,168,76,0.45); }

    /* â”€â”€ Progress ring i countdown â”€â”€ */
    .isha-ring-wrap { position: relative; width: 54px; height: 54px; flex-shrink: 0; }
    .isha-ring-svg { width: 54px; height: 54px; transform: rotate(-90deg); display: block; }
    .isha-ring-track { fill: none; stroke: rgba(255,255,255,0.07); stroke-width: 3.5; }
    .isha-ring-fill {
      fill: none;
      stroke: url(#ishaRingGrad);
      stroke-width: 3.5;
      stroke-linecap: round;
      stroke-dasharray: 144.51;
      stroke-dashoffset: 144.51;
      transition: stroke-dashoffset 1s ease, stroke 0.6s ease;
    }
    .isha-ring-icon {
      position: absolute; inset: 0;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.1rem;
    }

    /* â”€â”€ Today row i desktop-tabellen â€” guldskimmer frÃ¥n vÃ¤nster till hÃ¶ger â”€â”€ */
    tbody tr.today {
      background: var(--today-bg) !important;
      border-left-color: var(--today-green);
    }
    .td-sweep {
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: linear-gradient(
        105deg,
        transparent 0%,
        transparent 45%,
        rgba(201,168,76,0.05) 47%,
        rgba(232,201,122,0.22) 49%,
        rgba(255,248,210,0.38) 50%,
        rgba(232,201,122,0.22) 51%,
        rgba(201,168,76,0.05) 53%,
        transparent 55%,
        transparent 100%
      );
      background-size: 500% 100%;
      background-position: 150% 0;
      animation: diamondSweep 8s linear infinite;
    }
    @keyframes diamondSweep {
      0%   { background-position: 150% 0; }
      28%  { background-position: -50% 0; }
      100% { background-position: -50% 0; }
    }

    /* â”€â”€ EID CARD â”€â”€ */
    .eid-card { display: none; position: relative; border-radius: 24px; padding: 52px 32px 44px; text-align: center; margin-bottom: 32px; overflow: hidden; background: linear-gradient(160deg, #0a1f3d 0%, #0f2d40 25%, #163d38 55%, #1a4a44 80%, #24645d 100%); box-shadow: 0 2px 4px rgba(0,0,0,0.08), 0 12px 40px rgba(10,31,61,0.35), 0 32px 64px rgba(10,31,61,0.18); border: 1px solid rgba(201,168,76,0.12); animation: eidFadeUp 1.1s cubic-bezier(0.22,1,0.36,1) both; }
    @keyframes eidFadeUp { from { opacity: 0; transform: translateY(28px); } to { opacity: 1; transform: translateY(0); } }
    .eid-card::before { content: ''; position: absolute; inset: 0; background: radial-gradient(ellipse at 15% 20%, rgba(201,168,76,0.13) 0%, transparent 50%), radial-gradient(ellipse at 85% 80%, rgba(36,100,93,0.25) 0%, transparent 45%), radial-gradient(ellipse at 50% 50%, rgba(15,45,64,0.3) 0%, transparent 70%); pointer-events: none; }
    .eid-card::after { content: ''; position: absolute; inset: 0; opacity: 0.03; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E"); background-size: 128px; pointer-events: none; }
    .eid-inner { position: relative; z-index: 2; }
    .eid-ornament { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 28px; animation: eidFadeUp 1.1s 0.15s cubic-bezier(0.22,1,0.36,1) both; }
    .eid-orn-line { height: 1px; width: 44px; background: linear-gradient(to right, transparent, rgba(201,168,76,0.6)); }
    .eid-orn-line.r { background: linear-gradient(to left, transparent, rgba(201,168,76,0.6)); }
    .eid-orn-diamond { width: 6px; height: 6px; background: var(--gold); transform: rotate(45deg); }
    .eid-orn-dot { width: 3px; height: 3px; background: var(--gold-light); border-radius: 50%; }
    .eid-arabic { font-family: 'Cormorant Garamond', serif; font-size: clamp(1.6rem, 5vw, 2.2rem); font-weight: 500; color: rgba(255,255,255,0.92); letter-spacing: 0.04em; line-height: 1.4; margin-bottom: 6px; direction: rtl; animation: eidFadeUp 1.1s 0.25s cubic-bezier(0.22,1,0.36,1) both; }
    .eid-title { font-family: 'Cormorant Garamond', serif; font-size: clamp(2.6rem, 8vw, 4rem); font-weight: 700; color: #fff; line-height: 1.05; letter-spacing: 0.01em; margin-bottom: 10px; background: linear-gradient(105deg, #fff 0%, #fff 35%, var(--gold-light) 50%, #fff 65%, #fff 100%); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: eidFadeUp 1.1s 0.35s cubic-bezier(0.22,1,0.36,1) both, eidShimmer 4s 1.5s ease-in-out infinite; }
    @keyframes eidShimmer { 0% { background-position: 200% center; } 50% { background-position: -50% center; } 100% { background-position: 200% center; } }
    .eid-divider { display: flex; align-items: center; justify-content: center; gap: 8px; margin: 16px 0 18px; animation: eidFadeUp 1.1s 0.45s cubic-bezier(0.22,1,0.36,1) both; }
    .eid-divider-line { height: 1px; width: 36px; background: rgba(201,168,76,0.45); }
    .eid-divider-dot  { width: 4px; height: 4px; background: var(--gold); transform: rotate(45deg); }
    .eid-subtitle { font-size: 0.88rem; color: rgba(255,255,255,0.55); font-style: italic; letter-spacing: 0.06em; line-height: 1.6; animation: eidFadeUp 1.1s 0.52s cubic-bezier(0.22,1,0.36,1) both; }
    .eid-note { margin-top: 28px; padding-top: 22px; border-top: 1px solid rgba(255,255,255,0.08); font-size: 0.78rem; color: rgba(255,255,255,0.38); letter-spacing: 0.03em; line-height: 1.7; animation: eidFadeUp 1.1s 0.62s cubic-bezier(0.22,1,0.36,1) both; }
    .eid-note strong { color: rgba(255,255,255,0.55); font-weight: 500; }
    .eid-instagram { display: inline-flex; align-items: center; gap: 7px; margin-top: 18px; color: rgba(255,255,255,0.45); font-size: 0.76rem; text-decoration: none; letter-spacing: 0.04em; transition: color 0.2s; animation: eidFadeUp 1.1s 0.70s cubic-bezier(0.22,1,0.36,1) both; }
    .eid-instagram:hover { color: rgba(255,255,255,0.75); }
    .eid-crescents { position: absolute; inset: 0; pointer-events: none; overflow: hidden; }
    .eid-crescent { position: absolute; font-size: 1.1rem; opacity: 0; animation: eidFloat var(--dur, 6s) var(--delay, 0s) ease-in-out infinite; }
    @keyframes eidFloat { 0% { opacity: 0; transform: translateY(0) rotate(var(--rot,0deg)) scale(0.8); } 15% { opacity: var(--max-op, 0.18); } 85% { opacity: var(--max-op, 0.18); } 100% { opacity: 0; transform: translateY(-30px) rotate(var(--rot,15deg)) scale(1); } }

    /* â”€â”€ SECTION TITLE â”€â”€ */
    .section-title { text-align: center; margin-bottom: 20px; }
    .section-title h2 { font-family: 'Cormorant Garamond', serif; font-size: clamp(1.3rem, 4vw, 1.9rem); font-weight: 600; color: var(--primary-dark); transition: color 0.35s; }
    .divider { display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px; }
    .divider span { height: 1px; width: 40px; background: var(--gold); display: block; }
    .divider i { width: 5px; height: 5px; background: var(--gold); transform: rotate(45deg); display: block; }

    /* â”€â”€ LEGEND â”€â”€ */
    .legend { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-bottom: 20px; }
    .legend-item { display: flex; align-items: center; gap: 6px; background: var(--legend-bg); border-radius: 30px; padding: 5px 12px 5px 8px; box-shadow: var(--chip-shadow); font-size: .78rem; font-weight: 500; color: var(--text); transition: background 0.35s, color 0.35s, box-shadow 0.35s; }
    .legend-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }

    /* â”€â”€ TABLE â”€â”€ */
    .table-wrap { overflow: visible; border-radius: 16px; box-shadow: var(--table-shadow); transition: box-shadow 0.35s; }
    table { width: 100%; border-collapse: collapse; background: var(--surface); font-size: .875rem; transition: background 0.35s; }
    thead tr { background: var(--primary); transition: background 0.35s; }
    thead th { font-size: .7rem; font-weight: 500; text-transform: uppercase; letter-spacing: .1em; color: rgba(255,255,255,.7); padding: 14px 16px; text-align: left; white-space: nowrap; }
    tbody tr { border-bottom: 1px solid var(--border-subtle); transition: background .15s; border-left: 4px solid transparent; }
    tbody tr:last-child { border-bottom: none; }
    tbody tr:hover { background: var(--row-hover); }
    td { padding: 12px 16px; vertical-align: middle; }
    .td-dag { font-weight: 700; font-size: .95rem; color: var(--primary-dark); text-align: center; transition: color 0.35s; }
    .td-sidor { font-size: .8rem; color: var(--muted); white-space: nowrap; transition: color 0.35s; }
    .td-surah { font-size: .78rem; color: var(--primary-dark); max-width: 240px; line-height: 1.4; }
    .td-datum { font-size: .8rem; color: var(--muted); white-space: nowrap; transition: color 0.35s; }
    .td-datum.today-date { color: #1d7a4e; font-weight: 600; }
    .td-veckodag { font-size: .8rem; font-weight: 500; white-space: nowrap; transition: color 0.35s; }
    .fredag { color: var(--fredag-clr); font-weight: 700; }
    .lordag { color: var(--lordag-clr); }
    .sondag { color: var(--fredag-clr); }
    /* â”€â”€ Hijri label â”€â”€ */
    .hijri-label { display: flex; align-items: center; gap: 3px; margin-top: 3px; font-size: .65rem; color: rgba(160,120,20,0.85); white-space: nowrap; }
    .hijri-label .hijri-moon { font-size: .65rem; opacity: .75; }
    [data-theme="dark"] .hijri-label { color: rgba(201,168,76,0.55); }
    [data-theme="dark"] .hijri-label .hijri-moon { opacity: .55; }
    tbody tr.today .hijri-label { color: rgba(201,168,76,0.95); }
    tbody tr.today .hijri-label .hijri-moon { opacity: 1; }
    /* mobile */
    .dcm-hijri { display: flex; align-items: center; gap: 3px; font-size: .65rem; color: rgba(160,120,20,0.85); white-space: nowrap; }
    .dcm-hijri .hijri-moon { opacity: .75; }
    [data-theme="dark"] .dcm-hijri { color: rgba(201,168,76,0.55); }
    [data-theme="dark"] .dcm-hijri .hijri-moon { opacity: .55; }
    .day-card-mobile.today .dcm-hijri { color: rgba(201,168,76,0.95); }
    .day-card-mobile.today .dcm-hijri .hijri-moon { opacity: 1; }
    .imam-chip { display: inline-flex; align-items: center; gap: 6px; padding: 4px 11px 4px 8px; border-radius: 30px; font-size: .78rem; font-weight: 500; color: #fff; white-space: nowrap; }
    .imam-chip .dot { width: 6px; height: 6px; border-radius: 50%; background: rgba(255,255,255,.35); flex-shrink: 0; }
    .imam-abdurrahman { background: var(--abdurrahman); }
    .imam-saed { background: var(--saed); color: #1a1a1a !important; }
    .imam-saed .dot { background: rgba(0,0,0,.15) !important; }
    .imam-noor { background: #f0ede8; color: #1a1a1a !important; }
    .imam-noor .dot { background: rgba(0,0,0,.15) !important; }
    .imam-abdul { background: var(--abdul); }
    .imam-mohammed { background: var(--mohammed); }
    .imam-yacquub { background: var(--yacquub); }
    .imam-abdelsalam { background: var(--abdelsalam); }
    .imam-hatem { background: var(--hatem); }
    .imam-ibrahim { background: var(--ibrahim); }
    .today-badge { display: inline-block; background: var(--today-green); color: #fff; font-size: .6rem; font-weight: 700; text-transform: uppercase; letter-spacing: .08em; padding: 2px 6px; border-radius: 8px; margin-left: 5px; vertical-align: middle; }

    /* â”€â”€ TOOLTIP (surah) â”€â”€ */
    .surah-cell { position: relative; cursor: pointer; }
    .surah-names { font-size: .78rem; color: var(--primary-dark); line-height: 1.5; transition: color 0.35s; }

    @keyframes tooltipSlideUp {
      0%   { opacity: 0; transform: translateY(10px) scale(0.97); }
      60%  { opacity: 1; transform: translateY(-2px) scale(1.01); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }

    .tooltip-box {
      display: none;
      position: absolute;
      left: 0; top: calc(100% + 8px);
      background: #12211f;
      border: 1px solid rgba(201,168,76,0.40);
      color: rgba(255,255,255,0.88);
      font-size: .75rem; font-weight: 400; font-style: italic;
      padding: 9px 14px; border-radius: 10px;
      white-space: nowrap; z-index: 100;
      box-shadow: 0 8px 28px rgba(0,0,0,0.35);
      letter-spacing: .02em; pointer-events: none;
      transform-origin: top left;
    }
    @media (hover: hover) {
      .surah-cell:hover .tooltip-box {
        display: block;
        animation: tooltipSlideUp 0.38s cubic-bezier(0.34,1.56,0.64,1) forwards;
      }
    }
    .tooltip-box.visible {
      display: block;
      animation: tooltipSlideUp 0.38s cubic-bezier(0.34,1.56,0.64,1) forwards;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MOON TOOLTIP â€” exact original design from first document
       Gold dark bg, right-aligned above moon, stays inside table
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    /* Backdrop for mobile sheet */
    .moon-tooltip-backdrop {
      display: none;
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.45);
      z-index: 998;
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
    }
    @keyframes fadeInBackdrop  { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeOutBackdrop { from { opacity: 1; } to { opacity: 0; } }
    .moon-tooltip-backdrop.visible { display: block; animation: fadeInBackdrop 0.25s ease forwards; }
    .moon-tooltip-backdrop.hiding  { display: block; animation: fadeOutBackdrop 0.25s ease forwards; }

    /* â”€â”€ Moon icon â”€â”€ */
    .moon-icon {
      display: inline-flex; align-items: center; justify-content: center;
      width: 20px; height: 20px; border-radius: 50%;
      background: #0f2d5e; vertical-align: middle; flex-shrink: 0;
      cursor: pointer;
    }
    .moon-icon.moon-odd { background: linear-gradient(135deg, #9a6f0a, #c9a84c); animation: moonGlow 2.2s ease-in-out infinite; }

    /* â”€â”€ Moon wrap â”€â”€ */
    .moon-wrap { position: relative; display: inline-flex; align-items: center; }

    /* â•â• MOON BUBBLE â€” original gold design for ALL last-ten nights â•â• */

    /* Spring "blow up" animation */

    .moon-bubble {
      position: absolute;
      bottom: calc(100% + 10px);
      right: -10px;
      transform: translateY(120px);
      transform-origin: bottom right;

      width: 260px;
      max-width: 90vw;

      background: #12211f;
      border-radius: 10px;
      padding: 10px 12px;
      border: 1px solid rgba(201,168,76,0.40);
      box-shadow: 0 8px 28px rgba(0,0,0,0.35);

      color: rgba(255,255,255,0.88);
      font-size: 0.72rem;
      line-height: 1.55;
      font-style: italic;
      text-align: left;
      font-family: 'DM Sans', sans-serif;

      z-index: 10002;
      pointer-events: none;
      opacity: 0;
      visibility: hidden;
      transition: transform 2s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.4s ease;
      will-change: transform, opacity;
    }

    /* Open state â€” desktop */
    .moon-wrap.bubble-open .moon-bubble {
      visibility: visible;
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    /* Close animation â€” desktop */
    .moon-bubble.bubble-closing {
      opacity: 0 !important;
      transform: translateY(120px) !important;
      pointer-events: none !important;
    }

    .moon-bubble::before {
      content: '';
      position: absolute;
      top: 0; left: 14px; right: 14px; height: 1px;
      background: linear-gradient(to right, transparent, rgba(201,168,76,0.5), transparent);
      border-radius: 999px;
    }

    /* Downward tail pointing at the moon â€” far right */
    .moon-bubble::after {
      content: '';
      position: absolute;
      top: 100%; right: 12px; left: auto;
      transform: none;
      width: 0; height: 0;
      border-left: 7px solid transparent;
      border-right: 7px solid transparent;
      border-top: 8px solid #12211f;
      filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));
    }

    /* Gold label row â€” "ğŸŒ™ Laylatul-Qadr" */
    .moon-bubble-label {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.60rem;
      font-weight: 700;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: rgba(201,168,76,0.90);
      margin-bottom: 7px;
      font-style: normal;
      line-height: 1;
    }

    /* Hadith body text */
    .moon-bubble-text {
      display: block;
      font-style: italic;
    }

    /* Desktop hover trigger */
    @media (hover: hover) {
      .moon-wrap:hover .moon-bubble {
        visibility: visible;
        opacity: 1;
        pointer-events: auto;
        transform: translateY(0);
      }
    }

    /* â”€â”€ Last 10 nights: table row & today card adjustments â”€â”€ */
    tbody tr.last-ten { background: var(--surface); }
    tbody tr.last-ten.today { background: #0f2d5e !important; border-left-color: #3a7bd5; }
    [data-theme="dark"] tbody tr.last-ten.today { background: #0a2040 !important; }
    tbody tr.last-ten.today td { color: #fff !important; }
    tbody tr.last-ten.today .td-sidor,
    tbody tr.last-ten.today .td-datum,
    tbody tr.last-ten.today .td-veckodag { color: rgba(255,255,255,0.75) !important; }
    tbody tr.last-ten.today .td-dag { color: #fff !important; }
    tbody tr.last-ten.today .today-date { color: #7eb8f7 !important; }
    tbody tr.last-ten.today .today-badge { background: #3a7bd5; }
    tbody tr.last-ten.today .td-surah .surah-names { color: rgba(255,255,255,0.9) !important; }
    tbody tr.last-ten.today .moon-icon { background: transparent !important; border: 2px solid rgba(255,255,255,0.8); box-shadow: none !important; animation: none !important; }
    .day-card-mobile.last-ten.today .moon-icon { background: transparent !important; border: 2px solid rgba(255,255,255,0.8); box-shadow: none !important; animation: none !important; }

    /* â”€â”€ MOBILE CARDS â”€â”€ */
    .mobile-cards { display: none; }
    .day-card-mobile { background: var(--surface); border-radius: 14px; padding: 14px 16px; margin-bottom: 10px; box-shadow: var(--mobile-shadow); border-left: 4px solid transparent; transition: background 0.35s, box-shadow 0.35s; }
    .day-card-mobile.today { background: var(--today-bg); border-left-color: var(--today-green); }
    .dcm-top { display: flex; align-items: center; gap: 14px; margin-bottom: 8px; }
    .dcm-audio-right .play-btn { width: 34px; height: 34px; }
    .dcm-audio-right { display: flex; align-items: center; margin-left: auto; flex-shrink: 0; }
    .dcm-dag { font-weight: 700; font-size: 1.3rem; color: var(--primary-dark); min-width: 32px; text-align: center; flex-shrink: 0; transition: color 0.35s; }
    .dcm-dag.today-day { color: #1d7a4e; }
    .dcm-body { flex: 1; min-width: 0; }
    .dcm-imam { margin-bottom: 5px; }
    .dcm-meta { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .dcm-date { font-size: .75rem; color: var(--muted); transition: color 0.35s; }
    .dcm-day-label { font-size: .75rem; font-weight: 500; }
    .dcm-pages { font-size: .75rem; color: var(--muted); background: var(--dcm-pages-bg); padding: 2px 8px; border-radius: 10px; transition: background 0.35s, color 0.35s; }
    .dcm-surahs { margin-left: 46px; font-size: .78rem; color: var(--primary-dark); background: var(--dcm-surahs-bg); border-radius: 8px; padding: 6px 10px; line-height: 1.5; position: relative; cursor: pointer; transition: background 0.35s, color 0.35s; }
    .dcm-surahs-label { font-size: .65rem; text-transform: uppercase; letter-spacing: .1em; color: var(--muted); display: block; margin-bottom: 2px; transition: color 0.35s; }
    .dcm-tooltip { max-height: 0; overflow: hidden; opacity: 0; margin-top: 0; padding: 0 10px; background: var(--primary-dark); color: #fff; font-size: .75rem; font-weight: 500; border-radius: 7px; letter-spacing: .02em; transition: max-height 0.45s cubic-bezier(0.4,0,0.2,1), opacity 0.35s ease, margin-top 0.35s ease, padding 0.35s ease; }
    .dcm-tooltip.visible { max-height: 80px; opacity: 1; margin-top: 6px; padding: 7px 10px; }

    /* â”€â”€ Mobile last-ten â”€â”€ */
    .day-card-mobile.last-ten { background: var(--surface); }
    .day-card-mobile.last-ten.today { background: #0f2d5e !important; border-left-color: #3a7bd5; }
    [data-theme="dark"] .day-card-mobile.last-ten.today { background: #0a2040 !important; }
    .day-card-mobile.last-ten.today .dcm-dag,
    .day-card-mobile.last-ten.today .dcm-date,
    .day-card-mobile.last-ten.today .dcm-day-label { color: rgba(255,255,255,0.85) !important; }
    .day-card-mobile.last-ten.today .imam-chip { opacity: 0.95; }
    .day-card-mobile.last-ten.today .dcm-surahs { background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.9); }
    .day-card-mobile.last-ten.today .dcm-surahs-label { color: rgba(255,255,255,0.5); }
    .day-card-mobile.last-ten.today .dcm-pages { background: rgba(255,255,255,0.12); color: rgba(255,255,255,0.7); }
    .day-card-mobile.last-ten.today .today-badge { background: #3a7bd5; }
    .day-card-mobile.last-ten.today .dcm-dag.today-day { color: #7eb8f7 !important; }

    /* â•â• Mobile: .moon-bubble becomes full-screen bottom sheet â•â• */
    @media (max-width: 640px) {
      .moon-bubble {
        position: fixed !important;
        bottom: 0 !important; left: 0 !important; right: 0 !important;
        top: auto !important;
        width: 100% !important;
        max-width: 100% !important;
        border-radius: 22px 22px 0 0 !important;
        padding: 24px 22px 40px !important;
        font-size: 0.88rem !important;
        line-height: 1.7 !important;
        z-index: 10001 !important;
        pointer-events: none !important;
        opacity: 1 !important;
        visibility: hidden !important;
        transform: translateY(100%) !important;
        transition: transform 2s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.4s ease !important;
        border-bottom: none !important;
        will-change: transform;
      }
      .moon-bubble::before { display: none !important; }
      .moon-bubble::after  { display: none !important; }

      /* Open state */
      .moon-wrap.bubble-open .moon-bubble,
      .today-moon-wrap.bubble-open .moon-bubble {
        visibility: visible !important;
        pointer-events: auto !important;
        transform: translateY(0) !important;
      }
      /* Close */
      .moon-bubble.bubble-closing {
        visibility: visible !important;
        pointer-events: none !important;
        transform: translateY(100%) !important;
        opacity: 0 !important;
      }
      .moon-wrap:hover .moon-bubble { visibility: hidden !important; }
    }

    /* Backdrop above player on mobile */
    @media (max-width: 640px) {
      .moon-tooltip-backdrop { z-index: 10000 !important; }
    }

    /* Today-card moon wrap: bubble opens upward, centered on moon */
    .today-moon-wrap { position: relative; display: inline-flex; align-items: center; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       STICKY BOTTOM PLAYER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .sticky-player { position: fixed; bottom: 0; left: 0; right: 0; z-index: 9999; }
    .player-full { background: var(--player-bg); border-radius: 22px 22px 0 0; border-top: 1px solid var(--player-border); box-shadow: var(--player-shadow); padding: 10px 18px 10px; transform-origin: bottom center; transform: translateY(0) scaleY(1); opacity: 1; transition: transform 0.52s cubic-bezier(0.4,0,0.2,1), opacity 0.28s ease, box-shadow 0.52s ease, background 0.35s, border-color 0.35s; will-change: transform, opacity; pointer-events: none; }
    .sticky-player.visible .player-full { pointer-events: auto; }
    .sticky-player:not(.visible):not(.mini-mode) .player-full { transform: translateY(100%); opacity: 0; }
    .sticky-player.mini-mode .player-full { transform: translateY(55%) scaleY(0.08); opacity: 0; box-shadow: none; pointer-events: none; }
    .sticky-top-row { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; min-width: 0; transform-origin: top center; transition: transform 0.32s cubic-bezier(0.4,0,0.2,1), opacity 0.20s ease; }
    .sticky-player.mini-mode .sticky-top-row { transform: translateY(-8px) scaleY(0.3); opacity: 0; }
    .sticky-day-badge { font-size: .68rem; color: var(--primary-dark); font-weight: 700; white-space: nowrap; flex-shrink: 0; transition: color 0.35s; }
    .sticky-day-sub { font-size: .6rem; color: var(--muted-2); font-weight: 400; white-space: nowrap; flex-shrink: 0; transition: color 0.35s; }
    .sticky-marquee-wrap { flex: 1; min-width: 0; overflow: hidden; position: relative; }
    .sticky-marquee-wrap.fading { mask-image: linear-gradient(to right, transparent 0%, black 8%, black 85%, transparent 100%); -webkit-mask-image: linear-gradient(to right, transparent 0%, black 8%, black 85%, transparent 100%); }
    .sticky-marquee-inner { display: inline-flex; white-space: nowrap; }
    .sticky-marquee-inner.scrolling { animation: marqueeScroll var(--marquee-dur, 18s) linear infinite; }
    .sticky-marquee-text { font-size: .68rem; color: var(--muted); padding-right: 48px; transition: color 0.35s; }
    @keyframes marqueeScroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
    .sticky-times { font-size: .68rem; color: var(--muted-2); font-variant-numeric: tabular-nums; white-space: nowrap; flex-shrink: 0; transition: color 0.35s; }
    .sticky-seek-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .sticky-seek { flex: 1; height: 28px; display: flex; align-items: center; position: relative; cursor: grab; touch-action: none; }
    .sticky-seek.seeking { cursor: grabbing; }
    .sticky-seek::before { content: ''; position: absolute; left: 0; right: 0; top: 50%; height: 3px; transform: translateY(-50%); border-radius: 999px; background: var(--seek-bg); transition: height 0.18s cubic-bezier(0.4,0,0.2,1), background 0.35s; pointer-events: none; }
    .sticky-seek:hover::before, .sticky-seek.seeking::before, .sticky-seek.bar-expanded::before { height: 5px; }
    .sticky-seek-fill { position: absolute; left: 0; top: 50%; transform: translateY(-50%); height: 3px; border-radius: 999px; background: var(--seek-fill); width: 0%; pointer-events: none; z-index: 1; transition: height 0.18s cubic-bezier(0.4,0,0.2,1), background 0.35s; }
    .sticky-seek:hover .sticky-seek-fill, .sticky-seek.seeking .sticky-seek-fill, .sticky-seek.bar-expanded .sticky-seek-fill { height: 5px; }
    .sticky-seek-thumb { position: absolute; top: 50%; left: 0%; width: 0px; height: 0px; border-radius: 50%; background: var(--scrubber-notch); box-shadow: 0 1px 4px rgba(0,0,0,0.25); transform: translate(-50%, -50%); pointer-events: none; touch-action: none; z-index: 3; transition: width 0.18s cubic-bezier(0.34,1.56,0.64,1), height 0.18s cubic-bezier(0.34,1.56,0.64,1), background 0.35s; }
    .sticky-seek:hover .sticky-seek-thumb, .sticky-seek.seeking .sticky-seek-thumb, .sticky-seek.bar-expanded .sticky-seek-thumb { width: 13px; height: 13px; }
    .sticky-seek-thumb.dragging { width: 13px !important; height: 13px !important; }
    .sticky-player.mini-mode .sticky-seek-thumb { width: 0 !important; height: 0 !important; }
    .sticky-controls { display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; position: relative; transform-origin: bottom center; transition: transform 0.30s cubic-bezier(0.4,0,0.2,1), opacity 0.20s ease; }
    .sticky-ctrl-left  { display: flex; align-items: center; justify-content: flex-end; gap: 14px; padding-right: 20px; }
    .sticky-ctrl-right { display: flex; align-items: center; justify-content: flex-start; gap: 14px; padding-left: 20px; }
    .sticky-player.mini-mode .sticky-controls { transform: translateY(16px) scaleY(0.15); opacity: 0; }
    .sticky-ctrl-btn { background: none; border: none; cursor: pointer; color: var(--primary-dark); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; opacity: .75; transition: opacity 0.15s ease, transform 0.15s ease, color 0.35s, background 0.15s; }
    .sticky-ctrl-btn:hover { opacity: 1; transform: scale(1.12); background: var(--row-hover); }
    .sticky-ctrl-btn:disabled { opacity: .25; cursor: default; transform: none; background: none; }
    .sticky-ctrl-btn svg { width: 22px; height: 22px; display: block; }
    .sticky-play-main { width: 48px; height: 48px; border-radius: 50%; background: var(--primary-dark); border: none; cursor: pointer; color: #fff; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 10px rgba(36,100,93,.35); position: relative; overflow: hidden; transition: background 0.42s cubic-bezier(0.4,0,0.2,1), box-shadow 0.42s ease; }
    .sticky-play-main:hover { box-shadow: 0 4px 20px rgba(36,100,93,.45); }
    .sticky-play-main.red { background: #c0392b; box-shadow: 0 2px 10px rgba(192,57,43,0.40); }
    .sticky-play-main.red:hover { box-shadow: 0 4px 20px rgba(192,57,43,.50); }
    @keyframes spmSpring { 0% { transform: scale(1); } 28% { transform: scale(0.80); } 62% { transform: scale(1.13); } 84% { transform: scale(0.95); } 100% { transform: scale(1); } }
    .sticky-play-main.springing { animation: spmSpring 0.48s cubic-bezier(0.34,1.56,0.64,1); }
    .spm-ripple { position: absolute; border-radius: 50%; width: 48px; height: 48px; left: 0; top: 0; background: rgba(255,255,255,0.22); transform: scale(0); pointer-events: none; animation: spmRipple 0.55s ease-out forwards; }
    @keyframes spmRipple { to { transform: scale(2.6); opacity: 0; } }
    .spm-icon-wrap { position: relative; width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; }
    .spm-icon-wrap svg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); transition: opacity 0.26s cubic-bezier(0.4,0,0.2,1), transform 0.26s cubic-bezier(0.4,0,0.2,1); }
    .spm-play  { opacity: 1; transform: translate(calc(-50% + 1px), -50%) scale(1) !important; }
    .spm-pause { opacity: 0; transform: translate(-50%, -50%) scale(0.45) !important; }
    .sticky-play-main.red .spm-play  { opacity: 0; transform: translate(calc(-50% + 1px), -50%) scale(0.45) !important; }
    .sticky-play-main.red .spm-pause { opacity: 1; transform: translate(-50%, -50%) scale(1) !important; }
    .player-mini { position: absolute; bottom: 0; left: 0; right: 0; display: flex; flex-direction: column; background: var(--mini-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-radius: 18px 18px 0 0; border-top: 1px solid var(--player-border); box-shadow: 0 -4px 24px rgba(0,0,0,.10); overflow: hidden; transform: translateY(100%) scaleY(0.4); transform-origin: bottom center; opacity: 0; pointer-events: none; transition: transform 0.52s cubic-bezier(0.34,1.56,0.64,1), opacity 0.22s ease 0.06s, background 0.35s, border-color 0.35s; will-change: transform, opacity; }
    .sticky-player.mini-mode .player-mini { transform: translateY(0) scaleY(1); opacity: 1; pointer-events: auto; }
    .mini-bar-track { width: 100%; height: 22px; background: transparent; flex-shrink: 0; position: relative; display: flex; align-items: center; cursor: grab; touch-action: none; overflow: visible; }
    .mini-bar-track.seeking { cursor: grabbing; }
    .mini-bar-track::before { content: ''; position: absolute; left: 0; right: 0; top: 50%; transform: translateY(-50%); height: 3px; border-radius: 999px; background: var(--seek-bg); transition: height 0.18s cubic-bezier(0.4,0,0.2,1), background 0.35s; pointer-events: none; }
    .mini-bar-track:hover::before, .mini-bar-track.seeking::before, .mini-bar-track.bar-expanded::before { height: 5px; }
    .mini-bar-fill { position: absolute; left: 0; top: 50%; transform: translateY(-50%); height: 3px; width: 0%; border-radius: 999px; background: var(--seek-fill); pointer-events: none; z-index: 1; transition: height 0.18s cubic-bezier(0.4,0,0.2,1), background 0.35s; overflow: hidden; }
    .mini-bar-track:hover .mini-bar-fill, .mini-bar-track.seeking .mini-bar-fill, .mini-bar-track.bar-expanded .mini-bar-fill { height: 5px; }
    .mini-bar-fill::after { content: ''; position: absolute; top: 0; left: -60%; bottom: 0; width: 60%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.22), transparent); animation: barShimmer 2.8s ease-in-out infinite; }
    @keyframes barShimmer { 0%{left:-60%} 65%{left:120%} 100%{left:120%} }
    #mini-thumb { position: absolute; top: 50%; left: 0%; width: 0px; height: 0px; border-radius: 50%; background: var(--scrubber-notch); box-shadow: 0 1px 4px rgba(0,0,0,0.25); transform: translate(-50%, -50%); pointer-events: none; z-index: 3; transition: width 0.18s cubic-bezier(0.34,1.56,0.64,1), height 0.18s cubic-bezier(0.34,1.56,0.64,1), background 0.35s; }
    .mini-bar-track:hover #mini-thumb, .mini-bar-track.seeking #mini-thumb, .mini-bar-track.bar-expanded #mini-thumb { width: 11px; height: 11px; }
    #mini-thumb.dragging { width: 11px !important; height: 11px !important; }
    .mini-text-row { display: flex; align-items: center; justify-content: space-between; padding: 6px 16px 9px; }
    .mini-name { font-size: .65rem; color: var(--primary-dark); font-weight: 600; transition: color 0.35s; }
    .mini-time { font-size: .65rem; color: var(--muted-2); font-variant-numeric: tabular-nums; transition: color 0.35s; }
    .sticky-mute-btn.muted { opacity: 1 !important; color: #e05555 !important; }

    /* â”€â”€ PLAY BUTTONS â”€â”€ */
    .play-btn { display: inline-flex; align-items: center; justify-content: center; width: 32px; height: 32px; border-radius: 50%; background: var(--primary); border: none; cursor: pointer; color: #fff; flex-shrink: 0; box-shadow: 0 2px 8px rgba(36,100,93,.3); position: relative; overflow: hidden; transition: background 0.42s cubic-bezier(0.4,0,0.2,1), box-shadow 0.15s ease; }
    .play-btn:hover { box-shadow: 0 4px 14px rgba(36,100,93,.45); }
    .play-btn.playing { background: #c0392b; box-shadow: 0 2px 10px rgba(192,57,43,0.40); }
    .play-btn svg { display: block; position: relative; z-index: 1; }
    @keyframes playBtnSpring { 0% { transform: scale(1); } 28% { transform: scale(0.78); } 62% { transform: scale(1.14); } 84% { transform: scale(0.94); } 100% { transform: scale(1); } }
    .play-btn.springing { animation: playBtnSpring 0.48s cubic-bezier(0.34,1.56,0.64,1); }
    .play-btn-ripple { position: absolute; border-radius: 50%; width: 32px; height: 32px; left: 0; top: 0; background: rgba(255,255,255,0.28); transform: scale(0); pointer-events: none; animation: spmRipple 0.55s ease-out forwards; }
    .td-audio { text-align: center; width: 36px; padding: 12px 4px 12px 8px; }
    .td-moon { text-align: center; width: 32px; padding: 12px 8px 12px 0; }
    .moon-icon svg { display: block; }

    /* â”€â”€ FILTER â”€â”€ */
    .filter-wrap { margin-bottom: 20px; display: flex; flex-direction: column; align-items: center; gap: 10px; }
    .filter-chips { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
    .filter-chip { display: inline-flex; align-items: center; gap: 6px; background: var(--chip-bg); border: 1.5px solid transparent; border-radius: 30px; padding: 5px 12px 5px 8px; box-shadow: var(--chip-shadow); font-size: .78rem; font-weight: 500; font-family: inherit; cursor: pointer; color: var(--text); transition: all 0.2s ease; }
    .filter-chip:hover { box-shadow: 0 3px 12px rgba(0,0,0,.18); transform: translateY(-1px); }
    .filter-chip.active { background: var(--primary-dark); color: #fff; border-color: var(--primary-dark); box-shadow: 0 4px 14px rgba(26,74,68,.3); animation: chipPulse 3.2s ease-in-out infinite; }
    .filter-chip.active .filter-dot { border-color: rgba(255,255,255,.4) !important; }
    .filter-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
    @keyframes chipPulse { 
      0%   { box-shadow: 0 0 0 0 var(--pulse-color, rgba(255,255,255,0.9)), 0 4px 14px rgba(26,74,68,.3); transform: scale(1); } 
      50%  { box-shadow: 0 0 0 5px rgba(0,0,0,0), 0 4px 14px rgba(26,74,68,.3); transform: scale(1.04); } 
      100% { box-shadow: 0 0 0 0 rgba(0,0,0,0), 0 4px 14px rgba(26,74,68,.3); transform: scale(1); } 
    }
    .filter-chip[data-imam="abdurrahman"].active { --pulse-color: rgba(232,99,10,1); }
    .filter-chip[data-imam="saed"].active        { --pulse-color: rgba(212,168,0,1); }
    .filter-chip[data-imam="noor"].active         { --pulse-color: rgba(41,128,185,1); }
    .filter-chip[data-imam="abdul"].active        { --pulse-color: rgba(160,160,160,0.9); }
    .filter-chip[data-imam="mohammed"].active     { --pulse-color: rgba(33,145,80,1); }
    .filter-chip[data-imam="yacquub"].active      { --pulse-color: rgba(200,200,200,0.9); }
    .filter-chip[data-imam="ibrahim"].active      { --pulse-color: rgba(41,128,185,1); }
    .filter-chip[data-imam="abdelsalam"].active   { --pulse-color: rgba(200,200,200,0.9); }
    .filter-chip[data-imam="hatem"].active        { --pulse-color: rgba(200,200,200,0.9); }
    tbody tr.filtered-out { display: none; }
    .day-card-mobile.filtered-out { display: none; }

    @keyframes fadeUp { from { opacity: 0; transform: translateY(18px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    footer { background: var(--footer-bg); text-align: center; padding: 24px 20px; color: rgba(255,255,255,.45); font-size: .8rem; letter-spacing: .05em; transition: background 0.35s; }
    footer strong { color: var(--gold); }

    @media (max-width: 640px) {
      header { padding: 20px 16px 18px; }
      main { padding: 24px 12px 60px; }
      .table-wrap { display: none; }
      .mobile-cards { display: block; }
      .filter-chips { flex-direction: row; flex-wrap: wrap; justify-content: flex-start; width: 100%; gap: 8px; }
      .filter-chip { justify-content: flex-start; border-radius: 30px; padding: 6px 12px 6px 8px; font-size: .8rem; flex: 0 1 auto; }
      .filter-wrap { align-items: flex-start; }
      .today-card-top { padding: 18px 20px 16px; }
      .today-card-body { padding: 14px 20px 16px; }
      .today-imam-name { font-size: 1.6rem; }
    }


    /* â”€â”€ Instagram / Kamera-knapp i today-card â”€â”€ */
    .today-cam-btn {
      display: inline-flex; align-items: center; justify-content: center;
      gap: 6px; background: rgba(201,168,76,0.10);
      border: 1px solid rgba(201,168,76,0.28); color: var(--gold-light);
      padding: 9px 16px; border-radius: 100px;
      font-size: 0.68rem; font-weight: 600; letter-spacing: .06em; text-transform: uppercase;
      cursor: pointer; transition: all .25s; font-family: inherit; white-space: nowrap;
    }
    .today-cam-btn:hover { background: rgba(201,168,76,0.20); border-color: rgba(201,168,76,0.55); transform: translateY(-1px); }
    #img-canvas { display: none; }

    /* â”€â”€ HEADER CONTROLS (left side) â”€â”€ */
    .header-controls-left {
      position: absolute; top: 10px; left: 12px; z-index: 10;
      display: inline-flex; align-items: center; gap: 8px;
    }
    @media (max-width: 640px) {
      .header-controls-left {
        flex-direction: column; align-items: flex-start; gap: 6px; top: 8px;
      }
    }

    /* Share button â€” icon only */
    .share-btn {
      display: inline-flex; align-items: center; justify-content: center;
      width: 32px; height: 32px; border-radius: 50%;
      background: rgba(201,168,76,0.12);
      border: 1px solid rgba(201,168,76,0.32);
      color: var(--gold-light);
      cursor: pointer; transition: all .25s; font-family: inherit; flex-shrink: 0;
    }
    .share-btn:hover { background: rgba(201,168,76,0.22); border-color: rgba(201,168,76,0.6); transform: translateY(-1px); }
    .share-btn.share-copied { background: rgba(61,186,126,0.15); border-color: rgba(61,186,126,0.45); color: #3dba7e; }

    /* Share toast */
    .share-toast {
      position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%) translateY(12px);
      background: var(--surface); border: 1px solid rgba(61,186,126,0.4); color: #3dba7e;
      font-size: .75rem; font-weight: 600; padding: 10px 22px; border-radius: 100px;
      opacity: 0; transition: all .3s cubic-bezier(0.34,1.56,0.64,1); pointer-events: none;
      white-space: nowrap; box-shadow: 0 8px 24px rgba(0,0,0,0.3); z-index: 9998;
    }
    .share-toast.visible { opacity: 1; transform: translateX(-50%) translateY(0); }

    /* Lang dropdown */
    .lang-wrap { position: relative; }
    .lang-trigger {
      display: inline-flex; align-items: center; gap: 6px;
      background: rgba(255,255,255,0.09); border: 1px solid rgba(255,255,255,0.14);
      border-radius: 10px; padding: 4px 9px; cursor: pointer; transition: all .2s;
      font-family: inherit; color: #fff;
    }
    .lang-trigger:hover { background: rgba(255,255,255,0.15); }
    .lang-trigger .lang-flag { font-size: .9rem; line-height: 1; }
    .lang-trigger .lang-code { font-size: .68rem; font-weight: 700; color: rgba(255,255,255,.8); letter-spacing: .04em; }
    .lang-trigger .lang-chevron { color: rgba(255,255,255,.35); transition: transform .2s; flex-shrink: 0; }
    .lang-wrap.open .lang-chevron { transform: rotate(180deg); }
    .lang-dropdown {
      position: absolute; top: calc(100% + 8px); left: 0;
      background: var(--surface); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 14px; padding: 6px; min-width: 172px; z-index: 10010;
      box-shadow: 0 12px 40px rgba(0,0,0,0.45);
      opacity: 0; transform: translateY(-6px) scale(0.97);
      pointer-events: none; transition: all .22s cubic-bezier(0.34,1.56,0.64,1);
    }
    .lang-wrap.open .lang-dropdown { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
    .lang-item {
      display: flex; align-items: center; gap: 10px; padding: 8px 10px;
      border-radius: 9px; cursor: pointer; transition: background .15s;
    }
    .lang-item:hover { background: rgba(255,255,255,0.07); }
    .lang-item.active { background: rgba(36,100,93,0.35); }
    .lang-item .li-flag { font-size: .9rem; }
    .lang-item .li-native { font-size: .75rem; font-weight: 500; color: rgba(255,255,255,.7); flex: 1; }
    .lang-item .li-code { font-size: .6rem; font-weight: 700; letter-spacing: .06em; color: rgba(255,255,255,.28); }
    .lang-item.active .li-native { color: #fff; }
    .lang-item.active .li-code { color: rgba(201,168,76,.75); }
    .lang-divider-line { height: 1px; background: rgba(255,255,255,.06); margin: 4px 2px; }
  </style>
</head>
<body>

<header>
  <button class="theme-toggle" id="theme-toggle" onclick="toggleTheme()" aria-label="Byt tema">
    <div class="ios-track" id="ios-track">
      <span class="ios-track-label" id="toggle-label">LJUST<br>LÃ„GE</span>
      <div class="ios-thumb" id="ios-thumb">
        <span class="ios-thumb-icon ios-thumb-sun">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="4"/>
            <line x1="12" y1="2"  x2="12" y2="5"/>
            <line x1="12" y1="19" x2="12" y2="22"/>
            <line x1="4.22" y1="4.22"  x2="6.34" y2="6.34"/>
            <line x1="17.66" y1="17.66" x2="19.78" y2="19.78"/>
            <line x1="2"  y1="12" x2="5"  y2="12"/>
            <line x1="19" y1="12" x2="22" y2="12"/>
            <line x1="4.22" y1="19.78" x2="6.34" y2="17.66"/>
            <line x1="17.66" y1="6.34"  x2="19.78" y2="4.22"/>
          </svg>
        </span>
        <span class="ios-thumb-icon ios-thumb-moon">
          <svg width="11" height="11" viewBox="0 0 24 24" fill="white" stroke="none">
            <path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/>
          </svg>
        </span>
      </div>
    </div>
  </button>
  <div class="ornament">
    <div class="orn-line l"></div><div class="orn-dot"></div>
    <div class="orn-diamond"></div><div class="orn-dot"></div>
    <div class="orn-line r"></div>
  </div>
  <h1 id="header-h1">Tarawih Schema fÃ¶r<br>KÃ¤mpingehallen<br><span style="font-size:0.65em;letter-spacing:0.04em;opacity:0.85;" id="header-year">Ramadan 2026</span></h1>
  <div class="header-address">
    <div class="addr-text">
      <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
      TenstastrÃ¥ket 16, 163 61 SpÃ¥nga
    </div>
    <a href="https://www.google.com/maps/search/?api=1&query=TenstastrÃ¥ket+16,+163+61+SpÃ¥nga" target="_blank">
      <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
      <span data-i18n="findUs">Hitta hit</span>
    </a>
  </div>
  <!-- HEADER CONTROLS LEFT: SprÃ¥k + Dela -->
  <div class="header-controls-left">
    <div class="lang-wrap" id="lang-wrap">
      <div class="lang-trigger" id="lang-trigger">
        <span class="lang-flag" id="lang-flag">ğŸ‡¸ğŸ‡ª</span>
        <span class="lang-code" id="lang-code">SV</span>
        <svg class="lang-chevron" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="lang-dropdown" id="lang-dropdown">
        <div class="lang-item active" data-lang="sv" data-flag="ğŸ‡¸ğŸ‡ª" data-code="SV"><span class="li-flag">ğŸ‡¸ğŸ‡ª</span><span class="li-native">Svenska</span><span class="li-code">SV</span></div>
        <div class="lang-item" data-lang="ar" data-flag="ğŸ‡¸ğŸ‡¦" data-code="AR"><span class="li-flag">ğŸ‡¸ğŸ‡¦</span><span class="li-native">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span><span class="li-code">AR</span></div>
        <div class="lang-divider-line"></div>
        <div class="lang-item" data-lang="en" data-flag="ğŸ‡¬ğŸ‡§" data-code="EN"><span class="li-flag">ğŸ‡¬ğŸ‡§</span><span class="li-native">English</span><span class="li-code">EN</span></div>
        <div class="lang-item" data-lang="tr" data-flag="ğŸ‡¹ğŸ‡·" data-code="TR"><span class="li-flag">ğŸ‡¹ğŸ‡·</span><span class="li-native">TÃ¼rkÃ§e</span><span class="li-code">TR</span></div>
        <div class="lang-item" data-lang="so" data-flag="ğŸ‡¸ğŸ‡´" data-code="SO"><span class="li-flag">ğŸ‡¸ğŸ‡´</span><span class="li-native">Soomaali</span><span class="li-code">SO</span></div>
      </div>
    </div>
    <button class="share-btn" id="share-btn" onclick="handleShare()">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
    </button>
  </div>
  <!-- SHARE TOAST -->
  <div class="share-toast" id="share-toast"></div>
</header>

<!-- Mobile backdrop for moon bubble -->
<div class="moon-tooltip-backdrop" id="moon-tooltip-backdrop"></div>

<div class="wave">
  <svg viewBox="0 0 1440 56" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
    <path id="wave-path" d="M0,28 C400,65 1040,-9 1440,28 L1440,0 L0,0 Z" fill="#24645d"/>
  </svg>
</div>

<main>

  <!-- EID CARD -->
  <div class="eid-card" id="eid-card">
    <div class="eid-crescents">
      <span class="eid-crescent" style="left:8%;top:18%;--dur:7s;--delay:0s;--rot:-12deg;--max-op:0.15;">ğŸŒ™</span>
      <span class="eid-crescent" style="right:10%;top:12%;--dur:9s;--delay:1.2s;--rot:10deg;--max-op:0.12;">ğŸŒ™</span>
      <span class="eid-crescent" style="left:20%;bottom:20%;--dur:8s;--delay:2.5s;--rot:5deg;--max-op:0.10;">âœ¦</span>
      <span class="eid-crescent" style="right:18%;bottom:25%;--dur:6.5s;--delay:0.8s;--rot:-8deg;--max-op:0.13;">âœ¦</span>
      <span class="eid-crescent" style="left:50%;top:8%;--dur:10s;--delay:3s;--rot:3deg;--max-op:0.09;">ğŸŒ™</span>
    </div>
    <div class="eid-inner">
      <div class="eid-ornament">
        <div class="eid-orn-line"></div><div class="eid-orn-dot"></div>
        <div class="eid-orn-diamond"></div><div class="eid-orn-dot"></div>
        <div class="eid-orn-line r"></div>
      </div>
      <div class="eid-arabic">ØªÙÙ‚ÙØ¨ÙÙ‘Ù„Ù Ø§Ù„Ù„Ù‡Ù Ù…ÙÙ†ÙÙ‘Ø§ ÙˆÙÙ…ÙÙ†Ù’ÙƒÙÙ…</div>
      <div class="eid-title">Eid Mubarak</div>
      <div class="eid-divider">
        <div class="eid-divider-line"></div><div class="eid-divider-dot"></div><div class="eid-divider-line"></div>
      </div>
      <div class="eid-subtitle">Taqabbal Allahu minna wa minkum</div>
      <div class="eid-note">
        <strong>Ramadan 1447 Ã¤r avslutat.</strong><br>
        MÃ¥ Allah acceptera era bÃ¶ner, fasta och goda gÃ¤rningar.<br>
        Vi ses nÃ¤sta Ã¥r, in shaa Allah.
      </div>
      <a class="eid-instagram" href="https://www.instagram.com/sverigesimamer/" target="_blank" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>
        @sverigesimamer
      </a>
    </div>
  </div>

  <!-- TODAY CARD -->
  <div class="today-card-comet" id="today-card-comet" style="display:none;">
  <div class="today-card" id="today-card">
    <div class="today-card-top">
      <div class="today-card-header-content">
        <div class="today-badge-pill">
          <div class="today-badge-pill-dot"></div>
          <span class="today-badge-pill-text" data-i18n="badgeText">Dagens Imam</span>
        </div>
        <span class="today-imam-name" id="today-imam-name">â€”</span>
        <div class="today-date-row">
          <span class="today-date-text" id="today-date-label">â€”</span>
        </div>
      </div>
    </div>
    <div class="today-card-body">
      <div class="today-info-grid">
        <div class="today-info-cell">
          <span class="today-info-label" data-i18n="labelPages">Sidor idag</span>
          <span class="today-info-value" id="today-pages">â€”</span>
        </div>
        <div class="today-info-cell">
          <span class="today-info-label" data-i18n="labelSurahs">Suror</span>
          <span class="today-info-value" style="font-size:1rem; font-family:'DM Sans',sans-serif; font-weight:500;" id="today-surahs-name">â€”</span>
          <span class="today-info-sub" id="today-surahs-ref"></span>
        </div>
      </div>
      <div class="today-countdown-section" id="isha-countdown">
        <div class="today-countdown-inner">
          <!-- Progress ring -->
          <div class="isha-ring-wrap">
            <svg class="isha-ring-svg" viewBox="0 0 54 54">
              <defs>
                <linearGradient id="ishaRingGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="rgba(201,168,76,0.7)"/>
                  <stop offset="100%" stop-color="rgba(255,230,120,1)"/>
                </linearGradient>
              </defs>
              <circle class="isha-ring-track" cx="27" cy="27" r="23"/>
              <circle class="isha-ring-fill" id="isha-ring-fill" cx="27" cy="27" r="23"/>
            </svg>
            <div class="isha-ring-icon">ğŸ•Œ</div>
          </div>
          <div class="today-countdown-left">
            <span class="today-countdown-label" id="isha-label" data-i18n="ishaLabel">Tid kvar till Isha</span>
            <div class="timer-wrap">
              <div class="today-timer" id="isha-timer">--:--:--</div>
              <div class="today-timer-done" id="isha-timer-done" data-i18n="ishaDoneTimer">ğŸ•Œ BÃ¶netiden Ã¤r inne</div>
            </div>
            <span class="today-countdown-sub" id="isha-time-info"></span>
          </div>
          <button class="notif-btn" id="notif-btn" title="FÃ¥ en notis nÃ¤r Isha-bÃ¶netiden bÃ¶rjar">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
            <span id="notif-btn-label" data-i18n="notifyMe">Notifiera mig</span>
          </button>
        </div>
      </div>
      <div class="today-card-footer" style="justify-content:space-between;">
        <button class="today-cam-btn" id="today-cam-btn" onclick="exportInstagramCard()">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="5" width="20" height="15" rx="2"/><circle cx="12" cy="12" r="4"/><path d="M9 5V3h6v2"/></svg>
          <span data-i18n="shareImg">Dela bild</span>
        </button>
        <button class="today-scroll-btn" onclick="scrollToToday()">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
          <span data-i18n="scrollBtn">Se i schemat</span>
        </button>
      </div>
    </div>
  </div>
  </div>
  <canvas id="img-canvas"></canvas>

  <!-- SECTION TITLE -->
  <div class="section-title">
    <h2 data-i18n="sectionHeading">Imamernas BÃ¶neledning</h2>
    <div class="divider"><span></span><i></i><span></span></div>
  </div>

  <!-- FILTER -->
  <div class="filter-wrap" id="filter-wrap">
    <div class="filter-chips" id="filter-chips">
      <button class="filter-chip" data-imam="abdurrahman" onclick="toggleFilter('abdurrahman')"><span class="filter-dot" style="background:var(--abdurrahman)"></span>Abdurrahman Sudani</button>
      <button class="filter-chip" data-imam="saed" onclick="toggleFilter('saed')"><span class="filter-dot" style="background:var(--saed);border:1px solid #bbb"></span>Saed Magan</button>
      <button class="filter-chip" data-imam="noor" onclick="toggleFilter('noor')"><span class="filter-dot" style="background:#ffffff;border:1px solid #bbb"></span>Noor</button>
      <button class="filter-chip" data-imam="abdul" onclick="toggleFilter('abdul')"><span class="filter-dot" style="background:var(--abdul)"></span>Abdul Qadir</button>
      <button class="filter-chip" data-imam="mohammed" onclick="toggleFilter('mohammed')"><span class="filter-dot" style="background:var(--mohammed)"></span>Mohammed Haji</button>
      <button class="filter-chip" data-imam="yacquub" onclick="toggleFilter('yacquub')"><span class="filter-dot" style="background:var(--yacquub)"></span>Yacquub</button>
      <button class="filter-chip" data-imam="ibrahim" onclick="toggleFilter('ibrahim')"><span class="filter-dot" style="background:var(--ibrahim)"></span>Ibrahim Noor</button>
      <button class="filter-chip" data-imam="abdelsalam" onclick="toggleFilter('abdelsalam')"><span class="filter-dot" style="background:var(--abdelsalam)"></span>Abdelsalam Nour</button>
      <button class="filter-chip" data-imam="hatem" onclick="toggleFilter('hatem')"><span class="filter-dot" style="background:var(--hatem)"></span>Hatem</button>
    </div>
  </div>

  <!-- DESKTOP TABLE -->
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>#</th><th data-i18n="thPages">Sidor</th><th data-i18n="thSurahs">Suror</th><th>Imam</th><th data-i18n="thDate">Datum</th><th></th><th></th><th data-i18n="thDay">Dag</th>
        </tr>
      </thead>
      <tbody id="table-body"></tbody>
    </table>
  </div>

  <!-- MOBILE CARDS -->
  <div class="mobile-cards" id="mobile-cards"></div>

</main>

<footer>
  <a href="https://www.instagram.com/sverigesimamer/" target="_blank" rel="noopener" style="display:inline-flex;align-items:center;gap:7px;color:rgba(255,255,255,.65);text-decoration:none;margin-bottom:12px;font-size:.82rem;transition:color 0.2s;" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='rgba(255,255,255,.65)'">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>
    @sverigesimamer
  </a>
  <br>
  &copy; 2026 &nbsp;<strong>Sveriges Imamer</strong>&nbsp; â€” <span data-i18n="footerText">Tarawih Schema Ramadan 1447</span>
</footer>

<script>
  // â”€â”€ Hadith-texter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const H_STAND_UP        = 'standUp';
  const H_SEEK_ODD        = 'seekOdd';
  const H_SEEK_NIGHT      = 'seekNight';
  const DEFAULT_MOON_TEXT = 'standUp';

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TRANSLATIONS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  const LANG_KEY = 'tarawih-lang';
  let _currentLang = 'sv';

  const T = {
    sv: {
      days: { Monday:'MÃ¥ndag', Tuesday:'Tisdag', Wednesday:'Onsdag', Thursday:'Torsdag', Friday:'Fredag', Saturday:'LÃ¶rdag', Sunday:'SÃ¶ndag' },
      hadith: {
        standUp:   'Profeten ï·º sade: "Den som stÃ¥r upp i nattbÃ¶n under Laylatul-Qadr med tro och i hopp om belÃ¶ning fÃ¥r sina tidigare synder fÃ¶rlÃ¥tna." (al-Bukhari och Muslim)',
        seekOdd:   'Profeten ï·º sade: "SÃ¶k Laylat al-Qadr i de udda nÃ¤tterna under de sista tio dagarna av Ramadan." (Sahih Bukhari)',
        seekNight: 'Profeten ï·º sade: "SÃ¶k efter den (Maktens natt) pÃ¥ den tjugonionde, tjugosjunde och tjugofemte natten." Sahih al-Bukhari 2023',
      },
      months: ['januari','februari','mars','april','maj','juni','juli','augusti','september','oktober','november','december'],
      days7:  ['SÃ¶ndag','MÃ¥ndag','Tisdag','Onsdag','Torsdag','Fredag','LÃ¶rdag'],
      night:           'Natt',
      todayBadge:      'Idag',
      pagesPrefix:     'Sidor',
      headerTitle:     'Tarawih Schema fÃ¶r<br>KÃ¤mpingehallen',
      headerYear:      'Ramadan 2026',
      findUs:          'Hitta hit',
      lightMode:       'LJUST<br>LÃ„GE',
      darkMode:        'MÃ–RKT<br>LÃ„GE',
      shareToast:      'âœ“ LÃ¤nk kopierad till urklipp',
      badgeText:       'Dagens Imam',
      labelPages:      'Sidor idag',
      labelSurahs:     'Suror',
      ishaLabel:       'Tid kvar till Isha',
      ishaDoneLabel:   'Isha',
      ishaDoneTimer:   'ğŸ•Œ BÃ¶netiden Ã¤r inne',
      ishaPrefix:      'Isha-bÃ¶nen bÃ¶rjar kl. ',
      ishaDone:        'Isha-bÃ¶nen Ã¤r inne sedan kl. ',
      notifyMe:        'Notifiera mig',
      scrollBtn:       'Se i schemat',
      shareImg:        'Dela bild',
      sectionHeading:  'Imamernas BÃ¶neledning',
      thPages:         'Sidor',
      thSurahs:        'Suror',
      thDate:          'Datum',
      thDay:           'Dag',
      surahsDetail:    'Suror â€” tryck fÃ¶r detaljer',
      footerText:      'Tarawih Schema Ramadan 1447',
      notifTitle:      'ğŸ•Œ Isha-bÃ¶nen Ã¤r inne',
      notifBody:       'BÃ¶netiden har bÃ¶rjat â€” kl. ',
      notifGranted:    'Notis aktiv',
      notifDenied:     'Notis blockerad',
    },
    ar: {
      days: { Monday:'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', Tuesday:'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', Wednesday:'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', Thursday:'Ø§Ù„Ø®Ù…ÙŠØ³', Friday:'Ø§Ù„Ø¬Ù…Ø¹Ø©', Saturday:'Ø§Ù„Ø³Ø¨Øª', Sunday:'Ø§Ù„Ø£Ø­Ø¯' },
      hadith: {
        standUp:   'Ù‚Ø§Ù„ Ø§Ù„Ù†Ø¨ÙŠ ï·º: Â«Ù…ÙÙ† Ù‚Ø§Ù…Ù Ù„ÙÙŠÙ„Ø©Ù Ø§Ù„Ù‚ÙØ¯Ø±Ù Ø¥ÙŠÙ…Ø§Ù†Ù‹Ø§ ÙˆØ§Ø­ØªÙØ³Ø§Ø¨Ù‹Ø§ØŒ ØºÙÙÙØ±Ù Ù„Ù‡ Ù…Ø§ ØªÙÙ‚Ø¯ÙÙ‘Ù…Ù Ù…ÙÙ† Ø°ÙÙ†Ø¨ÙÙ‡.Â» (Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ ÙˆÙ…Ø³Ù„Ù…)',
        seekOdd:   'Ù‚Ø§Ù„ Ø§Ù„Ù†Ø¨ÙŠ ï·º: Â«ØªÙØ­ÙØ±ÙÙ‘ÙˆØ§ Ù„ÙÙŠÙ„Ø©Ù Ø§Ù„Ù‚ÙØ¯Ø±Ù ÙÙŠ Ø§Ù„ÙˆÙØªØ±Ù Ù…ÙÙ† Ø§Ù„Ø¹ÙØ´Ø±Ù Ø§Ù„Ø£ÙˆØ§Ø®ÙØ±Ù Ù…ÙÙ† Ø±ÙÙ…ÙØ¶Ø§Ù†.Â» (ØµØ­ÙŠØ­ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ)',
        seekNight: 'Ù‚Ø§Ù„ Ø§Ù„Ù†Ø¨ÙŠ ï·º: Â«Ø§Ù„ØªÙÙ…ÙØ³ÙˆÙ‡Ø§ ÙÙŠ Ø§Ù„ØªØ§Ø³ÙØ¹Ø©Ù ÙˆØ§Ù„Ø³Ø§Ø¨ÙØ¹Ø©Ù ÙˆØ§Ù„Ø®Ø§Ù…ÙØ³Ø©Ù.Â» ØµØ­ÙŠØ­ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ 2023',
      },
      months: ['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'],
      days7:  ['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'],
      night:           'Ù„ÙŠÙ„Ø©',
      todayBadge:      'Ø§Ù„ÙŠÙˆÙ…',
      pagesPrefix:     'ØµÙØ­Ø§Øª',
      headerTitle:     'Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­<br>ÙƒØ§Ù…Ø¨ÙŠÙ†ØºÙŠÙ‡Ø§Ù„Ù†',
      headerYear:      'Ø±Ù…Ø¶Ø§Ù† 2026',
      findUs:          'Ø§Ø¹Ø«Ø± Ø¹Ù„ÙŠÙ†Ø§',
      lightMode:       'ÙØ§ØªØ­',
      darkMode:        'Ø¯Ø§ÙƒÙ†',
      shareToast:      'âœ“ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·',
      badgeText:       'Ø¥Ù…Ø§Ù… Ø§Ù„ÙŠÙˆÙ…',
      labelPages:      'Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„ÙŠÙˆÙ…',
      labelSurahs:     'Ø§Ù„Ø³ÙˆØ±',
      ishaLabel:       'Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„Ø¹Ø´Ø§Ø¡',
      ishaDoneLabel:   'Ø§Ù„Ø¹Ø´Ø§Ø¡',
      ishaDoneTimer:   'ğŸ•Œ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø© Ø­Ø§Ù†',
      ishaPrefix:      'ØµÙ„Ø§Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡ ØªØ¨Ø¯Ø£ Ø§Ù„Ø³Ø§Ø¹Ø© ',
      ishaDone:        'ØµÙ„Ø§Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡ Ø¨Ø¯Ø£Øª Ø§Ù„Ø³Ø§Ø¹Ø© ',
      notifyMe:        'Ø£Ø´Ø¹Ø±Ù†ÙŠ',
      scrollBtn:       'Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„',
      shareImg:        'Ù…Ø´Ø§Ø±ÙƒØ© ØµÙˆØ±Ø©',
      sectionHeading:  'Ø¥Ù…Ø§Ù…Ø© Ø§Ù„ØµÙ„Ø§Ø©',
      thPages:         'Ø§Ù„ØµÙØ­Ø§Øª',
      thSurahs:        'Ø§Ù„Ø³ÙˆØ±',
      thDate:          'Ø§Ù„ØªØ§Ø±ÙŠØ®',
      thDay:           'Ø§Ù„ÙŠÙˆÙ…',
      surahsDetail:    'Ø§Ù„Ø³ÙˆØ± â€” Ø§Ø¶ØºØ· Ù„Ù„ØªÙØ§ØµÙŠÙ„',
      footerText:      'Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­ Ø±Ù…Ø¶Ø§Ù† 1447',
      notifTitle:      'ğŸ•Œ Ø­Ø§Ù† ÙˆÙ‚Øª ØµÙ„Ø§Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡',
      notifBody:       'Ø¨Ø¯Ø£Øª Ø§Ù„ØµÙ„Ø§Ø© â€” Ø§Ù„Ø³Ø§Ø¹Ø© ',
      notifGranted:    'Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù†Ø´Ø·',
      notifDenied:     'Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù…Ø­Ø¸ÙˆØ±',
    },
    en: {
      days: { Monday:'Monday', Tuesday:'Tuesday', Wednesday:'Wednesday', Thursday:'Thursday', Friday:'Friday', Saturday:'Saturday', Sunday:'Sunday' },
      hadith: {
        standUp:   'The Prophet ï·º said: "Whoever stands in prayer on Laylatul-Qadr with faith and in hope of reward, his previous sins will be forgiven." (al-Bukhari and Muslim)',
        seekOdd:   'The Prophet ï·º said: "Seek Laylat al-Qadr in the odd nights of the last ten days of Ramadan." (Sahih Bukhari)',
        seekNight: 'The Prophet ï·º said: "Seek it on the twenty-ninth, twenty-seventh and twenty-fifth night." Sahih al-Bukhari 2023',
      },
      months: ['January','February','March','April','May','June','July','August','September','October','November','December'],
      days7:  ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],
      night:           'Night',
      todayBadge:      'Today',
      pagesPrefix:     'Pages',
      headerTitle:     'Tarawih Schedule<br>KÃ¤mpingehallen',
      headerYear:      'Ramadan 2026',
      findUs:          'Get directions',
      lightMode:       'LIGHT<br>MODE',
      darkMode:        'DARK<br>MODE',
      shareToast:      'âœ“ Link copied to clipboard',
      badgeText:       "Today's Imam",
      labelPages:      "Today's pages",
      labelSurahs:     'Surahs',
      ishaLabel:       'Time until Isha',
      ishaDoneLabel:   'Isha',
      ishaDoneTimer:   'ğŸ•Œ Prayer time has begun',
      ishaPrefix:      'Isha prayer begins at ',
      ishaDone:        'Isha prayer started at ',
      notifyMe:        'Notify me',
      scrollBtn:       'View in schedule',
      shareImg:        'Share image',
      sectionHeading:  'Prayer Leadership',
      thPages:         'Pages',
      thSurahs:        'Surahs',
      thDate:          'Date',
      thDay:           'Day',
      surahsDetail:    'Surahs â€” tap for details',
      footerText:      'Tarawih Schedule Ramadan 1447',
      notifTitle:      'ğŸ•Œ Isha prayer has begun',
      notifBody:       'Prayer time has started â€” ',
      notifGranted:    'Notification active',
      notifDenied:     'Notification blocked',
    },
    tr: {
      days: { Monday:'Pazartesi', Tuesday:'SalÄ±', Wednesday:'Ã‡arÅŸamba', Thursday:'PerÅŸembe', Friday:'Cuma', Saturday:'Cumartesi', Sunday:'Pazar' },
      hadith: {
        standUp:   "Peygamber ï·º ÅŸÃ¶yle buyurdu: 'Kim Kadir Gecesiâ€™nde inanarak ve sevabÄ±nÄ± yalnÄ±zca Allahâ€™tan umarak ibadet ederse, geÃ§miÅŸ gÃ¼nahlarÄ± baÄŸÄ±ÅŸlanÄ±r.' (Buhari ve MÃ¼slim)",
        seekOdd:   "Peygamber ï·º ÅŸÃ¶yle buyurdu: 'Kadir Gecesiâ€™ni, Ramazanâ€™Ä±n son on gÃ¼nÃ¼ndeki tek gecelerde arayÄ±nÄ±z.' (Sahih Buhari)",
        seekNight: 'Peygamber ï·º ÅŸÃ¶yle buyurdu: "Onu yirmi dokuzuncu, yirmi yedinci ve yirmi beÅŸinci gecede arayÄ±nÄ±z." Sahih el-Buhari 2023',
      },
      months: ['Ocak','Åubat','Mart','Nisan','MayÄ±s','Haziran','Temmuz','AÄŸustos','EylÃ¼l','Ekim','KasÄ±m','AralÄ±k'],
      days7:  ['Pazar','Pazartesi','SalÄ±','Ã‡arÅŸamba','PerÅŸembe','Cuma','Cumartesi'],
      night:           'Gece',
      todayBadge:      'BugÃ¼n',
      pagesPrefix:     'Sayfalar',
      headerTitle:     'Teravih ProgramÄ±<br>KÃ¤mpingehallen',
      headerYear:      'Ramazan 2026',
      findUs:          'Yol tarifi',
      lightMode:       'AÃ‡IK<br>MOD',
      darkMode:        'KOYU<br>MOD',
      shareToast:      'âœ“ BaÄŸlantÄ± panoya kopyalandÄ±',
      badgeText:       'GÃ¼nÃ¼n Ä°mamÄ±',
      labelPages:      'BugÃ¼nÃ¼n sayfalarÄ±',
      labelSurahs:     'Sureler',
      ishaLabel:       'YatsÄ±ya kalan sÃ¼re',
      ishaDoneLabel:   'YatsÄ±',
      ishaDoneTimer:   'ğŸ•Œ Namaz vakti girdi',
      ishaPrefix:      'YatsÄ± namazÄ± saat ',
      ishaDone:        'YatsÄ± namazÄ± baÅŸladÄ±, saat ',
      notifyMe:        'Beni bildir',
      scrollBtn:       'Programda gÃ¶ster',
      shareImg:        'Resim paylaÅŸ',
      sectionHeading:  'Ä°mam ProgramÄ±',
      thPages:         'Sayfalar',
      thSurahs:        'Sureler',
      thDate:          'Tarih',
      thDay:           'GÃ¼n',
      surahsDetail:    'Sureler â€” detaylar iÃ§in dokun',
      footerText:      'Teravih ProgramÄ± Ramazan 1447',
      notifTitle:      'ğŸ•Œ YatsÄ± namazÄ± vakti girdi',
      notifBody:       'Namaz baÅŸladÄ± â€” saat ',
      notifGranted:    'Bildirim aktif',
      notifDenied:     'Bildirim engellendi',
    },
    so: {
      days: { Monday:'Isniin', Tuesday:'Talaado', Wednesday:'Arbaco', Thursday:'Khamiis', Friday:'Jimce', Saturday:'Sabti', Sunday:'Axad' },
      hadith: {
        standUp:   'Nabiga ï·º wuxuu yiri: "Qofkii taagan Laylatul-Qadr oo rumaysan oo rajaynaya abaalgud, dembiyadiisii hore waa la cafiyaa." (al-Bukhaari iyo Muslim)',
        seekOdd:   'Nabiga ï·º wuxuu yiri: "Ka doona Laylat al-Qadr habeenkii ku beegan tirada odd ee tobanka ugu dambeeyey ee Ramadaan." (Sahih Bukhaari)',
        seekNight: 'Nabiga ï·º wuxuu yiri: "Ka doona habeenka labaatan iyo sagaalaad, labaatan iyo toddobaad, iyo labaatan iyo shanaad." Sahih al-Bukhaari 2023',
      },
      months: ['Jannaayo','Febraayo','Maarso','Abriil','Maayo','Juun','Luulyo','Ogosto','Sebtembar','Oktoobar','Noofembar','Diseembar'],
      days7:  ['Axad','Isniin','Talaado','Arbaco','Khamiis','Jimce','Sabti'],
      night:           'Habeenka',
      todayBadge:      'Maanta',
      pagesPrefix:     'Bogagga',
      headerTitle:     'Jadwalka Taraawiix<br>KÃ¤mpingehallen',
      headerYear:      'Ramadaan 2026',
      findUs:          'Raadi halka',
      lightMode:       'IFTI<br>MOD',
      darkMode:        'MADOW<br>MOD',
      shareToast:      'âœ“ Xiriirka la koobiyeeyay',
      badgeText:       'Imaamka Maanta',
      labelPages:      'Bogagga maanta',
      labelSurahs:     'Surooyin',
      ishaLabel:       'Waqtiga khadka Cishaada',
      ishaDoneLabel:   "Cishaa'",
      ishaDoneTimer:   'ğŸ•Œ Waqtiga salaadda wuu yimid',
      ishaPrefix:      'Salaadda Cishaa waxay bilaabataa ',
      ishaDone:        'Salaadda Cishaa waxay bilaabatay ',
      notifyMe:        'I ogeysiiso',
      scrollBtn:       'Arag jadwalka',
      shareImg:        'Wadaag sawir',
      sectionHeading:  'Hogaanka Salaadda',
      thPages:         'Bogagga',
      thSurahs:        'Surooyin',
      thDate:          'Taariikhda',
      thDay:           'Maalinta',
      surahsDetail:    'Surooyin â€” taabo faahfaahin',
      footerText:      'Jadwalka Taraawiix Ramadaan 1447',
      notifTitle:      'ğŸ•Œ Waqtiga Cishaada wuu yimid',
      notifBody:       'Salaadda waxay bilaabatay â€” ',
      notifGranted:    'Ogeysiiska waa firfircoon',
      notifDenied:     'Ogeysiiska waa la xidhay',
    },
  };

  function getMoonText(row) {
    const key = row.moonText || DEFAULT_MOON_TEXT;
    return (T[_currentLang] && T[_currentLang].hadith && T[_currentLang].hadith[key])
      ? T[_currentLang].hadith[key]
      : T['sv'].hadith[key];
  }

  function getDay(englishDay) {
    return (T[_currentLang] && T[_currentLang].days && T[_currentLang].days[englishDay])
      ? T[_currentLang].days[englishDay]
      : englishDay;
  }

  function getDateLabel(d) {
    const t = T[_currentLang] || T['sv'];
    const dayName   = t.days7  ? t.days7[d.getDay()]   : ['SÃ¶ndag','MÃ¥ndag','Tisdag','Onsdag','Torsdag','Fredag','LÃ¶rdag'][d.getDay()];
    const monthName = t.months ? t.months[d.getMonth()] : ['januari','februari','mars','april','maj','juni','juli','augusti','september','oktober','november','december'][d.getMonth()];
    return dayName + ' ' + d.getDate() + ' ' + monthName;
  }

  const SCHEDULE = [
    {day:1,  sidor:'2â€“11',    imam:'abdurrahman', imamLabel:'Abdurrahman Sudani', datum:'2026-02-17', vecka:'Tuesday',   surahs:'Al-Baqarah',                                                                                                        tooltip:'2:1 â€“ 2:74'},
    {day:2,  sidor:'11â€“21',  imam:'saed',        imamLabel:'Saed Magan',         datum:'2026-02-18', vecka:'Wednesday',   surahs:'Al-Baqarah',                                                                                                        tooltip:'2:75 â€“ 2:141'},
    {day:3,  sidor:'22â€“31',  imam:'noor',        imamLabel:'Noor',               datum:'2026-02-19', vecka:'Thursday',  surahs:'Al-Baqarah',                                                                                                        tooltip:'2:142 â€“ 2:202'},
    {day:4,  sidor:'32â€“41',  imam:'abdul',       imamLabel:'Abdul Qadir',        datum:'2026-02-20', vecka:'Friday',   surahs:'Al-Baqarah',                                                                                                        tooltip:'2:203 â€“ 2:265'},
    {day:5,  sidor:'42â€“51',  imam:'mohammed',    imamLabel:'Mohammed Haji',      datum:'2026-02-21', vecka:'Saturday',   surahs:'Al-Baqarah, Ali Imran',                                                                                             tooltip:'2:266 â€“ 3:14'},
    {day:6,  sidor:'51â€“62',  imam:'abdurrahman', imamLabel:'Abdurrahman Sudani', datum:'2026-02-22', vecka:'Sunday',   surahs:'Ali Imran',                                                                                                         tooltip:'3:15 â€“ 3:92'},
    {day:7,  sidor:'62â€“72',  imam:'abdurrahman', imamLabel:'Abdurrahman Sudani', datum:'2026-02-23', vecka:'Monday',   surahs:'Ali Imran',                                                                                                         tooltip:'3:93 â€“ 3:170'},
    {day:8,  sidor:'72â€“81',  imam:'saed',        imamLabel:'Saed Magan',         datum:'2026-02-24', vecka:'Tuesday',   surahs:'Ali Imran, An-Nisa',                                                                                                tooltip:'3:171 â€“ 4:23'},
    {day:9,  sidor:'82â€“92',  imam:'ibrahim',     imamLabel:'Ibrahim Noor',        datum:'2026-02-25', vecka:'Wednesday',   surahs:'An-Nisa',                                                                                                           tooltip:'4:24 â€“ 4:87'},
    {day:10, sidor:'92â€“101', imam:'ibrahim',      imamLabel:'Ibrahim Noor',        datum:'2026-02-26', vecka:'Thursday',  surahs:'An-Nisa',                                                                                                           tooltip:'4:88 â€“ 4:147'},
    {day:11, sidor:'102â€“106',imam:'mohammed',    imamLabel:'Mohammed Haji',      datum:'2026-02-27', vecka:'Friday',   surahs:'An-Nisa, Fatir',                                                                                                    tooltip:'4:148 â€“ 35:30'},
    {day:12, sidor:'438â€“449',imam:'saed',        imamLabel:'Saed Magan',         datum:'2026-02-28', vecka:'Saturday',   surahs:'Fatir, Ya-Sin',                                                                                                     tooltip:'35:31 â€“ 36:82'},
    {day:13, sidor:'449â€“458',imam:'abdelsalam',  imamLabel:'Abdelsalam Nour',    datum:'2026-03-01', vecka:'Sunday',   surahs:'Ya-Sin, As-Saffat, Sad',                                                                                            tooltip:'36:83 â€“ 38:88'},
    {day:14, sidor:'458â€“467',imam:'saed',        imamLabel:'Saed Magan',         datum:'2026-03-02', vecka:'Monday',   surahs:'Az-Zumar',                                                                                                          tooltip:'39:1 â€“ 39:75'},
    {day:15, sidor:'467â€“476',imam:'noor',        imamLabel:'Noor',               datum:'2026-03-03', vecka:'Tuesday',   surahs:'Ghafir',                                                                                                            tooltip:'40:1 â€“ 40:85'},
    {day:16, sidor:'476â€“486',imam:'mohammed',    imamLabel:'Mohammed Haji',      datum:'2026-03-04', vecka:'Wednesday',   surahs:'Fussilat, Ash-Shura',                                                                                               tooltip:'41:1 â€“ 42:26'},
    {day:17, sidor:'486â€“495',imam:'saed',        imamLabel:'Saed Magan',         datum:'2026-03-05', vecka:'Thursday',  surahs:'Ash-Shura, Az-Zukhruf',                                                                                             tooltip:'42:27 â€“ 43:89'},
    {day:18, sidor:'496â€“506',imam:'saed',        imamLabel:'Saed Magan',         datum:'2026-03-06', vecka:'Friday',   surahs:'Ad-Dukhan, Al-Jathiyah, Al-Ahqaf',                                                                                  tooltip:'44:1 â€“ 46:35'},
    {day:19, sidor:'507â€“515',imam:'yacquub',     imamLabel:'Yacquub',            datum:'2026-03-07', vecka:'Saturday',   surahs:'Muhammad, Al-Fath',                                                                                                 tooltip:'47:1 â€“ 48:29'},
    {day:20, sidor:'515â€“523',imam:'yacquub',     imamLabel:'Yacquub',            datum:'2026-03-08', vecka:'Sunday',   surahs:'Al-Hujurat, Qaf, Adh-Dhariyat',                                                                                     tooltip:'49:1 â€“ 51:60', moonText:H_SEEK_ODD},
    {day:21, sidor:'523â€“531',imam:'noor',        imamLabel:'Noor',               datum:'2026-03-09', vecka:'Monday',   surahs:'At-Tur, An-Najm, Al-Qamar',                                                                                         tooltip:'52:1 â€“ 54:55', moonText:H_SEEK_ODD},
    {day:22, sidor:'531â€“539',imam:'mohammed',    imamLabel:'Mohammed Haji',      datum:'2026-03-10', vecka:'Tuesday',   surahs:'Ar-Rahman, Al-Waqiah, Al-Hadid',                                                                                    tooltip:'55:1 â€“ 57:15', moonText:H_STAND_UP},
    {day:23, sidor:'539â€“548',imam:'abdurrahman', imamLabel:'Abdurrahman Sudani', datum:'2026-03-11', vecka:'Wednesday',   surahs:'Al-Hadid, Al-Mujadilah, Al-Hashr',                                                                                  tooltip:'57:16 â€“ 59:24', moonText:H_SEEK_ODD},
    {day:24, sidor:'549â€“557',imam:'abdul',       imamLabel:'Abdul Qadir',        datum:'2026-03-12', vecka:'Thursday',  surahs:'Al-Mumtahanah, As-Saf, Al-Jumuah, Al-Munafiqun, At-Taghabun',                                                       tooltip:'60:1 â€“ 64:18', moonText:H_STAND_UP},
    {day:25, sidor:'558â€“566',imam:'hatem',       imamLabel:'Hatem',              datum:'2026-03-13', vecka:'Friday',   surahs:'At-Talaq, At-Tahrim, Al-Mulk, Al-Qalam',                                                                            tooltip:'65:1 â€“ 68:52', moonText:H_SEEK_NIGHT},
    {day:26, sidor:'566â€“574',imam:'abdurrahman', imamLabel:'Abdurrahman Sudani', datum:'2026-03-14', vecka:'Saturday',   surahs:'Al-Haqqah, Al-Maarij, Nuh, Al-Jinn, Al-Muzzammil',                                                                  tooltip:'69:1 â€“ 73:20', moonText:H_STAND_UP},
    {day:27, sidor:'575â€“583',imam:'noor',        imamLabel:'Noor',               datum:'2026-03-15', vecka:'Sunday',   surahs:'Al-Muddaththir, Al-Qiyamah, Al-Insan, Al-Mursalat, An-Naba',                                                         tooltip:'74:1 â€“ 78:40', moonText:H_SEEK_NIGHT},
    {day:28, sidor:'583â€“591',imam:'mohammed',    imamLabel:'Mohammed Haji',      datum:'2026-03-16', vecka:'Monday',   surahs:'An-Naziat, Abasa, At-Takwir, Al-Infitar, Al-Mutaffifin, Al-Inshiqaq, Al-Buruj, At-Tariq, Al-Ala',                    tooltip:'79:1 â€“ 87:19', moonText:H_STAND_UP},
    {day:29, sidor:'592â€“604',imam:'yacquub',     imamLabel:'Yacquub',            datum:'2026-03-17', vecka:'Tuesday',   surahs:'Al-Ghashiyah, Al-Fajr, Al-Balad, Ash-Shams, Al-Layl, Ad-Duha, Ash-Sharh, At-Tin, Al-Alaq, Al-Qadr, Al-Bayyinah, Az-Zalzalah, Al-Adiyat, Al-Qariah, At-Takathur, Al-Asr, Al-Humazah, Al-Fil, Quraysh, Al-Maun, Al-Kawthar, Al-Kafirun, An-Nasr, Al-Masad, Al-Ikhlas, Al-Falaq, An-Nas', tooltip:'88:1 â€“ 114:6', moonText:H_SEEK_NIGHT},
    {day:30, sidor:'2â€“11',   imam:'noor',        imamLabel:'Noor',               datum:'2026-03-18', vecka:'Wednesday',   surahs:'Al-Baqarah',                                                                                                        tooltip:'2:1 â€“ 2:74'},
  ];

  const _now = new Date();
  const _p2 = n => String(n).padStart(2,'0');
  const today = _now.getFullYear() + '-' + _p2(_now.getMonth()+1) + '-' + _p2(_now.getDate());
  const isAfterRamadan = today > '2026-03-18';

  function scrollToToday() {
    const isMobile = window.innerWidth <= 640;
    const el = document.getElementById(isMobile ? 'today-row-mobile' : 'today-row-desktop');
    if (!el) return;
    const y = el.getBoundingClientRect().top + window.scrollY - 80;
    window.scrollTo({ top: y, behavior: 'smooth' });
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MOON BUBBLE LOGIC
     - Desktop: hover opens, click toggles, outside click closes
     - Mobile: tap opens full-screen bottom sheet with backdrop
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  const backdrop = document.getElementById('moon-tooltip-backdrop');
  let _activeMoonWrap = null;

  // â”€â”€ Animationstider â€” matchar CSS-transitions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const BUBBLE_TRANSITION_MS = 2050; // matchar transition: 2s i CSS
  const BUBBLE_CLOSE_MS      = 2050;

  function isMobile() { return window.innerWidth <= 640; }

  function closeBubble(animate = true) {
    if (!_activeMoonWrap) return;
    const bubble = _activeMoonWrap.querySelector('.moon-bubble');
    _activeMoonWrap.classList.remove('bubble-open');
    if (bubble) {
      if (animate && isMobile()) {
        bubble.style.transform = 'translateY(100%)';
        setTimeout(() => {
          bubble.style.cssText = '';
          bubble.classList.remove('bubble-closing');
        }, BUBBLE_CLOSE_MS);
      } else if (animate) {
        bubble.classList.add('bubble-closing');
        setTimeout(() => {
          bubble.classList.remove('bubble-closing');
          bubble.style.cssText = '';
        }, BUBBLE_CLOSE_MS);
      } else {
        bubble.classList.remove('bubble-closing');
        bubble.style.cssText = '';
      }
    }
    if (isMobile()) {
      backdrop.classList.add('hiding');
      backdrop.classList.remove('visible');
      backdrop.addEventListener('animationend', () => backdrop.classList.remove('hiding'), { once: true });
    }
    _activeMoonWrap = null;
  }

  function openBubble(wrapEl) {
    if (_activeMoonWrap === wrapEl) { closeBubble(true); return; }
    if (_activeMoonWrap) closeBubble(false);
    _activeMoonWrap = wrapEl;
    const bubble = wrapEl.querySelector('.moon-bubble');
    if (bubble) {
      bubble.classList.remove('bubble-closing');
      if (isMobile()) {
        bubble.style.visibility = 'visible';
        bubble.style.transform = 'translateY(100%)';
        requestAnimationFrame(() => {
          requestAnimationFrame(() => { bubble.style.transform = 'translateY(0)'; });
        });
      } else {
        bubble.style.cssText = '';
        requestAnimationFrame(() => {
          const playerEl = document.getElementById('sticky-player');
          if (!playerEl || !playerEl.classList.contains('visible')) return;
          const bubbleRect = bubble.getBoundingClientRect();
          const playerRect = playerEl.getBoundingClientRect();
          if (bubbleRect.bottom > playerRect.top) {
            const overlap = bubbleRect.bottom - playerRect.top + 8;
            bubble.style.bottom = `calc(100% + 10px + ${overlap}px)`;
          }
        });
      }
    }
    wrapEl.classList.add('bubble-open');
    if (isMobile()) {
      backdrop.classList.add('visible');
      backdrop.classList.remove('hiding');
    }
  }

  backdrop.addEventListener('click', () => closeBubble(true));

  document.addEventListener('click', (e) => {
    // Close surah tooltips
    if (!e.target.closest('.surah-cell') && !e.target.closest('.dcm-surahs'))
      document.querySelectorAll('.tooltip-box.visible, .dcm-tooltip.visible').forEach(el => el.classList.remove('visible'));

    // Moon bubble click handling â€” works on ALL screen sizes
    const moonWrap = e.target.closest('.moon-wrap, .today-moon-wrap');
    if (moonWrap) {
      const isOpen = moonWrap.classList.contains('bubble-open');
      if (_activeMoonWrap && _activeMoonWrap !== moonWrap) closeBubble(false);
      isOpen ? closeBubble(true) : openBubble(moonWrap);
      e.stopPropagation();
      return;
    }

    // Close on outside click
    if (_activeMoonWrap && !e.target.closest('.moon-wrap') && !e.target.closest('.today-moon-wrap') && !e.target.closest('.moon-bubble')) {
      closeBubble(true);
    }
  });

  /* â”€â”€ Build moon bubble HTML â€” identical for ALL last-ten days â”€â”€ */
  function makeMoonBubble(text) {
    return `<div class="moon-bubble"><span class="moon-bubble-label">ğŸŒ™ Laylatul-Qadr</span><span class="moon-bubble-text">${text}</span></div>`;
  }

  /* â”€â”€ Moon icon SVG â”€â”€ */
  function moonSvg(fill, size) {
    return `<svg width="${size}" height="${size}" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z" fill="${fill}"/></svg>`;
  }

  /* â”€â”€ Build desktop table â”€â”€ */
  const tbody = document.getElementById('table-body');
  SCHEDULE.forEach(row => {
    const isToday = row.datum === today;
    const tr = document.createElement('tr');
    if (isToday) { tr.classList.add('today'); tr.id = 'today-row-desktop'; }
    const veckaClass = row.vecka === 'Friday' ? 'fredag' : row.vecka === 'Saturday' ? 'lordag' : row.vecka === 'Sunday' ? 'sondag' : '';
    const badge = isToday ? '<span class="today-badge" data-i18n="todayBadge">' + (T[_currentLang].todayBadge || 'Idag') + '</span>' : '';
    const isLastTen = row.day >= 21;
    if (isLastTen) tr.classList.add('last-ten');

    const isOdd = row.day % 2 !== 0;
    const moonFill = isOdd ? '#fff2c0' : 'white';
    const moonClass = isOdd ? 'moon-icon moon-odd' : 'moon-icon';
    const moonText = getMoonText(row);

    const moonCell = isLastTen
      ? `<span class="moon-wrap"><span class="${moonClass}">${moonSvg(moonFill, 12)}</span>${makeMoonBubble(moonText)}</span>`
      : '';

    const hijriDay = row.day - 1;
    const hijriLabel = hijriDay > 0 ? `<div class="hijri-label"><span class="hijri-moon">ğŸŒ™</span>${hijriDay} Ramadan</div>` : '';

    tr.innerHTML = `
      <td class="td-dag">${row.day}</td>
      <td class="td-sidor">${row.sidor}</td>
      <td class="td-surah surah-cell" tabindex="0">
        <div class="surah-names">${row.surahs}</div>
        <div class="tooltip-box">ğŸ“– ${row.tooltip}</div>
      </td>
      <td><span class="imam-chip imam-${row.imam}"><span class="dot"></span>${row.imamLabel}</span></td>
      <td class="td-datum ${isToday ? 'today-date' : ''}">${row.datum}${badge}${hijriLabel}</td>
      <td class="td-audio" id="audio-desktop-${row.datum}"></td>
      <td class="td-moon">${moonCell}</td>
      <td class="td-veckodag ${veckaClass}" data-vecka="${row.vecka}">${getDay(row.vecka)}</td>
    `;
    // Injicera EN sweep-div som tÃ¤cker hela today desktop-raden
    if (isToday) {
      tr.style.position = 'relative';
      const sweepTd = document.createElement('td');
      sweepTd.style.cssText = 'position:absolute;inset:0;padding:0;border:none;pointer-events:none;overflow:hidden;';
      const sweep = document.createElement('div');
      sweep.className = 'td-sweep';
      sweepTd.appendChild(sweep);
      tr.appendChild(sweepTd);
    }
    const cell = tr.querySelector('.surah-cell');
    if (cell) {
      cell.addEventListener('click', (e) => {
        const tip = cell.querySelector('.tooltip-box');
        const isVisible = tip.classList.contains('visible');
        document.querySelectorAll('.tooltip-box.visible').forEach(el => el.classList.remove('visible'));
        if (!isVisible) tip.classList.add('visible');
        e.stopPropagation();
      });
    }
    tbody.appendChild(tr);
  });

  /* â”€â”€ Build mobile cards â”€â”€ */
  const container = document.getElementById('mobile-cards');
  SCHEDULE.forEach(row => {
    const isToday = row.datum === today;
    const card = document.createElement('div');
    const isLastTenM = row.day >= 21;
    card.className = 'day-card-mobile' + (isToday ? ' today' : '') + (isLastTenM ? ' last-ten' : '');
    if (isToday) card.id = 'today-row-mobile';
    const veckaClass = row.vecka === 'Friday' ? 'fredag' : row.vecka === 'Saturday' ? 'lordag' : row.vecka === 'Sunday' ? 'sondag' : '';
    const badge = isToday ? '<span class="today-badge" data-i18n="todayBadge">' + (T[_currentLang].todayBadge || 'Idag') + '</span>' : '';
    const isOdd = row.day % 2 !== 0;
    const moonFill = isOdd ? '#fff2c0' : 'white';
    const moonClass = isOdd ? 'moon-icon moon-odd' : 'moon-icon';
    const moonText = getMoonText(row);

    const moonSpan = isLastTenM
      ? `<span class="moon-wrap" style="margin-left:5px;"><span class="${moonClass}">${moonSvg(moonFill, 11)}</span>${makeMoonBubble(moonText)}</span>`
      : '';

    card.innerHTML = `
      <div class="dcm-top">
        <div class="dcm-dag ${isToday ? 'today-day' : ''}">${row.day}</div>
        <div class="dcm-body">
          <div class="dcm-imam"><span class="imam-chip imam-${row.imam}"><span class="dot"></span>${row.imamLabel}</span></div>
          <div class="dcm-meta">
            <span class="dcm-date">${row.datum}${badge}</span>
            ${row.day > 1 ? `<span class="dcm-hijri"><span class="hijri-moon">ğŸŒ™</span>${row.day - 1} Ramadan</span>` : ''}
            ${moonSpan}
            <span class="dcm-day-label ${veckaClass}" data-vecka="${row.vecka}">${getDay(row.vecka)}</span>
            <span class="dcm-pages">s. ${row.sidor}</span>
          </div>
        </div>
        <div class="dcm-audio-right" id="audio-mobile-${row.datum}"></div>
      </div>
      <div class="dcm-surahs">
        <span class="dcm-surahs-label">${T[_currentLang].surahsDetail || 'Suror â€” tryck fÃ¶r detaljer'}</span>
        ${row.surahs}
        <div class="dcm-tooltip">ğŸ“– ${row.tooltip}</div>
      </div>
    `;
    const surahBox = card.querySelector('.dcm-surahs');
    surahBox.addEventListener('click', (e) => {
      const tip = surahBox.querySelector('.dcm-tooltip');
      const isVisible = tip.classList.contains('visible');
      document.querySelectorAll('.dcm-tooltip.visible').forEach(el => el.classList.remove('visible'));
      if (!isVisible) {
        tip.classList.add('visible');
        setTimeout(() => { surahBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); }, 220);
      }
      e.stopPropagation();
    });
    // Sweep pÃ¥ mobile today-kort
    if (isToday) {
      card.style.position = 'relative';
      card.style.overflow = 'hidden';
      const sweep = document.createElement('div');
      sweep.className = 'td-sweep';
      card.appendChild(sweep);
    }
    container.appendChild(card);
  });

  /* â”€â”€ Today card â”€â”€ */
  if (isAfterRamadan) document.getElementById('eid-card').style.display = 'block';

  const todayData = SCHEDULE.find(r => r.datum === today);
  if (todayData) {
    const d = new Date(today);
    document.getElementById('today-imam-name').textContent = todayData.imamLabel;
    const dateLabel = getDateLabel(d);

    // Hijri datum â€” dag 2 i schemat = 1 Ramadan 1447 (offset -1)
    const hijriDay = todayData.day - 1;
    const hijriStr = hijriDay + ' Ramadan 1447';

    if (todayData.day >= 21) {
      const dateEl = document.getElementById('today-date-label');
      dateEl.textContent = dateLabel;
      const isTodayOdd = todayData.day % 2 !== 0;
      const todayMoonText = getMoonText(todayData);
      const moonFill = isTodayOdd ? '#fff2c0' : 'white';
      const oddClass = isTodayOdd ? ' moon-odd-today' : '';
      const moonWrap = document.createElement('span');
      moonWrap.className = 'today-moon-wrap';
      moonWrap.style.marginLeft = '8px';
      moonWrap.innerHTML = `<span class="today-moon-icon${oddClass}">${moonSvg(moonFill, 12)}</span>${makeMoonBubble(todayMoonText)}`;
      dateEl.parentNode.appendChild(moonWrap);

      // Inline hadith in today-card header
      const headerContent = document.querySelector('.today-card-header-content');
      const hadithDiv = document.createElement('div');
      hadithDiv.className = 'today-hadith-inline';
      hadithDiv.innerHTML = `<span class="hadith-label">ğŸŒ™ Laylatul-Qadr</span>${todayMoonText}`;
      headerContent.appendChild(hadithDiv);
    } else {
      document.getElementById('today-date-label').textContent = dateLabel;
    }

    // LÃ¤gg till Hijri-datum i date-row
    const dateRow = document.querySelector('.today-date-row');
    if (dateRow) {
      const dot = document.createElement('div');
      dot.className = 'today-date-hijri-dot';
      const hijriEl = document.createElement('span');
      hijriEl.className = 'today-date-hijri';
      hijriEl.textContent = hijriStr;
      const arabicEl = document.createElement('span');
      arabicEl.className = 'today-date-hijri-arabic';
      arabicEl.textContent = 'Ø±Ù…Ø¶Ø§Ù†';
      dateRow.appendChild(dot);
      dateRow.appendChild(hijriEl);
      dateRow.appendChild(arabicEl);
    }

    const pagesValEl = document.getElementById('today-pages');
    pagesValEl.dataset.sidor = todayData.sidor;
    pagesValEl.textContent = (T[_currentLang].pagesPrefix || 'Sidor') + ' ' + todayData.sidor;
    document.getElementById('today-surahs-name').textContent = todayData.surahs;
    document.getElementById('today-surahs-ref').textContent = todayData.tooltip;

    // Visa komet-wrapper istÃ¤llet fÃ¶r pulsing
    const todayCard = document.getElementById('today-card');
    const cometWrap = document.getElementById('today-card-comet');
    todayCard.style.display = 'block';
    cometWrap.style.display = 'block';

    let _hasScrolled = false;
    const _scrollGuard = () => { _hasScrolled = true; };
    window.addEventListener('scroll', _scrollGuard, { passive: true, once: true });
    setTimeout(() => {
      window.removeEventListener('scroll', _scrollGuard);
      if (_hasScrolled) return;
      const card = document.getElementById('today-card-comet');
      const targetY = card.getBoundingClientRect().top + window.scrollY - 20;
      const startY = window.scrollY;
      const dist = targetY - startY;
      if (Math.abs(dist) < 10) return;
      const duration = 1100;
      let start = null;
      function easeInOutCubic(t) { return t < 0.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2,3)/2; }
      function step(ts) {
        if (!start) start = ts;
        const elapsed = ts - start;
        const progress = Math.min(elapsed / duration, 1);
        window.scrollTo(0, startY + dist * easeInOutCubic(progress));
        if (progress < 1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }, 3000);
  }

  /* â”€â”€ AUDIO â”€â”€ */
  const audioState = {};
  let _stickyScrollTimer = null;
  let _activeDatum = null;

  const PLAY_SVG  = `<svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor" style="display:block;margin-left:1px"><polygon points="7,3 21,12 7,21"/></svg>`;
  const PAUSE_SVG = `<svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor" style="display:block"><rect x="6" y="3" width="4" height="18"/><rect x="14" y="3" width="4" height="18"/></svg>`;
  const SPIN_SVG  = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" style="animation:spin 0.9s linear infinite;display:block"><path d="M12 2a10 10 0 1 0 10 10"/></svg>`;

  function triggerPlayBtnSpring(btn) {
    btn.classList.remove('springing');
    void btn.offsetWidth;
    btn.classList.add('springing');
    btn.addEventListener('animationend', () => btn.classList.remove('springing'), { once: true });
    const rip = document.createElement('span');
    rip.className = 'play-btn-ripple';
    btn.appendChild(rip);
    rip.addEventListener('animationend', () => rip.remove(), { once: true });
  }

  function updateStickyPlayBtn(isPlaying) {
    const btn = document.getElementById('sticky-play-btn');
    if (!btn) return;
    btn.classList.remove('springing');
    void btn.offsetWidth;
    btn.classList.add('springing');
    btn.addEventListener('animationend', () => btn.classList.remove('springing'), { once: true });
    const rip = document.createElement('span');
    rip.className = 'spm-ripple';
    btn.appendChild(rip);
    rip.addEventListener('animationend', () => rip.remove(), { once: true });
    if (isPlaying) { btn.classList.add('red'); }
    else           { btn.classList.remove('red'); }
  }

  function setBtns(datum, icon, isPlaying) {
    document.querySelectorAll('.play-btn[data-datum="' + datum + '"]').forEach(b => {
      b.innerHTML = icon;
      isPlaying ? b.classList.add('playing') : b.classList.remove('playing');
    });
    if (datum === _activeDatum) updateStickyPlayBtn(isPlaying);
  }

  function createPlayBtn(datum) {
    const btn = document.createElement('button');
    btn.className = 'play-btn';
    btn.setAttribute('data-datum', datum);
    btn.title = 'Spela upp recitation';
    btn.innerHTML = PLAY_SVG;
    btn.addEventListener('click', e => {
      e.stopPropagation();
      triggerPlayBtnSpring(btn);
      toggleAudio(datum);
    });
    return btn;
  }

  function fmtTime(s) {
    if (!isFinite(s)) return '0:00';
    const m = Math.floor(s / 60);
    const sec = Math.floor(s % 60);
    return `${m}:${sec.toString().padStart(2,'0')}`;
  }

  function updatePlayerUI(datum, currentTime, duration) {
    const pct = duration > 0 ? (currentTime / duration) * 100 : 0;
    const cur   = document.getElementById('cur-desktop-'   + datum);
    const dur   = document.getElementById('dur-desktop-'   + datum);
    const fill  = document.getElementById('fill-desktop-'  + datum);
    const thumb = document.getElementById('thumb-desktop-' + datum);
    if (cur)   cur.textContent   = fmtTime(currentTime);
    if (dur)   dur.textContent   = fmtTime(duration);
    if (fill)  fill.style.width  = pct + '%';
    if (thumb) thumb.style.left  = pct + '%';
    const sCur   = document.getElementById('sticky-cur');
    const sDur   = document.getElementById('sticky-dur');
    const sFill  = document.getElementById('sticky-fill');
    const sThumb = document.getElementById('sticky-thumb');
    const mFill  = document.getElementById('mini-fill');
    const mThumb = document.getElementById('mini-thumb');
    if (sCur)   sCur.textContent   = fmtTime(currentTime);
    if (sDur)   sDur.textContent   = fmtTime(duration);
    if (sFill)  sFill.style.width  = pct + '%';
    if (sThumb) sThumb.style.left  = pct + '%';
    if (mFill)  mFill.style.width  = pct + '%';
    if (mThumb) mThumb.style.left  = pct + '%';
    const mTime = document.getElementById('mini-time-display');
    if (mTime) mTime.textContent = fmtTime(currentTime) + ' / ' + fmtTime(duration);
  }

  function showSticky() { if (!_activeDatum) return; const p = document.getElementById('sticky-player'); p.classList.add('visible'); p.classList.remove('mini-mode'); }
  function hideSticky() { const p = document.getElementById('sticky-player'); p.classList.remove('visible'); p.classList.remove('mini-mode'); }
  function miniSticky() { if (!_activeDatum) return; const p = document.getElementById('sticky-player'); p.classList.add('visible'); p.classList.add('mini-mode'); }

  window.addEventListener('scroll', () => {
    if (!_activeDatum) return;
    miniSticky();
    clearTimeout(_stickyScrollTimer);
    _stickyScrollTimer = setTimeout(showSticky, 600);
  }, { passive: true });

  function navigateTo(datum) {
    if (_activeDatum && audioState[_activeDatum]) { audioState[_activeDatum].pause(); setBtns(_activeDatum, PLAY_SVG, false); closePlayer(_activeDatum); }
    toggleAudio(datum);
  }

  function makeDraggableSeek(trackEl, thumbEl) {
    if (!trackEl) return;
    let _dragging = false;
    let _collapseTimer = null;
    const fillEl = trackEl.id === 'sticky-seek'
      ? document.getElementById('sticky-fill')
      : document.getElementById('mini-fill');

    function getPct(clientX) {
      const rect = trackEl.getBoundingClientRect();
      return Math.max(0, Math.min(1, (clientX - rect.left) / rect.width));
    }
    function applyPct(pct) {
      if (thumbEl) thumbEl.style.left = (pct * 100) + '%';
      const mt = trackEl.querySelector('#mini-thumb');
      if (mt) mt.style.left = (pct * 100) + '%';
      if (fillEl) fillEl.style.width = (pct * 100) + '%';
    }
    function expand() { clearTimeout(_collapseTimer); trackEl.classList.add('bar-expanded'); }
    function scheduleCollapse() {
      clearTimeout(_collapseTimer);
      _collapseTimer = setTimeout(() => { if (!_dragging) trackEl.classList.remove('bar-expanded'); }, 800);
    }
    function commitSeek(pct) {
      if (!_activeDatum || !audioState[_activeDatum]) return;
      const audio = audioState[_activeDatum];
      if (!audio.duration) return;
      audio._seekLock = true;
      audio.currentTime = pct * audio.duration;
      updatePlayerUI(_activeDatum, audio.currentTime, audio.duration);
      clearTimeout(audio._seekLockTimer);
      audio._seekLockTimer = setTimeout(() => { audio._seekLock = false; }, 300);
    }
    trackEl.addEventListener('pointerdown', e => {
      if (!_activeDatum || !audioState[_activeDatum]) return;
      const audio = audioState[_activeDatum];
      if (!audio.duration) return;
      _dragging = true; audio._seekLock = true;
      trackEl.setPointerCapture(e.pointerId);
      trackEl.classList.add('seeking');
      if (thumbEl) thumbEl.classList.add('dragging');
      expand(); applyPct(getPct(e.clientX));
      e.stopPropagation(); e.preventDefault();
    }, { passive: false });
    trackEl.addEventListener('pointermove', e => {
      if (!_dragging) return;
      const pct = getPct(e.clientX); applyPct(pct);
      if (_activeDatum && audioState[_activeDatum]?.duration) {
        const scrubTime = pct * audioState[_activeDatum].duration;
        const cur = document.getElementById('sticky-cur');
        const mTime = document.getElementById('mini-time-display');
        if (cur) cur.textContent = fmtTime(scrubTime);
        if (mTime) mTime.textContent = fmtTime(scrubTime) + ' / ' + fmtTime(audioState[_activeDatum].duration);
      }
      e.stopPropagation();
    });
    trackEl.addEventListener('pointerup', e => {
      if (!_dragging) return;
      _dragging = false; trackEl.classList.remove('seeking');
      if (thumbEl) thumbEl.classList.remove('dragging');
      trackEl.releasePointerCapture(e.pointerId);
      commitSeek(getPct(e.clientX)); scheduleCollapse();
      e.stopPropagation();
    });
    trackEl.addEventListener('pointercancel', () => {
      _dragging = false; trackEl.classList.remove('seeking');
      if (thumbEl) thumbEl.classList.remove('dragging'); scheduleCollapse();
    });
    trackEl.addEventListener('pointerleave', () => { if (!_dragging) scheduleCollapse(); });
    trackEl.addEventListener('pointerenter', () => { expand(); });
  }

  document.addEventListener('DOMContentLoaded', function() {
    const seekEl  = document.getElementById('sticky-seek');
    const thumbEl = document.getElementById('sticky-thumb');
    makeDraggableSeek(seekEl, thumbEl);
    const miniTrack = document.querySelector('.mini-bar-track');
    const miniThumb = document.getElementById('mini-thumb');
    if (miniTrack) makeDraggableSeek(miniTrack, miniThumb);

    const muteBtn = document.getElementById('sticky-mute');
    if (muteBtn) muteBtn.addEventListener('click', e => {
      const isMuted = muteBtn.classList.toggle('muted');
      Object.values(audioState).forEach(a => { a.muted = isMuted; });
      window._globalMuted = isMuted;
      document.getElementById('mute-icon-on').style.display  = isMuted ? 'none' : '';
      document.getElementById('mute-icon-off').style.display = isMuted ? ''     : 'none';
      muteBtn.style.opacity = isMuted ? '1' : '';
      e.stopPropagation();
    });

    const playBtn = document.getElementById('sticky-play-btn');
    if (playBtn) playBtn.addEventListener('click', e => { if (!_activeDatum) return; toggleAudio(_activeDatum); e.stopPropagation(); });
    const prevBtn = document.getElementById('sticky-prev');
    if (prevBtn) prevBtn.addEventListener('click', e => {
      if (!_activeDatum) return;
      const idx = SCHEDULE.findIndex(r => r.datum === _activeDatum);
      if (idx > 0 && audioUrls[SCHEDULE[idx-1].datum]) navigateTo(SCHEDULE[idx-1].datum);
      e.stopPropagation();
    });
    const nextBtn = document.getElementById('sticky-next');
    if (nextBtn) nextBtn.addEventListener('click', e => {
      if (!_activeDatum) return;
      const idx = SCHEDULE.findIndex(r => r.datum === _activeDatum);
      if (idx < SCHEDULE.length-1 && audioUrls[SCHEDULE[idx+1].datum]) navigateTo(SCHEDULE[idx+1].datum);
      e.stopPropagation();
    });
  });

  function updateStickyMarquee(row) {
    const wrap  = document.getElementById('sticky-marquee-wrap');
    const inner = document.getElementById('sticky-marquee-inner');
    const text1 = document.getElementById('sticky-marquee-text');
    const text2 = document.getElementById('sticky-marquee-text2');
    if (!wrap || !inner || !text1 || !text2) return;
    const txt = row.surahs + '  Â·  ' + row.tooltip;
    text1.textContent = txt; text2.textContent = txt;
    text2.style.display = 'none';
    inner.classList.remove('scrolling'); inner.style.removeProperty('--marquee-dur'); wrap.classList.remove('fading');
    const ruler = document.createElement('span');
    ruler.style.cssText = 'position:fixed;top:-9999px;left:-9999px;white-space:nowrap;font-size:.68rem;visibility:hidden;pointer-events:none;';
    ruler.textContent = txt; document.body.appendChild(ruler);
    const playerEl = document.getElementById('sticky-player');
    const playerW = playerEl ? playerEl.getBoundingClientRect().width : window.innerWidth;
    const imamEl  = document.getElementById('sticky-imam-label');
    const dayEl   = document.getElementById('sticky-day-label');
    const timesEl = document.querySelector('.sticky-times');
    const imamW   = imamEl  ? imamEl.getBoundingClientRect().width  : 80;
    const dayW    = dayEl   ? dayEl.getBoundingClientRect().width   : 80;
    const timesW  = timesEl ? timesEl.getBoundingClientRect().width : 80;
    const gaps    = 8 * 3 + 32;
    const availW  = Math.max(60, playerW - imamW - dayW - timesW - gaps);
    const textW = ruler.getBoundingClientRect().width;
    document.body.removeChild(ruler);
    if (textW > availW) {
      text2.style.display = '';
      wrap.classList.add('fading');
      const totalW = textW + 48;
      const dur = Math.max(8, Math.round(totalW / 65));
      inner.style.setProperty('--marquee-dur', dur + 's');
      inner.classList.add('scrolling');
    }
  }

  function updateStickyControls() {
    if (!_activeDatum) return;
    const idx = SCHEDULE.findIndex(r => r.datum === _activeDatum);
    const prevBtn = document.getElementById('sticky-prev');
    const nextBtn = document.getElementById('sticky-next');
    const row = SCHEDULE[idx];
    if (prevBtn) prevBtn.disabled = idx <= 0 || !audioUrls[SCHEDULE[idx-1]?.datum];
    if (nextBtn) nextBtn.disabled = idx >= SCHEDULE.length-1 || !audioUrls[SCHEDULE[idx+1]?.datum];
    const imamEl  = document.getElementById('sticky-imam-label');
    const dayEl   = document.getElementById('sticky-day-label');
    const miniName = document.getElementById('mini-name-display');
    if (imamEl  && row) imamEl.textContent  = row.imamLabel;
    if (dayEl   && row) dayEl.textContent   = (T[_currentLang].night || 'Natt') + ' ' + row.day + ' Â· ' + getDay(row.vecka);
    if (miniName && row) miniName.textContent = row.imamLabel + ' Â· ' + (T[_currentLang].night || 'Natt') + ' ' + row.day;
    if (row) updateStickyMarquee(row);
  }

  function openPlayer(datum) { _activeDatum = datum; updateStickyControls(); updateStickyPlayBtn(true); setTimeout(showSticky, 200); }
  function closePlayer(datum) { _activeDatum = null; hideSticky(); updateStickyPlayBtn(false); }

  function toggleAudio(datum) {
    Object.keys(audioState).forEach(d => {
      if (d !== datum && audioState[d] && !audioState[d].paused) { audioState[d].pause(); closePlayer(d); setBtns(d, PLAY_SVG, false); }
    });
    if (!audioState[datum]) {
      const a = new Audio();
      a.muted = !!window._globalMuted;
      a.src = audioUrls[datum];
      a.addEventListener('waiting',  () => setBtns(datum, SPIN_SVG, true));
      a.addEventListener('playing',  () => { setBtns(datum, PAUSE_SVG, true); openPlayer(datum); });
      a.addEventListener('timeupdate', () => { if (!a._seekLock) updatePlayerUI(datum, a.currentTime, a.duration); });
      a.addEventListener('loadedmetadata', () => updatePlayerUI(datum, a.currentTime, a.duration));
      a.addEventListener('ended', () => { closePlayer(datum); setBtns(datum, PLAY_SVG, false); updatePlayerUI(datum, 0, a.duration); });
      audioState[datum] = a;
    }
    const audio = audioState[datum];
    if (audio.paused) {
      setBtns(datum, SPIN_SVG, true);
      audio.play().then(() => {}).catch(err => { console.warn('Play failed:', err); setBtns(datum, PLAY_SVG, false); });
    } else {
      audio.pause();
      setBtns(datum, PLAY_SVG, false);
      updateStickyPlayBtn(false);
    }
  }

  function injectPlayButtons(datum) {
    ['audio-desktop-' + datum, 'audio-mobile-' + datum].forEach(id => {
      const cell = document.getElementById(id);
      if (cell && !cell.querySelector('.play-btn')) cell.appendChild(createPlayBtn(datum));
    });
  }

  const basePath = window.location.pathname.split('/').slice(0, -1).join('/');
  const audioUrls = {};
  SCHEDULE.forEach(row => {
    const url = basePath + '/' + row.datum + '.mp3';
    audioUrls[row.datum] = url;
    fetch(url, { method: 'HEAD' })
      .then(res => { if (res.ok || res.status === 206) injectPlayButtons(row.datum); })
      .catch(() => { fetch(url).then(res => { if (res.ok) injectPlayButtons(row.datum); }).catch(() => {}); });
  });

  function applyLang(lang) {
    _currentLang = lang;
    const t = T[lang];
    document.dir = lang === 'ar' ? 'rtl' : 'ltr';

    // All data-i18n elements
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.dataset.i18n;
      if (t[key] !== undefined) el.textContent = t[key];
    });

    // Mobile cards surah label (dynamically rendered)
    document.querySelectorAll('.dcm-surahs-label').forEach(el => {
      el.textContent = t.surahsDetail;
    });

    // Header title + year
    const h1 = document.getElementById('header-h1');
    if (h1 && t.headerTitle) {
      const yearSpan = h1.querySelector('span');
      h1.childNodes[0].textContent = '';
      h1.innerHTML = t.headerTitle + '<br><span style="font-size:0.65em;letter-spacing:0.04em;opacity:0.85;">' + t.headerYear + '</span>';
    }

    // Today-card date label â€” re-render with correct language
    const dateLabelEl = document.getElementById('today-date-label');
    if (dateLabelEl && dateLabelEl.textContent && dateLabelEl.textContent !== 'â€”') {
      const todayRow = SCHEDULE.find(r => r.datum === today);
      if (todayRow) dateLabelEl.textContent = getDateLabel(new Date(today));
    }

    // Today-pages prefix â€” update if already rendered
    const pagesEl = document.getElementById('today-pages');
    if (pagesEl && pagesEl.dataset.sidor) {
      pagesEl.textContent = (t.pagesPrefix || 'Sidor') + ' ' + pagesEl.dataset.sidor;
    }

    // Theme toggle label â€” respect current theme
    const toggleLabel = document.getElementById('toggle-label');
    if (toggleLabel && t.lightMode && t.darkMode) {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      toggleLabel.innerHTML = isDark ? t.darkMode : t.lightMode;
    }

    // Today badge in table/cards
    document.querySelectorAll('.today-badge').forEach(el => {
      el.textContent = t.todayBadge || 'Idag';
    });

    // Weekday names in table and mobile cards
    document.querySelectorAll('[data-vecka]').forEach(el => {
      el.textContent = getDay(el.dataset.vecka);
    });

    // Today-card inline hadith
    const hadithInline = document.querySelector('.today-hadith-inline');
    if (hadithInline) {
      const todayRow = SCHEDULE.find(r => r.datum === today);
      if (todayRow) {
        const key = todayRow.moonText || DEFAULT_MOON_TEXT;
        const newText = (t.hadith && t.hadith[key]) ? t.hadith[key] : T['sv'].hadith[key];
        const label = hadithInline.querySelector('.hadith-label');
        hadithInline.innerHTML = (label ? label.outerHTML : '<span class="hadith-label">ğŸŒ™ Laylatul-Qadr</span>') + newText;
      }
    }

    // Moon bubble hadiths (desktop table + mobile cards)
    document.querySelectorAll('.moon-bubble').forEach(bubble => {
      const tr   = bubble.closest('tr');
      const card = bubble.closest('.day-card-mobile');
      let row = null;
      if (tr) {
        const dayNum = parseInt(tr.querySelector('.td-dag')?.textContent);
        if (!isNaN(dayNum)) row = SCHEDULE.find(r => r.day === dayNum);
      } else if (card) {
        const dayNum = parseInt(card.querySelector('.dcm-dag')?.textContent);
        if (!isNaN(dayNum)) row = SCHEDULE.find(r => r.day === dayNum);
      }
      if (!row) return;
      const key = row.moonText || DEFAULT_MOON_TEXT;
      const newText = (t.hadith && t.hadith[key]) ? t.hadith[key] : T['sv'].hadith[key];
      // Preserve inner structure (label span) if present, replace only text
      const textEl = bubble.querySelector('.moon-bubble-text');
      if (textEl) textEl.textContent = newText;
    });

    // Isha countdown live labels (only if not already done)
    const ishaLabelEl = document.getElementById('isha-label');
    if (ishaLabelEl && ishaLabelEl.textContent !== t.ishaDoneLabel) {
      ishaLabelEl.textContent = t.ishaLabel;
    }

    localStorage.setItem(LANG_KEY, lang);
  }

  /* â”€â”€ Lang dropdown toggle â”€â”€ */
  document.getElementById('lang-trigger').addEventListener('click', () => {
    const wrap     = document.getElementById('lang-wrap');
    const dropdown = document.getElementById('lang-dropdown');
    const isOpen   = wrap.classList.toggle('open');
    if (isOpen && window.innerWidth <= 640) {
      // Positionera dropdown med fixed sÃ¥ den inte klipps av header overflow
      const triggerRect = document.getElementById('lang-trigger').getBoundingClientRect();
      dropdown.style.position = 'fixed';
      dropdown.style.top      = (triggerRect.bottom + 8) + 'px';
      dropdown.style.left     = triggerRect.left + 'px';
    } else {
      dropdown.style.position = '';
      dropdown.style.top      = '';
      dropdown.style.left     = '';
    }
  });
  document.addEventListener('click', e => {
    if (!e.target.closest('#lang-wrap')) {
      document.getElementById('lang-wrap').classList.remove('open');
    }
  });
  document.querySelectorAll('.lang-item').forEach(item => {
    item.addEventListener('click', () => {
      document.querySelectorAll('.lang-item').forEach(i => i.classList.remove('active'));
      item.classList.add('active');
      document.getElementById('lang-flag').textContent = item.dataset.flag;
      document.getElementById('lang-code').textContent = item.dataset.code;
      document.getElementById('lang-wrap').classList.remove('open');
      applyLang(item.dataset.lang);
    });
  });


  /* â”€â”€ Instagram Story canvas export â”€â”€ */
  function exportInstagramCard() {
    const todayRow = SCHEDULE.find(r => r.datum === today);
    if (!todayRow) return;

    // VÃ¤nta pÃ¥ att Google Fonts Ã¤r laddade â€” annars ritar canvas med system-font
    // document.fonts.ready Ã¤r en Promise som lÃ¶ser sig direkt om fonts redan Ã¤r klara
    document.fonts.ready.then(() => _drawAndExport(todayRow));
  }

  function _drawAndExport(todayRow) {
    const t = T[_currentLang];
    const W = 1080, H = 1350;
    const canvas = document.getElementById('img-canvas');
    canvas.width  = W;
    canvas.height = H;
    const ctx = canvas.getContext('2d');

    // â”€â”€ HjÃ¤lp: roundRect med fallback fÃ¶r gamla iOS Safari â”€â”€
    function rrect(x, y, w, h, r) {
      if (ctx.roundRect) {
        ctx.roundRect(x, y, w, h, r);
      } else {
        ctx.beginPath();
        ctx.moveTo(x + r, y);
        ctx.lineTo(x + w - r, y);
        ctx.quadraticCurveTo(x + w, y, x + w, y + r);
        ctx.lineTo(x + w, y + h - r);
        ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
        ctx.lineTo(x + r, y + h);
        ctx.quadraticCurveTo(x, y + h, x, y + h - r);
        ctx.lineTo(x, y + r);
        ctx.quadraticCurveTo(x, y, x + r, y);
        ctx.closePath();
      }
    }

    // â”€â”€ HjÃ¤lp: radbryt text â”€â”€
    function wrapText(text, x, y, maxWidth, lineHeight) {
      const words = text.split(' ');
      let line = '';
      for (const word of words) {
        const test = line ? line + ' ' + word : word;
        if (ctx.measureText(test).width > maxWidth && line) {
          ctx.fillText(line, x, y);
          line = word;
          y += lineHeight;
        } else { line = test; }
      }
      if (line) ctx.fillText(line, x, y);
      return y;
    }

    // â”€â”€ Bakgrund â”€â”€
    const bg = ctx.createLinearGradient(0, 0, W * 0.3, H);
    bg.addColorStop(0,   '#0c2018');
    bg.addColorStop(0.5, '#152e24');
    bg.addColorStop(1,   '#1e4a3c');
    ctx.fillStyle = bg;
    rrect(0, 0, W, H, 0);
    ctx.fill();

    // Guld glow uppe hÃ¶ger
    const glow = ctx.createRadialGradient(W * 0.82, H * 0.06, 0, W * 0.82, H * 0.06, W * 0.6);
    glow.addColorStop(0,   'rgba(201,168,76,0.18)');
    glow.addColorStop(0.5, 'rgba(201,168,76,0.06)');
    glow.addColorStop(1,   'rgba(201,168,76,0)');
    ctx.fillStyle = glow;
    ctx.fillRect(0, 0, W, H);

    // Subtil grÃ¶n glow nere vÃ¤nster
    const glow2 = ctx.createRadialGradient(W * 0.15, H * 0.88, 0, W * 0.15, H * 0.88, W * 0.5);
    glow2.addColorStop(0,   'rgba(36,100,93,0.22)');
    glow2.addColorStop(1,   'rgba(36,100,93,0)');
    ctx.fillStyle = glow2;
    ctx.fillRect(0, 0, W, H);

    // â”€â”€ Ornament uppe â”€â”€
    const OY = 148;
    ctx.strokeStyle = 'rgba(201,168,76,0.40)';
    ctx.lineWidth = 2;
    // VÃ¤nster linje
    ctx.beginPath(); ctx.moveTo(100, OY); ctx.lineTo(W/2 - 34, OY); ctx.stroke();
    // HÃ¶ger linje
    ctx.beginPath(); ctx.moveTo(W/2 + 34, OY); ctx.lineTo(W - 100, OY); ctx.stroke();
    // Prickar
    [W/2 - 16, W/2 + 16].forEach(px => {
      ctx.beginPath(); ctx.arc(px, OY, 3, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(201,168,76,0.55)'; ctx.fill();
    });
    // Diamond mitt
    ctx.save();
    ctx.translate(W/2, OY); ctx.rotate(Math.PI/4);
    ctx.fillStyle = 'rgba(201,168,76,0.90)';
    ctx.fillRect(-9, -9, 18, 18);
    ctx.restore();

    // â”€â”€ Mosque badge uppe â”€â”€
    ctx.font = '500 38px "DM Sans", sans-serif';
    ctx.fillStyle = 'rgba(201,168,76,0.60)';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText('ğŸ•Œ  KÃ¤mpingehallen', W/2, 230);

    // â”€â”€ Ramadan / natt-label â”€â”€
    const nightLabel = (t.night || 'Natt') + ' ' + todayRow.day;
    const hijriDay   = todayRow.day - 1;
    ctx.font = '400 34px "DM Sans", sans-serif';
    ctx.fillStyle = 'rgba(255,255,255,0.38)';
    const hijriPart = hijriDay > 0 ? '  Â·  ' + hijriDay + ' Ø±Ù…Ø¶Ø§Ù† 1447' : '  Â·  Ramadan 1447';
    ctx.fillText(nightLabel + hijriPart, W/2, 290);

    // â”€â”€ "Dagens Imam" pill â”€â”€
    const pillLabel = (t.badgeText || 'Dagens Imam').toUpperCase();
    ctx.font = '600 26px "DM Sans", sans-serif';
    const pillW = ctx.measureText(pillLabel).width + 60;
    const pillH = 48, pillX = W/2 - pillW/2, pillY = 340;
    ctx.fillStyle = 'rgba(201,168,76,0.12)';
    rrect(pillX, pillY, pillW, pillH, pillH/2);
    ctx.fill();
    ctx.strokeStyle = 'rgba(201,168,76,0.35)';
    ctx.lineWidth = 1.5;
    rrect(pillX, pillY, pillW, pillH, pillH/2);
    ctx.stroke();
    // Prick
    ctx.beginPath(); ctx.arc(pillX + 24, pillY + pillH/2, 5, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(201,168,76,0.8)'; ctx.fill();
    ctx.fillStyle = 'rgba(201,168,76,0.85)';
    ctx.textAlign = 'center';
    ctx.fillText(pillLabel, W/2 + 6, pillY + 32);

    // â”€â”€ Imam-namn â”€â”€
    ctx.fillStyle = '#ffffff';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    const imamName = todayRow.imamLabel;
    // VÃ¤lj storlek dynamiskt baserat pÃ¥ lÃ¤ngd
    const fontSize = imamName.length > 18 ? 96 : imamName.length > 14 ? 110 : 128;
    ctx.font = '600 ' + fontSize + 'px "Cormorant Garamond", serif';
    const nameMaxW = W - 120;
    if (ctx.measureText(imamName).width > nameMaxW) {
      const parts = imamName.split(' ');
      const mid = Math.ceil(parts.length / 2);
      ctx.fillText(parts.slice(0, mid).join(' '), W/2, 530);
      ctx.fillText(parts.slice(mid).join(' '),    W/2, 530 + fontSize + 12);
    } else {
      ctx.fillText(imamName, W/2, 560);
    }

    // â”€â”€ Guld-divider â”€â”€
    const divY = 700;
    const dg = ctx.createLinearGradient(W/2 - 200, 0, W/2 + 200, 0);
    dg.addColorStop(0,   'rgba(201,168,76,0)');
    dg.addColorStop(0.3, 'rgba(201,168,76,0.5)');
    dg.addColorStop(0.5, 'rgba(232,201,122,0.9)');
    dg.addColorStop(0.7, 'rgba(201,168,76,0.5)');
    dg.addColorStop(1,   'rgba(201,168,76,0)');
    ctx.strokeStyle = dg;
    ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(W/2 - 200, divY); ctx.lineTo(W/2 + 200, divY); ctx.stroke();
    // Diamond i mitten av divider
    ctx.save();
    ctx.translate(W/2, divY); ctx.rotate(Math.PI/4);
    ctx.fillStyle = 'rgba(201,168,76,0.7)';
    ctx.fillRect(-6, -6, 12, 12);
    ctx.restore();

    // â”€â”€ Datum â”€â”€
    ctx.font = '400 42px "DM Sans", sans-serif';
    ctx.fillStyle = 'rgba(255,255,255,0.45)';
    ctx.textAlign = 'center';
    ctx.fillText(getDateLabel(new Date(today)), W/2, 790);

    // â”€â”€ Info-grid: Sidor | Suror â”€â”€
    const gridY = 860, gridX1 = 100, gridX2 = W/2 + 40, gridW = W/2 - 140;

    // Labels
    ctx.font = '600 28px "DM Sans", sans-serif';
    ctx.fillStyle = 'rgba(201,168,76,0.65)';
    ctx.textAlign = 'left';
    ctx.letterSpacing = '0.1em';
    ctx.fillText((t.thPages  || 'SIDOR').toUpperCase(),  gridX1, gridY);
    ctx.fillText((t.thSurahs || 'SUROR').toUpperCase(), gridX2, gridY);
    ctx.letterSpacing = '0';

    // Vertikal separator
    ctx.strokeStyle = 'rgba(255,255,255,0.08)';
    ctx.lineWidth = 1;
    ctx.beginPath(); ctx.moveTo(W/2 + 14, gridY - 30); ctx.lineTo(W/2 + 14, gridY + 280); ctx.stroke();

    // Sidor-vÃ¤rde
    ctx.font = '600 64px "Cormorant Garamond", serif';
    ctx.fillStyle = '#ffffff';
    ctx.fillText(todayRow.sidor, gridX1, gridY + 76);

    // Suror â€” radbryt
    ctx.font = '400 32px "DM Sans", sans-serif';
    ctx.fillStyle = 'rgba(255,255,255,0.72)';
    const surahList = todayRow.surahs.split(', ');
    let sLine = '', sY = gridY + 46, sMaxW = gridW;
    for (let i = 0; i < surahList.length; i++) {
      const sep = i < surahList.length - 1 ? ', ' : '';
      const test = sLine ? sLine + ', ' + surahList[i] : surahList[i];
      if (ctx.measureText(test + sep).width > sMaxW && sLine) {
        ctx.fillText(sLine + ',', gridX2, sY);
        sLine = surahList[i]; sY += 42;
        if (sY > gridY + 280) { ctx.fillText('â€¦', gridX2, sY); break; }
      } else { sLine = test; }
    }
    if (sLine && sY <= gridY + 280) ctx.fillText(sLine, gridX2, sY);

    // â”€â”€ Ornament nere â”€â”€
    const botOY = H - 200;
    ctx.strokeStyle = 'rgba(201,168,76,0.20)';
    ctx.lineWidth = 1;
    ctx.beginPath(); ctx.moveTo(100, botOY); ctx.lineTo(W - 100, botOY); ctx.stroke();

    // â”€â”€ Branding â”€â”€
    ctx.font = '500 32px "DM Sans", sans-serif';
    ctx.fillStyle = 'rgba(255,255,255,0.30)';
    ctx.textAlign = 'center';
    ctx.fillText('Ramadan 2026  Â·  tarawih.se', W/2, botOY + 54);
    ctx.font = '500 30px "DM Sans", sans-serif';
    ctx.fillStyle = 'rgba(201,168,76,0.50)';
    ctx.fillText('@sverigesimamer', W/2, botOY + 100);

    // â”€â”€ Exportera: native share pÃ¥ mobil, nedladdning pÃ¥ desktop â”€â”€
    canvas.toBlob(blob => {
      const fname = 'tarawih-natt-' + todayRow.day + '.png';
      const file  = new File([blob], fname, { type: 'image/png' });
      if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
        navigator.share({ files: [file], title: 'Tarawih ' + nightLabel }).catch(() => {});
      } else {
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = fname;
        a.click();
        setTimeout(() => URL.revokeObjectURL(a.href), 3000);
      }
    }, 'image/png');
  }

  /* â”€â”€ Share â”€â”€ */
  function handleShare() {
    const t = T[_currentLang];
    const btn = document.getElementById('share-btn');
    const toast = document.getElementById('share-toast');
    if (navigator.share) {
      navigator.share({ title: 'Tarawih Schema â€” KÃ¤mpingehallen', url: window.location.href });
      return;
    }
    navigator.clipboard.writeText(window.location.href).catch(() => {});
    btn.classList.add('share-copied');
    toast.textContent = t.shareToast;
    toast.classList.add('visible');
    setTimeout(() => {
      btn.classList.remove('share-copied');
      toast.classList.remove('visible');
    }, 2200);
  }

  /* â”€â”€ Detect or restore language â”€â”€
     Priority: 1) localStorage  2) browser language  3) 'sv'
  â”€â”€ */
  (function() {
    // Map browser language codes â†’ our supported keys
    const LANG_MAP = {
      'sv': 'sv', 'sv-SE': 'sv', 'sv-FI': 'sv',
      'ar': 'ar', 'ar-SA': 'ar', 'ar-EG': 'ar', 'ar-AE': 'ar',
        'ar-IQ': 'ar', 'ar-MA': 'ar', 'ar-DZ': 'ar', 'ar-TN': 'ar',
        'ar-LY': 'ar', 'ar-JO': 'ar', 'ar-LB': 'ar', 'ar-SY': 'ar',
        'ar-YE': 'ar', 'ar-KW': 'ar', 'ar-QA': 'ar', 'ar-BH': 'ar',
        'ar-OM': 'ar', 'ar-SD': 'ar', 'ar-SO': 'ar',
      'en': 'en', 'en-US': 'en', 'en-GB': 'en', 'en-AU': 'en',
        'en-CA': 'en', 'en-NZ': 'en', 'en-ZA': 'en',
      'tr': 'tr', 'tr-TR': 'tr', 'tr-CY': 'tr',
      'so': 'so', 'so-SO': 'so', 'so-ET': 'so', 'so-KE': 'so',
    };

    function detectBrowserLang() {
      const langs = navigator.languages || [navigator.language || 'sv'];
      for (const l of langs) {
        if (LANG_MAP[l])            return LANG_MAP[l];
        const base = l.split('-')[0];
        if (LANG_MAP[base])         return LANG_MAP[base];
      }
      return 'sv';
    }

    const lang = localStorage.getItem(LANG_KEY) || detectBrowserLang();
    // Always activate the matching UI item
    const item = document.querySelector('.lang-item[data-lang="' + lang + '"]');
    if (item) {
      document.querySelectorAll('.lang-item').forEach(i => i.classList.remove('active'));
      item.classList.add('active');
      document.getElementById('lang-flag').textContent = item.dataset.flag;
      document.getElementById('lang-code').textContent = item.dataset.code;
    }
    applyLang(lang);
    // Save detected lang so next visit skips detection
    if (!localStorage.getItem(LANG_KEY)) localStorage.setItem(LANG_KEY, lang);
  })();

  /* â”€â”€ ISHA COUNTDOWN â”€â”€ */
  const ISHA_TIMES = {
    '2026-02-17':'18:56','2026-02-18':'18:58','2026-02-19':'19:00',
    '2026-02-20':'19:03','2026-02-21':'19:05','2026-02-22':'19:07',
    '2026-02-23':'19:10','2026-02-24':'19:12','2026-02-25':'19:14',
    '2026-02-26':'19:17','2026-02-27':'19:19','2026-02-28':'19:22',
    '2026-03-01':'19:24','2026-03-02':'19:27','2026-03-03':'19:29',
    '2026-03-04':'19:32','2026-03-05':'19:34','2026-03-06':'19:37',
    '2026-03-07':'19:39','2026-03-08':'19:42','2026-03-09':'19:45',
    '2026-03-10':'19:47','2026-03-11':'19:50','2026-03-12':'19:53',
    '2026-03-13':'19:55','2026-03-14':'19:58','2026-03-15':'20:01',
    '2026-03-16':'20:04','2026-03-17':'20:07','2026-03-18':'20:09',
  };

  function padZ(n) { return String(n).padStart(2,'0'); }
  function getDateKey(d) { const y=d.getFullYear(),m=padZ(d.getMonth()+1),day=padZ(d.getDate()); return y+'-'+m+'-'+day; }

  function startIshaCountdown() {
    const countdownEl  = document.getElementById('isha-countdown');
    const timerEl      = document.getElementById('isha-timer');
    const timerDoneEl  = document.getElementById('isha-timer-done');
    const infoEl       = document.getElementById('isha-time-info');
    const labelEl      = document.getElementById('isha-label');
    const notifBtn     = document.getElementById('notif-btn');
    const notifLabel   = document.getElementById('notif-btn-label');
    if (!countdownEl) return;
    countdownEl.style.display = 'block';
    let _hasTriggeredDone = false;

    function updateNotifBtn() {
      if (!('Notification' in window)) { notifBtn.style.display = 'none'; return; }
      if (Notification.permission === 'granted') { notifBtn.classList.add('granted'); notifLabel.textContent = T[_currentLang].notifGranted || 'Notis aktiv'; notifBtn.querySelector('svg').style.stroke = '#1d7a4e'; }
      else if (Notification.permission === 'denied') { notifBtn.classList.add('denied'); notifLabel.textContent = T[_currentLang].notifDenied || 'Notis blockerad'; }
    }
    updateNotifBtn();
    notifBtn.addEventListener('click', async () => {
      if (!('Notification' in window)) return;
      if (Notification.permission === 'default') { await Notification.requestPermission(); updateNotifBtn(); }
    });

    function fireIshaNotification(ishaStr) {
      if (!('Notification' in window) || Notification.permission !== 'granted') return;
      new Notification(T[_currentLang].notifTitle, { body: T[_currentLang].notifBody + ishaStr, icon: '/favicon.ico', badge: '/favicon.ico', tag: 'isha-prayer', renotify: false, silent: false });
    }

    function triggerDoneAnimation(ishaStr) {
      if (_hasTriggeredDone) return;
      _hasTriggeredDone = true;
      timerEl.classList.add('fading-out');
      timerDoneEl.classList.add('fading-in');
      countdownEl.classList.add('isha-done');
      countdownEl.classList.add('isha-pulsing');
      countdownEl.addEventListener('animationend', () => { countdownEl.classList.remove('isha-pulsing'); }, { once: true });
      fireIshaNotification(ishaStr);
    }

    function tick() {
      const now = new Date();
      const todayKey = getDateKey(now);
      const nowSec = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
      const ishaStr = ISHA_TIMES[todayKey];
      if (!ishaStr) { timerEl.textContent = '--:--:--'; labelEl.textContent = T[_currentLang].ishaLabel; infoEl.textContent = ''; return; }
      const [ishaH, ishaM] = ishaStr.split(':').map(Number);
      const ishaSec = ishaH * 3600 + ishaM * 60;

      // Progress ring â€” fÃ¶nster frÃ¥n 16:00 till Isha
      const ringEl = document.getElementById('isha-ring-fill');
      const CIRCUMFERENCE = 2 * Math.PI * 23; // 144.51
      if (ringEl) {
        const windowStart = 16 * 3600;
        const windowLen   = ishaSec - windowStart;
        const elapsed     = Math.max(0, nowSec - windowStart);
        const progress    = Math.min(1, elapsed / windowLen);
        ringEl.style.strokeDashoffset = CIRCUMFERENCE * (1 - progress);
      }

      if (nowSec >= ishaSec) {
        triggerDoneAnimation(ishaStr);
        labelEl.textContent = T[_currentLang].ishaDoneLabel;
        infoEl.textContent  = T[_currentLang].ishaDone + ishaStr;
        if (ringEl) { ringEl.style.stroke = '#3dba7e'; ringEl.style.strokeDashoffset = '0'; }
      } else {
        labelEl.textContent = T[_currentLang].ishaLabel;
        infoEl.textContent  = T[_currentLang].ishaPrefix + ishaStr;
        const diff = ishaSec - nowSec;
        const h = Math.floor(diff / 3600), m = Math.floor((diff % 3600) / 60), s = diff % 60;
        timerEl.textContent = padZ(h) + ':' + padZ(m) + ':' + padZ(s);
        // Guld-ton nÃ¤r < 30 min kvar
        if (ringEl && diff < 1800) {
          timerEl.style.color = 'var(--gold)';
          ringEl.style.stroke = 'rgba(201,168,76,0.9)';
        } else if (ringEl) {
          timerEl.style.color = '';
          ringEl.style.stroke = '';
        }
      }
    }
    tick();
    setInterval(tick, 1000);
  }
  startIshaCountdown();

  /* â”€â”€ THEME TOGGLE â”€â”€ */
  const THEME_KEY = 'tarawih-theme';
  const _root = document.documentElement;

  function _applyTheme(theme) {
    _root.setAttribute('data-theme', theme);
    const label    = document.getElementById('toggle-label');
    const wavePath = document.getElementById('wave-path');
    if (theme === 'dark') {
      if (label)    label.innerHTML = (T[_currentLang] && T[_currentLang].darkMode) ? T[_currentLang].darkMode : 'MÃ–RKT<br>LÃ„GE';
      if (wavePath) wavePath.setAttribute('fill', '#131f1b');
    } else {
      if (label)    label.innerHTML = (T[_currentLang] && T[_currentLang].lightMode) ? T[_currentLang].lightMode : 'LJUST<br>LÃ„GE';
      if (wavePath) wavePath.setAttribute('fill', '#24645d');
    }
    localStorage.setItem(THEME_KEY, theme);
  }

  function toggleTheme() {
    const next = _root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
    _applyTheme(next);
  }

  (function() {
    const saved = localStorage.getItem(THEME_KEY);
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    _applyTheme(saved || (prefersDark ? 'dark' : 'light'));
  })();

  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
    if (!localStorage.getItem(THEME_KEY)) _applyTheme(e.matches ? 'dark' : 'light');
  });

  /* â”€â”€ FILTER â”€â”€ */
  let activeFilter = null;
  function toggleFilter(imam) {
    activeFilter = (activeFilter === imam) ? null : imam;
    applyFilter();
    if (activeFilter) {
      setTimeout(() => {
        const target = window.innerWidth <= 640 ? document.getElementById('mobile-cards') : document.querySelector('.table-wrap');
        if (target) { const y = target.getBoundingClientRect().top + window.scrollY - 90; window.scrollTo({ top: y, behavior: 'smooth' }); }
      }, 80);
    }
  }

  function applyFilter() {
    document.body.style.width = document.body.offsetWidth + 'px';
    document.body.style.overflowY = 'hidden';
    const imamColors = { abdurrahman:'rgba(232,99,10,0.5)', saed:'rgba(212,168,0,0.5)', noor:'rgba(41,128,185,0.5)', abdul:'rgba(44,44,44,0.5)', mohammed:'rgba(33,145,80,0.5)', yacquub:'rgba(125,58,172,0.5)', ibrahim:'rgba(26,58,107,0.5)', abdelsalam:'rgba(123,63,0,0.5)', hatem:'rgba(45,106,79,0.5)' };
    document.querySelectorAll('.filter-chip').forEach(btn => {
      const isActive = btn.dataset.imam === activeFilter;
      btn.classList.toggle('active', isActive);
      if (isActive) btn.style.setProperty('--pulse-color', imamColors[btn.dataset.imam] || 'rgba(0,0,0,0.3)');
      else btn.style.removeProperty('--pulse-color');
    });
    document.querySelectorAll('#table-body tr').forEach(tr => {
      const chip = tr.querySelector('.imam-chip');
      const show = !activeFilter || (chip && chip.classList.contains('imam-' + activeFilter));
      tr.classList.toggle('filtered-out', !show);
    });
    document.querySelectorAll('#mobile-cards .day-card-mobile').forEach(card => {
      const chip = card.querySelector('.imam-chip');
      const show = !activeFilter || (chip && chip.classList.contains('imam-' + activeFilter));
      card.classList.toggle('filtered-out', !show);
    });
    const visibleRows  = [...document.querySelectorAll('#table-body tr:not(.filtered-out)')];
    const visibleCards = [...document.querySelectorAll('#mobile-cards .day-card-mobile:not(.filtered-out)')];
    const lastDelay = Math.max(
      visibleRows.length  ? (visibleRows.length  - 1) * 45 + 320 : 0,
      visibleCards.length ? (visibleCards.length - 1) * 55 + 320 : 0
    );
    visibleRows.forEach((tr, i) => {
      tr.style.opacity='0'; tr.style.transform='translateY(8px)'; tr.style.transition='opacity 0.3s ease,transform 0.3s ease';
      setTimeout(() => { tr.style.opacity='1'; tr.style.transform='translateY(0)'; setTimeout(() => { tr.style.transition='background .15s'; tr.style.opacity=''; tr.style.transform=''; }, 320); }, i*45);
    });
    visibleCards.forEach((card, i) => {
      card.style.opacity='0'; card.style.transform='translateY(10px)'; card.style.transition='opacity 0.3s ease,transform 0.3s ease';
      setTimeout(() => { card.style.opacity='1'; card.style.transform='translateY(0)'; setTimeout(() => { card.style.transition=''; card.style.opacity=''; card.style.transform=''; }, 320); }, i*55);
    });
    setTimeout(() => { document.body.style.width=''; document.body.style.overflowY=''; }, lastDelay + 50);
  }

</script>

<!-- STICKY BOTTOM PLAYER -->
<div class="sticky-player" id="sticky-player">
  <div class="player-full">
    <div class="sticky-top-row">
      <span class="sticky-day-badge" id="sticky-imam-label">â€“</span>
      <span class="sticky-day-sub" id="sticky-day-label"></span>
      <div class="sticky-marquee-wrap" id="sticky-marquee-wrap">
        <div class="sticky-marquee-inner" id="sticky-marquee-inner">
          <span class="sticky-marquee-text" id="sticky-marquee-text"></span>
          <span class="sticky-marquee-text" id="sticky-marquee-text2" aria-hidden="true"></span>
        </div>
      </div>
      <span class="sticky-times"><span id="sticky-cur">0:00</span> / <span id="sticky-dur">0:00</span></span>
    </div>
    <div class="sticky-seek-row">
      <div class="sticky-seek" id="sticky-seek">
        <div class="sticky-seek-fill" id="sticky-fill"></div>
        <div class="sticky-seek-thumb" id="sticky-thumb"></div>
      </div>
    </div>
    <div class="sticky-controls">
      <div class="sticky-ctrl-left">
        <button class="sticky-ctrl-btn" id="sticky-prev" title="FÃ¶regÃ¥ende dag">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h2v12H6zm3.5 6 8.5 6V6z"/></svg>
        </button>
      </div>
      <button class="sticky-play-main" id="sticky-play-btn" aria-label="Spela/Pausa">
        <span class="spm-icon-wrap" aria-hidden="true">
          <svg class="spm-play" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <polygon points="7,3 21,12 7,21"/>
          </svg>
          <svg class="spm-pause" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <rect x="6" y="3" width="4" height="18" rx="1.5"/>
            <rect x="14" y="3" width="4" height="18" rx="1.5"/>
          </svg>
        </span>
      </button>
      <div class="sticky-ctrl-right">
        <button class="sticky-ctrl-btn" id="sticky-next" title="NÃ¤sta dag">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18 6h-2v12h2zm-3.5 6L6 6v12z"/></svg>
        </button>
        <button class="sticky-ctrl-btn sticky-mute-btn" id="sticky-mute" title="Ljud av/pÃ¥">
          <svg id="mute-icon-on" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
            <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
            <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
          </svg>
          <svg id="mute-icon-off" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none;">
            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
            <line x1="23" y1="9" x2="17" y2="15"/>
            <line x1="17" y1="9" x2="23" y2="15"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
  <div class="player-mini">
    <div class="mini-bar-track">
      <div class="mini-bar-fill" id="mini-fill"></div>
      <div id="mini-thumb"></div>
    </div>
    <div class="mini-text-row">
      <span class="mini-name" id="mini-name-display">â€“</span>
      <span class="mini-time" id="mini-time-display">0:00 / 0:00</span>
    </div>
  </div>
</div>

</body>
</html>
